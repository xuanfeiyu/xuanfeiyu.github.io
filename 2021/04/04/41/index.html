<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="JavaScipt," />










<meta name="description" content="作者：FY引用请标明出处  Part 4 · React 框架原理与实战模块四 · React 服务端渲染专题（原生实现、Next.js 集成框架、Gatsby）任务一：ReactSSR1.ReactSSR相关观念回顾 什么是客户端渲染  CSR：Client Side Rendering 服务端仅返回 JSON 数据，DATA 和 HTML 在客户端进行渲染.  什么是服务器端渲染  SSR：">
<meta property="og:type" content="article">
<meta property="og:title" content="学习笔记 ----- 【React 框架原理与实战】React 服务端渲染专题（原生实现、Next.js 集成框架、Gatsby）">
<meta property="og:url" content="http://yoursite.com/2021/04/04/41/index.html">
<meta property="og:site_name" content="旋の飞羽">
<meta property="og:description" content="作者：FY引用请标明出处  Part 4 · React 框架原理与实战模块四 · React 服务端渲染专题（原生实现、Next.js 集成框架、Gatsby）任务一：ReactSSR1.ReactSSR相关观念回顾 什么是客户端渲染  CSR：Client Side Rendering 服务端仅返回 JSON 数据，DATA 和 HTML 在客户端进行渲染.  什么是服务器端渲染  SSR：">
<meta property="article:published_time" content="2021-04-03T16:00:00.000Z">
<meta property="article:modified_time" content="2021-05-12T12:15:07.284Z">
<meta property="article:author" content="FY">
<meta property="article:tag" content="JavaScipt">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2021/04/04/41/"/>





  <title>学习笔记 ----- 【React 框架原理与实战】React 服务端渲染专题（原生实现、Next.js 集成框架、Gatsby） | 旋の飞羽</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">旋の飞羽</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人间值得，未来可期。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/04/04/41/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旋の飞羽">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">学习笔记 ----- 【React 框架原理与实战】React 服务端渲染专题（原生实现、Next.js 集成框架、Gatsby）</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-04T00:00:00+08:00">
                2021-04-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>作者：FY<br>引用请标明出处</p>
</blockquote>
<h1 id="Part-4-·-React-框架原理与实战"><a href="#Part-4-·-React-框架原理与实战" class="headerlink" title="Part 4 · React 框架原理与实战"></a>Part 4 · React 框架原理与实战</h1><h2 id="模块四-·-React-服务端渲染专题（原生实现、Next-js-集成框架、Gatsby）"><a href="#模块四-·-React-服务端渲染专题（原生实现、Next-js-集成框架、Gatsby）" class="headerlink" title="模块四 · React 服务端渲染专题（原生实现、Next.js 集成框架、Gatsby）"></a>模块四 · React 服务端渲染专题（原生实现、Next.js 集成框架、Gatsby）</h2><h2 id="任务一：ReactSSR"><a href="#任务一：ReactSSR" class="headerlink" title="任务一：ReactSSR"></a>任务一：ReactSSR</h2><h3 id="1-ReactSSR相关观念回顾"><a href="#1-ReactSSR相关观念回顾" class="headerlink" title="1.ReactSSR相关观念回顾"></a>1.ReactSSR相关观念回顾</h3><blockquote>
<p>什么是客户端渲染</p>
</blockquote>
<p>CSR：Client Side Rendering</p>
<p>服务端仅返回 JSON 数据，DATA 和 HTML 在客户端进行渲染.</p>
<blockquote>
<p>什么是服务器端渲染</p>
</blockquote>
<p>SSR：Server Side Rendering</p>
<p>服务器端返回 HTML，DATA和HTML在服务器端进行渲染.</p>
<blockquote>
<p>客户端渲染存在的问题</p>
</blockquote>
<p>1.首屏等待时间长，用户体验差<br>2.页面结构为空，不利于SEO</p>
<blockquote>
<p>React SSR 同构</p>
</blockquote>
<p>同构指的是代码复用，即实现客户端和服务端最大程度的代码复用.</p>
<h3 id="2-项目结构初始化"><a href="#2-项目结构初始化" class="headerlink" title="2.项目结构初始化"></a>2.项目结构初始化</h3><ul>
<li>react-ssr<ul>
<li>src 源代码文件夹<ul>
<li>client 客户端代码</li>
<li>server 服务端代码</li>
<li>share 同构代码</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="3-实现ReactSSR雏形"><a href="#3-实现ReactSSR雏形" class="headerlink" title="3.实现ReactSSR雏形"></a>3.实现ReactSSR雏形</h3><blockquote>
<p>创建 Node 服务器</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">'express'</span>;</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line">app.use(express.static(<span class="string">'public'</span>));</span><br><span class="line">app.listen(<span class="number">3000</span>,()=&gt;<span class="built_in">console</span>.log(<span class="string">"server is listening on 3000 port"</span>));</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> app;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>实现 React SSR</p>
</blockquote>
<p>1.引入要渲染的 React 组件<br>2.通过 renderToString 方法将 React 组件转换为 HTML 字符串<br>3.将结果HTML字符串响应到客户端</p>
<p>renderToString 方法用于将 React 组件转换为 HTML 字符串，通过 react-dom/server 导入</p>
<h3 id="4-服务器端程序webpack打包配置"><a href="#4-服务器端程序webpack打包配置" class="headerlink" title="4.服务器端程序webpack打包配置"></a>4.服务器端程序webpack打包配置</h3><blockquote>
<p>webpack 打包配置</p>
</blockquote>
<p>问题：Node 环境不支持 ESModule 模块系统，不支持 JSX 语法.</p>
<blockquote>
<p>项目启动命令配置</p>
</blockquote>
<p>1.配置服务端打包命令：”dev:server-build”:”webpack –config webpack.server.js –watch”<br>2.配置服务端启动命令：”dev:server-run”:”nodemon –watch build –exec&quot;node build/bundle.js&quot;“</p>
<h3 id="5-为组件元素附加事件的方式"><a href="#5-为组件元素附加事件的方式" class="headerlink" title="5.为组件元素附加事件的方式"></a>5.为组件元素附加事件的方式</h3><blockquote>
<p>实现思路分析</p>
</blockquote>
<p>在客户端对组件进行二次“渲染”，为组件元素附加事件。</p>
<blockquote>
<p>客户端二次“渲染”hydrate</p>
</blockquote>
<p>使用 hydrate 方法对组件进行渲染，为组件元素附加事件.<br>hydrate 方法在实现渲染的时候，会复用原本已经存在的DOM节点，减少重新生成节点以及删除原本DOM节点的开销.<br>通过 react-dom 导入 hydrate.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.hydrate(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>,<span class="built_in">document</span>.QuerySelector(<span class="string">"#root"</span>))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>客户端 React 打包配置</p>
</blockquote>
<p>1.webpack 配置</p>
<p>打包目的：转换 JSX 语法，转换浏览器不识别的高级 JavaScript 语法<br>打包目标位置：public 文件夹</p>
<p>2.打包启动命令配置</p>
<p>“dev:client-build”:”webpack –config webpack.client.js –watch”</p>
<blockquote>
<p>添加客户端包文件请求链接</p>
</blockquote>
<p>在响应给客户端的 HTML 代码中添加 script 标签，请求客户端 JavaScript 打包文件.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">htmL</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>React SSR<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span>$&#123;content&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"bundle.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>服务端实现静态资源访问</p>
</blockquote>
<p>服务端程序实现静态资源访问功能，客户端 JavaScript 打包文件会被作为静态资源使用.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(express.static(<span class="string">'public'</span>));</span><br></pre></td></tr></table></figure>

<h3 id="6-优化：合并webpack配置"><a href="#6-优化：合并webpack配置" class="headerlink" title="6.优化：合并webpack配置"></a>6.优化：合并webpack配置</h3><p>服务端 webpack 配置和客户端 webpack 配置存在重复，将重复配置抽象到 webpack.base.js 配置文件中.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base'</span>);</span><br><span class="line"><span class="keyword">const</span> config = &#123; ... &#125;</span><br><span class="line"><span class="built_in">module</span>.exporets = merge(baseConfig,config);</span><br></pre></td></tr></table></figure>

<h3 id="7-优化：合并项目启动命令"><a href="#7-优化：合并项目启动命令" class="headerlink" title="7.优化：合并项目启动命令"></a>7.优化：合并项目启动命令</h3><p>目的：使用一个命令启动项目，解决多个命令启动的繁琐问题，通过 npm-run-all 工具实现.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"dev"</span>: <span class="string">"npm-run-all --parallel dev:*"</span></span><br></pre></td></tr></table></figure>

<h3 id="8-优化：服务器端打包文件体积优化"><a href="#8-优化：服务器端打包文件体积优化" class="headerlink" title="8.优化：服务器端打包文件体积优化"></a>8.优化：服务器端打包文件体积优化</h3><p>问题：在服务端打包文件中，包含了 Node 系统模块，导致打包文件本身体积庞大.<br>解决：通过 webpack 配置剔除打包文件中的 Node 模块.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.server.js</span></span><br><span class="line"><span class="keyword">const</span> nodeExternals = <span class="built_in">require</span>(<span class="string">'webpack-node-exteernals'</span>);</span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">    externals: [nodeExternals()]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-优化：代码拆分"><a href="#9-优化：代码拆分" class="headerlink" title="9.优化：代码拆分"></a>9.优化：代码拆分</h3><blockquote>
<p>将启动服务器代码和渲染代码进行模块化拆分</p>
</blockquote>
<p>优化代码组织方式，渲染 React 组件代码是独立功能，所以把它从服务器端入口文件中进行抽离.</p>
<h3 id="10-实现服务器端路由"><a href="#10-实现服务器端路由" class="headerlink" title="10.实现服务器端路由"></a>10.实现服务器端路由</h3><blockquote>
<p>实现思路分析</p>
</blockquote>
<p>在 React SSR 项目中需要实现两端路由.<br>客户端路由是用于支持用户通过点击链接的形式跳转页面.<br>服务端路由是用于支持用户直接从浏览器地址栏中访问页面.<br>客户端和服务端公用一套路由规则.</p>
<blockquote>
<p>编写路由规则</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> HomePage <span class="keyword">from</span> <span class="string">'./pages/HomePage'</span>;</span><br><span class="line"><span class="keyword">import</span> ListPage <span class="keyword">from</span> <span class="string">'./pages/ListPage'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [&#123;</span><br><span class="line">    path: <span class="string">'/'</span>,</span><br><span class="line">    component: HomePage,</span><br><span class="line">    exact: <span class="literal">true</span></span><br><span class="line">&#125;,&#123;</span><br><span class="line">    path: <span class="string">'/list'</span>,</span><br><span class="line">    ...ListPage</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>实现服务端路由</p>
</blockquote>
<p>1.Express 路由接收任何请求</p>
<p>Express 路由接收所有 GET 请求，服务端 React 路由通过请求路径匹配要进行渲染的组件.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">"*“， async(req, res) =&gt; &#123;&#125;);</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>实现服务端路由</p>
</blockquote>
<p>2.服务端路由配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; StaticRouter &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; renderRoutes &#125; <span class="keyword">from</span> <span class="string">"react-router-config"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> req = &#123;</span><br><span class="line">    <span class="keyword">const</span> content = renderToString(</span><br><span class="line">        &lt;StaticRouter location=&#123;req.path&#125;&gt;</span><br><span class="line">          &#123;renderRoutes(routes)&#125;</span><br><span class="line">        &lt;<span class="regexp">/StaticRouter&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="11-实现客户端路由"><a href="#11-实现客户端路由" class="headerlink" title="11.实现客户端路由"></a>11.实现客户端路由</h3><p>2.添加客户端路由配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BrowserRouter &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; renderRoutes &#125; <span class="keyword">from</span> <span class="string">"react-router-config"</span>;</span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">"../share/routes"</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.hydrate(</span><br><span class="line">    &lt;BrowsRouter&gt;&#123;renderRoutes(routes)&#125;&lt;<span class="regexp">/BrowsRouter&gt;,</span></span><br><span class="line"><span class="regexp">    document.querySelector('#root')</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure>

<h3 id="12-实现客户端Redux"><a href="#12-实现客户端Redux" class="headerlink" title="12.实现客户端Redux"></a>12.实现客户端Redux</h3><blockquote>
<p>实现思路分析</p>
</blockquote>
<p>在实现了 React SSR 的项目中需要实现两端 Redux.<br>客户端 Redux 就是通过客户端 JavaScript 管理 Store 中的数据.<br>服务器端 Redux 就是在服务器端搭建一套 Redux 代码，用于管理组件中的数据.<br>客户端和服务器端共用一套 Reducer 代码.<br>创建 Store 的代码由于参数传递不同所以不可以共用.</p>
<h3 id="13-实现服务器端Redux-一"><a href="#13-实现服务器端Redux-一" class="headerlink" title="13.实现服务器端Redux(一)"></a>13.实现服务器端Redux(一)</h3><p>1.创建 Store</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</span><br><span class="line"><span class="keyword">import</span> reducers <span class="keyword">from</span> <span class="string">'../share/store/reducers'</span>;</span><br><span class="line"></span><br><span class="line">expport <span class="keyword">default</span> () =&gt; createStore(reducers, &#123;&#125;, apllyMiddleware(thunk));</span><br></pre></td></tr></table></figure>

<p>2.配置 Store</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">"*"</span>, <span class="keyword">async</span>(req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> store = createStore();</span><br><span class="line">    res.send(renderer(req,store))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (req, store) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> content = renderToString(</span><br><span class="line">      &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">        &lt;StaticRouter location=&#123;req.path&#125;&gt;</span><br><span class="line">          &#123;renderRoutes(routes)&#125;</span><br><span class="line">        &lt;<span class="regexp">/StaticRouter&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-实现服务器端Redux-二"><a href="#14-实现服务器端Redux-二" class="headerlink" title="14.实现服务器端Redux(二)"></a>14.实现服务器端Redux(二)</h3><blockquote>
<p>服务器端 store 数据填充</p>
</blockquote>
<p>问题：服务器端创建的 store 是空的，组件并不能从 Store 中获取到任何数据.<br>解决：服务器端在渲染组件之前获取到组件所需要的数据.</p>
<p>1.在组件中添加 loadData 方法，此方法用于获取组件所需数据，方法被服务器端调用.<br>2.将 loadData 方法保存在当前组件的路由信息对象中.<br>3.服务器端在接收到请求后，根据请求地址匹配出要渲染的组件的路由信息.<br>4.从路由信息中获取组件中的 loadData 方法并调用方法获取组件所需数据.<br>5.当数据获取完成以后再渲染组件并将结果响应到客户端.</p>
<h3 id="15-实现服务器端Redux-三"><a href="#15-实现服务器端Redux-三" class="headerlink" title="15.实现服务器端Redux(三)"></a>15.实现服务器端Redux(三)</h3><blockquote>
<p>React 警告消除</p>
</blockquote>
<p>警告原因：客户端 Store 在初始状态下是没有数据的，在渲染组件的时候生成的是空 ul，但是服务器端是先获取数据再进行组件渲染，所以生成的是有子元素的ul，hydrate 方法在对比的时候发现两者不一致，所以报了警告.<br>解决思路：将服务器端获取到的数据回填给客户端，让客户端拥有初始数据.</p>
<p>1.服务器响应 Store 初始状态</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = store.getState();</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div id=<span class="string">"root"</span>&gt;$&#123;content&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;script&gt;window.INITIAL_STATE = $&#123;initialState&#125;&lt;/</span>script&gt;</span><br><span class="line">  &lt;script src=<span class="string">"bundle.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br></pre></td></tr></table></figure>

<p>2.客户端设置 Store 初始状态</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> store = createStore(</span><br><span class="line">    reducers,</span><br><span class="line">    <span class="built_in">window</span>.INITIAL_STATE,</span><br><span class="line">    applyMiddleware(thunk)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="16-防止XSS攻击"><a href="#16-防止XSS攻击" class="headerlink" title="16.防止XSS攻击"></a>16.防止XSS攻击</h3><p>转义状态的恶意代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> reaponse = &#123;</span><br><span class="line">    data: [&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">"&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;"</span>&#125;]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">import</span> serialize <span class="keyword">from</span> <span class="string">'serialaze-javascript'</span>;</span><br><span class="line"><span class="keyword">const</span> initialState = serialize(store.getState());</span><br></pre></td></tr></table></figure>

<h2 id="任务二：Next"><a href="#任务二：Next" class="headerlink" title="任务二：Next"></a>任务二：Next</h2><h3 id="1-Next-js整体介绍"><a href="#1-Next-js整体介绍" class="headerlink" title="1.Next.js整体介绍"></a>1.Next.js整体介绍</h3><p>Next.js 是 React 服务端渲染应用框架，用于构建 SEO 友好的 SPA 应用.</p>
<p>1.支持两种预渲染方式，静态生成和服务端渲染.<br>2.基于页面的路由系统，路由零配置.<br>3.自动代码拆分，优化页面加载速度.<br>4.支持静态导出，可将应用导出为静态网站.<br>5.内置CSS-in-JS库styled-jsx.<br>6.方案成熟，可用于生产环境，世界许多公司都在使用.<br>7.应用部署简单，拥有专属部署环境 Vercel，也可以部署在其他环境.</p>
<h3 id="2-创建Next项目"><a href="#2-创建Next项目" class="headerlink" title="2.创建Next项目"></a>2.创建Next项目</h3><p>创建：npm init next-app next-guide<br>运行：npm run dev<br>访问：localhost:3000</p>
<p>临时安装 create-next-app 用于创建 Next.js 项目</p>
<h3 id="3-基于页面的路由系统-创建页面"><a href="#3-基于页面的路由系统-创建页面" class="headerlink" title="3.基于页面的路由系统-创建页面"></a>3.基于页面的路由系统-创建页面</h3><p>在 Next.js 中，页面是被放置在 pages 文件夹中的 React 组件.<br>组件需要被默认导出.<br>组件文件中不需要引入 React.<br>页面地址与文件地址是对应的关系.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/list.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">List</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>List page works<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>pages/index.js       /<br>pages/list.js        /list<br>pages/post/first.js  /post/first</p>
<h3 id="4-基于页面的路由系统-页面跳转"><a href="#4-基于页面的路由系统-页面跳转" class="headerlink" title="4.基于页面的路由系统-页面跳转"></a>4.基于页面的路由系统-页面跳转</h3><blockquote>
<p>页面跳转</p>
</blockquote>
<p>Link 组件默认使用 JavaScript 进行页面跳转，既 SPA 形式的跳转.<br>如果浏览器中 JavaScript 被禁用，则使用链接跳转.<br>Link 组件中不应该添加出 href 属性以外的属性，其余属性添加到a标签上.<br>Link 组件通过预取（在生产中）功能自动优化应用程序以获得最佳性能.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'next/link'</span>;</span><br><span class="line">&lt;Link href=<span class="string">"/list"</span>&gt;<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">title</span>=<span class="string">"list page"</span>&gt;</span>list page<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>&lt;<span class="regexp">/Link&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-Next应用中的静态资源访问"><a href="#5-Next应用中的静态资源访问" class="headerlink" title="5.Next应用中的静态资源访问"></a>5.Next应用中的静态资源访问</h3><blockquote>
<p>静态资源</p>
</blockquote>
<p>应用程序根目录中的 public 文件夹用于提供静态资源.</p>
<p>通过以下形式进行访问.<br>public/images/1.jpg -&gt; /images/1.jpg<br>public/css/base.css -&gt; /css/base.css</p>
<h3 id="6-修改页面中的元数据"><a href="#6-修改页面中的元数据" class="headerlink" title="6.修改页面中的元数据"></a>6.修改页面中的元数据</h3><p>通过 Head 组件修改元数据.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Head <span class="keyword">from</span> <span class="string">'next/head'</span>;</span><br><span class="line">&lt;&gt;</span><br><span class="line">  &lt;Head&gt;</span><br><span class="line">    &lt;title&gt;Index Page&lt;<span class="regexp">/title&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Head&gt;</span><br><span class="line">&lt;<span class="regexp">/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-Next应用中添加样式的方式"><a href="#7-Next应用中添加样式的方式" class="headerlink" title="7.Next应用中添加样式的方式"></a>7.Next应用中添加样式的方式</h3><blockquote>
<p>内置 style-jsx</p>
</blockquote>
<p>在 Next.js 中内置了 style-jsx,它是一个 CSS-in-JS，允许在 React 组件中编写CSS，CSS仅作用于组件内部.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;Link href=<span class="string">"/list"</span>&gt;</span><br><span class="line">  &lt;a className=<span class="string">"Demo"</span>&gt;jump to list page&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">&lt;Link&gt;</span></span><br><span class="line"><span class="regexp">&lt;style jsx&gt;&#123;`</span></span><br><span class="line"><span class="regexp">.demo &#123;</span></span><br><span class="line"><span class="regexp">    color: red;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">`&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>CSS 模块</p>
</blockquote>
<p>通过使用 CSS 模块功能，允许将组件的 CSS 样式编写在单独的 CSS 文件中.<br>CSS 模块约定样式文件的名称必须为“组件文件名称.module.css”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.module.css</span></span><br><span class="line">.p &#123; <span class="attr">color</span>: green &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./index.module.css'</span>;</span><br><span class="line">&lt;div className=&#123;styles.p&#125;&gt;&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>全局样式文件</p>
</blockquote>
<p>1.在pages文件夹中新建_app.js文件并加入如下代码<br>2.在项目根目录下创建styles文件夹，并在其中创建global.css<br>3.在_app.js中通过import引入global.css.<br>4.重新启动开发服务器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params">&#123; Component, pageProps &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123; <span class="attr">...pageProps</span> &#125; /&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-预渲染介绍"><a href="#8-预渲染介绍" class="headerlink" title="8.预渲染介绍"></a>8.预渲染介绍</h3><blockquote>
<p>预渲染概述</p>
</blockquote>
<p>预渲染是指数据和HTML的拼接在服务器端提前完成.<br>预渲染可以使 SEO 更加友好.<br>预渲染会带来更好的用户体验，可以无需运行 JavaScript 即可查看应用程序 UI.</p>
<blockquote>
<p>预渲染的两种形式</p>
</blockquote>
<p>在 Next.js 中支持两种形式的预渲染：静态生成和服务器端渲染.<br>静态生成和服务器端渲染是生成 HTML 的时机不同.<br>静态生成：静态生成是在构建时生成 HTML.以后的每个请求都共用构建时生成好的 HTML.<br>服务器端渲染：服务器端渲染是在请求时生成 HTML。每个请求都会重新生成 HTML.</p>
<blockquote>
<p>两种预渲染方式的选择</p>
</blockquote>
<p>Next.js 允许开发者为每个页面选择不同的预渲染方式，不同的预渲染方式拥有不同的特点.应根据场景进行渲染.<br>但大多数页面建议使用静态生成.<br>静态生成一次构建，反复使用，访问速度快.因为页面都是事先生成好的.<br>使用场景：营销页面、博客文章、电子商务产品列表、帮助和文档.<br>服务器端渲染访问速度不如静态生成快，但是由于每次请求都会重新渲染，所以使用数据频繁更新的页面或页面内容随请求变化而变化的页面.</p>
<h3 id="9-实现静态生成"><a href="#9-实现静态生成" class="headerlink" title="9.实现静态生成"></a>9.实现静态生成</h3><blockquote>
<p>无数据和有数据的静态生成</p>
</blockquote>
<p>如果组件不需要在其他地方获取数据，直接进行静态生成.<br>如果组件需要在其他地方获取数据，在构建时 Next.js 会预先获取组件需要的数据，然后再对组件进行静态生成.</p>
<blockquote>
<p>静态生成 getStaticProps</p>
</blockquote>
<p>getStaticProps 方法的作用是获取组件静态生成需要的数据.并通过 props 的方式将数据传递给组件.<br>该方法是一个异步函数，需要在组件内部进行导出.<br>在开发模式下，getStaticProps 改为在每个请求上运行.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getStaticProps</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 从文件系统，API，数据库中获取的数据</span></span><br><span class="line">  <span class="keyword">const</span> data = ...</span><br><span class="line">  <span class="comment">// props 属性的值将会传递给组件</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    props: ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-实现服务器端渲染"><a href="#10-实现服务器端渲染" class="headerlink" title="10.实现服务器端渲染"></a>10.实现服务器端渲染</h3><blockquote>
<p>服务器端渲染 getServerSideProps</p>
</blockquote>
<p>如果采用服务器端渲染，需要在组件中导出 getServerSideProps 方法.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getServerSideProps</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// context 中包含特定的请求参数</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    props: &#123;</span><br><span class="line">      <span class="comment">// props for your component</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-实现基于动态路由的静态生成"><a href="#11-实现基于动态路由的静态生成" class="headerlink" title="11.实现基于动态路由的静态生成"></a>11.实现基于动态路由的静态生成</h3><blockquote>
<p>基于动态路由的静态生成</p>
</blockquote>
<p>基于参数为页面组件生成 HTML 页面，有多少参数就生成多少 HTML 页面<br>在构建应用时，先获取用户可以访问的所有路由参数，再根据路由参数获取具体数据，然后根据数据生成静态 HTML</p>
<blockquote>
<p>实现基于动态路由的静态生成</p>
</blockquote>
<p>1.创建基于动态路由的页面组件文件，命名时在文件名称外面加上[]，比如[id].js<br>2.导出异步函数 getStaticPaths，用于获取所有用户可以访问的路由参数.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getStaticPaths</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">// 此处获取所有用户可以访问的路由参数</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 返回固定格式的路由参数</span></span><br><span class="line">    paths: [&#123;<span class="attr">params</span>:&#123;<span class="attr">id</span>:<span class="number">1</span>&#125;&#125;, &#123;<span class="attr">params</span>:&#123;<span class="attr">id</span>:<span class="number">2</span>&#125;&#125;],</span><br><span class="line">    当用户访问的路由参数没有在当前函数中返回时，是否显示<span class="number">404</span>页面 <span class="literal">false</span>：显示 <span class="literal">true</span> 不显示</span><br><span class="line">    fallback: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：getStaticPaths 和 getStaticProps 只运行在服务器端，永远不会运行在客户端，甚至不会被打包到客户端 JavaScript 中，意味着这里可以随意写服务端代码，比如查询数据库.</p>
<h3 id="12-fallback选项的作用"><a href="#12-fallback选项的作用" class="headerlink" title="12.fallback选项的作用"></a>12.fallback选项的作用</h3><p>略</p>
<h3 id="13-自定义404页面"><a href="#13-自定义404页面" class="headerlink" title="13.自定义404页面"></a>13.自定义404页面</h3><p>要创建自定义 404 页面，需要在 pages 文件夹中创建 404.js 文件.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Custom404</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>404 - Page Not Found<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-API-Routes"><a href="#14-API-Routes" class="headerlink" title="14.API Routes"></a>14.API Routes</h3><blockquote>
<p>什么是 API Routes</p>
</blockquote>
<p>API Routes 可以理解为接口，客户端向服务器端发送请求获取数据的接口.<br>Next.js 应用允许 React 开发者编写服务器端代码创建数据接口.</p>
<blockquote>
<p>如何实现 API Routes</p>
</blockquote>
<p>1.在 pages/api 文件夹中创建 API Routes 文件，比如 user.js<br>2.在文件中默认导出请求处理数据，函数有两个参数，req为请求对象，res为响应对象.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.status(<span class="number">200</span>).send(&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">'Tom'</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：当前 API Routes 可以接收任何 Http 请求方法.</p>
<p>3.访问 API Routes：localhost:3000/api/user</p>
<p>不要在 getStaticPaths 或 getStaticProps 函数中访问 API Routes，因为这两个函数就是在服务器端运行的，可以直接写服务器端代码.</p>
<h3 id="15-案例代码初始化配置"><a href="#15-案例代码初始化配置" class="headerlink" title="15.案例代码初始化配置"></a>15.案例代码初始化配置</h3><ul>
<li>npm init next-app movie</li>
<li>npm install @chakra-ui/core@next</li>
<li>npx chakra-cli init –theme</li>
<li>npm install @emotion/babel-preset-css-prop –save</li>
</ul>
<h3 id="16-实现头部组件布局"><a href="#16-实现头部组件布局" class="headerlink" title="16.实现头部组件布局"></a>16.实现头部组件布局</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/Header.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;Box, Container, Button, Image &#125; <span class="keyword">from</span> <span class="string">'@chakra-ui/core'</span>; leftIcon=&#123;&lt;<span class="regexp">/&gt;&#125;</span></span><br><span class="line"><span class="regexp">import styled from "@emotion/</span>styled<span class="string">";</span></span><br><span class="line"><span class="string">import &#123; css &#125; from "</span>@emotion/core<span class="string">";</span></span><br><span class="line"><span class="string">import &#123; FaSignInAlt, FaSearch &#125; from "</span>react-icons/fa<span class="string">";</span></span><br><span class="line"><span class="string">import &#123; BsFillPersonFill &#125; from "</span>react-icons/bs<span class="string">";</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const log = css`</span></span><br><span class="line"><span class="string">  position: absolute;</span></span><br><span class="line"><span class="string">  left: 50%;</span></span><br><span class="line"><span class="string">  top: 50%;</span></span><br><span class="line"><span class="string">  transform: translate(-50%, -50%);</span></span><br><span class="line"><span class="string">  width: 140px;</span></span><br><span class="line"><span class="string">`;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const SignInAndJoin = styled.div`</span></span><br><span class="line"><span class="string">  height: 52px;</span></span><br><span class="line"><span class="string">  line-height: 52px;</span></span><br><span class="line"><span class="string">  border-left: 1px solid #393939;</span></span><br><span class="line"><span class="string">  border-right: 1px solid #393939;</span></span><br><span class="line"><span class="string">  padding: 0 6px;</span></span><br><span class="line"><span class="string">  float: left;</span></span><br><span class="line"><span class="string">  color: #fff;</span></span><br><span class="line"><span class="string">  &amp; &gt; button &#123;</span></span><br><span class="line"><span class="string">    padding: 0 10px;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  &amp; &gt; button: nth-of-type(1):after &#123;</span></span><br><span class="line"><span class="string">    content: "</span><span class="string">";</span></span><br><span class="line"><span class="string">    width: 1px;</span></span><br><span class="line"><span class="string">    height: 10px;</span></span><br><span class="line"><span class="string">    background: #fff;</span></span><br><span class="line"><span class="string">    position: absolute;</span></span><br><span class="line"><span class="string">    right: 0;</span></span><br><span class="line"><span class="string">    top: 21px;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const Search = styled.a`</span></span><br><span class="line"><span class="string">  float: right;</span></span><br><span class="line"><span class="string">  height: 52px;</span></span><br><span class="line"><span class="string">  border-left: 1px solid #393939;</span></span><br><span class="line"><span class="string">  border-right: 1px solid #393939;</span></span><br><span class="line"><span class="string">  color: #FFF;</span></span><br><span class="line"><span class="string">  font-size: 20px;</span></span><br><span class="line"><span class="string">  padding: 0 10px;</span></span><br><span class="line"><span class="string">  display: flex;</span></span><br><span class="line"><span class="string">  align-items: center;</span></span><br><span class="line"><span class="string">`;</span></span><br><span class="line"><span class="string">export default function Header() &#123;</span></span><br><span class="line">  return &lt;Box h=&#123;52&#125; bgColor="#202020" borderBottom="1px solid #393939"&gt;</span><br><span class="line">    &lt;Container h=&#123;<span class="number">52</span>&#125; maxW=&#123;<span class="number">1200</span>&#125; pos=<span class="string">"realtive"</span>&gt;</span><br><span class="line">      &lt;SignInAndJoin&gt;</span><br><span class="line">        &lt;Button leftIcon=&#123;&lt;FaSignInAlt/&gt;&#125;&gt;登录&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Button leftIcon=&#123;&lt;BsFillPersonFill/</span>&gt;&#125;&gt;注册&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>SignInAndJoin&gt;</span><br><span class="line">      &lt;Image css=&#123;logo&#125; src=<span class="string">"/images/logo.png"</span>/&gt;</span><br><span class="line">      &lt;Search&gt;</span><br><span class="line">        &lt;FaSearch/&gt;</span><br><span class="line">      &lt;<span class="regexp">/Search&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Container&gt;</span><br><span class="line">  &lt;<span class="regexp">/Box&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="17-实现导航组件布局"><a href="#17-实现导航组件布局" class="headerlink" title="17.实现导航组件布局"></a>17.实现导航组件布局</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/Navigation.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; Box, HStack &#125; <span class="keyword">from</span> <span class="string">'@chakra-ui/core'</span>;</span><br><span class="line"><span class="keyword">import</span> Link <span class="keyword">from</span> <span class="string">'next/link'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Navigation</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Box</span> <span class="attr">h</span>=<span class="string">&#123;52&#125;</span> <span class="attr">bgColor</span>=<span class="string">"#202020"</span> <span class="attr">color</span>=<span class="string">"#FFF"</span>&gt;</span></span></span><br><span class="line">    &lt;HStack h=&#123;52&#125; spacing=&#123;3&#125; justifyContent="center" alignItems="center"&gt;</span><br><span class="line">      &lt;Link href="#"&gt;&lt;a&gt;影片&lt;/a&gt;&lt;/Link&gt;</span><br><span class="line">      &lt;Link href="#"&gt;&lt;a&gt;漫画&lt;/a&gt;&lt;/Link&gt;</span><br><span class="line">      &lt;Link href="#"&gt;&lt;a&gt;电影&lt;/a&gt;&lt;/Link&gt;</span><br><span class="line">      &lt;Link href="#"&gt;&lt;a&gt;电视&lt;/a&gt;&lt;/Link&gt;</span><br><span class="line">      &lt;Link href="#"&gt;&lt;a&gt;新闻&lt;/a&gt;&lt;/Link&gt;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">HStack</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Box</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="18-实现轮播图组件布局"><a href="#18-实现轮播图组件布局" class="headerlink" title="18.实现轮播图组件布局"></a>18.实现轮播图组件布局</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/Swiper.js</span></span><br><span class="line"><span class="comment">// import "react-reaponsive-carousel/lib/styles/carousel.min.css";</span></span><br><span class="line"><span class="keyword">import</span> &#123; Carousel &#125; <span class="keyword">from</span> <span class="string">"react-reaponsive-carousel"</span>;</span><br><span class="line"><span class="keyword">import</span> Head <span class="keyword">from</span> <span class="string">'next/head'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; css &#125; <span class="keyword">from</span> <span class="string">'@emotion/core'</span>;</span><br><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'@emotion/styled'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Box, Heading, Text, Button &#125; <span class="keyword">from</span> <span class="string">'@chakra-ui/core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CarouselItem = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">  position: relative;</span></span><br><span class="line"><span class="string">  &amp; &gt; div &#123;</span></span><br><span class="line"><span class="string">    position: absolute;</span></span><br><span class="line"><span class="string">    left: 50%;</span></span><br><span class="line"><span class="string">    top: 0;</span></span><br><span class="line"><span class="string">    transform: translateX(-50%);</span></span><br><span class="line"><span class="string">    color: #FFF;</span></span><br><span class="line"><span class="string">    padding-top: 180px;</span></span><br><span class="line"><span class="string">    text-align: left;</span></span><br><span class="line"><span class="string">    width: 100%;</span></span><br><span class="line"><span class="string">    max-width: 12500px;</span></span><br><span class="line"><span class="string">    &amp; &gt; p &#123;</span></span><br><span class="line"><span class="string">      margin: 15px 0;</span></span><br><span class="line"><span class="string">      font-size: 14px;</span></span><br><span class="line"><span class="string">      width: 450px;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &amp; &gt; img &#123;</span></span><br><span class="line"><span class="string">    filter: brightness(50%);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> swiperContainer = css`</span><br><span class="line"><span class="css">  <span class="selector-tag">postition</span>: <span class="selector-tag">relative</span>;</span></span><br><span class="line"><span class="css">  &amp; &gt; <span class="selector-class">.carousel</span>: <span class="selector-tag">last-child</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">position</span>: <span class="selector-tag">absolute</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">left</span>: 0;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">bottom</span>: 0;</span></span><br><span class="line"><span class="css">    &amp; &gt; <span class="selector-class">.thumbs-wrapper</span> &gt; <span class="selector-class">.thumbs</span> &#123;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">display</span>: <span class="selector-tag">flex</span>;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">justify-content</span>: <span class="selector-tag">center</span>;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">  &#125;</span></span><br><span class="line"><span class="css">`</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Swiper</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &lt;Head&gt;</span><br><span class="line">        &lt;link rel=<span class="string">"stylesheet"</span> href=<span class="string">"/css/carousel.min.css"</span> /&gt;</span><br><span class="line">      &lt;<span class="regexp">/Head&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Carousel css=&#123;swiperContainer&#125; showArrows=&#123;false&#125; showIndicators=&#123;false&#125; showStatus=&#123;false&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;CarouselItem&gt;</span></span><br><span class="line"><span class="regexp">          &lt;img src="/im</span>ages/<span class="number">1.</span>jpeg<span class="string">" /&gt;</span></span><br><span class="line"><span class="string">          &lt;Box&gt;</span></span><br><span class="line"><span class="string">            &lt;Heading as="</span>h2<span class="string">" size="</span>lg<span class="string">"&gt;KING IN BLACK&lt;/Heading&gt;</span></span><br><span class="line"><span class="string">            &lt;Text&gt;The next shocking chapter in Donny Cates and Ryan Stegman's Venom Saga is revealed!&lt;/Text&gt;</span></span><br><span class="line"><span class="string">            &lt;Button colorScheme="</span>red<span class="string">"&gt;CHECK DETAIL&lt;/Button&gt;</span></span><br><span class="line"><span class="string">          &lt;/Box&gt;</span></span><br><span class="line"><span class="string">        &lt;/CarouselItem&gt;</span></span><br><span class="line"><span class="string">        &lt;CarouselItem&gt;</span></span><br><span class="line"><span class="string">          &lt;img src="</span>/images/<span class="number">2.</span>jpeg<span class="string">" /&gt;</span></span><br><span class="line"><span class="string">        &lt;/CarouselItem&gt;</span></span><br><span class="line"><span class="string">        &lt;CarouselItem&gt;</span></span><br><span class="line"><span class="string">          &lt;img src="</span>/images/<span class="number">3.</span>jpeg<span class="string">" /&gt;</span></span><br><span class="line"><span class="string">        &lt;/CarouselItem&gt;</span></span><br><span class="line"><span class="string">      &lt;/Carousel&gt;</span></span><br><span class="line"><span class="string">    &lt;/&gt;</span></span><br><span class="line"><span class="string">  )</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="19-电影列表布局"><a href="#19-电影列表布局" class="headerlink" title="19.电影列表布局"></a>19.电影列表布局</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/Movie.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; Box, Heading, HStack, Image, Text &#125; <span class="keyword">from</span> <span class="string">'@chakra-ui/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; MdMovie &#125; <span class="keyword">from</span> <span class="string">"react-icons/md"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Movie</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Box</span> <span class="attr">maxW</span>=<span class="string">&#123;1200&#125;</span> <span class="attr">mx</span>=<span class="string">"auto"</span> <span class="attr">mt</span>=<span class="string">"20px"</span>&gt;</span></span></span><br><span class="line">    &lt;HStack fontSize="24px"&gt;</span><br><span class="line">      &lt;MdMovie /&gt;</span><br><span class="line">      &lt;Heading as="h3" fontSize="24px"&gt;电影&lt;/Heading&gt;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">HStack</span>&gt;</span></span></span><br><span class="line">    &lt;HStack mt="20px"&gt;</span><br><span class="line">      &lt;Box w=&#123;290&#125;&gt;</span><br><span class="line">        &lt;Image src="/images/item_1.jpg" /&gt;</span><br><span class="line">        &lt;Text mt="10px"&gt;Marvel Mission Recap: captain Marvel's Star of Hala&lt;/Text&gt;</span><br><span class="line">      &lt;/Box&gt;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">HStack</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Box</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="20-电影详情页面布局"><a href="#20-电影详情页面布局" class="headerlink" title="20.电影详情页面布局"></a>20.电影详情页面布局</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/Layout.js</span></span><br><span class="line"><span class="keyword">import</span> Header <span class="keyword">from</span> <span class="string">'./Header'</span>;</span><br><span class="line"><span class="keyword">import</span> Navigation <span class="keyword">from</span> <span class="string">'./Navigation'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Layout</span>(<span class="params">&#123;children&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Header</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Navigation</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;children&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/detail/[id].js</span></span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">"../../components/Layout"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Box, Heading, Divider, Text &#125; <span class="keyword">from</span> <span class="string">"@chakra-ui/core"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; css &#125; <span class="keyword">from</span> <span class="string">'@emotion/core'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> DetailContainer = css`</span><br><span class="line"><span class="css">  <span class="selector-tag">padding</span>: 10<span class="selector-tag">px</span> 0;</span></span><br><span class="line"><span class="css">  &amp; &gt; <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">font-size</span>: 14<span class="selector-tag">px</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">margin-bottom</span>: 10<span class="selector-tag">px</span>;</span></span><br><span class="line"><span class="css">  &#125;</span></span><br><span class="line"><span class="css">  &amp; &gt; <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">margin-bottom</span>: 10<span class="selector-tag">px</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">display</span>: <span class="selector-tag">block</span>;</span></span><br><span class="line"><span class="css">  &#125;</span></span><br><span class="line"><span class="css">`</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> funciton Detail() &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout&gt;</span><br><span class="line">      &lt;Box maxW=&#123;<span class="number">1200</span>&#125; mx=<span class="string">"auto"</span> mt=<span class="string">"70px"</span>&gt;</span><br><span class="line">        &lt;Heading <span class="keyword">as</span>=<span class="string">"h2"</span> mx=<span class="string">"auto"</span> mt=<span class="string">"70px"</span>&gt;</span><br><span class="line">          Marvel Mission Recap: Captain Marvel<span class="string">'s Star of Hala</span></span><br><span class="line"><span class="string">        &lt;/Heading&gt;</span></span><br><span class="line"><span class="string">        &lt;Heading mt="" as="h4" size="lg" color="gray.500" fontWeight="light"&gt;</span></span><br><span class="line"><span class="string">          The results are out of this world!`</span></span><br><span class="line"><span class="string">        &lt;/Heading&gt;</span></span><br><span class="line"><span class="string">        &lt;Divider mt="10px" /&gt;</span></span><br><span class="line"><span class="string">        &lt;Box overflow="hidden" mt="10px"&gt;</span></span><br><span class="line"><span class="string">          &lt;Text float="left"&gt;作者：Tomas&lt;/Text&gt;</span></span><br><span class="line"><span class="string">          &lt;Text float="right"&gt;发布时间： 2045-05-25&lt;/Text&gt;</span></span><br><span class="line"><span class="string">        &lt;/Box&gt;</span></span><br><span class="line"><span class="string">        &lt;Divider mt="10px" /&gt;</span></span><br><span class="line"><span class="string">        &lt;Box css=&#123;DetailContainer&#125;&gt;</span></span><br><span class="line"><span class="string">          &lt;p&gt;Congrats agents - it appears that many of you successfully completed the latest Marvel Mission&lt;/p&gt;</span></span><br><span class="line"><span class="string">          &lt;p&gt;Congrats agents - it appears that many of you successfully completed the latest Marvel Mission&lt;/p&gt;</span></span><br><span class="line"><span class="string">          &lt;p&gt;Congrats agents - it appears that many of you successfully completed the latest Marvel Mission&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;/Box&gt;</span></span><br><span class="line"><span class="string">      &lt;/Box&gt;</span></span><br><span class="line"><span class="string">    &lt;/Layout&gt;</span></span><br><span class="line"><span class="string">  )</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="21-实现首页组件的静态生成：轮播图数据获取与展示"><a href="#21-实现首页组件的静态生成：轮播图数据获取与展示" class="headerlink" title="21.实现首页组件的静态生成：轮播图数据获取与展示"></a>21.实现首页组件的静态生成：轮播图数据获取与展示</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/Layout'</span>;</span><br><span class="line"><span class="keyword">import</span> Swiper, &#123; loadSwiper &#125; <span class="keyword">from</span> <span class="string">'../components/Swiper'</span>;</span><br><span class="line"><span class="keyword">import</span> Movie <span class="keyword">from</span> <span class="string">'../components/Movie'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params">&#123;swiper&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Layout&gt;</span><br><span class="line">      &lt;Swiper data=&#123;swiper&#125;/&gt;</span><br><span class="line">      &lt;Movie /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export async function getStaticProps() &#123;</span></span><br><span class="line"><span class="regexp">  let &#123;data: swiper&#125; = await loadSwiper();</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    props: &#123;</span></span><br><span class="line"><span class="regexp">      swiper</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="22-实现首页组件的静态生成：电影列表数据的获取与展示"><a href="#22-实现首页组件的静态生成：电影列表数据的获取与展示" class="headerlink" title="22.实现首页组件的静态生成：电影列表数据的获取与展示"></a>22.实现首页组件的静态生成：电影列表数据的获取与展示</h3><p>略</p>
<h3 id="23-实现详情页基于动态路由的静态生成"><a href="#23-实现详情页基于动态路由的静态生成" class="headerlink" title="23.实现详情页基于动态路由的静态生成"></a>23.实现详情页基于动态路由的静态生成</h3><p>略</p>
<h3 id="24-导出静态网站"><a href="#24-导出静态网站" class="headerlink" title="24.导出静态网站"></a>24.导出静态网站</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"export"</span>: <span class="string">"next build &amp;&amp; next export"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="25-自定义Next应用服务器"><a href="#25-自定义Next应用服务器" class="headerlink" title="25.自定义Next应用服务器"></a>25.自定义Next应用服务器</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server/index.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> next = <span class="built_in">require</span>(<span class="string">'next'</span>);</span><br><span class="line"><span class="keyword">const</span> dev = process.env.NODE_ENV!==<span class="string">'production'</span>;</span><br><span class="line"><span class="keyword">const</span> app = next(&#123;dev&#125;);</span><br><span class="line"><span class="keyword">const</span> handler = app.getRequestHandler();</span><br><span class="line">app.prepare().then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> server = express();</span><br><span class="line">  server.get(<span class="string">'*'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    handler(req, res)</span><br><span class="line">  &#125;);</span><br><span class="line">  server.listen(<span class="number">3000</span>,()=&gt;<span class="built_in">console</span>.log(<span class="string">'服务器启动成功'</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"dev"</span>: <span class="string">"nodemon server/index.js"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="26-部署Next应用到Vercel平台"><a href="#26-部署Next应用到Vercel平台" class="headerlink" title="26.部署Next应用到Vercel平台"></a>26.部署Next应用到Vercel平台</h3><ul>
<li>vercel.com</li>
</ul>
<h2 id="任务三：Gatsby"><a href="#任务三：Gatsby" class="headerlink" title="任务三：Gatsby"></a>任务三：Gatsby</h2><h3 id="1-什么是Gatsby以及静态应用的优势"><a href="#1-什么是Gatsby以及静态应用的优势" class="headerlink" title="1.什么是Gatsby以及静态应用的优势"></a>1.什么是Gatsby以及静态应用的优势</h3><p>Gatsby 是一个静态站点生成器.<br>官网：<a href="https://www.gatsbyjs.org/" target="_blank" rel="noopener">https://www.gatsbyjs.org/</a></p>
<blockquote>
<p>静态应用的优势</p>
</blockquote>
<p>1.访问速度快<br>2.更利于 SEO 搜索引擎的内容抓取<br>3.部署简单</p>
<h3 id="2-Gatsby工作流程与框架特性"><a href="#2-Gatsby工作流程与框架特性" class="headerlink" title="2.Gatsby工作流程与框架特性"></a>2.Gatsby工作流程与框架特性</h3><blockquote>
<p>Gatsby 总览</p>
</blockquote>
<p>1.基于 React 和 GraphQL.结合了 webpack，babel，react-router等前端领域中最先进工具.开发人员开发体验好<br>2.采用数据层和 UI 分离而不失 SEO 的现代前端开发模式.对 SEO 非常友好<br>3.数据预读取，在浏览器空闲的时候预先读取链接对应的页面内容.使静态页面拥有 SPA 应用的用户体验，用户体验好<br>4.数据来源多样化：Headless CMS，markdown，API.<br>5.功能插件化，Gatsby 中提供了丰富且功能强大的各种类型的插件，用什么装什么.</p>
<h3 id="3-创建Gatsby项目"><a href="#3-创建Gatsby项目" class="headerlink" title="3.创建Gatsby项目"></a>3.创建Gatsby项目</h3><blockquote>
<p>1.全局安装脚手架工具</p>
</blockquote>
<ul>
<li>npm install gatsby-cli -g</li>
</ul>
<blockquote>
<p>2.创建项目</p>
</blockquote>
<p>创建：gatsby new project-name <a href="https://github.com/gatsbyjs/gatsby-starter-hello-world" target="_blank" rel="noopener">https://github.com/gatsbyjs/gatsby-starter-hello-world</a><br>启动：gatsby develop 或 npm start<br>访问：localhost:8000</p>
<h3 id="4-基于文件的路由系统"><a href="#4-基于文件的路由系统" class="headerlink" title="4.基于文件的路由系统"></a>4.基于文件的路由系统</h3><p>Gatsby框架内置基于文件的路由系统，页面组件被放置在 src/pages 文件夹中.</p>
<h3 id="5-以编程的方式创建页面"><a href="#5-以编程的方式创建页面" class="headerlink" title="5.以编程的方式创建页面"></a>5.以编程的方式创建页面</h3><p>基于一个模板创建多个HTML页面，有多少数据就创建多少页面<br>比如商品详情页面，有多少商品就生成多少商品详情展示页面.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// createPages 方法用于创建页面</span></span><br><span class="line"><span class="comment">// Gatsby 在构建应用时会调用该方法</span></span><br><span class="line"><span class="comment">// 该方法需要在 gatsby-node.js 文件中定义</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPages</span>(<span class="params">&#123;actions&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;createPage&#125; = actions;</span><br><span class="line">  <span class="comment">// 获取模板绝对路径</span></span><br><span class="line">  <span class="comment">// 获取组件所需数据</span></span><br><span class="line">  <span class="comment">// 根据模板和数据创建页面</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;createPages&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-Link组件的使用"><a href="#6-Link组件的使用" class="headerlink" title="6.Link组件的使用"></a>6.Link组件的使用</h3><p>在 Gatsby 框架中页面跳转通过 Link 组件实现.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Link&#125; <span class="keyword">from</span> <span class="string">'gatsby'</span>;</span><br><span class="line">&lt;Link to=<span class="string">"/list"</span>&gt;jump to list page&lt;<span class="regexp">/Link&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-GraphQL数据层介绍"><a href="#7-GraphQL数据层介绍" class="headerlink" title="7.GraphQL数据层介绍"></a>7.GraphQL数据层介绍</h3><p>在 Gatsby 框架中提供了一个统一的存储数据的地方，叫做数据层》<br>在应用构建时，Gatsby 会从外部获取数据并将数据放入数据层，组件可以直接从数据层查询数据.<br>数据层使用 GraphQL 构建.<br>调试工具：localhot:8000/___graphql</p>
<h3 id="8-在组件中从数据层中查询数据"><a href="#8-在组件中从数据层中查询数据" class="headerlink" title="8.在组件中从数据层中查询数据"></a>8.在组件中从数据层中查询数据</h3><blockquote>
<p>页面组件</p>
</blockquote>
<p>在组件文件中导出查询命令，框架执行查询并将结果传递给组件的prop对象.存储在props对象的data属性中.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;graphql&#125; <span class="keyword">from</span> <span class="string">"gatsby"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PageComponent</span>(<span class="params">&#123;data&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;data.site.siteMetadata.title&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> query = graphql<span class="string">`</span></span><br><span class="line"><span class="string">  query &#123;</span></span><br><span class="line"><span class="string">    site &#123;</span></span><br><span class="line"><span class="string">      siteMetadata &#123;</span></span><br><span class="line"><span class="string">        title</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>非页面组件</p>
</blockquote>
<p>通过钩子函数 useStaticQuery 进行手动查询.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;graphql,useStaticQuery&#125; <span class="keyword">from</span> <span class="string">"gatsby"</span>;</span><br><span class="line"><span class="keyword">const</span> data = useStaticQuery(graphql<span class="string">`</span></span><br><span class="line"><span class="string">  query &#123;</span></span><br><span class="line"><span class="string">    site &#123;</span></span><br><span class="line"><span class="string">      siteMetadata &#123;</span></span><br><span class="line"><span class="string">        title</span></span><br><span class="line"><span class="string">        description</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>)</span><br></pre></td></tr></table></figure>

<h3 id="9-Gatsby-框架中和插件相关的一些概念"><a href="#9-Gatsby-框架中和插件相关的一些概念" class="headerlink" title="9.Gatsby 框架中和插件相关的一些概念"></a>9.Gatsby 框架中和插件相关的一些概念</h3><p>Gatsby 框架内置插件系统，插件是为应用添加功能的最好的方式.</p>
<p>在 Gatsby 中有三种类型的插件：分别为数据源插件（source），数据转换插件（tansformer），功能插件（plugin）<br>数据源插件：负责从应用外部获取数据，将数据统一放在 Gatsby 的数据层中<br>数据转换插件：负责转换特定类型的数据的格式，比如将 markdown 文件中的内容转换为对象形式<br>功能插件：为应用提供功能，比如通过插件让应用支持 Less 或者TypeScript.</p>
<p><a href="https://www.gatsbyjs.org/plugins/" target="_blank" rel="noopener">https://www.gatsbyjs.org/plugins/</a></p>
<h3 id="10-将本地JSON文件数据添加到数据层中"><a href="#10-将本地JSON文件数据添加到数据层中" class="headerlink" title="10.将本地JSON文件数据添加到数据层中"></a>10.将本地JSON文件数据添加到数据层中</h3><p>要将本地 JSON 文件中的数据放入数据层需要用到两个插件.<br>gatsby-source-filesystem: 用于将本地文件中的数据添加至数据层.<br>gatsby-transformer-json: 将原始 JSON 字符串转换为 JavaScript 对象.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        &#123;</span><br><span class="line">            resolve: <span class="string">"gatsby-source-filesystem"</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                name: <span class="string">"data"</span>,</span><br><span class="line">                path: <span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/data/`</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"gatsby-transformer-json"</span>,</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-图像优化"><a href="#11-图像优化" class="headerlink" title="11.图像优化"></a>11.图像优化</h3><p>1.图像文件和数据文件不在源代码中的同一位置<br>2.图像路径基于构建站点的绝对路径，而不是相对于数据的路径，难以分析出图片的真实位置<br>3.图像没有经过任何优化操作</p>
<blockquote>
<p>图像优化</p>
</blockquote>
<p>gatsby-source-filesystem: 用于将本地文件信息添加至数据层<br>gatsby-plugin-sharp: 提供本地图像的处理功能（调整图像尺寸，压缩图像体积等等）<br>gatsby-transformer-sharp: 将 gatsby-plugin-sharp 插件处理后的图像信息添加到数据层<br>gatsby-image: React 组件，优化图像显示，基于 gatsby-transformer-sharp 插件转化后的数据</p>
<p>1.生成多个具有不同宽度的图像版本，为图像设置 srcset 和 sizes 属性，因此无论您的设备是什么宽度都可以加载到合适大小的图片<br>2.使用“模糊处理”技术，其中将一个20px宽的小图像显示为占位符直到实际图像下载完成为止</p>
<ul>
<li>npm install gatsby-plugin-shap gatsby-transformer-sharp gatsby-image</li>
</ul>
<h3 id="12-将本地markdown文件作为数据源构建文章列表"><a href="#12-将本地markdown文件作为数据源构建文章列表" class="headerlink" title="12.将本地markdown文件作为数据源构建文章列表"></a>12.将本地markdown文件作为数据源构建文章列表</h3><blockquote>
<p>构建文章列表</p>
</blockquote>
<p>1.通过 gatsby-source-filesystem 将 markdown 文件数据放入数据层</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">resolve: <span class="string">`gatsby-source-filesystem`</span>,</span><br><span class="line">options: &#123;</span><br><span class="line">    name:<span class="string">`posts`</span>,</span><br><span class="line">    path:<span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/src/posts`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.通过 gatsby-transformer-remark 将数据层中的原始 markdown 数据转换为对象形式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [<span class="string">`gatsby-transformer-remark`</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-以编程方式为所有md数据节点添加slug属性"><a href="#13-以编程方式为所有md数据节点添加slug属性" class="headerlink" title="13.以编程方式为所有md数据节点添加slug属性"></a>13.以编程方式为所有md数据节点添加slug属性</h3><blockquote>
<p>构建文章详情</p>
</blockquote>
<p>1.重新构建查询数据，添加 slug 作为请求标识，slug值为文件名称</p>
<p>gatsby.md -&gt; /posts/gatsby<br>react.md -&gt; /post/react</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onCreateNode = <span class="function">(<span class="params">&#123;node,actions&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;createNodeField&#125; = actions;</span><br><span class="line">    <span class="keyword">if</span>(node.internal.type === <span class="string">'MarkdownRemark'</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> slug = path.basename(node.fileAbsollutePath, <span class="string">'.md'</span>);</span><br><span class="line">        createNodeField(&#123;</span><br><span class="line">            node,</span><br><span class="line">            name: <span class="string">'slug'</span>,</span><br><span class="line">            value: slug</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-根据slug构建文章详情页"><a href="#14-根据slug构建文章详情页" class="headerlink" title="14.根据slug构建文章详情页"></a>14.根据slug构建文章详情页</h3><p>2.根据 slug 标识构建页面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createPages = <span class="keyword">async</span>(&#123;graphql, actions&#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;createPage&#125; = actions;</span><br><span class="line">    <span class="keyword">const</span> template = path.resolve(<span class="string">'./src/tempalte/blog.js'</span>);</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> graphql(<span class="string">``</span>);</span><br><span class="line">    res.data.allMarkdownRemark.edges.forEach(<span class="function"><span class="params">edge</span> =&gt;</span> &#123;</span><br><span class="line">    createPage(&#123;</span><br><span class="line">        component: template,</span><br><span class="line">        path: <span class="string">`/blog/<span class="subst">$&#123;edge.node.fileds.slug&#125;</span>`</span>,</span><br><span class="line">        context: &#123;<span class="attr">slug</span>:edge.node.fileds.slug&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="15-解决markdown文件中的图片显示优化问题"><a href="#15-解决markdown文件中的图片显示优化问题" class="headerlink" title="15.解决markdown文件中的图片显示优化问题"></a>15.解决markdown文件中的图片显示优化问题</h3><p>4.处理 markdown 文件中图片</p>
<p>gatsby-remark-images: 处理 markdown 中的图片，以便可以在生产环境中使用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    resolve: <span class="string">"gatsby-transformer-remark"</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">        plugins: [<span class="string">"gatsby-remark-images"</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="16-将CMS作为Gatsby应用程序的外部数据源"><a href="#16-将CMS作为Gatsby应用程序的外部数据源" class="headerlink" title="16.将CMS作为Gatsby应用程序的外部数据源"></a>16.将CMS作为Gatsby应用程序的外部数据源</h3><blockquote>
<p>从 Strapi 中获取数据</p>
</blockquote>
<p>创建项目：npx create-strapi-app 项目名称<br><a href="https://github.com/strapi/strapi" target="_blank" rel="noopener">https://github.com/strapi/strapi</a></p>
<p><a href="https://www.gatsbyjs.org/packages/gatsby-source-strapi/?=strapi" target="_blank" rel="noopener">https://www.gatsbyjs.org/packages/gatsby-source-strapi/?=strapi</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    resolve: <span class="string">`gatsby-source-strapi`</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">        apiURL: <span class="string">`http://localhost:1337`</span>,</span><br><span class="line">        contentTypes: [<span class="string">`posts`</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="17-开发数据源插件-获取外部数据"><a href="#17-开发数据源插件-获取外部数据" class="headerlink" title="17.开发数据源插件-获取外部数据"></a>17.开发数据源插件-获取外部数据</h3><p>数据源插件负责从 Gatsby 应用外部获取数据，创建数据查询节点供开发者使用</p>
<p>1.gatsby clean 清除上一次的构建内容<br>2.在项目根目录下创建 plugins 文件夹，在此文件夹中继续创建具体的插件文件夹，比如 gatsby-source-mystrapi 文件夹<br>3.在插件文件夹中创建 gatsby-node.js 文件<br>4.插件实际上就是 npm 包<br>5.导出 sourceNodes 方法用于获取外部数据，创建数据查询节点<br>6.在 gatsby-config.js 文件中配置插件，并传递插件所需的配置参数<br>7.重新运行应用</p>
<h3 id="18-开发数据源插件-添加数据至数据层"><a href="#18-开发数据源插件-添加数据至数据层" class="headerlink" title="18.开发数据源插件-添加数据至数据层"></a>18.开发数据源插件-添加数据至数据层</h3><p>略</p>
<h3 id="19-开发数据转换插件"><a href="#19-开发数据转换插件" class="headerlink" title="19.开发数据转换插件"></a>19.开发数据转换插件</h3><p>transformer 插件将 source 插件提供的数据转换为新的数据</p>
<p>1.在 plugins 文件夹中创建 gatsby-transformer-xml 文件夹<br>2.在插件文件夹中创建 gatsby-node.js 文件<br>3.在文件夹中导出 onCreateNode 方法用于构建 Gatsby 查询节点<br>4.根据节点类型筛选 xml 节点 node.nternal.medidaType -&gt; application/xml<br>5.通过 loadNodeContent 方法读取节点中的数据<br>6.通过 xml2js 将 xml 数据转换为对象<br>7.将对象转换为 Gatsby 查询节点</p>
<h3 id="20-SEO优化"><a href="#20-SEO优化" class="headerlink" title="20.SEO优化"></a>20.SEO优化</h3><p>gatsby-plugin-react-helmet</p>
<p>react-helmet 是一个组件，用于控制页面元数据，这对于 SEO 非常重要.<br>此插件用于将页面元数据添加到 Gatsby 构建的静态 HTML 页面中.</p>
<ul>
<li>npm install gatsby-plugin-react-helmet react-helmet</li>
</ul>
<h3 id="21-让Gatsby应用支持less"><a href="#21-让Gatsby应用支持less" class="headerlink" title="21.让Gatsby应用支持less"></a>21.让Gatsby应用支持less</h3><blockquote>
<p>在 gatsby 应用中使用 less</p>
</blockquote>
<p>下载插件：npm install –save gatsby-plugin-less<br>配置插件：plugins:[<code>gatsby-plugin-less</code>]<br>创建样式：index.module.less<br>引入样式：import styles from ‘./index.module.less’</p>
<h3 id="22-案例实现方式介绍"><a href="#22-案例实现方式介绍" class="headerlink" title="22.案例实现方式介绍"></a>22.案例实现方式介绍</h3><p>略</p>
<h3 id="23-创建realworld项目"><a href="#23-创建realworld项目" class="headerlink" title="23.创建realworld项目"></a>23.创建realworld项目</h3><ul>
<li>gatsby new realworld <a href="https://github.com/gatsbyjs/gatsby-starter-hello-world" target="_blank" rel="noopener">https://github.com/gatsbyjs/gatsby-starter-hello-world</a></li>
<li>rm package-lock.json</li>
<li>rm -rf node_modules</li>
</ul>
<h3 id="24-构建案例所需组件"><a href="#24-构建案例所需组件" class="headerlink" title="24.构建案例所需组件"></a>24.构建案例所需组件</h3><p>略</p>
<h3 id="25-在案例中配置Redux"><a href="#25-在案例中配置Redux" class="headerlink" title="25.在案例中配置Redux"></a>25.在案例中配置Redux</h3><ul>
<li>npm install redux react-redux</li>
</ul>
<h3 id="26-实现登录（一）"><a href="#26-实现登录（一）" class="headerlink" title="26.实现登录（一）"></a>26.实现登录（一）</h3><h3 id="27-实现登录（二）"><a href="#27-实现登录（二）" class="headerlink" title="27.实现登录（二）"></a>27.实现登录（二）</h3><h3 id="28-同步用户状态"><a href="#28-同步用户状态" class="headerlink" title="28.同步用户状态"></a>28.同步用户状态</h3><h3 id="29-实现客户端路由"><a href="#29-实现客户端路由" class="headerlink" title="29.实现客户端路由"></a>29.实现客户端路由</h3><h3 id="30-受保护的客户端路由"><a href="#30-受保护的客户端路由" class="headerlink" title="30.受保护的客户端路由"></a>30.受保护的客户端路由</h3><h3 id="31-文章列表实现思路分析"><a href="#31-文章列表实现思路分析" class="headerlink" title="31.文章列表实现思路分析"></a>31.文章列表实现思路分析</h3><h3 id="32-通过数据源插件获取外部文章列表数据"><a href="#32-通过数据源插件获取外部文章列表数据" class="headerlink" title="32.通过数据源插件获取外部文章列表数据"></a>32.通过数据源插件获取外部文章列表数据</h3><h3 id="33-将文章列表数据添加至数据层"><a href="#33-将文章列表数据添加至数据层" class="headerlink" title="33.将文章列表数据添加至数据层"></a>33.将文章列表数据添加至数据层</h3><h3 id="34-根据文章列表数据创建带分页的文章列表页面"><a href="#34-根据文章列表数据创建带分页的文章列表页面" class="headerlink" title="34.根据文章列表数据创建带分页的文章列表页面"></a>34.根据文章列表数据创建带分页的文章列表页面</h3><h3 id="35-组件查询数据显示数据-1"><a href="#35-组件查询数据显示数据-1" class="headerlink" title="35.组件查询数据显示数据-1"></a>35.组件查询数据显示数据-1</h3><h3 id="36-动态获取文章列表数据"><a href="#36-动态获取文章列表数据" class="headerlink" title="36.动态获取文章列表数据"></a>36.动态获取文章列表数据</h3><h3 id="37-创建文章详情页面"><a href="#37-创建文章详情页面" class="headerlink" title="37.创建文章详情页面"></a>37.创建文章详情页面</h3><h3 id="38-创建动态文章详情页面"><a href="#38-创建动态文章详情页面" class="headerlink" title="38.创建动态文章详情页面"></a>38.创建动态文章详情页面</h3>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JavaScipt/" rel="tag"># JavaScipt</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/03/23/40/" rel="next" title="学习笔记 ----- 【React 框架原理与实战】React Hooks、Chakra-UI、组件性能优化、封装组件库">
                <i class="fa fa-chevron-left"></i> 学习笔记 ----- 【React 框架原理与实战】React Hooks、Chakra-UI、组件性能优化、封装组件库
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/04/11/42/" rel="prev" title="学习笔记 ----- 【React 框架原理与实战】React + Redux + Ant Design + TypeScript 实战">
                学习笔记 ----- 【React 框架原理与实战】React + Redux + Ant Design + TypeScript 实战 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="FY" />
            
              <p class="site-author-name" itemprop="name">FY</p>
              <p class="site-description motion-element" itemprop="description">Just Be Yourself</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">48</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/xuanfeiyu" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Part-4-·-React-框架原理与实战"><span class="nav-number">1.</span> <span class="nav-text">Part 4 · React 框架原理与实战</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#模块四-·-React-服务端渲染专题（原生实现、Next-js-集成框架、Gatsby）"><span class="nav-number">1.1.</span> <span class="nav-text">模块四 · React 服务端渲染专题（原生实现、Next.js 集成框架、Gatsby）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#任务一：ReactSSR"><span class="nav-number">1.2.</span> <span class="nav-text">任务一：ReactSSR</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-ReactSSR相关观念回顾"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.ReactSSR相关观念回顾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-项目结构初始化"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.项目结构初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-实现ReactSSR雏形"><span class="nav-number">1.2.3.</span> <span class="nav-text">3.实现ReactSSR雏形</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-服务器端程序webpack打包配置"><span class="nav-number">1.2.4.</span> <span class="nav-text">4.服务器端程序webpack打包配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-为组件元素附加事件的方式"><span class="nav-number">1.2.5.</span> <span class="nav-text">5.为组件元素附加事件的方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-优化：合并webpack配置"><span class="nav-number">1.2.6.</span> <span class="nav-text">6.优化：合并webpack配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-优化：合并项目启动命令"><span class="nav-number">1.2.7.</span> <span class="nav-text">7.优化：合并项目启动命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-优化：服务器端打包文件体积优化"><span class="nav-number">1.2.8.</span> <span class="nav-text">8.优化：服务器端打包文件体积优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-优化：代码拆分"><span class="nav-number">1.2.9.</span> <span class="nav-text">9.优化：代码拆分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-实现服务器端路由"><span class="nav-number">1.2.10.</span> <span class="nav-text">10.实现服务器端路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-实现客户端路由"><span class="nav-number">1.2.11.</span> <span class="nav-text">11.实现客户端路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-实现客户端Redux"><span class="nav-number">1.2.12.</span> <span class="nav-text">12.实现客户端Redux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-实现服务器端Redux-一"><span class="nav-number">1.2.13.</span> <span class="nav-text">13.实现服务器端Redux(一)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-实现服务器端Redux-二"><span class="nav-number">1.2.14.</span> <span class="nav-text">14.实现服务器端Redux(二)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-实现服务器端Redux-三"><span class="nav-number">1.2.15.</span> <span class="nav-text">15.实现服务器端Redux(三)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-防止XSS攻击"><span class="nav-number">1.2.16.</span> <span class="nav-text">16.防止XSS攻击</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#任务二：Next"><span class="nav-number">1.3.</span> <span class="nav-text">任务二：Next</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Next-js整体介绍"><span class="nav-number">1.3.1.</span> <span class="nav-text">1.Next.js整体介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-创建Next项目"><span class="nav-number">1.3.2.</span> <span class="nav-text">2.创建Next项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-基于页面的路由系统-创建页面"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.基于页面的路由系统-创建页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-基于页面的路由系统-页面跳转"><span class="nav-number">1.3.4.</span> <span class="nav-text">4.基于页面的路由系统-页面跳转</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Next应用中的静态资源访问"><span class="nav-number">1.3.5.</span> <span class="nav-text">5.Next应用中的静态资源访问</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-修改页面中的元数据"><span class="nav-number">1.3.6.</span> <span class="nav-text">6.修改页面中的元数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-Next应用中添加样式的方式"><span class="nav-number">1.3.7.</span> <span class="nav-text">7.Next应用中添加样式的方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-预渲染介绍"><span class="nav-number">1.3.8.</span> <span class="nav-text">8.预渲染介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-实现静态生成"><span class="nav-number">1.3.9.</span> <span class="nav-text">9.实现静态生成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-实现服务器端渲染"><span class="nav-number">1.3.10.</span> <span class="nav-text">10.实现服务器端渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-实现基于动态路由的静态生成"><span class="nav-number">1.3.11.</span> <span class="nav-text">11.实现基于动态路由的静态生成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-fallback选项的作用"><span class="nav-number">1.3.12.</span> <span class="nav-text">12.fallback选项的作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-自定义404页面"><span class="nav-number">1.3.13.</span> <span class="nav-text">13.自定义404页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-API-Routes"><span class="nav-number">1.3.14.</span> <span class="nav-text">14.API Routes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-案例代码初始化配置"><span class="nav-number">1.3.15.</span> <span class="nav-text">15.案例代码初始化配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-实现头部组件布局"><span class="nav-number">1.3.16.</span> <span class="nav-text">16.实现头部组件布局</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-实现导航组件布局"><span class="nav-number">1.3.17.</span> <span class="nav-text">17.实现导航组件布局</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-实现轮播图组件布局"><span class="nav-number">1.3.18.</span> <span class="nav-text">18.实现轮播图组件布局</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-电影列表布局"><span class="nav-number">1.3.19.</span> <span class="nav-text">19.电影列表布局</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-电影详情页面布局"><span class="nav-number">1.3.20.</span> <span class="nav-text">20.电影详情页面布局</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#21-实现首页组件的静态生成：轮播图数据获取与展示"><span class="nav-number">1.3.21.</span> <span class="nav-text">21.实现首页组件的静态生成：轮播图数据获取与展示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#22-实现首页组件的静态生成：电影列表数据的获取与展示"><span class="nav-number">1.3.22.</span> <span class="nav-text">22.实现首页组件的静态生成：电影列表数据的获取与展示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#23-实现详情页基于动态路由的静态生成"><span class="nav-number">1.3.23.</span> <span class="nav-text">23.实现详情页基于动态路由的静态生成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#24-导出静态网站"><span class="nav-number">1.3.24.</span> <span class="nav-text">24.导出静态网站</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#25-自定义Next应用服务器"><span class="nav-number">1.3.25.</span> <span class="nav-text">25.自定义Next应用服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#26-部署Next应用到Vercel平台"><span class="nav-number">1.3.26.</span> <span class="nav-text">26.部署Next应用到Vercel平台</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#任务三：Gatsby"><span class="nav-number">1.4.</span> <span class="nav-text">任务三：Gatsby</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-什么是Gatsby以及静态应用的优势"><span class="nav-number">1.4.1.</span> <span class="nav-text">1.什么是Gatsby以及静态应用的优势</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Gatsby工作流程与框架特性"><span class="nav-number">1.4.2.</span> <span class="nav-text">2.Gatsby工作流程与框架特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-创建Gatsby项目"><span class="nav-number">1.4.3.</span> <span class="nav-text">3.创建Gatsby项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-基于文件的路由系统"><span class="nav-number">1.4.4.</span> <span class="nav-text">4.基于文件的路由系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-以编程的方式创建页面"><span class="nav-number">1.4.5.</span> <span class="nav-text">5.以编程的方式创建页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-Link组件的使用"><span class="nav-number">1.4.6.</span> <span class="nav-text">6.Link组件的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-GraphQL数据层介绍"><span class="nav-number">1.4.7.</span> <span class="nav-text">7.GraphQL数据层介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-在组件中从数据层中查询数据"><span class="nav-number">1.4.8.</span> <span class="nav-text">8.在组件中从数据层中查询数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-Gatsby-框架中和插件相关的一些概念"><span class="nav-number">1.4.9.</span> <span class="nav-text">9.Gatsby 框架中和插件相关的一些概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-将本地JSON文件数据添加到数据层中"><span class="nav-number">1.4.10.</span> <span class="nav-text">10.将本地JSON文件数据添加到数据层中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-图像优化"><span class="nav-number">1.4.11.</span> <span class="nav-text">11.图像优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-将本地markdown文件作为数据源构建文章列表"><span class="nav-number">1.4.12.</span> <span class="nav-text">12.将本地markdown文件作为数据源构建文章列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-以编程方式为所有md数据节点添加slug属性"><span class="nav-number">1.4.13.</span> <span class="nav-text">13.以编程方式为所有md数据节点添加slug属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-根据slug构建文章详情页"><span class="nav-number">1.4.14.</span> <span class="nav-text">14.根据slug构建文章详情页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-解决markdown文件中的图片显示优化问题"><span class="nav-number">1.4.15.</span> <span class="nav-text">15.解决markdown文件中的图片显示优化问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-将CMS作为Gatsby应用程序的外部数据源"><span class="nav-number">1.4.16.</span> <span class="nav-text">16.将CMS作为Gatsby应用程序的外部数据源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-开发数据源插件-获取外部数据"><span class="nav-number">1.4.17.</span> <span class="nav-text">17.开发数据源插件-获取外部数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-开发数据源插件-添加数据至数据层"><span class="nav-number">1.4.18.</span> <span class="nav-text">18.开发数据源插件-添加数据至数据层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-开发数据转换插件"><span class="nav-number">1.4.19.</span> <span class="nav-text">19.开发数据转换插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-SEO优化"><span class="nav-number">1.4.20.</span> <span class="nav-text">20.SEO优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#21-让Gatsby应用支持less"><span class="nav-number">1.4.21.</span> <span class="nav-text">21.让Gatsby应用支持less</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#22-案例实现方式介绍"><span class="nav-number">1.4.22.</span> <span class="nav-text">22.案例实现方式介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#23-创建realworld项目"><span class="nav-number">1.4.23.</span> <span class="nav-text">23.创建realworld项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#24-构建案例所需组件"><span class="nav-number">1.4.24.</span> <span class="nav-text">24.构建案例所需组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#25-在案例中配置Redux"><span class="nav-number">1.4.25.</span> <span class="nav-text">25.在案例中配置Redux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#26-实现登录（一）"><span class="nav-number">1.4.26.</span> <span class="nav-text">26.实现登录（一）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#27-实现登录（二）"><span class="nav-number">1.4.27.</span> <span class="nav-text">27.实现登录（二）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#28-同步用户状态"><span class="nav-number">1.4.28.</span> <span class="nav-text">28.同步用户状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#29-实现客户端路由"><span class="nav-number">1.4.29.</span> <span class="nav-text">29.实现客户端路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#30-受保护的客户端路由"><span class="nav-number">1.4.30.</span> <span class="nav-text">30.受保护的客户端路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#31-文章列表实现思路分析"><span class="nav-number">1.4.31.</span> <span class="nav-text">31.文章列表实现思路分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#32-通过数据源插件获取外部文章列表数据"><span class="nav-number">1.4.32.</span> <span class="nav-text">32.通过数据源插件获取外部文章列表数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#33-将文章列表数据添加至数据层"><span class="nav-number">1.4.33.</span> <span class="nav-text">33.将文章列表数据添加至数据层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#34-根据文章列表数据创建带分页的文章列表页面"><span class="nav-number">1.4.34.</span> <span class="nav-text">34.根据文章列表数据创建带分页的文章列表页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#35-组件查询数据显示数据-1"><span class="nav-number">1.4.35.</span> <span class="nav-text">35.组件查询数据显示数据-1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#36-动态获取文章列表数据"><span class="nav-number">1.4.36.</span> <span class="nav-text">36.动态获取文章列表数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#37-创建文章详情页面"><span class="nav-number">1.4.37.</span> <span class="nav-text">37.创建文章详情页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#38-创建动态文章详情页面"><span class="nav-number">1.4.38.</span> <span class="nav-text">38.创建动态文章详情页面</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">FY</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
