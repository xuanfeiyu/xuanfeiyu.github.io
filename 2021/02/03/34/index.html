<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="JavaScipt," />










<meta name="description" content="作者：FY引用请标明出处  Part 3 · Vue.js 框架源码与进阶模块四 · 搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库任务一：搭建自己的SSR1.渲染一个 Vue 实例 mkdir vue-ssr cd vue-ssr npm init -y npm i vue-server-renderer  12345678910111213141516const Vue">
<meta property="og:type" content="article">
<meta property="og:title" content="学习笔记 ----- 【Vue.js 框架源码与进阶】搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库">
<meta property="og:url" content="http://yoursite.com/2021/02/03/34/index.html">
<meta property="og:site_name" content="旋の飞羽">
<meta property="og:description" content="作者：FY引用请标明出处  Part 3 · Vue.js 框架源码与进阶模块四 · 搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库任务一：搭建自己的SSR1.渲染一个 Vue 实例 mkdir vue-ssr cd vue-ssr npm init -y npm i vue-server-renderer  12345678910111213141516const Vue">
<meta property="article:published_time" content="2021-02-02T16:00:00.000Z">
<meta property="article:modified_time" content="2021-02-02T16:05:57.729Z">
<meta property="article:author" content="FY">
<meta property="article:tag" content="JavaScipt">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2021/02/03/34/"/>





  <title>学习笔记 ----- 【Vue.js 框架源码与进阶】搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库 | 旋の飞羽</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">旋の飞羽</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人间值得，未来可期。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/03/34/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旋の飞羽">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">学习笔记 ----- 【Vue.js 框架源码与进阶】搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-02-03T00:00:00+08:00">
                2021-02-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>作者：FY<br>引用请标明出处</p>
</blockquote>
<h1 id="Part-3-·-Vue-js-框架源码与进阶"><a href="#Part-3-·-Vue-js-框架源码与进阶" class="headerlink" title="Part 3 · Vue.js 框架源码与进阶"></a>Part 3 · Vue.js 框架源码与进阶</h1><h2 id="模块四-·-搭建自己的SSR、静态站点生成（SSG）及封装-Vue-js-组件库"><a href="#模块四-·-搭建自己的SSR、静态站点生成（SSG）及封装-Vue-js-组件库" class="headerlink" title="模块四 · 搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库"></a>模块四 · 搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库</h2><h2 id="任务一：搭建自己的SSR"><a href="#任务一：搭建自己的SSR" class="headerlink" title="任务一：搭建自己的SSR"></a>任务一：搭建自己的SSR</h2><h3 id="1-渲染一个-Vue-实例"><a href="#1-渲染一个-Vue-实例" class="headerlink" title="1.渲染一个 Vue 实例"></a>1.渲染一个 Vue 实例</h3><ul>
<li>mkdir vue-ssr</li>
<li>cd vue-ssr</li>
<li>npm init -y</li>
<li>npm i vue-server-renderer</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const renderer = require('</span>vue-server-renderer<span class="string">').createRenderer()</span></span><br><span class="line"><span class="string">const app = new Vue(&#123;</span></span><br><span class="line"><span class="string">  template: `</span></span><br><span class="line"><span class="string">  &lt;div id="app"&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line"><span class="string">  data: &#123;</span></span><br><span class="line"><span class="string">    message: '</span>XXXX<span class="string">'</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">renderer.renderToString(app, (err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">  if(err) throw err</span></span><br><span class="line"><span class="string">  console.log(html)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure>

<h3 id="2-结合到-Web-服务器中"><a href="#2-结合到-Web-服务器中" class="headerlink" title="2.结合到 Web 服务器中"></a>2.结合到 Web 服务器中</h3><ul>
<li>npm i express</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">const renderer = require('</span>vue-server-renderer<span class="string">').createRenderer()</span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string">server.get('</span>/<span class="string">',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">const app = new Vue(&#123;</span></span><br><span class="line"><span class="string">  template: `</span></span><br><span class="line"><span class="string">  &lt;div id="app"&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line"><span class="string">  data: &#123;</span></span><br><span class="line"><span class="string">    message: '</span>XXXX<span class="string">'</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">renderer.renderToString(app, (err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">  if(err) &#123;</span></span><br><span class="line"><span class="string">    return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  // res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">  res.end(`</span></span><br><span class="line"><span class="string">  &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">  &lt;html lang="en"&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">      &lt;meta charset="UTF-8"&gt;</span></span><br><span class="line"><span class="string">      &lt;meta name="viewport" content="width=device-width,initial-scale=1.0"&gt;</span></span><br><span class="line"><span class="string">      &lt;title&gt;Document&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">      $&#123;html&#125;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/html&gt;`)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="3-使用-HTML-模板"><a href="#3-使用-HTML-模板" class="headerlink" title="3.使用 HTML 模板"></a>3.使用 HTML 模板</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.template.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1.0"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- vur-ssr-outlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">cosnst fs = require('</span>fs<span class="string">')</span></span><br><span class="line"><span class="string">const renderer = require('</span>vue-server-renderer<span class="string">').createRenderer(&#123;</span></span><br><span class="line"><span class="string">  template: fs.readFileSync('</span>./index.template.html<span class="string">','</span>utf<span class="number">-8</span><span class="string">')</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string">server.get('</span>/<span class="string">',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">const app = new Vue(&#123;</span></span><br><span class="line"><span class="string">  template: `</span></span><br><span class="line"><span class="string">  &lt;div id="app"&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line"><span class="string">  data: &#123;</span></span><br><span class="line"><span class="string">    message: '</span>XXXX<span class="string">'</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">renderer.renderToString(app, (err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">  if(err) &#123;</span></span><br><span class="line"><span class="string">    return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  // res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">  res.end(html)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="4-在模板中使用外部数据"><a href="#4-在模板中使用外部数据" class="headerlink" title="4.在模板中使用外部数据"></a>4.在模板中使用外部数据</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.template.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1.0"</span>&gt;</span></span><br><span class="line">      &#123;&#123;&#123;meta&#125;&#125;&#125;</span><br><span class="line">      <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- vur-ssr-outlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">cosnst fs = require('</span>fs<span class="string">')</span></span><br><span class="line"><span class="string">const renderer = require('</span>vue-server-renderer<span class="string">').createRenderer(&#123;</span></span><br><span class="line"><span class="string">  template: fs.readFileSync('</span>./index.template.html<span class="string">','</span>utf<span class="number">-8</span><span class="string">')</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string">server.get('</span>/<span class="string">',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">const app = new Vue(&#123;</span></span><br><span class="line"><span class="string">  template: `</span></span><br><span class="line"><span class="string">  &lt;div id="app"&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line"><span class="string">  data: &#123;</span></span><br><span class="line"><span class="string">    message: '</span>XXXX<span class="string">'</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">renderer.renderToString(app, &#123;</span></span><br><span class="line"><span class="string">  title: '</span>XXXX<span class="string">',</span></span><br><span class="line"><span class="string">  meta: `&lt;meta name="description" content="XXXX"`</span></span><br><span class="line"><span class="string">&#125;，(err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">  if(err) &#123;</span></span><br><span class="line"><span class="string">    return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  // res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">  res.end(html)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="5-构建配置-基本思路"><a href="#5-构建配置-基本思路" class="headerlink" title="5.构建配置-基本思路"></a>5.构建配置-基本思路</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">cosnst fs = require('</span>fs<span class="string">')</span></span><br><span class="line"><span class="string">const renderer = require('</span>vue-server-renderer<span class="string">').createRenderer(&#123;</span></span><br><span class="line"><span class="string">  template: fs.readFileSync('</span>./index.template.html<span class="string">','</span>utf<span class="number">-8</span><span class="string">')</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string">server.get('</span>/<span class="string">',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">const app = new Vue(&#123;</span></span><br><span class="line"><span class="string">  template: `</span></span><br><span class="line"><span class="string">  &lt;div id="app"&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;h2&gt;客户端动态交互&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;input v-model="message"&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;button @click="onClick"&gt;点击测试&lt;/button&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line"><span class="string">  data: &#123;</span></span><br><span class="line"><span class="string">    message: '</span>XXXX<span class="string">'</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  methods: &#123;</span></span><br><span class="line"><span class="string">    onClick()&#123;</span></span><br><span class="line"><span class="string">      console.log('</span>Hello World!<span class="string">')</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">renderer.renderToString(app, &#123;</span></span><br><span class="line"><span class="string">  title: '</span>XXXX<span class="string">',</span></span><br><span class="line"><span class="string">  meta: `&lt;meta name="description" content="XXXX"`</span></span><br><span class="line"><span class="string">&#125;，(err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">  if(err) &#123;</span></span><br><span class="line"><span class="string">    return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  // res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">  res.end(html)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="6-构建配置-源码结构"><a href="#6-构建配置-源码结构" class="headerlink" title="6.构建配置-源码结构"></a>6.构建配置-源码结构</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- App.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>客户端动态交互<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"message"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"onClick"</span>&gt;</span>点击测试<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">'App'</span>,</span></span><br><span class="line">  data()&#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      message: <span class="string">'XXXX'</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onClick()&#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'Hello World!'</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出一个工厂函数，用于创建新的</span></span><br><span class="line"><span class="comment">// 应用程序、router 和 store 实例</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createApp</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    <span class="comment">// 根实例简单的渲染应用程序组件。</span></span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123; app &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry-client.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端特定引导逻辑……</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; app &#125; = createApp()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里假定 App.vue 模板中根元素具有 `id="app"`</span></span><br><span class="line">app.$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry-server.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> context =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; app &#125; = createApp()</span><br><span class="line">  <span class="comment">// 服务端路由处理、数据预取</span></span><br><span class="line">  <span class="keyword">return</span> app</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-构建配置-安装依赖"><a href="#7-构建配置-安装依赖" class="headerlink" title="7.构建配置-安装依赖"></a>7.构建配置-安装依赖</h3><blockquote>
<p>安装依赖</p>
</blockquote>
<ul>
<li><p>安装生产依赖</p>
<ul>
<li>npm i vue vue-server-renderer express cross-env<ul>
<li>vue Vue.js 核心库</li>
<li>vue-server-renderer Vue 服务端渲染工具</li>
<li>express 基于 Node 的 Web 服务框架</li>
<li>cross-env 通过 npm scripts 设置跨平台环境变量</li>
</ul>
</li>
</ul>
</li>
<li><p>安装开发依赖</p>
<ul>
<li>npm i -D webpack webpack-cli webpack-merge webpack-node-externals @babel/core @babel/plugin-transform-runtime @babel/preset-env babel-loader css-loader url-loader file-loader rimraf vue-loader vue-template-compiler friendly-errors-webpack-plugin<ul>
<li>webpack webpack 核心包</li>
<li>webpack-cli webpack 的命令行工具</li>
<li>webpack-merge webpack 配置信息合并工具</li>
<li>webpack-node-externals 排除 webpack 中的 Node 模块</li>
<li>rimraf 基于 Node 封装的一个跨平台 rm -rf 工具</li>
<li>friendly-errors-webpack-plugin 友好的 webpack 错误提示</li>
<li>@babel/core @babel/plugin-transform-runtime @babel/preset-env babel-loader Babel 相关工具</li>
<li>vue-loader vue-template-compiler 处理 .vue 资源</li>
<li>file-loader 处理字体资源</li>
<li>css-loader 处理 CSS 资源</li>
<li>url-loader 处理图片资源</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="8-构建配置-webpack-配置文件"><a href="#8-构建配置-webpack-配置文件" class="headerlink" title="8.构建配置-webpack 配置文件"></a>8.构建配置-webpack 配置文件</h3><blockquote>
<p>配置文件及打包命令</p>
</blockquote>
<ul>
<li>初始化 webpack 打包配置文件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">build</span><br><span class="line">|—— webpack.base.config.js</span><br><span class="line">|—— webpack.client.config.js</span><br><span class="line">|—— webpack.server.config.js</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.base.config.js</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 公共配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> VueLoaderPlugin = <span class="built_in">require</span>(<span class="string">'vue-loader/lib/plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> FriendlyErrorsWebpackPlugin = <span class="built_in">require</span>(<span class="string">'friendly-errors-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">file</span> =&gt;</span> path.resolve(__dirname, file)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isProd = process.env.NODE_ENV === <span class="string">'production'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: isProd ? <span class="string">'production'</span> : <span class="string">'development'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: resolve(<span class="string">'../dist/'</span>),</span><br><span class="line">    publicPath: <span class="string">'/dist/'</span>,</span><br><span class="line">    filename: <span class="string">'[name].[chunkhash].js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="comment">// 路径别名，@ 指向 src</span></span><br><span class="line">      <span class="string">'@'</span>: resolve(<span class="string">'../src/'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 可以省略的扩展名</span></span><br><span class="line">    <span class="comment">// 当省略扩展名的时候，按照从前往后的顺序依次解析</span></span><br><span class="line">    extensions: [<span class="string">'.js'</span>, <span class="string">'.vue'</span>, <span class="string">'.json'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: isProd ? <span class="string">'source-map'</span> : <span class="string">'cheap-module-eval-source-map'</span>,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      <span class="comment">// 处理图片资源</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg|gif)$/i</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">8192</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 处理字体资源</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(woff|woff2|eot|ttf|otf)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">'file-loader'</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 处理 .vue 资源</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">        loader: <span class="string">'vue-loader'</span></span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 处理 CSS 资源</span></span><br><span class="line">      <span class="comment">// 它会应用到普通的 `.css` 文件</span></span><br><span class="line">      <span class="comment">// 以及 `.vue` 文件中的 `&lt;style&gt;` 块</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">'vue-style-loader'</span>,</span><br><span class="line">          <span class="string">'css-loader'</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// CSS 预处理器，参考：https://vue-loader.vuejs.org/zh/guide/pre-processors.html</span></span><br><span class="line">      <span class="comment">// 例如处理 Less 资源</span></span><br><span class="line">      <span class="comment">// &#123;</span></span><br><span class="line">      <span class="comment">//   test: /\.less$/,</span></span><br><span class="line">      <span class="comment">//   use: [</span></span><br><span class="line">      <span class="comment">//     'vue-style-loader',</span></span><br><span class="line">      <span class="comment">//     'css-loader',</span></span><br><span class="line">      <span class="comment">//     'less-loader'</span></span><br><span class="line">      <span class="comment">//   ]</span></span><br><span class="line">      <span class="comment">// &#125;,</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> VueLoaderPlugin(),</span><br><span class="line">    <span class="keyword">new</span> FriendlyErrorsWebpackPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.client.config.js</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端打包配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.config.js'</span>)</span><br><span class="line"><span class="keyword">const</span> VueSSRClientPlugin = <span class="built_in">require</span>(<span class="string">'vue-server-renderer/client-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseConfig, &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: <span class="string">'./src/entry-client.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      <span class="comment">// ES6 转 ES5</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.m?js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/(node_modules|bower_components)/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [<span class="string">'@babel/preset-env'</span>],</span><br><span class="line">            cacheDirectory: <span class="literal">true</span>,</span><br><span class="line">            plugins: [<span class="string">'@babel/plugin-transform-runtime'</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重要信息：这将 webpack 运行时分离到一个引导 chunk 中，</span></span><br><span class="line">  <span class="comment">// 以便可以在之后正确注入异步 chunk。</span></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      name: <span class="string">"manifest"</span>,</span><br><span class="line">      minChunks: <span class="literal">Infinity</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// 此插件在输出目录中生成 `vue-ssr-client-manifest.json`。</span></span><br><span class="line">    <span class="keyword">new</span> VueSSRClientPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.server.config.js</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 服务端打包配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> nodeExternals = <span class="built_in">require</span>(<span class="string">'webpack-node-externals'</span>)</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.config.js'</span>)</span><br><span class="line"><span class="keyword">const</span> VueSSRServerPlugin = <span class="built_in">require</span>(<span class="string">'vue-server-renderer/server-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseConfig, &#123;</span><br><span class="line">  <span class="comment">// 将 entry 指向应用程序的 server entry 文件</span></span><br><span class="line">  entry: <span class="string">'./src/entry-server.js'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这允许 webpack 以 Node 适用方式处理模块加载</span></span><br><span class="line">  <span class="comment">// 并且还会在编译 Vue 组件时，</span></span><br><span class="line">  <span class="comment">// 告知 `vue-loader` 输送面向服务器代码(server-oriented code)。</span></span><br><span class="line">  target: <span class="string">'node'</span>,</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'server-bundle.js'</span>,</span><br><span class="line">    <span class="comment">// 此处告知 server bundle 使用 Node 风格导出模块(Node-style exports)</span></span><br><span class="line">    libraryTarget: <span class="string">'commonjs2'</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 不打包 node_modules 第三方包，而是保留 require 方式直接加载</span></span><br><span class="line">  externals: [nodeExternals(&#123;</span><br><span class="line">    <span class="comment">// 白名单中的资源依然正常打包</span></span><br><span class="line">    allowlist: [<span class="regexp">/\.css$/</span>]</span><br><span class="line">  &#125;)],</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// 这是将服务器的整个输出构建为单个 JSON 文件的插件。</span></span><br><span class="line">    <span class="comment">// 默认文件名为 `vue-ssr-server-bundle.json`</span></span><br><span class="line">    <span class="keyword">new</span> VueSSRServerPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="9-构建配置-配置构建命令"><a href="#9-构建配置-配置构建命令" class="headerlink" title="9.构建配置-配置构建命令"></a>9.构建配置-配置构建命令</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">  "scripts": &#123;</span><br><span class="line">    "build:client": "cross-env NODE_ENV=production webpack --config build/webpack.client.config.js",</span><br><span class="line">    "build:server": "cross-env NODE_ENV=production webpack --config build/webpack.server.config.js",</span><br><span class="line">    "build": "rimraf dist &amp;&amp; npm run build:client &amp;&amp; npm run build:server",</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h3 id="10-构建配置-启动应用"><a href="#10-构建配置-启动应用" class="headerlink" title="10.构建配置-启动应用"></a>10.构建配置-启动应用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">cosnst fs = require('</span>fs<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const serverBundle = require('</span>./dist/vue-ssr-server-bundle.json<span class="string">')</span></span><br><span class="line"><span class="string">const template = fs.readFileSync('</span>./index.template.html<span class="string">', '</span>utf<span class="number">-8</span><span class="string">')</span></span><br><span class="line"><span class="string">const clientManifest = require('</span>./dist/vue-ssr-client-manifest.json<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const renderer = require('</span>vue-server-renderer<span class="string">').createBundleRenderer(serverBundle,&#123;</span></span><br><span class="line"><span class="string">  template,</span></span><br><span class="line"><span class="string">  clientManifest</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.use('</span>./dist<span class="string">',express.static('</span>./dist<span class="string">'))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.get('</span>/<span class="string">',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">  renderer.renderToString(app, &#123;</span></span><br><span class="line"><span class="string">    title: '</span>XXXX<span class="string">',</span></span><br><span class="line"><span class="string">    meta: `&lt;meta name="description" content="XXXX"`</span></span><br><span class="line"><span class="string">  &#125;，(err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">    if(err) &#123;</span></span><br><span class="line"><span class="string">      return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    // res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">    res.end(html)</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="11-构建配置-解析渲染流程"><a href="#11-构建配置-解析渲染流程" class="headerlink" title="11.构建配置-解析渲染流程"></a>11.构建配置-解析渲染流程</h3><p>略</p>
<h3 id="12-构建配置开发模式-基本思路"><a href="#12-构建配置开发模式-基本思路" class="headerlink" title="12.构建配置开发模式-基本思路"></a>12.构建配置开发模式-基本思路</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">  "scripts": &#123;</span><br><span class="line">    "build:client": "cross-env NODE_ENV=production webpack --config build/webpack.client.config.js",</span><br><span class="line">    "build:server": "cross-env NODE_ENV=production webpack --config build/webpack.server.config.js",</span><br><span class="line">    "build": "rimraf dist &amp;&amp; npm run build:client &amp;&amp; npm run build:server",</span><br><span class="line">    "start": "cross-env NODE_ENV=production node server.js",</span><br><span class="line">    "dev": "node server.js"</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">cosnst fs = require('</span>fs<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const isProd = process.env.NODE_ENV === '</span>production<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">let renderer</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if(isProd)&#123;</span></span><br><span class="line"><span class="string">  const serverBundle = require('</span>./dist/vue-ssr-server-bundle.json<span class="string">')</span></span><br><span class="line"><span class="string">  const template = fs.readFileSync('</span>./index.template.html<span class="string">', '</span>utf<span class="number">-8</span><span class="string">')</span></span><br><span class="line"><span class="string">  const clientManifest = require('</span>./dist/vue-ssr-client-manifest.json<span class="string">')</span></span><br><span class="line"><span class="string">  renderer = require('</span>vue-server-renderer<span class="string">').createBundleRenderer(serverBundle,&#123;</span></span><br><span class="line"><span class="string">    template,</span></span><br><span class="line"><span class="string">    clientManifest</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125; else &#123;</span></span><br><span class="line"><span class="string">  // 开发模式 -&gt; 监视打包构建 -&gt; 重新生成 Renderer 渲染器</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.use('</span>./dist<span class="string">',express.static('</span>./dist<span class="string">'))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const render = (req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">  renderer.renderToString(app, &#123;</span></span><br><span class="line"><span class="string">    title: '</span>XXXX<span class="string">',</span></span><br><span class="line"><span class="string">    meta: `&lt;meta name="description" content="XXXX"`</span></span><br><span class="line"><span class="string">  &#125;，(err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">    if(err) &#123;</span></span><br><span class="line"><span class="string">      return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    // res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">    res.end(html)</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.get('</span>/<span class="string">', isProd?render:(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">  // 等待有了 Renderer 渲染器以后，调用 render 进行渲染</span></span><br><span class="line"><span class="string">  render()</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="13-构建配置开发模式-提取处理模块"><a href="#13-构建配置开发模式-提取处理模块" class="headerlink" title="13.构建配置开发模式-提取处理模块"></a>13.构建配置开发模式-提取处理模块</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">cosnst fs = require('</span>fs<span class="string">')</span></span><br><span class="line"><span class="string">const &#123; createBundleRenderer &#125; = require('</span>vue-server-renderer<span class="string">')</span></span><br><span class="line"><span class="string">const setupDevServer = require('</span>./build/setup-dev-server<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.use('</span>./dist<span class="string">',express.static('</span>./dist<span class="string">'))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const isProd = process.env.NODE_ENV === '</span>production<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">let renderer</span></span><br><span class="line"><span class="string">let onReady</span></span><br><span class="line"><span class="string">if(isProd)&#123;</span></span><br><span class="line"><span class="string">  const serverBundle = require('</span>./dist/vue-ssr-server-bundle.json<span class="string">')</span></span><br><span class="line"><span class="string">  const template = fs.readFileSync('</span>./index.template.html<span class="string">', '</span>utf<span class="number">-8</span><span class="string">')</span></span><br><span class="line"><span class="string">  const clientManifest = require('</span>./dist/vue-ssr-client-manifest.json<span class="string">')</span></span><br><span class="line"><span class="string">  renderer = createBundleRenderer(serverBundle,&#123;</span></span><br><span class="line"><span class="string">    template,</span></span><br><span class="line"><span class="string">    clientManifest</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125; else &#123;</span></span><br><span class="line"><span class="string">  // 开发模式 -&gt; 监视打包构建 -&gt; 重新生成 Renderer 渲染器</span></span><br><span class="line"><span class="string">  onReady = setupDevServer(server, (serverBundle,template,clientManifest)=&gt;&#123;</span></span><br><span class="line"><span class="string">    renderer = createBundleRenderer(serverBundle,&#123;</span></span><br><span class="line"><span class="string">      template,</span></span><br><span class="line"><span class="string">      clientManifest</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const render = (req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">  renderer.renderToString(app, &#123;</span></span><br><span class="line"><span class="string">    title: '</span>XXXX<span class="string">',</span></span><br><span class="line"><span class="string">    meta: `&lt;meta name="description" content="XXXX"`</span></span><br><span class="line"><span class="string">  &#125;，(err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">    if(err) &#123;</span></span><br><span class="line"><span class="string">      return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    // res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">    res.end(html)</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.get('</span>/<span class="string">', isProd</span></span><br><span class="line"><span class="string">? render</span></span><br><span class="line"><span class="string">: async (req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">    // 等待有了 Renderer 渲染器以后，调用 render 进行渲染</span></span><br><span class="line"><span class="string">    await onReady</span></span><br><span class="line"><span class="string">    render(req,res)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup-dev-server.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">server, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onReady = <span class="keyword">new</span> <span class="built_in">Promise</span>()</span><br><span class="line">  <span class="comment">// 监视构建 -&gt; 更新 Renderer</span></span><br><span class="line">  <span class="keyword">return</span> onReady</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-构建配置开发模式-updata-更新函数"><a href="#14-构建配置开发模式-updata-更新函数" class="headerlink" title="14.构建配置开发模式-updata 更新函数"></a>14.构建配置开发模式-updata 更新函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup-dev-server.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">server, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onReady = <span class="keyword">new</span> <span class="built_in">Promise</span>()</span><br><span class="line">  <span class="comment">// 监视构建 -&gt; 更新 Renderer</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> template</span><br><span class="line">  <span class="keyword">let</span> serverBundle</span><br><span class="line">  <span class="keyword">let</span> clientManifest</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> update = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(template &amp;&amp; serverBundle &amp;&amp; clientManifest) &#123;</span><br><span class="line">      ready()</span><br><span class="line">      callback(template, serverBundle, clientManifest)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 监视构建 template -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="comment">// 监视构建 serverBundle -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="comment">// 监视构建 clientManifest -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">return</span> onReady</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="15-构建配置开发模式-处理模板文件"><a href="#15-构建配置开发模式-处理模板文件" class="headerlink" title="15.构建配置开发模式-处理模板文件"></a>15.构建配置开发模式-处理模板文件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup-dev-server.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> chokidar = <span class="built_in">require</span>(<span class="string">'chokidar'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">server, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onReady = <span class="keyword">new</span> <span class="built_in">Promise</span>()</span><br><span class="line">  <span class="comment">// 监视构建 -&gt; 更新 Renderer</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> template</span><br><span class="line">  <span class="keyword">let</span> serverBundle</span><br><span class="line">  <span class="keyword">let</span> clientManifest</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> update = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(template &amp;&amp; serverBundle &amp;&amp; clientManifest) &#123;</span><br><span class="line">      ready()</span><br><span class="line">      callback(template, serverBundle, clientManifest)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 监视构建 template -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> templatePath = path.resolve(__dirname, <span class="string">'../index.template.html'</span>)</span><br><span class="line">  template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">  update()</span><br><span class="line">  chokidar.watch(templatePath).on(<span class="string">'change'</span>,() =&gt; &#123;</span><br><span class="line">    template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 监视构建 serverBundle -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="comment">// 监视构建 clientManifest -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">return</span> onReady</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="16-构建配置开发模式-服务器监视打包"><a href="#16-构建配置开发模式-服务器监视打包" class="headerlink" title="16.构建配置开发模式-服务器监视打包"></a>16.构建配置开发模式-服务器监视打包</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup-dev-server.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> chokidar = <span class="built_in">require</span>(<span class="string">'chokidar'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">file</span> =&gt;</span> path.resolve(__dirname, file)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">server, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onReady = <span class="keyword">new</span> <span class="built_in">Promise</span>()</span><br><span class="line">  <span class="comment">// 监视构建 -&gt; 更新 Renderer</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> template</span><br><span class="line">  <span class="keyword">let</span> serverBundle</span><br><span class="line">  <span class="keyword">let</span> clientManifest</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> update = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(template &amp;&amp; serverBundle &amp;&amp; clientManifest) &#123;</span><br><span class="line">      ready()</span><br><span class="line">      callback(template, serverBundle, clientManifest)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 监视构建 template -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> templatePath = path.resolve(__dirname, <span class="string">'../index.template.html'</span>)</span><br><span class="line">  template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">  update()</span><br><span class="line">  chokidar.watch(templatePath).on(<span class="string">'change'</span>,() =&gt; &#123;</span><br><span class="line">    template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 监视构建 serverBundle -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> serverConfig = <span class="built_in">require</span>(<span class="string">'./webpack.server.config'</span>)</span><br><span class="line">  <span class="keyword">const</span> serverCompiler = webpack(serverConfig)</span><br><span class="line">  serverCompiler.watch(&#123;&#125;,(err, stats)=&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err</span><br><span class="line">    <span class="keyword">if</span>(stats.hasErrors()) <span class="keyword">return</span></span><br><span class="line">    serverBundle = Json.parse(</span><br><span class="line">      fs.readFileSync(resolve(<span class="string">'../dist/vue-ssr-server-bundle.json'</span>),<span class="string">'utf-8'</span>)</span><br><span class="line">    )</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 监视构建 clientManifest -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">return</span> onReady</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="17-构建配置开发模式-把数据写入内存中"><a href="#17-构建配置开发模式-把数据写入内存中" class="headerlink" title="17.构建配置开发模式-把数据写入内存中"></a>17.构建配置开发模式-把数据写入内存中</h3><ul>
<li>npm install webpack-dev-middleware –save-dev</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup-dev-server.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> chokidar = <span class="built_in">require</span>(<span class="string">'chokidar'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> devMiddleware = <span class="built_in">require</span>(<span class="string">'webpack-dev-middleware'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">file</span> =&gt;</span> path.resolve(__dirname, file)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">server, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onReady = <span class="keyword">new</span> <span class="built_in">Promise</span>()</span><br><span class="line">  <span class="comment">// 监视构建 -&gt; 更新 Renderer</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> template</span><br><span class="line">  <span class="keyword">let</span> serverBundle</span><br><span class="line">  <span class="keyword">let</span> clientManifest</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> update = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(template &amp;&amp; serverBundle &amp;&amp; clientManifest) &#123;</span><br><span class="line">      ready()</span><br><span class="line">      callback(template, serverBundle, clientManifest)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 监视构建 template -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> templatePath = path.resolve(__dirname, <span class="string">'../index.template.html'</span>)</span><br><span class="line">  template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">  update()</span><br><span class="line">  chokidar.watch(templatePath).on(<span class="string">'change'</span>,() =&gt; &#123;</span><br><span class="line">    template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 监视构建 serverBundle -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> serverConfig = <span class="built_in">require</span>(<span class="string">'./webpack.server.config'</span>)</span><br><span class="line">  <span class="keyword">const</span> serverCompiler = webpack(serverConfig)</span><br><span class="line">  <span class="keyword">const</span> serverDevMiddleware = devMiddleware(serverCompiler, &#123;</span><br><span class="line">    logLevel: <span class="string">'silent'</span> <span class="comment">// 关闭日志输出，由 FriendlyErrorsWebpackPlugin 处理</span></span><br><span class="line">  &#125;)</span><br><span class="line">  serverCompiler.hooks.done.tap(<span class="string">'server'</span>,()=&gt;&#123;</span><br><span class="line">    serverBundle = <span class="built_in">JSON</span>.parse(</span><br><span class="line">      serverDevMiddleware.fileSystem.readFileSync(resolve(<span class="string">'../dist/vue-ssr-server-bundle.json'</span>),<span class="string">'utf-8'</span>)</span><br><span class="line">    )</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// serverCompiler.watch(&#123;&#125;,(err, stats)=&gt;&#123;</span></span><br><span class="line">  <span class="comment">//   if(err) throw err</span></span><br><span class="line">  <span class="comment">//   if(stats.hasErrors()) return</span></span><br><span class="line">  <span class="comment">//   serverBundle = JSON.parse(</span></span><br><span class="line">  <span class="comment">//     fs.readFileSync(resolve('../dist/vue-ssr-server-bundle.json'),'utf-8')</span></span><br><span class="line">  <span class="comment">//   )</span></span><br><span class="line">  <span class="comment">//   update()</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line">  <span class="comment">// 监视构建 clientManifest -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">return</span> onReady</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="18-构建配置开发模式-客户端构建"><a href="#18-构建配置开发模式-客户端构建" class="headerlink" title="18.构建配置开发模式-客户端构建"></a>18.构建配置开发模式-客户端构建</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup-dev-server.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> chokidar = <span class="built_in">require</span>(<span class="string">'chokidar'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> devMiddleware = <span class="built_in">require</span>(<span class="string">'webpack-dev-middleware'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">file</span> =&gt;</span> path.resolve(__dirname, file)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">server, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onReady = <span class="keyword">new</span> <span class="built_in">Promise</span>()</span><br><span class="line">  <span class="comment">// 监视构建 -&gt; 更新 Renderer</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> template</span><br><span class="line">  <span class="keyword">let</span> serverBundle</span><br><span class="line">  <span class="keyword">let</span> clientManifest</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> update = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(template &amp;&amp; serverBundle &amp;&amp; clientManifest) &#123;</span><br><span class="line">      ready()</span><br><span class="line">      callback(template, serverBundle, clientManifest)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 监视构建 template -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> templatePath = path.resolve(__dirname, <span class="string">'../index.template.html'</span>)</span><br><span class="line">  template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">  update()</span><br><span class="line">  chokidar.watch(templatePath).on(<span class="string">'change'</span>,() =&gt; &#123;</span><br><span class="line">    template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 监视构建 serverBundle -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> serverConfig = <span class="built_in">require</span>(<span class="string">'./webpack.server.config'</span>)</span><br><span class="line">  <span class="keyword">const</span> serverCompiler = webpack(serverConfig)</span><br><span class="line">  <span class="keyword">const</span> serverDevMiddleware = devMiddleware(serverCompiler, &#123;</span><br><span class="line">    logLevel: <span class="string">'silent'</span> <span class="comment">// 关闭日志输出，由 FriendlyErrorsWebpackPlugin 处理</span></span><br><span class="line">  &#125;)</span><br><span class="line">  serverCompiler.hooks.done.tap(<span class="string">'server'</span>,()=&gt;&#123;</span><br><span class="line">    serverBundle = <span class="built_in">JSON</span>.parse(</span><br><span class="line">      serverDevMiddleware.fileSystem.readFileSync(resolve(<span class="string">'../dist/vue-ssr-server-bundle.json'</span>),<span class="string">'utf-8'</span>)</span><br><span class="line">    )</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// serverCompiler.watch(&#123;&#125;,(err, stats)=&gt;&#123;</span></span><br><span class="line">  <span class="comment">//   if(err) throw err</span></span><br><span class="line">  <span class="comment">//   if(stats.hasErrors()) return</span></span><br><span class="line">  <span class="comment">//   serverBundle = JSON.parse(</span></span><br><span class="line">  <span class="comment">//     fs.readFileSync(resolve('../dist/vue-ssr-server-bundle.json'),'utf-8')</span></span><br><span class="line">  <span class="comment">//   )</span></span><br><span class="line">  <span class="comment">//   update()</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line">  <span class="comment">// 监视构建 clientManifest -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> clientConfig = <span class="built_in">require</span>(<span class="string">'./webpack.client.config'</span>)</span><br><span class="line">  <span class="keyword">const</span> clientCompiler = webpack(clientConfig)</span><br><span class="line">  <span class="keyword">const</span> clientDevMiddleware = devMiddleware(clientCompiler, &#123;</span><br><span class="line">    publicPath: clientConfig.output.publickPath,</span><br><span class="line">    logLevel: <span class="string">'silent'</span> <span class="comment">// 关闭日志输出，由 FriendlyErrorsWebpackPlugin 处理</span></span><br><span class="line">  &#125;)</span><br><span class="line">  clientCompiler.hooks.done.tap(<span class="string">'client'</span>,()=&gt;&#123;</span><br><span class="line">    clientManifest = <span class="built_in">JSON</span>.parse(</span><br><span class="line">      clientDevMiddleware.fileSystem.readFileSync(resolve(<span class="string">'../dist/vue-ssr-client-manifest.json'</span>),<span class="string">'utf-8'</span>)</span><br><span class="line">    )</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 将 clientDevMiddleware 挂载到 Express 服务中，提供对其内部内存中数据的访问</span></span><br><span class="line">  server.use(clientDevMiddleware)</span><br><span class="line">  <span class="keyword">return</span> onReady</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="19-构建配置开发模式-热更新"><a href="#19-构建配置开发模式-热更新" class="headerlink" title="19.构建配置开发模式-热更新"></a>19.构建配置开发模式-热更新</h3><ul>
<li>npm install –save-dev webpack-hot-middleware</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup-dev-server.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> chokidar = <span class="built_in">require</span>(<span class="string">'chokidar'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> devMiddleware = <span class="built_in">require</span>(<span class="string">'webpack-dev-middleware'</span>)</span><br><span class="line"><span class="keyword">const</span> hotMiddleware = <span class="built_in">require</span>(<span class="string">'webpack-hot-middleware'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">file</span> =&gt;</span> path.resolve(__dirname, file)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">server, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onReady = <span class="keyword">new</span> <span class="built_in">Promise</span>()</span><br><span class="line">  <span class="comment">// 监视构建 -&gt; 更新 Renderer</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> template</span><br><span class="line">  <span class="keyword">let</span> serverBundle</span><br><span class="line">  <span class="keyword">let</span> clientManifest</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> update = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(template &amp;&amp; serverBundle &amp;&amp; clientManifest) &#123;</span><br><span class="line">      ready()</span><br><span class="line">      callback(template, serverBundle, clientManifest)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 监视构建 template -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> templatePath = path.resolve(__dirname, <span class="string">'../index.template.html'</span>)</span><br><span class="line">  template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">  update()</span><br><span class="line">  chokidar.watch(templatePath).on(<span class="string">'change'</span>,() =&gt; &#123;</span><br><span class="line">    template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 监视构建 serverBundle -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> serverConfig = <span class="built_in">require</span>(<span class="string">'./webpack.server.config'</span>)</span><br><span class="line">  <span class="keyword">const</span> serverCompiler = webpack(serverConfig)</span><br><span class="line">  <span class="keyword">const</span> serverDevMiddleware = devMiddleware(serverCompiler, &#123;</span><br><span class="line">    logLevel: <span class="string">'silent'</span> <span class="comment">// 关闭日志输出，由 FriendlyErrorsWebpackPlugin 处理</span></span><br><span class="line">  &#125;)</span><br><span class="line">  serverCompiler.hooks.done.tap(<span class="string">'server'</span>,()=&gt;&#123;</span><br><span class="line">    serverBundle = <span class="built_in">JSON</span>.parse(</span><br><span class="line">      serverDevMiddleware.fileSystem.readFileSync(resolve(<span class="string">'../dist/vue-ssr-server-bundle.json'</span>),<span class="string">'utf-8'</span>)</span><br><span class="line">    )</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// serverCompiler.watch(&#123;&#125;,(err, stats)=&gt;&#123;</span></span><br><span class="line">  <span class="comment">//   if(err) throw err</span></span><br><span class="line">  <span class="comment">//   if(stats.hasErrors()) return</span></span><br><span class="line">  <span class="comment">//   serverBundle = JSON.parse(</span></span><br><span class="line">  <span class="comment">//     fs.readFileSync(resolve('../dist/vue-ssr-server-bundle.json'),'utf-8')</span></span><br><span class="line">  <span class="comment">//   )</span></span><br><span class="line">  <span class="comment">//   update()</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line">  <span class="comment">// 监视构建 clientManifest -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> clientConfig = <span class="built_in">require</span>(<span class="string">'./webpack.client.config'</span>)</span><br><span class="line">  clientConfig.plugins.push(<span class="keyword">new</span> webpack.HotModuleReplacementPlugin())</span><br><span class="line">  clientConfig.entry.app = [</span><br><span class="line">    <span class="string">'webpack-hot-middleware/client?quiet=true&amp;reload=true'</span>, <span class="comment">// 和服务端交互处理热更新一个客户端脚本</span></span><br><span class="line">    clientConfig.entry.app</span><br><span class="line">    ]</span><br><span class="line">  clientConfig.output.filename = <span class="string">'[name].js'</span> <span class="comment">// 热更新模式下确保一致的 hash</span></span><br><span class="line">  <span class="keyword">const</span> clientCompiler = webpack(clientConfig)</span><br><span class="line">  <span class="keyword">const</span> clientDevMiddleware = devMiddleware(clientCompiler, &#123;</span><br><span class="line">    publicPath: clientConfig.output.publickPath,</span><br><span class="line">    logLevel: <span class="string">'silent'</span> <span class="comment">// 关闭日志输出，由 FriendlyErrorsWebpackPlugin 处理</span></span><br><span class="line">  &#125;)</span><br><span class="line">  clientCompiler.hooks.done.tap(<span class="string">'client'</span>,()=&gt;&#123;</span><br><span class="line">    clientManifest = <span class="built_in">JSON</span>.parse(</span><br><span class="line">      clientDevMiddleware.fileSystem.readFileSync(resolve(<span class="string">'../dist/vue-ssr-client-manifest.json'</span>),<span class="string">'utf-8'</span>)</span><br><span class="line">    )</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  server.use(hotMiddleware(clientCompiler, &#123;</span><br><span class="line">    log: <span class="literal">false</span> <span class="comment">// 关闭本身的日志输出</span></span><br><span class="line">  &#125;))</span><br><span class="line">  <span class="comment">// 将 clientDevMiddleware 挂载到 Express 服务中，提供对其内部内存中数据的访问</span></span><br><span class="line">  server.use(clientDevMiddleware)</span><br><span class="line">  <span class="keyword">return</span> onReady</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="20-编写通用应用注意事项"><a href="#20-编写通用应用注意事项" class="headerlink" title="20.编写通用应用注意事项"></a>20.编写通用应用注意事项</h3><p>略</p>
<h3 id="21-路由处理-配置-VueRouter"><a href="#21-路由处理-配置-VueRouter" class="headerlink" title="21.路由处理-配置 VueRouter"></a>21.路由处理-配置 VueRouter</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'@/pages/Home'</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createRouter = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">    mode: <span class="string">'history'</span>, <span class="comment">// 兼容前后端</span></span><br><span class="line">    routes: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'/'</span>,</span><br><span class="line">        name: <span class="string">'home'</span>,</span><br><span class="line">        component: Home</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'/about'</span>,</span><br><span class="line">        name: <span class="string">'about'</span>,</span><br><span class="line">        component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/About'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'/posts'</span>,</span><br><span class="line">        name: <span class="string">'post-list'</span>,</span><br><span class="line">        component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/Posts'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'*'</span>,</span><br><span class="line">        name: <span class="string">'error404'</span>,</span><br><span class="line">        component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/404'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> router</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="22-路由处理-将路由注册到根实例"><a href="#22-路由处理-将路由注册到根实例" class="headerlink" title="22.路由处理-将路由注册到根实例"></a>22.路由处理-将路由注册到根实例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter &#125; <span class="keyword">from</span> <span class="string">'./router/index.js'</span></span><br><span class="line"><span class="comment">// 导出一个工厂函数，用于创建新的</span></span><br><span class="line"><span class="comment">// 应用程序、router 和 store 实例</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createApp</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> router = createRouter()</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    router,</span><br><span class="line">    <span class="comment">// 根实例简单的渲染应用程序组件。</span></span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123; app , router&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="23-路由处理-适配服务端入口"><a href="#23-路由处理-适配服务端入口" class="headerlink" title="23.路由处理-适配服务端入口"></a>23.路由处理-适配服务端入口</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry-server.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> context =&gt; &#123;</span><br><span class="line">  <span class="comment">// 因为有可能会是异步路由钩子函数或组件，所以我们将返回一个 Promise，</span></span><br><span class="line">  <span class="comment">// 以便服务器能够等待所有的内容在渲染前，</span></span><br><span class="line">  <span class="comment">// 就已经准备就绪。</span></span><br><span class="line">  <span class="keyword">const</span> &#123; app, router &#125; = createApp()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置服务器端 router 的位置</span></span><br><span class="line">  router.push(context.url)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 等到 router 将可能的异步组件和钩子函数解析完</span></span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(router.onReady.bind(router))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> app</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="24-路由处理-服务端-server-适配"><a href="#24-路由处理-服务端-server-适配" class="headerlink" title="24.路由处理-服务端 server 适配"></a>24.路由处理-服务端 server 适配</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">cosnst fs = require('</span>fs<span class="string">')</span></span><br><span class="line"><span class="string">const &#123; createBundleRenderer &#125; = require('</span>vue-server-renderer<span class="string">')</span></span><br><span class="line"><span class="string">const setupDevServer = require('</span>./build/setup-dev-server<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.use('</span>./dist<span class="string">',express.static('</span>./dist<span class="string">'))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const isProd = process.env.NODE_ENV === '</span>production<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">let renderer</span></span><br><span class="line"><span class="string">let onReady</span></span><br><span class="line"><span class="string">if(isProd)&#123;</span></span><br><span class="line"><span class="string">  const serverBundle = require('</span>./dist/vue-ssr-server-bundle.json<span class="string">')</span></span><br><span class="line"><span class="string">  const template = fs.readFileSync('</span>./index.template.html<span class="string">', '</span>utf<span class="number">-8</span><span class="string">')</span></span><br><span class="line"><span class="string">  const clientManifest = require('</span>./dist/vue-ssr-client-manifest.json<span class="string">')</span></span><br><span class="line"><span class="string">  renderer = createBundleRenderer(serverBundle,&#123;</span></span><br><span class="line"><span class="string">    template,</span></span><br><span class="line"><span class="string">    clientManifest</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125; else &#123;</span></span><br><span class="line"><span class="string">  // 开发模式 -&gt; 监视打包构建 -&gt; 重新生成 Renderer 渲染器</span></span><br><span class="line"><span class="string">  onReady = setupDevServer(server, (serverBundle,template,clientManifest)=&gt;&#123;</span></span><br><span class="line"><span class="string">    renderer = createBundleRenderer(serverBundle,&#123;</span></span><br><span class="line"><span class="string">      template,</span></span><br><span class="line"><span class="string">      clientManifest</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const render = async (req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">  try &#123;</span></span><br><span class="line"><span class="string">    const html = await renderer.renderToString(app, &#123;</span></span><br><span class="line"><span class="string">      title: '</span>XXXX<span class="string">',</span></span><br><span class="line"><span class="string">      meta: `&lt;meta name="description" content="XXXX"`,</span></span><br><span class="line"><span class="string">      url: req.url</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">    res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">    res.end(html)</span></span><br><span class="line"><span class="string">  &#125; catch (err) &#123;</span></span><br><span class="line"><span class="string">    return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">// 服务端路由设置为 * ，意味着所有的路由都会进入这里</span></span><br><span class="line"><span class="string">server.get('</span>*<span class="string">', isProd</span></span><br><span class="line"><span class="string">? render</span></span><br><span class="line"><span class="string">: async (req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">    // 等待有了 Renderer 渲染器以后，调用 render 进行渲染</span></span><br><span class="line"><span class="string">    await onReady</span></span><br><span class="line"><span class="string">    render(req,res)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="25-路由处理-适配客户端入口"><a href="#25-路由处理-适配客户端入口" class="headerlink" title="25.路由处理-适配客户端入口"></a>25.路由处理-适配客户端入口</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry-client.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端特定引导逻辑……</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; app, router &#125; = createApp()</span><br><span class="line"></span><br><span class="line">router.onReady(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  app.$mount(<span class="string">'#app'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="26-路由处理-处理完成"><a href="#26-路由处理-处理完成" class="headerlink" title="26.路由处理-处理完成"></a>26.路由处理-处理完成</h3><p>略</p>
<h3 id="27-管理页面-Head-内容"><a href="#27-管理页面-Head-内容" class="headerlink" title="27.管理页面 Head 内容"></a>27.管理页面 Head 内容</h3><ul>
<li>npm i vue-meta</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter &#125; <span class="keyword">from</span> <span class="string">'./router/index.js'</span></span><br><span class="line"><span class="keyword">import</span> VueMeta <span class="keyword">from</span> <span class="string">'vue-meta'</span></span><br><span class="line">Vue.use(VueMeta)</span><br><span class="line">Vue.mixin(&#123;</span><br><span class="line">  metaInfo: &#123;</span><br><span class="line">    titleTemplate: <span class="string">'%s - XXXX'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 导出一个工厂函数，用于创建新的</span></span><br><span class="line"><span class="comment">// 应用程序、router 和 store 实例</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createApp</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> router = createRouter()</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    router,</span><br><span class="line">    <span class="comment">// 根实例简单的渲染应用程序组件。</span></span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123; app , router&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry-server.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> context =&gt; &#123;</span><br><span class="line">  <span class="comment">// 因为有可能会是异步路由钩子函数或组件，所以我们将返回一个 Promise，</span></span><br><span class="line">  <span class="comment">// 以便服务器能够等待所有的内容在渲染前，</span></span><br><span class="line">  <span class="comment">// 就已经准备就绪。</span></span><br><span class="line">  <span class="keyword">const</span> &#123; app, router &#125; = createApp()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置服务器端 router 的位置</span></span><br><span class="line">  router.push(context.url)</span><br><span class="line"></span><br><span class="line">  context.meta = meta</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 等到 router 将可能的异步组件和钩子函数解析完</span></span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(router.onReady.bind(router))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> app</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.template.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1.0"</span>&gt;</span></span><br><span class="line">      &#123;&#123;&#123; meta.inject().title.text() &#125;&#125;&#125;</span><br><span class="line">      &#123;&#123;&#123; meta.inject().meta.text() &#125;&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- vur-ssr-outlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="28-数据预取和状态管理-思路分析"><a href="#28-数据预取和状态管理-思路分析" class="headerlink" title="28.数据预取和状态管理-思路分析"></a>28.数据预取和状态管理-思路分析</h3><p>略</p>
<h3 id="29-数据预取和状态管理-数据预取"><a href="#29-数据预取和状态管理-数据预取" class="headerlink" title="29.数据预取和状态管理-数据预取"></a>29.数据预取和状态管理-数据预取</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createStore = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">      posts: []</span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    mutations: &#123;</span><br><span class="line">      setPosts (state, data) &#123;</span><br><span class="line">        state.posts = data</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    actions: &#123;</span><br><span class="line">      <span class="comment">// 在服务端渲染期间务必让 action 返回一个 Promise</span></span><br><span class="line">      <span class="keyword">async</span> getPosts (&#123; commit &#125;) &#123;</span><br><span class="line">        <span class="comment">// return new Promise()</span></span><br><span class="line">        <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.get(<span class="string">'https://cnodejs.org/api/v1/topics'</span>)</span><br><span class="line">        commit(<span class="string">'setPosts'</span>, data.data)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用启动入口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter &#125; <span class="keyword">from</span> <span class="string">'./router/'</span></span><br><span class="line"><span class="keyword">import</span> VueMeta <span class="keyword">from</span> <span class="string">'vue-meta'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'./store'</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueMeta)</span><br><span class="line"></span><br><span class="line">Vue.mixin(&#123;</span><br><span class="line">  metaInfo: &#123;</span><br><span class="line">    titleTemplate: <span class="string">'%s - XXXX'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出一个工厂函数，用于创建新的</span></span><br><span class="line"><span class="comment">// 应用程序、router 和 store 实例</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createApp</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> router = createRouter()</span><br><span class="line">  <span class="keyword">const</span> store = createStore()</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    router, <span class="comment">// 把路由挂载到 Vue 根实例中</span></span><br><span class="line">    store, <span class="comment">// 把容器挂载到 Vue 根实例中</span></span><br><span class="line">    <span class="comment">// 根实例简单的渲染应用程序组件。</span></span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123; app, router, store &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="30-数据预取和状态管理-将预取数据同步到客户端"><a href="#30-数据预取和状态管理-将预取数据同步到客户端" class="headerlink" title="30.数据预取和状态管理-将预取数据同步到客户端"></a>30.数据预取和状态管理-将预取数据同步到客户端</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry-server.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> context =&gt; &#123;</span><br><span class="line">  <span class="comment">// 因为有可能会是异步路由钩子函数或组件，所以我们将返回一个 Promise，</span></span><br><span class="line">    <span class="comment">// 以便服务器能够等待所有的内容在渲染前，</span></span><br><span class="line">    <span class="comment">// 就已经准备就绪。</span></span><br><span class="line">  <span class="keyword">const</span> &#123; app, router, store &#125; = createApp()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> meta = app.$meta()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置服务器端 router 的位置</span></span><br><span class="line">  router.push(context.url)</span><br><span class="line"></span><br><span class="line">  context.meta = meta</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 等到 router 将可能的异步组件和钩子函数解析完</span></span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(router.onReady.bind(router))</span><br><span class="line"></span><br><span class="line">  context.rendered = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Renderer 会把 context.state 数据对象内联到页面模板中</span></span><br><span class="line">    <span class="comment">// 最终发送给客户端的页面中会包含一段脚本：window.__INITIAL_STATE__ = context.state</span></span><br><span class="line">    <span class="comment">// 客户端就要把页面中的 window.__INITIAL_STATE__ 拿出来填充到客户端 store 容器中</span></span><br><span class="line">    context.state = store.state</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> app</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry.client.js</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端入口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端特定引导逻辑……</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; app, router, store &#125; = createApp()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.__INITIAL_STATE__) &#123;</span><br><span class="line">  store.replaceState(<span class="built_in">window</span>.__INITIAL_STATE__)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.onReady(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  app.$mount(<span class="string">'#app'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="任务二：静态站点生成"><a href="#任务二：静态站点生成" class="headerlink" title="任务二：静态站点生成"></a>任务二：静态站点生成</h2><h3 id="1-Gridsome基础-介绍"><a href="#1-Gridsome基础-介绍" class="headerlink" title="1.Gridsome基础-介绍"></a>1.Gridsome基础-介绍</h3><blockquote>
<p>Gridsome 是什么</p>
</blockquote>
<ul>
<li>一个免费、开源、基于 Vue.js 技术栈的静态网站生成器</li>
<li>官方网站：<a href="https://gridsome.org/" target="_blank" rel="noopener">https://gridsome.org/</a></li>
<li>GitHub: <a href="https://github.com/gridsome/gridsome" target="_blank" rel="noopener">https://github.com/gridsome/gridsome</a></li>
</ul>
<blockquote>
<p>什么是静态网站生成器</p>
</blockquote>
<ul>
<li>静态网站生成器是使用一系列配置、模板以及数据，生成静态 HTML 文件及相关资源的工具</li>
<li>这个功能也叫预渲染</li>
<li>生成的网站不需要类似 PHP 这样的服务器</li>
<li>只需要放到支持静态资源的 Web Server 或 CDN 上即可运行</li>
</ul>
<blockquote>
<p>静态网站的好处</p>
</blockquote>
<ul>
<li><p>省钱</p>
<ul>
<li>不需要专业的服务器，只要能托管静态文件的空间即可</li>
</ul>
</li>
<li><p>快速</p>
<ul>
<li>不经过后端服务器处理，只传输内容</li>
</ul>
</li>
<li><p>安全</p>
<ul>
<li>没有后端程序的运行，自然会更安全</li>
</ul>
</li>
</ul>
<blockquote>
<p>常见的静态网站生成器</p>
</blockquote>
<ul>
<li>Jekyll(Ruby)</li>
<li>Hexo(Node)</li>
<li>Hugo(Golang)</li>
<li>Gatsby(Node/React)</li>
<li>Gridsome(Node/Vue)</li>
<li>另外，Next.js，Nuxt.js 也能生成静态网站，但是它们更多被认为是 SSR（服务端渲染）框架。</li>
</ul>
<blockquote>
<p>JAMStack</p>
</blockquote>
<ul>
<li>这类静态网站生成器还有个漂亮的名字叫 JAMStack</li>
<li>JAMStack 的 JAM 是 JavaScript、API 和 Markup 的首字母组合</li>
<li>本质上是一种胖前端，通过调用各种 API 来实现更多的功能</li>
<li>其实也是一种前后端的模式，只不过离得比较开，甚至前后端来自多个不同的厂商</li>
</ul>
<blockquote>
<p>静态应用使用场景</p>
</blockquote>
<ul>
<li><p>不适合有大量路由页面的应用</p>
<ul>
<li>如果您的站点有成百上千条路由页面，则预渲染将非常缓慢。当然，您每次更新只需要做一次，但是可能要花一些时间。大多数人不会最终获得数千条静态路由页面，而只是以防万一。</li>
</ul>
</li>
<li><p>不适合有大量动态内容的应用</p>
<ul>
<li>如果渲染路线中包含特定于用户查看其内容或其他动态源的内容，则应确保您具有可以显示的占位符组件，直到动态内容加载到客户端为止。否则可能有点怪异。</li>
</ul>
</li>
</ul>
<blockquote>
<p>Gridsome 学习建议</p>
</blockquote>
<ul>
<li>使用 Gridsome 需要一定的 Vue 基础，如果有基础，看过文档，只会觉得比 Vue 本身更简单一些。</li>
</ul>
<h3 id="2-Gridsome基础-创建-Gridsome-项目"><a href="#2-Gridsome基础-创建-Gridsome-项目" class="headerlink" title="2.Gridsome基础-创建 Gridsome 项目"></a>2.Gridsome基础-创建 Gridsome 项目</h3><ul>
<li><p><a href="https://github.com/lovell/sharp" target="_blank" rel="noopener">https://github.com/lovell/sharp</a></p>
<ul>
<li>npm config set sharp_binary_host “<a href="https://npm.taobao.org/mirrors/sharp&quot;" target="_blank" rel="noopener">https://npm.taobao.org/mirrors/sharp&quot;</a></li>
<li>npm config set sharp_libvips_binary_host “<a href="https://npm.taobao.org/mirrors/sharp-libvips&quot;" target="_blank" rel="noopener">https://npm.taobao.org/mirrors/sharp-libvips&quot;</a></li>
</ul>
</li>
<li><p><a href="https://github.com/nodejs/node-gyp" target="_blank" rel="noopener">https://github.com/nodejs/node-gyp</a></p>
<ul>
<li>npm install -g node-gyp</li>
<li>npm install –global windows-build-tools</li>
</ul>
</li>
</ul>
<h3 id="3-Gridsome基础-预渲染"><a href="#3-Gridsome基础-预渲染" class="headerlink" title="3.Gridsome基础-预渲染"></a>3.Gridsome基础-预渲染</h3><ul>
<li>npm i -g serve</li>
<li>serve dist</li>
</ul>
<h3 id="4-Gridsome基础-目录结构"><a href="#4-Gridsome基础-目录结构" class="headerlink" title="4.Gridsome基础-目录结构"></a>4.Gridsome基础-目录结构</h3><p>略</p>
<h3 id="5-Gridsome基础-项目配置"><a href="#5-Gridsome基础-项目配置" class="headerlink" title="5.Gridsome基础-项目配置"></a>5.Gridsome基础-项目配置</h3><p>略</p>
<h3 id="6-Gridsome基础-Pages"><a href="#6-Gridsome基础-Pages" class="headerlink" title="6.Gridsome基础-Pages"></a>6.Gridsome基础-Pages</h3><p>略</p>
<h3 id="7-Gridsome基础-添加集合"><a href="#7-Gridsome基础-添加集合" class="headerlink" title="7.Gridsome基础-添加集合"></a>7.Gridsome基础-添加集合</h3><p>略</p>
<h3 id="8-Gridsome基础-在-GraphQL-中查询数据"><a href="#8-Gridsome基础-在-GraphQL-中查询数据" class="headerlink" title="8.Gridsome基础-在 GraphQL 中查询数据"></a>8.Gridsome基础-在 GraphQL 中查询数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://localhost:8080/___explore</span></span><br><span class="line"># query &#123;</span><br><span class="line">#   post(id:2)&#123;</span><br><span class="line">#     id</span><br><span class="line">#     title</span><br><span class="line">#     content</span><br><span class="line">#   &#125;</span><br><span class="line"># &#125;</span><br><span class="line"></span><br><span class="line">query&#123;</span><br><span class="line">  allPost&#123;</span><br><span class="line">    edges&#123;</span><br><span class="line">      node&#123;</span><br><span class="line">        id</span><br><span class="line">        title</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-Gridsome基础-在页面中查询-GraphQL"><a href="#9-Gridsome基础-在页面中查询-GraphQL" class="headerlink" title="9.Gridsome基础-在页面中查询 GraphQL"></a>9.Gridsome基础-在页面中查询 GraphQL</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Layout&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;Post2&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">        &lt;li v-for="edge in $page.posts.edges" :key="edge.node.id"&gt;</span></span><br><span class="line"><span class="regexp">          &lt;g-link to="/</span><span class="string">"&gt;&#123;&#123; edge.node.title &#125;&#125;&lt;/g-link&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">      &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;/Layout&gt;</span></span><br><span class="line"><span class="string">&lt;/template&gt;</span></span><br><span class="line"><span class="string">&lt;page-query&gt;</span></span><br><span class="line"><span class="string">query&#123;</span></span><br><span class="line"><span class="string">  posts:allPost&#123;</span></span><br><span class="line"><span class="string">    edges&#123;</span></span><br><span class="line"><span class="string">      node&#123;</span></span><br><span class="line"><span class="string">        id</span></span><br><span class="line"><span class="string">        title</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/page-query&gt;</span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">export default &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;style&gt;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="10-Gridsome基础-使用模板渲染节点页面"><a href="#10-Gridsome基础-使用模板渲染节点页面" class="headerlink" title="10.Gridsome基础-使用模板渲染节点页面"></a>10.Gridsome基础-使用模板渲染节点页面</h3><p>略</p>
<h3 id="11-Gridsome案例-创建项目"><a href="#11-Gridsome案例-创建项目" class="headerlink" title="11.Gridsome案例-创建项目"></a>11.Gridsome案例-创建项目</h3><ul>
<li>gridsome create blog-with-gridsome</li>
</ul>
<h3 id="12-Gridsome案例-处理首页模板"><a href="#12-Gridsome案例-处理首页模板" class="headerlink" title="12.Gridsome案例-处理首页模板"></a>12.Gridsome案例-处理首页模板</h3><p>略</p>
<h3 id="13-Gridsome案例-处理其它页面模板"><a href="#13-Gridsome案例-处理其它页面模板" class="headerlink" title="13.Gridsome案例-处理其它页面模板"></a>13.Gridsome案例-处理其它页面模板</h3><p>略</p>
<h3 id="14-Gridsome案例-使用本地md文件管理文章内容"><a href="#14-Gridsome案例-使用本地md文件管理文章内容" class="headerlink" title="14.Gridsome案例-使用本地md文件管理文章内容"></a>14.Gridsome案例-使用本地md文件管理文章内容</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  siteName: <span class="string">'Gridsome'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    &#123;</span><br><span class="line">      use: <span class="string">'@gridsome/source-filesystem'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        typeName: <span class="string">'BlogPost'</span>,</span><br><span class="line">        path: <span class="string">'./content/blog/**/*.md'</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="15-Gridsome案例-Strapi介绍"><a href="#15-Gridsome案例-Strapi介绍" class="headerlink" title="15.Gridsome案例-Strapi介绍"></a>15.Gridsome案例-Strapi介绍</h3><ul>
<li><a href="https://strapi.io/" target="_blank" rel="noopener">https://strapi.io/</a></li>
</ul>
<h3 id="16-Gridsome案例-Strapi基本使用"><a href="#16-Gridsome案例-Strapi基本使用" class="headerlink" title="16.Gridsome案例-Strapi基本使用"></a>16.Gridsome案例-Strapi基本使用</h3><ul>
<li>npx create-strapi-app my-project –quickstart</li>
<li>一定要注意 node 版本</li>
</ul>
<h3 id="17-Gridsome案例-使用Strapi接口数据"><a href="#17-Gridsome案例-使用Strapi接口数据" class="headerlink" title="17.Gridsome案例-使用Strapi接口数据"></a>17.Gridsome案例-使用Strapi接口数据</h3><ul>
<li>运行使用 development，不然不支持插件</li>
<li>设置 public 权限，位置和教程不一样，在设置里</li>
</ul>
<h3 id="18-Gridsome案例-访问受保护的API"><a href="#18-Gridsome案例-访问受保护的API" class="headerlink" title="18.Gridsome案例-访问受保护的API"></a>18.Gridsome案例-访问受保护的API</h3><ul>
<li>添加角色权限，获取 token</li>
</ul>
<h3 id="19-Gridsome案例-通过GraphQL访问Strapi"><a href="#19-Gridsome案例-通过GraphQL访问Strapi" class="headerlink" title="19.Gridsome案例-通过GraphQL访问Strapi"></a>19.Gridsome案例-通过GraphQL访问Strapi</h3><p>略</p>
<h3 id="20-Gridsome案例-将Strapi数据预取到Gridsome应用中"><a href="#20-Gridsome案例-将Strapi数据预取到Gridsome应用中" class="headerlink" title="20.Gridsome案例-将Strapi数据预取到Gridsome应用中"></a>20.Gridsome案例-将Strapi数据预取到Gridsome应用中</h3><ul>
<li>npm install @gridsome/source-strapi</li>
</ul>
<h3 id="21-Gridsome案例-设计文章和标签数据模型"><a href="#21-Gridsome案例-设计文章和标签数据模型" class="headerlink" title="21.Gridsome案例-设计文章和标签数据模型"></a>21.Gridsome案例-设计文章和标签数据模型</h3><p>略</p>
<h3 id="22-Gridsome案例-展示文章列表"><a href="#22-Gridsome案例-展示文章列表" class="headerlink" title="22.Gridsome案例-展示文章列表"></a>22.Gridsome案例-展示文章列表</h3><p>略</p>
<h3 id="23-Gridsome案例-文章列表分页"><a href="#23-Gridsome案例-文章列表分页" class="headerlink" title="23.Gridsome案例-文章列表分页"></a>23.Gridsome案例-文章列表分页</h3><p>略</p>
<h3 id="24-Gridsome案例-展示文章详情"><a href="#24-Gridsome案例-展示文章详情" class="headerlink" title="24.Gridsome案例-展示文章详情"></a>24.Gridsome案例-展示文章详情</h3><p>略</p>
<h3 id="25-Gridsome案例-处理Markdown格式的文章内容"><a href="#25-Gridsome案例-处理Markdown格式的文章内容" class="headerlink" title="25.Gridsome案例-处理Markdown格式的文章内容"></a>25.Gridsome案例-处理Markdown格式的文章内容</h3><ul>
<li>npm install markdown-it</li>
</ul>
<h3 id="26-Gridsome案例-文章标签"><a href="#26-Gridsome案例-文章标签" class="headerlink" title="26.Gridsome案例-文章标签"></a>26.Gridsome案例-文章标签</h3><p>略</p>
<h3 id="27-Gridsome案例-基本设置"><a href="#27-Gridsome案例-基本设置" class="headerlink" title="27.Gridsome案例-基本设置"></a>27.Gridsome案例-基本设置</h3><p>略</p>
<h3 id="28-Gridsome案例-联系我"><a href="#28-Gridsome案例-联系我" class="headerlink" title="28.Gridsome案例-联系我"></a>28.Gridsome案例-联系我</h3><p>略</p>
<h3 id="29-Gridsome案例-部署Strapi"><a href="#29-Gridsome案例-部署Strapi" class="headerlink" title="29.Gridsome案例-部署Strapi"></a>29.Gridsome案例-部署Strapi</h3><ul>
<li>git remote add origin …</li>
<li>git push -u origin master</li>
<li>ssh …</li>
<li>git clone …</li>
<li>cd …</li>
<li>npm i</li>
<li>npm run build</li>
<li>npm run start</li>
<li>npm i -g pm2</li>
<li>pm2 start npm – run start –name …</li>
</ul>
<h3 id="30-Gridsome案例-把本地服务联通远程Strapi"><a href="#30-Gridsome案例-把本地服务联通远程Strapi" class="headerlink" title="30.Gridsome案例-把本地服务联通远程Strapi"></a>30.Gridsome案例-把本地服务联通远程Strapi</h3><p>略</p>
<h3 id="31-Gridsome案例-部署Gridsome应用"><a href="#31-Gridsome案例-部署Gridsome应用" class="headerlink" title="31.Gridsome案例-部署Gridsome应用"></a>31.Gridsome案例-部署Gridsome应用</h3><h2 id="任务三：封装-Vue-js-组件库"><a href="#任务三：封装-Vue-js-组件库" class="headerlink" title="任务三：封装 Vue.js 组件库"></a>任务三：封装 Vue.js 组件库</h2><h3 id="1-课程目标"><a href="#1-课程目标" class="headerlink" title="1.课程目标"></a>1.课程目标</h3><blockquote>
<p>开源组件库</p>
</blockquote>
<ul>
<li>Element-UI</li>
<li>iView</li>
</ul>
<blockquote>
<p>CDD</p>
</blockquote>
<ul>
<li>CDD(Component-Driven Development)<ul>
<li>自下而上</li>
<li>从组件级别开始，到页面级别结束</li>
</ul>
</li>
</ul>
<blockquote>
<p>CDD 的好处</p>
</blockquote>
<ul>
<li>组件在最大程度被重用</li>
<li>并行开发</li>
<li>可视化测试</li>
</ul>
<blockquote>
<p>课程介绍</p>
</blockquote>
<ul>
<li>处理组件边界情况</li>
<li>快速原型开发</li>
<li>组件开发</li>
<li>Storybook</li>
<li>Monorepo</li>
<li>基于模板生成包的结构</li>
<li>Lerna + yarn workspaces</li>
<li>组件测试</li>
<li>Rollup 打包</li>
</ul>
<h3 id="2-处理组件的边界情况"><a href="#2-处理组件的边界情况" class="headerlink" title="2.处理组件的边界情况"></a>2.处理组件的边界情况</h3><ul>
<li>$root</li>
<li>$parent/$children</li>
<li>$refs</li>
<li>依赖注入provide/inject</li>
</ul>
<h3 id="3-attrs-listeners"><a href="#3-attrs-listeners" class="headerlink" title="3.attrs-listeners"></a>3.attrs-listeners</h3><ul>
<li>$attrs<ul>
<li>把父组件中非 prop 属性绑定到内部组件</li>
</ul>
</li>
<li>$listeners<ul>
<li>把父组件中的 DOM 对象的原生事件绑定到内部组件</li>
</ul>
</li>
</ul>
<h3 id="4-快速原型开发"><a href="#4-快速原型开发" class="headerlink" title="4.快速原型开发"></a>4.快速原型开发</h3><blockquote>
<p>快速原型开发</p>
</blockquote>
<ul>
<li>VueCLI 中提供了一个插件可以进行原型快速开发</li>
<li>需要先额外安装一个全局的扩展<ul>
<li>npm install -g @vue/cli-service-global</li>
</ul>
</li>
<li>使用 vue serve 快速查看组件的运行效果</li>
</ul>
<blockquote>
<p>vue serve</p>
</blockquote>
<ul>
<li><p>vue serve 如果不指定参数默认会在当前目录找以下入口文件</p>
<ul>
<li>main.js、index.js、App.vue、app.vue</li>
</ul>
</li>
<li><p>可以指定要加载的组件</p>
<ul>
<li>vue serve ./src/login.vue</li>
</ul>
</li>
</ul>
<h3 id="5-快速原型开发-ElementUI"><a href="#5-快速原型开发-ElementUI" class="headerlink" title="5.快速原型开发-ElementUI"></a>5.快速原型开发-ElementUI</h3><blockquote>
<p>安装 ElementUI</p>
</blockquote>
<ul>
<li>初始化 package.json<ul>
<li>npm init -y</li>
</ul>
</li>
<li>安装 ElementUI<ul>
<li>vue add element</li>
</ul>
</li>
<li>加载 ElementUI，使用 Vue.use() 安装插件</li>
</ul>
<h3 id="6-组件开发-步骤条组件"><a href="#6-组件开发-步骤条组件" class="headerlink" title="6.组件开发-步骤条组件"></a>6.组件开发-步骤条组件</h3><blockquote>
<p>组件分类</p>
</blockquote>
<ul>
<li>第三方组件</li>
<li>基础组件</li>
<li>业务组件</li>
</ul>
<h3 id="7-组件开发-表单组件-上"><a href="#7-组件开发-表单组件-上" class="headerlink" title="7.组件开发-表单组件-上"></a>7.组件开发-表单组件-上</h3><blockquote>
<p>整体结构</p>
</blockquote>
<ul>
<li>Form</li>
<li>FormItem</li>
<li>Input</li>
<li>Button</li>
</ul>
<h3 id="8-组件开发-表单组件-下"><a href="#8-组件开发-表单组件-下" class="headerlink" title="8.组件开发-表单组件-下"></a>8.组件开发-表单组件-下</h3><p>略</p>
<h3 id="9-组件开发-表单组件-表单验证-上"><a href="#9-组件开发-表单组件-表单验证-上" class="headerlink" title="9.组件开发-表单组件-表单验证-上"></a>9.组件开发-表单组件-表单验证-上</h3><ul>
<li>npm install async-validator</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Form</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;form&gt;</span><br><span class="line">    &lt;slot&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">  &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;、script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    name:&#39;LgForm&#39;,</span><br><span class="line">    provide()&#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            form: this</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    props: &#123;</span><br><span class="line">        model: &#123;</span><br><span class="line">            type: Object</span><br><span class="line">        &#125;,</span><br><span class="line">        rules: &#123;</span><br><span class="line">            type: Object</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;、script&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; FormItem</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label&gt;&#123;&#123;label&#125;&#125;&lt;label&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;slot&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">      &lt;p v-if&#x3D;&quot;errMessage&quot;&gt;&#123;&#123;errMessage&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;、script&gt;</span><br><span class="line">import AsyncValidator from &#39;async-validator&#39;</span><br><span class="line">export default &#123;</span><br><span class="line">    name:&#39;LgFormItem&#39;,</span><br><span class="line">    inject:[&#39;form&#39;],</span><br><span class="line">    props: &#123;</span><br><span class="line">        label: &#123;</span><br><span class="line">            type: String</span><br><span class="line">        &#125;,</span><br><span class="line">        prop: &#123;</span><br><span class="line">            type: String</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted()&#123;</span><br><span class="line">        this.$on(&#39;validate&#39;,()&#x3D;&gt;&#123;</span><br><span class="line">            this.validate()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    data()&#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            errMessage: &#39;&#39;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        validate()&#123;</span><br><span class="line">            if(!this.prop) return</span><br><span class="line">            const value &#x3D; this.form.model[this.prop]</span><br><span class="line">            const rules &#x3D; this.form.rules[this.prop]</span><br><span class="line">            </span><br><span class="line">            const descriptor &#x3D; &#123;[this.prop]:rules&#125;</span><br><span class="line">            const validator &#x3D; new AsyncValidator(descriptor)</span><br><span class="line">            return validator.validate(&#123;[this.prop]:value&#125;,errors &#x3D;&gt; &#123;</span><br><span class="line">                if(errors)&#123;</span><br><span class="line">                    this.errMessage &#x3D; errors[0].message</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    this.errMessage &#x3D; &#39;&#39;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;、script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="10-组件开发-表单组件-表单验证-下"><a href="#10-组件开发-表单组件-表单验证-下" class="headerlink" title="10.组件开发-表单组件-表单验证-下"></a>10.组件开发-表单组件-表单验证-下</h3><blockquote>
<p>Input 组件验证</p>
</blockquote>
<ul>
<li>Input 组件中触发自定义事件 validate</li>
<li>FormItem 渲染完毕注册自定义事件 validate</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;&#x2F; Input</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;input v-bind&#x3D;&quot;$attrs&quot; :type&#x3D;&quot;type&quot; :value&#x3D;&quot;value&quot; @input&#x3D;&quot;handleInput&quot;&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;、script&gt;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    name:&#39;LgInput&#39;,</span><br><span class="line">    inheritAttrs: false,</span><br><span class="line">    props: &#123;</span><br><span class="line">        value: &#123;</span><br><span class="line">            type: String</span><br><span class="line">        &#125;,</span><br><span class="line">        type: &#123;</span><br><span class="line">            type: String,</span><br><span class="line">            default: &#39;text&#39;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        handleInput(evt) &#123;</span><br><span class="line">            this.$emit(&#39;input&#39;, evt.target.value)</span><br><span class="line">            const findParent &#x3D; parent &#x3D;&gt; &#123;</span><br><span class="line">                while (parent) &#123;</span><br><span class="line">                    if(parent.$options.name &#x3D;&#x3D;&#x3D; &#39;LgFormItem&#39;) &#123;</span><br><span class="line">                        break</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        parent &#x3D; parent.$parent</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                return parent</span><br><span class="line">            &#125;</span><br><span class="line">            const parent &#x3D; findParent(this.$parent)</span><br><span class="line">            if (parent) &#123;</span><br><span class="line">                parent.$emit(&#39;validate&#39;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;、script&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Button</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;button @click&#x3D;&quot;handleClick&quot;&gt;&lt;slot&gt;&lt;&#x2F;slot&gt;&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;、script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#39;LoButton&#39;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleClick(evt) &#123;</span><br><span class="line">      this.$emit(&#39;click&#39;,evt)</span><br><span class="line">      evt.preventDefault()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;、script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="11-Monorepo"><a href="#11-Monorepo" class="headerlink" title="11.Monorepo"></a>11.Monorepo</h3><blockquote>
<p>两种项目的组织方式</p>
</blockquote>
<ul>
<li><p>Multirepo(Multiple Repository)</p>
<ul>
<li>每一个包对应一个项目</li>
</ul>
</li>
<li><p>Monorepo(Monolithic Repository)</p>
<ul>
<li>一个项目仓库中管理多个模块/包</li>
</ul>
</li>
</ul>
<h3 id="12-Storybook上"><a href="#12-Storybook上" class="headerlink" title="12.Storybook上"></a>12.Storybook上</h3><blockquote>
<p>Storybook</p>
</blockquote>
<ul>
<li>可视化的组件展示平台</li>
<li>在隔离的开发环境中，以交互式的方式展示组件</li>
<li>独立开发组件</li>
<li>支持的框架<ul>
<li>React、React Native、Vue、Angular</li>
<li>Ember、HTML、Svelte、Mithril、Riot</li>
</ul>
</li>
</ul>
<blockquote>
<p>Storybook 安装</p>
</blockquote>
<ul>
<li>自动安装<ul>
<li>npx -p @storybook/cli sb init –type vue</li>
<li>yarn add vue</li>
<li>yarn add vue-loader vue-template-compiler –dev</li>
</ul>
</li>
<li>手动安装</li>
</ul>
<h3 id="13-Storybook下"><a href="#13-Storybook下" class="headerlink" title="13.Storybook下"></a>13.Storybook下</h3><p>略</p>
<h3 id="14-yarn-workspaces"><a href="#14-yarn-workspaces" class="headerlink" title="14.yarn workspaces"></a>14.yarn workspaces</h3><blockquote>
<p>开启 yarn 的工作区</p>
</blockquote>
<ul>
<li>项目根目录的 package.json</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"privite"</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">"workspaces"</span>: [</span><br><span class="line">  <span class="string">"./packages/*"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>yarn workspaces 使用</p>
</blockquote>
<ul>
<li><p>给工作区根目录安装开发依赖</p>
<ul>
<li>yarn add jest -D -W</li>
</ul>
</li>
<li><p>给指定工作区安装依赖</p>
<ul>
<li>yarn workspace lg-button add lodash@4</li>
</ul>
</li>
<li><p>给所有工作区安装依赖</p>
<ul>
<li>yarn install</li>
</ul>
</li>
</ul>
<h3 id="15-Lerna上"><a href="#15-Lerna上" class="headerlink" title="15.Lerna上"></a>15.Lerna上</h3><blockquote>
<p>Lerna 介绍</p>
</blockquote>
<ul>
<li>Lerna 是一个优化使用 git 和 npm 管理多包仓库的工作流工具</li>
<li>用于管理具有多个包的 JavaScript 项目</li>
<li>它可以一键把代码提交到 git 和 npm 仓库</li>
</ul>
<blockquote>
<p>lerna 使用</p>
</blockquote>
<ul>
<li><p>全局安装</p>
<ul>
<li>yarn global add lerna</li>
</ul>
</li>
<li><p>初始化</p>
<ul>
<li>lerna init</li>
</ul>
</li>
<li><p>发布</p>
<ul>
<li>lerna publish</li>
</ul>
</li>
</ul>
<h3 id="16-Lerna下"><a href="#16-Lerna下" class="headerlink" title="16.Lerna下"></a>16.Lerna下</h3><p>略</p>
<h3 id="17-Vue组件的单元测试"><a href="#17-Vue组件的单元测试" class="headerlink" title="17.Vue组件的单元测试"></a>17.Vue组件的单元测试</h3><blockquote>
<p>组件单元测试好处</p>
</blockquote>
<ul>
<li>提供描述组件行为的文档</li>
<li>节省手动测试的时间</li>
<li>减少研发新特性时产生的 bug</li>
<li>改进设计</li>
<li>促进重构</li>
</ul>
<blockquote>
<p>安装依赖</p>
</blockquote>
<ul>
<li>Vue Test Utils</li>
<li>Jest</li>
<li>vue-jest</li>
<li>babel-jest</li>
<li>安装<ul>
<li>yarn add jest @vue/test-utils vue-jest babel-jest -D -W</li>
</ul>
</li>
</ul>
<h3 id="18-Vue组件的单元测试-2"><a href="#18-Vue组件的单元测试-2" class="headerlink" title="18.Vue组件的单元测试 2"></a>18.Vue组件的单元测试 2</h3><blockquote>
<p>Jest 常用 API</p>
</blockquote>
<ul>
<li><p>全局函数</p>
<ul>
<li>describe(name, fn) 把相关测试组合在一起</li>
<li>test(name, fn) 测试方法</li>
<li>expect(value) 断言</li>
</ul>
</li>
<li><p>匹配器</p>
<ul>
<li>toBe(value) 判断值是否相等</li>
<li>toEqual(obj) 判断对象是否相等</li>
<li>toContain(value) 判断数组或者字符串中是否包含</li>
</ul>
</li>
<li><p>快照</p>
<ul>
<li>toMatchSnapshot()</li>
</ul>
</li>
</ul>
<blockquote>
<p>Vue Test Utils 常用 API</p>
</blockquote>
<ul>
<li><p>mount()</p>
<ul>
<li>创建一个包含被挂载和渲染的 Vue 组件的 Wrapper</li>
</ul>
</li>
<li><p>Wrapper</p>
<ul>
<li>vm wrapper 包裹的组件实例</li>
<li>props() 返回 Vue 实例选项中的 props 对象</li>
<li>html() 组件生成的 HTML 标签</li>
<li>find() 通过选择器返回匹配到的组件中的 DOM 元素</li>
<li>trigger() 触发 DOM 原生事件，自定义事件 wrapper.vm.$emit()</li>
</ul>
</li>
</ul>
<h3 id="19-Rollup打包上"><a href="#19-Rollup打包上" class="headerlink" title="19.Rollup打包上"></a>19.Rollup打包上</h3><blockquote>
<p>Rollup</p>
</blockquote>
<ul>
<li>Rollup 是一个模块打包器</li>
<li>Rollup 支持 Tree-shaking</li>
<li>打包的结果比 Webpack 要小</li>
<li>开发框架/组件库的时候使用 Rollup 更合适</li>
</ul>
<blockquote>
<p>安装依赖</p>
</blockquote>
<ul>
<li>Rollup</li>
<li>rollup-plugin-terser</li>
<li><a href="mailto:tollup-plugin-vue@5.1.9">tollup-plugin-vue@5.1.9</a></li>
<li>vue-template-compiler</li>
</ul>
<h3 id="20-Rollup打包下"><a href="#20-Rollup打包下" class="headerlink" title="20.Rollup打包下"></a>20.Rollup打包下</h3><p>略</p>
<h3 id="21-设置环境变量"><a href="#21-设置环境变量" class="headerlink" title="21.设置环境变量"></a>21.设置环境变量</h3><ul>
<li>yarn add cross-env -D -W</li>
</ul>
<h3 id="22-清理"><a href="#22-清理" class="headerlink" title="22.清理"></a>22.清理</h3><ul>
<li>yarn add rimraf -D -W</li>
</ul>
<h3 id="23-基于模板生成组件基本结构"><a href="#23-基于模板生成组件基本结构" class="headerlink" title="23.基于模板生成组件基本结构"></a>23.基于模板生成组件基本结构</h3><ul>
<li>yarn plop -W -D</li>
</ul>
<h3 id="24-基于模板生成组件基本结构2"><a href="#24-基于模板生成组件基本结构2" class="headerlink" title="24.基于模板生成组件基本结构2"></a>24.基于模板生成组件基本结构2</h3><p>略</p>
<h3 id="25-发布"><a href="#25-发布" class="headerlink" title="25.发布"></a>25.发布</h3><p>略</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JavaScipt/" rel="tag"># JavaScipt</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/01/01/33/" rel="next" title="新年寄语">
                <i class="fa fa-chevron-left"></i> 新年寄语
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/02/06/35/" rel="prev" title="学习笔记 ----- 【Vue.js 框架源码与进阶】Vue.js 3.0 Composition APIs 及 3.0 原理剖析">
                学习笔记 ----- 【Vue.js 框架源码与进阶】Vue.js 3.0 Composition APIs 及 3.0 原理剖析 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="FY" />
            
              <p class="site-author-name" itemprop="name">FY</p>
              <p class="site-description motion-element" itemprop="description">Just Be Yourself</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">48</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/xuanfeiyu" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Part-3-·-Vue-js-框架源码与进阶"><span class="nav-number">1.</span> <span class="nav-text">Part 3 · Vue.js 框架源码与进阶</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#模块四-·-搭建自己的SSR、静态站点生成（SSG）及封装-Vue-js-组件库"><span class="nav-number">1.1.</span> <span class="nav-text">模块四 · 搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#任务一：搭建自己的SSR"><span class="nav-number">1.2.</span> <span class="nav-text">任务一：搭建自己的SSR</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-渲染一个-Vue-实例"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.渲染一个 Vue 实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-结合到-Web-服务器中"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.结合到 Web 服务器中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-使用-HTML-模板"><span class="nav-number">1.2.3.</span> <span class="nav-text">3.使用 HTML 模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-在模板中使用外部数据"><span class="nav-number">1.2.4.</span> <span class="nav-text">4.在模板中使用外部数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-构建配置-基本思路"><span class="nav-number">1.2.5.</span> <span class="nav-text">5.构建配置-基本思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-构建配置-源码结构"><span class="nav-number">1.2.6.</span> <span class="nav-text">6.构建配置-源码结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-构建配置-安装依赖"><span class="nav-number">1.2.7.</span> <span class="nav-text">7.构建配置-安装依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-构建配置-webpack-配置文件"><span class="nav-number">1.2.8.</span> <span class="nav-text">8.构建配置-webpack 配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-构建配置-配置构建命令"><span class="nav-number">1.2.9.</span> <span class="nav-text">9.构建配置-配置构建命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-构建配置-启动应用"><span class="nav-number">1.2.10.</span> <span class="nav-text">10.构建配置-启动应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-构建配置-解析渲染流程"><span class="nav-number">1.2.11.</span> <span class="nav-text">11.构建配置-解析渲染流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-构建配置开发模式-基本思路"><span class="nav-number">1.2.12.</span> <span class="nav-text">12.构建配置开发模式-基本思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-构建配置开发模式-提取处理模块"><span class="nav-number">1.2.13.</span> <span class="nav-text">13.构建配置开发模式-提取处理模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-构建配置开发模式-updata-更新函数"><span class="nav-number">1.2.14.</span> <span class="nav-text">14.构建配置开发模式-updata 更新函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-构建配置开发模式-处理模板文件"><span class="nav-number">1.2.15.</span> <span class="nav-text">15.构建配置开发模式-处理模板文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-构建配置开发模式-服务器监视打包"><span class="nav-number">1.2.16.</span> <span class="nav-text">16.构建配置开发模式-服务器监视打包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-构建配置开发模式-把数据写入内存中"><span class="nav-number">1.2.17.</span> <span class="nav-text">17.构建配置开发模式-把数据写入内存中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-构建配置开发模式-客户端构建"><span class="nav-number">1.2.18.</span> <span class="nav-text">18.构建配置开发模式-客户端构建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-构建配置开发模式-热更新"><span class="nav-number">1.2.19.</span> <span class="nav-text">19.构建配置开发模式-热更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-编写通用应用注意事项"><span class="nav-number">1.2.20.</span> <span class="nav-text">20.编写通用应用注意事项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#21-路由处理-配置-VueRouter"><span class="nav-number">1.2.21.</span> <span class="nav-text">21.路由处理-配置 VueRouter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#22-路由处理-将路由注册到根实例"><span class="nav-number">1.2.22.</span> <span class="nav-text">22.路由处理-将路由注册到根实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#23-路由处理-适配服务端入口"><span class="nav-number">1.2.23.</span> <span class="nav-text">23.路由处理-适配服务端入口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#24-路由处理-服务端-server-适配"><span class="nav-number">1.2.24.</span> <span class="nav-text">24.路由处理-服务端 server 适配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#25-路由处理-适配客户端入口"><span class="nav-number">1.2.25.</span> <span class="nav-text">25.路由处理-适配客户端入口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#26-路由处理-处理完成"><span class="nav-number">1.2.26.</span> <span class="nav-text">26.路由处理-处理完成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#27-管理页面-Head-内容"><span class="nav-number">1.2.27.</span> <span class="nav-text">27.管理页面 Head 内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#28-数据预取和状态管理-思路分析"><span class="nav-number">1.2.28.</span> <span class="nav-text">28.数据预取和状态管理-思路分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#29-数据预取和状态管理-数据预取"><span class="nav-number">1.2.29.</span> <span class="nav-text">29.数据预取和状态管理-数据预取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#30-数据预取和状态管理-将预取数据同步到客户端"><span class="nav-number">1.2.30.</span> <span class="nav-text">30.数据预取和状态管理-将预取数据同步到客户端</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#任务二：静态站点生成"><span class="nav-number">1.3.</span> <span class="nav-text">任务二：静态站点生成</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Gridsome基础-介绍"><span class="nav-number">1.3.1.</span> <span class="nav-text">1.Gridsome基础-介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Gridsome基础-创建-Gridsome-项目"><span class="nav-number">1.3.2.</span> <span class="nav-text">2.Gridsome基础-创建 Gridsome 项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-Gridsome基础-预渲染"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.Gridsome基础-预渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-Gridsome基础-目录结构"><span class="nav-number">1.3.4.</span> <span class="nav-text">4.Gridsome基础-目录结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Gridsome基础-项目配置"><span class="nav-number">1.3.5.</span> <span class="nav-text">5.Gridsome基础-项目配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-Gridsome基础-Pages"><span class="nav-number">1.3.6.</span> <span class="nav-text">6.Gridsome基础-Pages</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-Gridsome基础-添加集合"><span class="nav-number">1.3.7.</span> <span class="nav-text">7.Gridsome基础-添加集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-Gridsome基础-在-GraphQL-中查询数据"><span class="nav-number">1.3.8.</span> <span class="nav-text">8.Gridsome基础-在 GraphQL 中查询数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-Gridsome基础-在页面中查询-GraphQL"><span class="nav-number">1.3.9.</span> <span class="nav-text">9.Gridsome基础-在页面中查询 GraphQL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-Gridsome基础-使用模板渲染节点页面"><span class="nav-number">1.3.10.</span> <span class="nav-text">10.Gridsome基础-使用模板渲染节点页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-Gridsome案例-创建项目"><span class="nav-number">1.3.11.</span> <span class="nav-text">11.Gridsome案例-创建项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-Gridsome案例-处理首页模板"><span class="nav-number">1.3.12.</span> <span class="nav-text">12.Gridsome案例-处理首页模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-Gridsome案例-处理其它页面模板"><span class="nav-number">1.3.13.</span> <span class="nav-text">13.Gridsome案例-处理其它页面模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-Gridsome案例-使用本地md文件管理文章内容"><span class="nav-number">1.3.14.</span> <span class="nav-text">14.Gridsome案例-使用本地md文件管理文章内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-Gridsome案例-Strapi介绍"><span class="nav-number">1.3.15.</span> <span class="nav-text">15.Gridsome案例-Strapi介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-Gridsome案例-Strapi基本使用"><span class="nav-number">1.3.16.</span> <span class="nav-text">16.Gridsome案例-Strapi基本使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-Gridsome案例-使用Strapi接口数据"><span class="nav-number">1.3.17.</span> <span class="nav-text">17.Gridsome案例-使用Strapi接口数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-Gridsome案例-访问受保护的API"><span class="nav-number">1.3.18.</span> <span class="nav-text">18.Gridsome案例-访问受保护的API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-Gridsome案例-通过GraphQL访问Strapi"><span class="nav-number">1.3.19.</span> <span class="nav-text">19.Gridsome案例-通过GraphQL访问Strapi</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-Gridsome案例-将Strapi数据预取到Gridsome应用中"><span class="nav-number">1.3.20.</span> <span class="nav-text">20.Gridsome案例-将Strapi数据预取到Gridsome应用中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#21-Gridsome案例-设计文章和标签数据模型"><span class="nav-number">1.3.21.</span> <span class="nav-text">21.Gridsome案例-设计文章和标签数据模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#22-Gridsome案例-展示文章列表"><span class="nav-number">1.3.22.</span> <span class="nav-text">22.Gridsome案例-展示文章列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#23-Gridsome案例-文章列表分页"><span class="nav-number">1.3.23.</span> <span class="nav-text">23.Gridsome案例-文章列表分页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#24-Gridsome案例-展示文章详情"><span class="nav-number">1.3.24.</span> <span class="nav-text">24.Gridsome案例-展示文章详情</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#25-Gridsome案例-处理Markdown格式的文章内容"><span class="nav-number">1.3.25.</span> <span class="nav-text">25.Gridsome案例-处理Markdown格式的文章内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#26-Gridsome案例-文章标签"><span class="nav-number">1.3.26.</span> <span class="nav-text">26.Gridsome案例-文章标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#27-Gridsome案例-基本设置"><span class="nav-number">1.3.27.</span> <span class="nav-text">27.Gridsome案例-基本设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#28-Gridsome案例-联系我"><span class="nav-number">1.3.28.</span> <span class="nav-text">28.Gridsome案例-联系我</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#29-Gridsome案例-部署Strapi"><span class="nav-number">1.3.29.</span> <span class="nav-text">29.Gridsome案例-部署Strapi</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#30-Gridsome案例-把本地服务联通远程Strapi"><span class="nav-number">1.3.30.</span> <span class="nav-text">30.Gridsome案例-把本地服务联通远程Strapi</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#31-Gridsome案例-部署Gridsome应用"><span class="nav-number">1.3.31.</span> <span class="nav-text">31.Gridsome案例-部署Gridsome应用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#任务三：封装-Vue-js-组件库"><span class="nav-number">1.4.</span> <span class="nav-text">任务三：封装 Vue.js 组件库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-课程目标"><span class="nav-number">1.4.1.</span> <span class="nav-text">1.课程目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-处理组件的边界情况"><span class="nav-number">1.4.2.</span> <span class="nav-text">2.处理组件的边界情况</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-attrs-listeners"><span class="nav-number">1.4.3.</span> <span class="nav-text">3.attrs-listeners</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-快速原型开发"><span class="nav-number">1.4.4.</span> <span class="nav-text">4.快速原型开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-快速原型开发-ElementUI"><span class="nav-number">1.4.5.</span> <span class="nav-text">5.快速原型开发-ElementUI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-组件开发-步骤条组件"><span class="nav-number">1.4.6.</span> <span class="nav-text">6.组件开发-步骤条组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-组件开发-表单组件-上"><span class="nav-number">1.4.7.</span> <span class="nav-text">7.组件开发-表单组件-上</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-组件开发-表单组件-下"><span class="nav-number">1.4.8.</span> <span class="nav-text">8.组件开发-表单组件-下</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-组件开发-表单组件-表单验证-上"><span class="nav-number">1.4.9.</span> <span class="nav-text">9.组件开发-表单组件-表单验证-上</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-组件开发-表单组件-表单验证-下"><span class="nav-number">1.4.10.</span> <span class="nav-text">10.组件开发-表单组件-表单验证-下</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-Monorepo"><span class="nav-number">1.4.11.</span> <span class="nav-text">11.Monorepo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-Storybook上"><span class="nav-number">1.4.12.</span> <span class="nav-text">12.Storybook上</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-Storybook下"><span class="nav-number">1.4.13.</span> <span class="nav-text">13.Storybook下</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-yarn-workspaces"><span class="nav-number">1.4.14.</span> <span class="nav-text">14.yarn workspaces</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-Lerna上"><span class="nav-number">1.4.15.</span> <span class="nav-text">15.Lerna上</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#16-Lerna下"><span class="nav-number">1.4.16.</span> <span class="nav-text">16.Lerna下</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-Vue组件的单元测试"><span class="nav-number">1.4.17.</span> <span class="nav-text">17.Vue组件的单元测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-Vue组件的单元测试-2"><span class="nav-number">1.4.18.</span> <span class="nav-text">18.Vue组件的单元测试 2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-Rollup打包上"><span class="nav-number">1.4.19.</span> <span class="nav-text">19.Rollup打包上</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-Rollup打包下"><span class="nav-number">1.4.20.</span> <span class="nav-text">20.Rollup打包下</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#21-设置环境变量"><span class="nav-number">1.4.21.</span> <span class="nav-text">21.设置环境变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#22-清理"><span class="nav-number">1.4.22.</span> <span class="nav-text">22.清理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#23-基于模板生成组件基本结构"><span class="nav-number">1.4.23.</span> <span class="nav-text">23.基于模板生成组件基本结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#24-基于模板生成组件基本结构2"><span class="nav-number">1.4.24.</span> <span class="nav-text">24.基于模板生成组件基本结构2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#25-发布"><span class="nav-number">1.4.25.</span> <span class="nav-text">25.发布</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">FY</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
