<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Just Be Yourself">
<meta property="og:type" content="website">
<meta property="og:title" content="旋の飞羽">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="旋の飞羽">
<meta property="og:description" content="Just Be Yourself">
<meta property="article:author" content="FY">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>旋の飞羽</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">旋の飞羽</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人间值得，未来可期。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/16/36/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旋の飞羽">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/16/36/" itemprop="url">学习笔记 ----- 【Vue.js 框架源码与进阶】Vue.js + Vuex + TypeScript 实战项目开发与项目优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-02-16T00:00:00+08:00">
                2021-02-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>作者：FY<br>引用请标明出处</p>
</blockquote>
<h1 id="Part-3-·-Vue-js-框架源码与进阶"><a href="#Part-3-·-Vue-js-框架源码与进阶" class="headerlink" title="Part 3 · Vue.js 框架源码与进阶"></a>Part 3 · Vue.js 框架源码与进阶</h1><h2 id="模块六-·-Vue-js-Vuex-TypeScript-实战项目开发与项目优化"><a href="#模块六-·-Vue-js-Vuex-TypeScript-实战项目开发与项目优化" class="headerlink" title="模块六 · Vue.js + Vuex + TypeScript 实战项目开发与项目优化"></a>模块六 · Vue.js + Vuex + TypeScript 实战项目开发与项目优化</h2><h2 id="任务一：Vue-项目实战"><a href="#任务一：Vue-项目实战" class="headerlink" title="任务一：Vue 项目实战"></a>任务一：Vue 项目实战</h2><h3 id="1-使用VueCLI创建项目"><a href="#1-使用VueCLI创建项目" class="headerlink" title="1.使用VueCLI创建项目"></a>1.使用VueCLI创建项目</h3><ul>
<li>vue create edu-boss-fed<ul>
<li>Manually select features</li>
<li>Babel</li>
<li>TypeScript</li>
<li>Router</li>
<li>Vuex</li>
<li>CSS Pre-processors</li>
<li>Linter / Formatter</li>
<li>Standard</li>
</ul>
</li>
</ul>
<h3 id="2-加入Git版本管理"><a href="#2-加入Git版本管理" class="headerlink" title="2.加入Git版本管理"></a>2.加入Git版本管理</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建本地仓库</span></span><br><span class="line">git init</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将文件添加到暂存区</span></span><br><span class="line">git add 文件</span><br><span class="line"><span class="meta">#</span><span class="bash"> 提交历史记录</span></span><br><span class="line">git commit "提交日志"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加远端仓库地址</span></span><br><span class="line">git remote add origin 你的远程仓库地址</span><br><span class="line"><span class="meta">#</span><span class="bash"> 推送提交</span></span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<h3 id="3-初始目录结构说明"><a href="#3-初始目录结构说明" class="headerlink" title="3.初始目录结构说明"></a>3.初始目录结构说明</h3><h3 id="4-调整初始目录结构"><a href="#4-调整初始目录结构" class="headerlink" title="4.调整初始目录结构"></a>4.调整初始目录结构</h3><h3 id="5-使用TS开发Vue-环境说明"><a href="#5-使用TS开发Vue-环境说明" class="headerlink" title="5.使用TS开发Vue-环境说明"></a>5.使用TS开发Vue-环境说明</h3><ul>
<li>vue add @vue/typescript</li>
</ul>
<h3 id="6-使用TS开发Vue项目-相关配置说明"><a href="#6-使用TS开发Vue项目-相关配置说明" class="headerlink" title="6.使用TS开发Vue项目-相关配置说明"></a>6.使用TS开发Vue项目-相关配置说明</h3><h3 id="7-使用TS开发Vue项目-使用OptionsAPI定义Vue组件"><a href="#7-使用TS开发Vue项目-使用OptionsAPI定义Vue组件" class="headerlink" title="7.使用TS开发Vue项目-使用OptionsAPI定义Vue组件"></a>7.使用TS开发Vue项目-使用OptionsAPI定义Vue组件</h3><h3 id="8-使用TS开发Vue项目-使用ClassAPIs定义Vue组件"><a href="#8-使用TS开发Vue项目-使用ClassAPIs定义Vue组件" class="headerlink" title="8.使用TS开发Vue项目-使用ClassAPIs定义Vue组件"></a>8.使用TS开发Vue项目-使用ClassAPIs定义Vue组件</h3><h3 id="9-使用TS开发Vue项目-关于装饰器语法"><a href="#9-使用TS开发Vue项目-关于装饰器语法" class="headerlink" title="9.使用TS开发Vue项目-关于装饰器语法"></a>9.使用TS开发Vue项目-关于装饰器语法</h3><h3 id="10-使用TS开发Vue项目-使用VuePropertyDecorator创建Vue组件"><a href="#10-使用TS开发Vue项目-使用VuePropertyDecorator创建Vue组件" class="headerlink" title="10.使用TS开发Vue项目-使用VuePropertyDecorator创建Vue组件"></a>10.使用TS开发Vue项目-使用VuePropertyDecorator创建Vue组件</h3><h3 id="11-使用TS开发Vue项目-总结创建组件的方式"><a href="#11-使用TS开发Vue项目-总结创建组件的方式" class="headerlink" title="11.使用TS开发Vue项目-总结创建组件的方式"></a>11.使用TS开发Vue项目-总结创建组件的方式</h3><h3 id="12-代码格式规范-介绍"><a href="#12-代码格式规范-介绍" class="headerlink" title="12.代码格式规范-介绍"></a>12.代码格式规范-介绍</h3><h3 id="13-代码格式规范-项目中的代码规范说明"><a href="#13-代码格式规范-项目中的代码规范说明" class="headerlink" title="13.代码格式规范-项目中的代码规范说明"></a>13.代码格式规范-项目中的代码规范说明</h3><h3 id="14-代码格式规范-自定义校验规则"><a href="#14-代码格式规范-自定义校验规则" class="headerlink" title="14.代码格式规范-自定义校验规则"></a>14.代码格式规范-自定义校验规则</h3><h3 id="15-导入Element组件库"><a href="#15-导入Element组件库" class="headerlink" title="15.导入Element组件库"></a>15.导入Element组件库</h3><h3 id="16-样式处理"><a href="#16-样式处理" class="headerlink" title="16.样式处理"></a>16.样式处理</h3><h3 id="17-样式处理-共享全局样式变量"><a href="#17-样式处理-共享全局样式变量" class="headerlink" title="17.样式处理-共享全局样式变量"></a>17.样式处理-共享全局样式变量</h3><h3 id="18-接口处理-配置后端代理"><a href="#18-接口处理-配置后端代理" class="headerlink" title="18.接口处理-配置后端代理"></a>18.接口处理-配置后端代理</h3><h3 id="19-接口处理-封装请求模块"><a href="#19-接口处理-封装请求模块" class="headerlink" title="19.接口处理-封装请求模块"></a>19.接口处理-封装请求模块</h3><h3 id="20-布局-初始化路由组件"><a href="#20-布局-初始化路由组件" class="headerlink" title="20.布局-初始化路由组件"></a>20.布局-初始化路由组件</h3><h3 id="21-布局-Layout和嵌套路由"><a href="#21-布局-Layout和嵌套路由" class="headerlink" title="21.布局-Layout和嵌套路由"></a>21.布局-Layout和嵌套路由</h3><h3 id="22-布局-Container布局容器"><a href="#22-布局-Container布局容器" class="headerlink" title="22.布局-Container布局容器"></a>22.布局-Container布局容器</h3><h3 id="23-布局-侧边栏菜单"><a href="#23-布局-侧边栏菜单" class="headerlink" title="23.布局-侧边栏菜单"></a>23.布局-侧边栏菜单</h3><h3 id="24-布局-头部Header"><a href="#24-布局-头部Header" class="headerlink" title="24.布局-头部Header"></a>24.布局-头部Header</h3><h3 id="25-登录-页面布局"><a href="#25-登录-页面布局" class="headerlink" title="25.登录-页面布局"></a>25.登录-页面布局</h3><h3 id="26-登录-接口测试"><a href="#26-登录-接口测试" class="headerlink" title="26.登录-接口测试"></a>26.登录-接口测试</h3><h3 id="27-登录-请求登录"><a href="#27-登录-请求登录" class="headerlink" title="27.登录-请求登录"></a>27.登录-请求登录</h3><h3 id="28-登录-处理请求结果"><a href="#28-登录-处理请求结果" class="headerlink" title="28.登录-处理请求结果"></a>28.登录-处理请求结果</h3><h3 id="29-登录-请求期间禁用按钮点击"><a href="#29-登录-请求期间禁用按钮点击" class="headerlink" title="29.登录-请求期间禁用按钮点击"></a>29.登录-请求期间禁用按钮点击</h3><h3 id="30-登录-表单验证"><a href="#30-登录-表单验证" class="headerlink" title="30.登录-表单验证"></a>30.登录-表单验证</h3><h3 id="31-登录-封装请求方法"><a href="#31-登录-封装请求方法" class="headerlink" title="31.登录-封装请求方法"></a>31.登录-封装请求方法</h3><h3 id="32-登录-关于请求体data和ContentType的问题"><a href="#32-登录-关于请求体data和ContentType的问题" class="headerlink" title="32.登录-关于请求体data和ContentType的问题"></a>32.登录-关于请求体data和ContentType的问题</h3><h3 id="33-身份认证-把登录状态存储到Vuex容器中"><a href="#33-身份认证-把登录状态存储到Vuex容器中" class="headerlink" title="33.身份认证-把登录状态存储到Vuex容器中"></a>33.身份认证-把登录状态存储到Vuex容器中</h3><h3 id="34-身份认证-校验页面访问权限"><a href="#34-身份认证-校验页面访问权限" class="headerlink" title="34.身份认证-校验页面访问权限"></a>34.身份认证-校验页面访问权限</h3><h3 id="35-身份认证-测试获取当前登录用户信息接口"><a href="#35-身份认证-测试获取当前登录用户信息接口" class="headerlink" title="35.身份认证-测试获取当前登录用户信息接口"></a>35.身份认证-测试获取当前登录用户信息接口</h3><h3 id="36-身份认证-登录成功跳转回原来页面"><a href="#36-身份认证-登录成功跳转回原来页面" class="headerlink" title="36.身份认证-登录成功跳转回原来页面"></a>36.身份认证-登录成功跳转回原来页面</h3><h3 id="37-身份认证-展示当前登录用户信息"><a href="#37-身份认证-展示当前登录用户信息" class="headerlink" title="37.身份认证-展示当前登录用户信息"></a>37.身份认证-展示当前登录用户信息</h3><h3 id="38-身份认证-使用请求拦截器统一设置Token"><a href="#38-身份认证-使用请求拦截器统一设置Token" class="headerlink" title="38.身份认证-使用请求拦截器统一设置Token"></a>38.身份认证-使用请求拦截器统一设置Token</h3><h3 id="39-身份认证-用户退出"><a href="#39-身份认证-用户退出" class="headerlink" title="39.身份认证-用户退出"></a>39.身份认证-用户退出</h3><h2 id="任务二：用户登录和身份认证"><a href="#任务二：用户登录和身份认证" class="headerlink" title="任务二：用户登录和身份认证"></a>任务二：用户登录和身份认证</h2><h3 id="1-处理Token过期-概念介绍"><a href="#1-处理Token过期-概念介绍" class="headerlink" title="1.处理Token过期-概念介绍"></a>1.处理Token过期-概念介绍</h3><h3 id="2-处理Token过期-分析响应拦截器"><a href="#2-处理Token过期-分析响应拦截器" class="headerlink" title="2.处理Token过期-分析响应拦截器"></a>2.处理Token过期-分析响应拦截器</h3><h3 id="3-处理Token过期-axios错误处理"><a href="#3-处理Token过期-axios错误处理" class="headerlink" title="3.处理Token过期-axios错误处理"></a>3.处理Token过期-axios错误处理</h3><h3 id="4-处理Token过期-错误消息提示"><a href="#4-处理Token过期-错误消息提示" class="headerlink" title="4.处理Token过期-错误消息提示"></a>4.处理Token过期-错误消息提示</h3><h3 id="5-处理Token过期-实现基本流程逻辑"><a href="#5-处理Token过期-实现基本流程逻辑" class="headerlink" title="5.处理Token过期-实现基本流程逻辑"></a>5.处理Token过期-实现基本流程逻辑</h3><h3 id="6-处理Token过期-关于多次请求的问题"><a href="#6-处理Token过期-关于多次请求的问题" class="headerlink" title="6.处理Token过期-关于多次请求的问题"></a>6.处理Token过期-关于多次请求的问题</h3><h3 id="7-处理Token过期-解决多次请求刷新Token问题"><a href="#7-处理Token过期-解决多次请求刷新Token问题" class="headerlink" title="7.处理Token过期-解决多次请求刷新Token问题"></a>7.处理Token过期-解决多次请求刷新Token问题</h3><h3 id="8-处理Token过期-解决多次请求其它接口重试的问题"><a href="#8-处理Token过期-解决多次请求其它接口重试的问题" class="headerlink" title="8.处理Token过期-解决多次请求其它接口重试的问题"></a>8.处理Token过期-解决多次请求其它接口重试的问题</h3><h2 id="任务三：用户权限"><a href="#任务三：用户权限" class="headerlink" title="任务三：用户权限"></a>任务三：用户权限</h2><h3 id="1-用户和权限模块介绍"><a href="#1-用户和权限模块介绍" class="headerlink" title="1.用户和权限模块介绍"></a>1.用户和权限模块介绍</h3><h3 id="2-分析模块开发的流程"><a href="#2-分析模块开发的流程" class="headerlink" title="2.分析模块开发的流程"></a>2.分析模块开发的流程</h3><h3 id="3-菜单管理-添加菜单-布局"><a href="#3-菜单管理-添加菜单-布局" class="headerlink" title="3.菜单管理-添加菜单-布局"></a>3.菜单管理-添加菜单-布局</h3><h3 id="4-菜单管理-添加菜单-数据绑定"><a href="#4-菜单管理-添加菜单-数据绑定" class="headerlink" title="4.菜单管理-添加菜单-数据绑定"></a>4.菜单管理-添加菜单-数据绑定</h3><h3 id="5-菜单管理-添加菜单-提交表单"><a href="#5-菜单管理-添加菜单-提交表单" class="headerlink" title="5.菜单管理-添加菜单-提交表单"></a>5.菜单管理-添加菜单-提交表单</h3><h3 id="6-菜单管理-添加菜单-处理上级菜单"><a href="#6-菜单管理-添加菜单-处理上级菜单" class="headerlink" title="6.菜单管理-添加菜单-处理上级菜单"></a>6.菜单管理-添加菜单-处理上级菜单</h3><h3 id="7-菜单管理-展示菜单列表"><a href="#7-菜单管理-展示菜单列表" class="headerlink" title="7.菜单管理-展示菜单列表"></a>7.菜单管理-展示菜单列表</h3><h3 id="8-菜单管理-删除菜单"><a href="#8-菜单管理-删除菜单" class="headerlink" title="8.菜单管理-删除菜单"></a>8.菜单管理-删除菜单</h3><h3 id="9-菜单管理-编辑菜单-提取组件"><a href="#9-菜单管理-编辑菜单-提取组件" class="headerlink" title="9.菜单管理-编辑菜单-提取组件"></a>9.菜单管理-编辑菜单-提取组件</h3><h3 id="10-菜单管理-编辑菜单"><a href="#10-菜单管理-编辑菜单" class="headerlink" title="10.菜单管理-编辑菜单"></a>10.菜单管理-编辑菜单</h3><h3 id="11-资源管理-内容安排"><a href="#11-资源管理-内容安排" class="headerlink" title="11.资源管理-内容安排"></a>11.资源管理-内容安排</h3><h3 id="12-资源管理-布局"><a href="#12-资源管理-布局" class="headerlink" title="12.资源管理-布局"></a>12.资源管理-布局</h3><h3 id="13-资源管理-展示资源列表"><a href="#13-资源管理-展示资源列表" class="headerlink" title="13.资源管理-展示资源列表"></a>13.资源管理-展示资源列表</h3><h3 id="14-资源管理-资源列表分页处理"><a href="#14-资源管理-资源列表分页处理" class="headerlink" title="14.资源管理-资源列表分页处理"></a>14.资源管理-资源列表分页处理</h3><h3 id="15-资源管理-列表数据筛选"><a href="#15-资源管理-列表数据筛选" class="headerlink" title="15.资源管理-列表数据筛选"></a>15.资源管理-列表数据筛选</h3><h3 id="16-资源管理-重置数据筛选"><a href="#16-资源管理-重置数据筛选" class="headerlink" title="16.资源管理-重置数据筛选"></a>16.资源管理-重置数据筛选</h3><h3 id="17-资源管理-加载中loading和按钮禁用"><a href="#17-资源管理-加载中loading和按钮禁用" class="headerlink" title="17.资源管理-加载中loading和按钮禁用"></a>17.资源管理-加载中loading和按钮禁用</h3><h2 id="任务四：角色权限管理"><a href="#任务四：角色权限管理" class="headerlink" title="任务四：角色权限管理"></a>任务四：角色权限管理</h2><h3 id="1-角色管理-模块介绍"><a href="#1-角色管理-模块介绍" class="headerlink" title="1.角色管理-模块介绍"></a>1.角色管理-模块介绍</h3><h3 id="2-角色管理-添加角色-使用对话框组件"><a href="#2-角色管理-添加角色-使用对话框组件" class="headerlink" title="2.角色管理-添加角色-使用对话框组件"></a>2.角色管理-添加角色-使用对话框组件</h3><h3 id="3-角色管理-添加角色-完成"><a href="#3-角色管理-添加角色-完成" class="headerlink" title="3.角色管理-添加角色-完成"></a>3.角色管理-添加角色-完成</h3><h3 id="4-角色管理-编辑角色-复用添加角色处理"><a href="#4-角色管理-编辑角色-复用添加角色处理" class="headerlink" title="4.角色管理-编辑角色-复用添加角色处理"></a>4.角色管理-编辑角色-复用添加角色处理</h3><h3 id="5-角色管理-编辑角色-完成"><a href="#5-角色管理-编辑角色-完成" class="headerlink" title="5.角色管理-编辑角色-完成"></a>5.角色管理-编辑角色-完成</h3><h3 id="6-角色管理-分配菜单-准备"><a href="#6-角色管理-分配菜单-准备" class="headerlink" title="6.角色管理-分配菜单-准备"></a>6.角色管理-分配菜单-准备</h3><h3 id="7-角色管理-分配菜单-展示所有菜单列表"><a href="#7-角色管理-分配菜单-展示所有菜单列表" class="headerlink" title="7.角色管理-分配菜单-展示所有菜单列表"></a>7.角色管理-分配菜单-展示所有菜单列表</h3><h3 id="8-角色管理-分配菜单-展示所有菜单列表"><a href="#8-角色管理-分配菜单-展示所有菜单列表" class="headerlink" title="8.角色管理-分配菜单-展示所有菜单列表"></a>8.角色管理-分配菜单-展示所有菜单列表</h3><h3 id="9-角色管理-分配菜单-完成"><a href="#9-角色管理-分配菜单-完成" class="headerlink" title="9.角色管理-分配菜单-完成"></a>9.角色管理-分配菜单-完成</h3><h3 id="10-角色管理-分配菜单-清空选中的菜单项"><a href="#10-角色管理-分配菜单-清空选中的菜单项" class="headerlink" title="10.角色管理-分配菜单-清空选中的菜单项"></a>10.角色管理-分配菜单-清空选中的菜单项</h3><h3 id="11-角色管理-分配资源"><a href="#11-角色管理-分配资源" class="headerlink" title="11.角色管理-分配资源"></a>11.角色管理-分配资源</h3><h3 id="12-用户管理-模块介绍"><a href="#12-用户管理-模块介绍" class="headerlink" title="12.用户管理-模块介绍"></a>12.用户管理-模块介绍</h3><h3 id="13-用户管理-分配角色-准备"><a href="#13-用户管理-分配角色-准备" class="headerlink" title="13.用户管理-分配角色-准备"></a>13.用户管理-分配角色-准备</h3><h3 id="14-用户管理-分配角色-展示角色列表"><a href="#14-用户管理-分配角色-展示角色列表" class="headerlink" title="14.用户管理-分配角色-展示角色列表"></a>14.用户管理-分配角色-展示角色列表</h3><h3 id="15-用户管理-分配角色-提交分配"><a href="#15-用户管理-分配角色-提交分配" class="headerlink" title="15.用户管理-分配角色-提交分配"></a>15.用户管理-分配角色-提交分配</h3><h3 id="16-用户管理-分配角色-完成"><a href="#16-用户管理-分配角色-完成" class="headerlink" title="16.用户管理-分配角色-完成"></a>16.用户管理-分配角色-完成</h3><h2 id="任务五：课程管理"><a href="#任务五：课程管理" class="headerlink" title="任务五：课程管理"></a>任务五：课程管理</h2><h3 id="1-课程管理-模块介绍"><a href="#1-课程管理-模块介绍" class="headerlink" title="1.课程管理-模块介绍"></a>1.课程管理-模块介绍</h3><h3 id="2-课程管理-展示上架状态"><a href="#2-课程管理-展示上架状态" class="headerlink" title="2.课程管理-展示上架状态"></a>2.课程管理-展示上架状态</h3><h3 id="3-课程管理-处理课程上下架"><a href="#3-课程管理-处理课程上下架" class="headerlink" title="3.课程管理-处理课程上下架"></a>3.课程管理-处理课程上下架</h3><h3 id="4-课程管理-添加课程-使用步骤条"><a href="#4-课程管理-添加课程-使用步骤条" class="headerlink" title="4.课程管理-添加课程-使用步骤条"></a>4.课程管理-添加课程-使用步骤条</h3><h3 id="5-课程管理-添加课程-搭建表单结构"><a href="#5-课程管理-添加课程-搭建表单结构" class="headerlink" title="5.课程管理-添加课程-搭建表单结构"></a>5.课程管理-添加课程-搭建表单结构</h3><h3 id="6-课程管理-添加课程-基本信息数据绑定"><a href="#6-课程管理-添加课程-基本信息数据绑定" class="headerlink" title="6.课程管理-添加课程-基本信息数据绑定"></a>6.课程管理-添加课程-基本信息数据绑定</h3><h3 id="7-添加课程-上传课程封面-分析实现逻辑"><a href="#7-添加课程-上传课程封面-分析实现逻辑" class="headerlink" title="7.添加课程-上传课程封面-分析实现逻辑"></a>7.添加课程-上传课程封面-分析实现逻辑</h3><h3 id="8-添加课程-上传课程封面-上传组件使用"><a href="#8-添加课程-上传课程封面-上传组件使用" class="headerlink" title="8.添加课程-上传课程封面-上传组件使用"></a>8.添加课程-上传课程封面-上传组件使用</h3><h3 id="9-添加课程-上传课程封面-封装上传组件"><a href="#9-添加课程-上传课程封面-封装上传组件" class="headerlink" title="9.添加课程-上传课程封面-封装上传组件"></a>9.添加课程-上传课程封面-封装上传组件</h3><h3 id="10-添加课程-上传进度提示-使用进度条组件"><a href="#10-添加课程-上传进度提示-使用进度条组件" class="headerlink" title="10.添加课程-上传进度提示-使用进度条组件"></a>10.添加课程-上传进度提示-使用进度条组件</h3><h3 id="11-添加课程-上传进度提示-完成"><a href="#11-添加课程-上传进度提示-完成" class="headerlink" title="11.添加课程-上传进度提示-完成"></a>11.添加课程-上传进度提示-完成</h3><h3 id="12-添加课程-发布成功"><a href="#12-添加课程-发布成功" class="headerlink" title="12.添加课程-发布成功"></a>12.添加课程-发布成功</h3><h3 id="13-添加课程-富文本编辑器介绍"><a href="#13-添加课程-富文本编辑器介绍" class="headerlink" title="13.添加课程-富文本编辑器介绍"></a>13.添加课程-富文本编辑器介绍</h3><h3 id="14-添加课程-封装使用富文本编辑器组件"><a href="#14-添加课程-封装使用富文本编辑器组件" class="headerlink" title="14.添加课程-封装使用富文本编辑器组件"></a>14.添加课程-封装使用富文本编辑器组件</h3><h3 id="15-添加课程-富文本编辑器-图片上传"><a href="#15-添加课程-富文本编辑器-图片上传" class="headerlink" title="15.添加课程-富文本编辑器-图片上传"></a>15.添加课程-富文本编辑器-图片上传</h3><h3 id="16-编辑课程"><a href="#16-编辑课程" class="headerlink" title="16.编辑课程"></a>16.编辑课程</h3><h3 id="17-课程内容-功能介绍"><a href="#17-课程内容-功能介绍" class="headerlink" title="17.课程内容-功能介绍"></a>17.课程内容-功能介绍</h3><h3 id="18-课程内容-准备"><a href="#18-课程内容-准备" class="headerlink" title="18.课程内容-准备"></a>18.课程内容-准备</h3><h3 id="19-课程内容-展示章节列表"><a href="#19-课程内容-展示章节列表" class="headerlink" title="19.课程内容-展示章节列表"></a>19.课程内容-展示章节列表</h3><h3 id="20-课程内容-阶段列表-自定义树组件节点内容"><a href="#20-课程内容-阶段列表-自定义树组件节点内容" class="headerlink" title="20.课程内容-阶段列表-自定义树组件节点内容"></a>20.课程内容-阶段列表-自定义树组件节点内容</h3><h3 id="21-课程内容-处理节点拖动的逻辑"><a href="#21-课程内容-处理节点拖动的逻辑" class="headerlink" title="21.课程内容-处理节点拖动的逻辑"></a>21.课程内容-处理节点拖动的逻辑</h3><h3 id="22-课程内容-列表拖动排序数据更新"><a href="#22-课程内容-列表拖动排序数据更新" class="headerlink" title="22.课程内容-列表拖动排序数据更新"></a>22.课程内容-列表拖动排序数据更新</h3><h3 id="23-上传课时视频-功能介绍"><a href="#23-上传课时视频-功能介绍" class="headerlink" title="23.上传课时视频-功能介绍"></a>23.上传课时视频-功能介绍</h3><h3 id="24-上传课时视频-准备"><a href="#24-上传课时视频-准备" class="headerlink" title="24.上传课时视频-准备"></a>24.上传课时视频-准备</h3><h3 id="25-上传课时视频-阿里云视频点播服务介绍"><a href="#25-上传课时视频-阿里云视频点播服务介绍" class="headerlink" title="25.上传课时视频-阿里云视频点播服务介绍"></a>25.上传课时视频-阿里云视频点播服务介绍</h3><h3 id="26-上传课时视频-阿里云视频上传-体验官方demo"><a href="#26-上传课时视频-阿里云视频上传-体验官方demo" class="headerlink" title="26.上传课时视频-阿里云视频上传-体验官方demo"></a>26.上传课时视频-阿里云视频上传-体验官方demo</h3><h3 id="27-上传课时视频-初始化阿里云上传"><a href="#27-上传课时视频-初始化阿里云上传" class="headerlink" title="27.上传课时视频-初始化阿里云上传"></a>27.上传课时视频-初始化阿里云上传</h3><h3 id="28-上传课时视频-封装上传相关接口"><a href="#28-上传课时视频-封装上传相关接口" class="headerlink" title="28.上传课时视频-封装上传相关接口"></a>28.上传课时视频-封装上传相关接口</h3><h3 id="29-上传课时视频-上传文件成功"><a href="#29-上传课时视频-上传文件成功" class="headerlink" title="29.上传课时视频-上传文件成功"></a>29.上传课时视频-上传文件成功</h3><h3 id="30-上传课时视频-处理完成"><a href="#30-上传课时视频-处理完成" class="headerlink" title="30.上传课时视频-处理完成"></a>30.上传课时视频-处理完成</h3><h2 id="任务六：发布部署"><a href="#任务六：发布部署" class="headerlink" title="任务六：发布部署"></a>任务六：发布部署</h2><h3 id="1-发布部署-项目打包"><a href="#1-发布部署-项目打包" class="headerlink" title="1.发布部署-项目打包"></a>1.发布部署-项目打包</h3><h3 id="2-发布部署-本地预览服务"><a href="#2-发布部署-本地预览服务" class="headerlink" title="2.发布部署-本地预览服务"></a>2.发布部署-本地预览服务</h3><h3 id="3-发布部署-注意事项"><a href="#3-发布部署-注意事项" class="headerlink" title="3.发布部署-注意事项"></a>3.发布部署-注意事项</h3><h3 id="4-发布部署-部署说明"><a href="#4-发布部署-部署说明" class="headerlink" title="4.发布部署-部署说明"></a>4.发布部署-部署说明</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/06/35/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旋の飞羽">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/06/35/" itemprop="url">学习笔记 ----- 【Vue.js 框架源码与进阶】Vue.js 3.0 Composition APIs 及 3.0 原理剖析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-02-06T00:00:00+08:00">
                2021-02-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>作者：FY<br>引用请标明出处</p>
</blockquote>
<h1 id="Part-3-·-Vue-js-框架源码与进阶"><a href="#Part-3-·-Vue-js-框架源码与进阶" class="headerlink" title="Part 3 · Vue.js 框架源码与进阶"></a>Part 3 · Vue.js 框架源码与进阶</h1><h2 id="模块五-·-Vue-js-3-0-Composition-APIs-及-3-0-原理剖析"><a href="#模块五-·-Vue-js-3-0-Composition-APIs-及-3-0-原理剖析" class="headerlink" title="模块五 · Vue.js 3.0 Composition APIs 及 3.0 原理剖析"></a>模块五 · Vue.js 3.0 Composition APIs 及 3.0 原理剖析</h2><h2 id="任务一：Vue-3-0介绍"><a href="#任务一：Vue-3-0介绍" class="headerlink" title="任务一：Vue 3.0介绍"></a>任务一：Vue 3.0介绍</h2><h3 id="1-Vue-js-3-0-源码组织方式"><a href="#1-Vue-js-3-0-源码组织方式" class="headerlink" title="1.Vue.js 3.0 源码组织方式"></a>1.Vue.js 3.0 源码组织方式</h3><ul>
<li>源码组织方式的变化</li>
<li>Composition API</li>
<li>性能提升</li>
<li>Vite</li>
</ul>
<blockquote>
<p>源码组织方式</p>
</blockquote>
<ul>
<li>源码采用 TypeScript 重写</li>
<li>使用 Monorepo 管理项目结构</li>
</ul>
<h3 id="2-不同的构建版本"><a href="#2-不同的构建版本" class="headerlink" title="2.不同的构建版本"></a>2.不同的构建版本</h3><blockquote>
<p>构建版本</p>
</blockquote>
<ul>
<li><p>cjs</p>
<ul>
<li>vue.cjs.js</li>
<li>vue.cjs.prod.js</li>
</ul>
</li>
<li><p>global</p>
<ul>
<li>vue.global.js</li>
<li>vue.global.prod.js</li>
<li>vue.runtime.global.js</li>
<li>vue.runtime.global.prod.js</li>
</ul>
</li>
</ul>
<h3 id="3-Composition-API-设计动机"><a href="#3-Composition-API-设计动机" class="headerlink" title="3.Composition API 设计动机"></a>3.Composition API 设计动机</h3><ul>
<li><p>RFC(Request For Comments)</p>
<ul>
<li><a href="https://github.com/vuejs/rfcs" target="_blank" rel="noopener">https://github.com/vuejs/rfcs</a></li>
</ul>
</li>
<li><p>Composition API RFC</p>
<ul>
<li><a href="https://composition-api.vuejs.org" target="_blank" rel="noopener">https://composition-api.vuejs.org</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>设计动机</p>
</blockquote>
<ul>
<li><p>Options API</p>
<ul>
<li>包含一个描述组件选项（data、metheds、props等）的对象</li>
<li>Options API 开发复杂组件，同一个功能逻辑的代码被拆分到不同选项</li>
</ul>
</li>
<li><p>Composition API</p>
<ul>
<li>Vue.js 3.0新增的一组 API</li>
<li>一组基于函数的 API</li>
<li>可以更灵活的组织组件的逻辑</li>
</ul>
</li>
</ul>
<h3 id="4-性能提升"><a href="#4-性能提升" class="headerlink" title="4.性能提升"></a>4.性能提升</h3><ul>
<li>响应式系统升级</li>
<li>编译优化</li>
<li>源码体积的优化</li>
</ul>
<blockquote>
<p>响应式系统升级</p>
</blockquote>
<ul>
<li>Vue.js 2.x 中响应式系统的核心 defineProperty</li>
<li>Vue.js 3.0 中使用 Proxy 对象重写响应式系统<ul>
<li>可以监听动态新增的属性</li>
<li>可以监听删除的属性</li>
<li>可以监听数组的索引和 length 属性</li>
</ul>
</li>
</ul>
<blockquote>
<p>编译优化</p>
</blockquote>
<ul>
<li>Vue.js 2.x 中通过标记静态根节点，优化 diff 的过程</li>
<li>Vue.js 3.x 中标记和提升所有的静态根节点，diff 的时候只需要对比动态节点内容<ul>
<li>Fragments（升级 Vetur 插件）</li>
<li>静态提升</li>
<li>Patch flag</li>
<li>缓存事件处理函数</li>
</ul>
</li>
</ul>
<blockquote>
<p>源码打包体积</p>
</blockquote>
<ul>
<li>Vue.js 3.0 中移除了一些不常用的 API<ul>
<li>例如：inline-template、filter 等</li>
</ul>
</li>
<li>Tree-shaking</li>
</ul>
<h3 id="5-Vite"><a href="#5-Vite" class="headerlink" title="5.Vite"></a>5.Vite</h3><blockquote>
<p>ES Module</p>
</blockquote>
<ul>
<li>现代浏览器都支持 ES Module（IE 不支持）</li>
<li>通过下面的方式加载模块<ul>
<li><script type="module" src="..."></script></li>
</ul>
</li>
<li>支持模块的 script 默认延迟加载<ul>
<li>类似于 script 标签设置 defer</li>
<li>在文档解析完成后，触发 DOMContentLoaded 事件前执行</li>
</ul>
</li>
</ul>
<h3 id="6-Vite"><a href="#6-Vite" class="headerlink" title="6.Vite"></a>6.Vite</h3><blockquote>
<p>Vite as Vue-CLI</p>
</blockquote>
<ul>
<li>Vite 在开发模式下不需要打包可以直接运行</li>
<li>Vue-CLI 开发模式下必须对项目打包才可以运行</li>
</ul>
<blockquote>
<p>Vite 特点</p>
</blockquote>
<ul>
<li>快速冷启动</li>
<li>按需编译</li>
<li>模块热更新</li>
</ul>
<blockquote>
<p>Vite as Vue-CLI</p>
</blockquote>
<ul>
<li>Vite 在生产环境下使用 Rollup 打包<ul>
<li>基于 ES Module 的方式打包</li>
</ul>
</li>
<li>Vue-CLI 使用 webpack 打包</li>
</ul>
<blockquote>
<p>Vite 创建项目</p>
</blockquote>
<ul>
<li>Vite 创建项目</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm init vite-app &lt;project-name&gt;</span><br><span class="line">cd &lt;project-name&gt;</span><br><span class="line">npm install</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<ul>
<li>基于模板创建项目</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init vite-app --template react</span><br><span class="line">npm init vite-app --template preact</span><br></pre></td></tr></table></figure>

<h2 id="任务二：Composition-API"><a href="#任务二：Composition-API" class="headerlink" title="任务二：Composition API"></a>任务二：Composition API</h2><h3 id="1-Composition-API"><a href="#1-Composition-API" class="headerlink" title="1.Composition API"></a>1.Composition API</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; createApp, reactive &#125; <span class="keyword">from</span> <span class="string">'./node_modules/vue/dist/vue.esm-browser.js'</span></span></span><br><span class="line"><span class="actionscript"><span class="keyword">const</span> app = createApp(&#123;</span></span><br><span class="line">    setup()&#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> position = reactive(&#123;</span></span><br><span class="line">            x:0,</span><br><span class="line">            y:0</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line">            position</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted()&#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.position.x = <span class="number">100</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="actionscript">app.mount(<span class="string">'#app'</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-生命周期钩子函数"><a href="#2-生命周期钩子函数" class="headerlink" title="2.生命周期钩子函数"></a>2.生命周期钩子函数</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; createApp, reactive, onMounted, onUnmounted &#125; <span class="keyword">from</span> <span class="string">'./node_modules/vue/dist/vue.esm-browser.js'</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">useMousePosition</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> position = reactive(&#123;</span></span><br><span class="line">            x:0,</span><br><span class="line">            y:0</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> update = <span class="function"><span class="params">e</span> =&gt;</span>&#123;</span></span><br><span class="line">           position.x = e.pageX</span><br><span class="line">           position.y = e.pageY</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        onMounted(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">window</span>.addEventListener(<span class="string">'mousemove'</span>, update)</span></span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line"><span class="javascript">        onUnmounted(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">window</span>.removeEventListener(<span class="string">'mousemove'</span>, update)</span></span><br><span class="line">        &#125;)</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> position</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="actionscript"><span class="keyword">const</span> app = createApp(&#123;</span></span><br><span class="line">    setup()&#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> postition = useMousePosition()</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line">            position</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted()&#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">this</span>.position.x = <span class="number">100</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="actionscript">app.mount(<span class="string">'#app'</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-reactive-toRefs-ref"><a href="#3-reactive-toRefs-ref" class="headerlink" title="3.reactive-toRefs-ref"></a>3.reactive-toRefs-ref</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; createApp, reactive, onMounted, onUnmounted, toRefs &#125; <span class="keyword">from</span> <span class="string">'./node_modules/vue/dist/vue.esm-browser.js'</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">useMousePosition</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> position = reactive(&#123;</span></span><br><span class="line">            x:0,</span><br><span class="line">            y:0</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> update = <span class="function"><span class="params">e</span> =&gt;</span>&#123;</span></span><br><span class="line">           position.x = e.pageX</span><br><span class="line">           position.y = e.pageY</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        onMounted(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">window</span>.addEventListener(<span class="string">'mousemove'</span>, update)</span></span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line"><span class="javascript">        onUnmounted(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">window</span>.removeEventListener(<span class="string">'mousemove'</span>, update)</span></span><br><span class="line">        &#125;)</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> toRefs(position)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="actionscript"><span class="keyword">const</span> app = createApp(&#123;</span></span><br><span class="line">    setup()&#123;</span><br><span class="line"><span class="actionscript">        <span class="comment">// const postition = useMousePosition()</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> &#123; x, y &#125; = useMousePosition()</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line">            x,</span><br><span class="line">            y</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="actionscript">app.mount(<span class="string">'#app'</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; createApp, ref &#125; <span class="keyword">from</span> <span class="string">'./node_modules/vue/dist/vue.esm-browser.js'</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">useCount</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">  <span class="keyword">const</span> count = ref(<span class="number">0</span>)</span></span><br><span class="line"><span class="actionscript">  <span class="keyword">return</span> &#123;</span></span><br><span class="line">      count,</span><br><span class="line"><span class="javascript">      increase: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line">        count.value++</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">createApp(&#123;</span><br><span class="line">    setup()&#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line">            ...useCount()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="actionscript">&#125;).mount(<span class="string">'#app'</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-computed"><a href="#4-computed" class="headerlink" title="4.computed"></a>4.computed</h3><ul>
<li>第一种用法<ul>
<li>watch(()=&gt;count.value+1)</li>
</ul>
</li>
<li>第二种用法</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> count = ref(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> plusOne = computed(&#123;</span><br><span class="line">    <span class="keyword">get</span>:()=&gt;count.value+1,</span><br><span class="line">    <span class="keyword">set</span>:val=&gt;&#123;</span><br><span class="line">        count.value = val <span class="number">-1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; createApp, reactive, computed &#125; <span class="keyword">from</span> <span class="string">'./node_modules/vue/dist/vue.esm-browser.js'</span></span></span><br><span class="line"><span class="actionscript">  <span class="keyword">const</span> data = [</span></span><br><span class="line"><span class="actionscript">      &#123; text:<span class="string">'看书'</span>, completed: <span class="literal">false</span> &#125;,</span></span><br><span class="line"><span class="actionscript">      &#123; text:<span class="string">'敲代码'</span>, completed: <span class="literal">false</span> &#125;,</span></span><br><span class="line"><span class="actionscript">      &#123; text:<span class="string">'约会'</span>, completed: <span class="literal">true</span> &#125;</span></span><br><span class="line">  ]</span><br><span class="line">  createApp(&#123;</span><br><span class="line">      setup()&#123;</span><br><span class="line"><span class="actionscript">          <span class="keyword">const</span> todos = reactive(data)</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> activeCount = computed(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">return</span> todos.filter(<span class="function"><span class="params">item</span> =&gt;</span> !item.completed).length</span></span><br><span class="line">          &#125;)</span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> &#123;</span></span><br><span class="line">              activeCount,</span><br><span class="line"><span class="javascript">              push:<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span></span><br><span class="line">                  todos.push(&#123;</span><br><span class="line"><span class="actionscript">                      text: <span class="string">'开会'</span>，</span></span><br><span class="line"><span class="actionscript">                      completed: <span class="literal">false</span></span></span><br><span class="line">                  &#125;)</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="5-watch"><a href="#5-watch" class="headerlink" title="5.watch"></a>5.watch</h3><ul>
<li>Watch 的三个参数<ul>
<li>第一个参数：要监听的数据</li>
<li>第二个参数：监听到数据变化后执行的函数，这个函数有两个参数分别是新值和旧值</li>
<li>第三个参数：选项对象，deep 和 immediate</li>
</ul>
</li>
<li>Watch 的返回值<ul>
<li>取消监听的函数</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; createApp, ref, watch &#125; <span class="keyword">from</span> <span class="string">'./node_modules/vue/dist/vue.esm-browser.js'</span></span></span><br><span class="line">createApp(&#123;</span><br><span class="line">    setup()&#123;</span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> question = ref(<span class="string">''</span>)</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">const</span> answer = ref(<span class="string">''</span>)</span></span><br><span class="line"></span><br><span class="line">      watch(question,(newValue, oldValue) =&gt; &#123;</span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(<span class="string">'https://www.yesno.wtf/api'</span>)</span></span><br><span class="line"><span class="javascript">          <span class="keyword">const</span> data = <span class="keyword">await</span> response.json()</span></span><br><span class="line">          answer.value = data.answer</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line">          question,</span><br><span class="line">          answer</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">&#125;).mount(<span class="string">'#app'</span>)</span></span><br></pre></td></tr></table></figure>
<h3 id="6-watchEffect"><a href="#6-watchEffect" class="headerlink" title="6.watchEffect"></a>6.watchEffect</h3><ul>
<li>是 watch 函数的简化版本，也用来监视数据的变化</li>
<li>接收一个函数作为参数，监听函数内响应式数据的变化</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"module"</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123; createApp, ref, watchEffect &#125; <span class="keyword">from</span> <span class="string">'./node_modules/vue/dist/vue.esm-browser.js'</span></span></span><br><span class="line">createApp(&#123;</span><br><span class="line">    setup()&#123;</span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> count = ref(<span class="number">0</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> stop = watchEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(count.value)</span></span><br><span class="line">        &#125;)</span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line">            count,</span><br><span class="line">            stop,</span><br><span class="line"><span class="javascript">            increase:<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span></span><br><span class="line">                count.value++</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">&#125;).mount(<span class="string">'#app'</span>)</span></span><br></pre></td></tr></table></figure>

<h3 id="7-todolist-功能演示"><a href="#7-todolist-功能演示" class="headerlink" title="7.todolist-功能演示"></a>7.todolist-功能演示</h3><ul>
<li>添加待办事项</li>
<li>删除待办事项</li>
<li>编辑待办事项</li>
<li>切换待办事项</li>
<li>存储待办事项</li>
</ul>
<h3 id="8-todolist-项目结构"><a href="#8-todolist-项目结构" class="headerlink" title="8.todolist-项目结构"></a>8.todolist-项目结构</h3><ul>
<li><a href="mailto:vue-cli@4.5">vue-cli@4.5</a>以上 vue3.0</li>
</ul>
<h3 id="9-todolist-添加待办事项"><a href="#9-todolist-添加待办事项" class="headerlink" title="9.todolist-添加待办事项"></a>9.todolist-添加待办事项</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">const</span> useAdd = <span class="function"><span class="params">todos</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> input = ref(<span class="string">''</span>)</span><br><span class="line">    <span class="keyword">const</span> assTodo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> text = input.value &amp;&amp; input.value.trim()</span><br><span class="line">        <span class="keyword">if</span>(text.length === <span class="number">0</span>) <span class="keyword">return</span></span><br><span class="line">        todos.value.unshift(&#123;</span><br><span class="line">            text,</span><br><span class="line">            completed: <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        input,</span><br><span class="line">        addTodo</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">'App'</span>,</span><br><span class="line">    setup () &#123;</span><br><span class="line">        <span class="keyword">const</span> todos = ref([])</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            ...useAdd(todos),</span><br><span class="line">            todos</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-todolist-删除待办事项"><a href="#10-todolist-删除待办事项" class="headerlink" title="10.todolist-删除待办事项"></a>10.todolist-删除待办事项</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> useRemove = <span class="function"><span class="params">todos</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> remove = <span class="function"><span class="params">todo</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> index = todos.value.indexof(todo)</span><br><span class="line">        todos.value.splice(index, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        remove</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">'App'</span>,</span><br><span class="line">    setup () &#123;</span><br><span class="line">        <span class="keyword">const</span> todos = ref([])</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            todos,</span><br><span class="line">            ...useAdd(todos),</span><br><span class="line">            ...useRemove(todos)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-todolist-编辑待办事项"><a href="#11-todolist-编辑待办事项" class="headerlink" title="11.todolist-编辑待办事项"></a>11.todolist-编辑待办事项</h3><ul>
<li>双击待办项，展示编辑文本框</li>
<li>按回车或者编辑文本框失去焦点，修改数据</li>
<li>按 esc 取消编辑</li>
<li>把编辑文本框清空按回车，删除这一项</li>
<li>显示编辑文本框的时候获取焦点</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> useEdit = <span class="function"><span class="params">remove</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> beforeEditingText = <span class="string">''</span></span><br><span class="line">    <span class="keyword">const</span> editingTodo = ref(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">const</span> editTodo = <span class="function"><span class="params">todo</span> =&gt;</span> &#123;</span><br><span class="line">        beforeEditingText = todo.text</span><br><span class="line">        editingTodo.value = todo</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">const</span> doneEdit = <span class="function"><span class="params">todo</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(!editingTodo.value) <span class="keyword">return</span></span><br><span class="line">        todo.text = todo.text.trim()</span><br><span class="line">        todo.text || remove(todo)</span><br><span class="line">        editingTodo.value = <span class="literal">null</span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">const</span> cancelEdit = <span class="function"><span class="params">todo</span> =&gt;</span> &#123;</span><br><span class="line">        editingTodo.value = <span class="literal">null</span></span><br><span class="line">        todo.text = beforeEditingText</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        editingTodo,</span><br><span class="line">        editTodo,</span><br><span class="line">        doneEdit,</span><br><span class="line">        cancelEdit,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">'App'</span>,</span><br><span class="line">    setup () &#123;</span><br><span class="line">        <span class="keyword">const</span> todos = ref([])</span><br><span class="line">        <span class="keyword">const</span> &#123; remove &#125; = useRemove(todos)</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            todos,</span><br><span class="line">            ...useAdd(todos),</span><br><span class="line">            ...useEdit(remove)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="12-todolist-编辑待办事项-编辑文本框获取焦点"><a href="#12-todolist-编辑待办事项-编辑文本框获取焦点" class="headerlink" title="12.todolist-编辑待办事项-编辑文本框获取焦点"></a>12.todolist-编辑待办事项-编辑文本框获取焦点</h3><blockquote>
<p>自定义指令</p>
</blockquote>
<ul>
<li>Vue 2.x</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Vue.directive(<span class="string">'editingFocus'</span>, &#123;</span><br><span class="line">    bind(el, bingding, vnode, prevVnode) &#123;&#125;,</span><br><span class="line">    inserted()&#123;&#125;,</span><br><span class="line">    update()&#123;&#125;,<span class="comment">//remove</span></span><br><span class="line">    componentUpdated()&#123;&#125;,</span><br><span class="line">    unbind()&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>Vue 3.x</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.directive(<span class="string">'editingFocus'</span>,&#123;</span><br><span class="line">    beforeMount(el,bingding,vnode,prevVnode)&#123;&#125;,</span><br><span class="line">    mounted()&#123;&#125;,</span><br><span class="line">    beforeUpdate()&#123;&#125;,<span class="comment">//new</span></span><br><span class="line">    update()&#123;&#125;,</span><br><span class="line">    beforeUnmount()&#123;&#125;,<span class="comment">//new</span></span><br><span class="line">    unmounted()&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">'App'</span>,</span><br><span class="line">    setup () &#123;</span><br><span class="line">        <span class="keyword">const</span> todos = ref([])</span><br><span class="line">        <span class="keyword">const</span> &#123; remove &#125; = useRemove(todos)</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            todos,</span><br><span class="line">            ...useAdd(todos),</span><br><span class="line">            ...useEdit(remove)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    direactives:&#123;</span><br><span class="line">        editingFocus: <span class="function">(<span class="params">el, binding</span>) =&gt;</span> &#123;</span><br><span class="line">            binding.value &amp;&amp; el.focus()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-todolist-切换待办事项-演示效果"><a href="#13-todolist-切换待办事项-演示效果" class="headerlink" title="13.todolist-切换待办事项-演示效果"></a>13.todolist-切换待办事项-演示效果</h3><blockquote>
<p>切换代办事项状态</p>
</blockquote>
<ul>
<li>点击 checkbox，改变所有待办事项</li>
<li>All/Active/Completed</li>
<li>其它<ul>
<li>显示未完成待办项个数</li>
<li>移除所有完成的项目</li>
<li>如果没有待办项，隐藏 main 和 footer</li>
</ul>
</li>
</ul>
<h3 id="14-todolist-切换待办事项-改变待办事项完成状态"><a href="#14-todolist-切换待办事项-改变待办事项完成状态" class="headerlink" title="14.todolist-切换待办事项-改变待办事项完成状态"></a>14.todolist-切换待办事项-改变待办事项完成状态</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> useFilter = <span class="function"><span class="params">todos</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> allDone = computed(&#123;</span><br><span class="line">        <span class="keyword">get</span>()&#123;</span><br><span class="line">            <span class="keyword">return</span> !todos.value.filter(<span class="function"><span class="params">todo</span> =&gt;</span> !todo.completed).length</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">set</span>(value)&#123;</span><br><span class="line">            todos.value.forEach(<span class="function"><span class="params">todo</span> =&gt;</span> &#123;</span><br><span class="line">                todo.completed = value</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        allDone</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="15-todolist-切换待办事项-切换状态"><a href="#15-todolist-切换待办事项-切换状态" class="headerlink" title="15.todolist-切换待办事项-切换状态"></a>15.todolist-切换待办事项-切换状态</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> filter = &#123;</span><br><span class="line">    all: <span class="function"><span class="params">list</span> =&gt;</span> list,</span><br><span class="line">    active: <span class="function"><span class="params">list</span> =&gt;</span> list.filter(<span class="function"><span class="params">todo</span> =&gt;</span> !todo.completed),</span><br><span class="line">    completed: <span class="function"><span class="params">list</span> =&gt;</span> list.filter(<span class="function"><span class="params">todo</span> =&gt;</span> todo.completed)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> type = ref(<span class="string">'all'</span>)</span><br><span class="line"><span class="keyword">const</span> filteredTodos = computed(<span class="function"><span class="params">()</span> =&gt;</span> filter[type.value](todos.value))</span><br><span class="line"><span class="keyword">const</span> onHashChange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> hash = <span class="built_in">window</span>.location.hash.replace(<span class="string">'#/'</span>,<span class="string">''</span>)</span><br><span class="line">    <span class="keyword">if</span>(filter[hash])&#123;</span><br><span class="line">        type.value = hash</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        type.value = <span class="string">'all'</span></span><br><span class="line">        <span class="built_in">window</span>.location.hash = <span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">onMounted(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'hashChange'</span>, onHashChange)</span><br><span class="line">    onHashChange()</span><br><span class="line">&#125;)</span><br><span class="line">onUnmounted(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.removeEventListener(<span class="string">'hashChange'</span>, onHashChange)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="16-todolist-切换待办事项-其它"><a href="#16-todolist-切换待办事项-其它" class="headerlink" title="16.todolist-切换待办事项-其它"></a>16.todolist-切换待办事项-其它</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> useRemove = <span class="function"><span class="params">todos</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> remove = <span class="function"><span class="params">todo</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> index = todos.value.indexof(todo)</span><br><span class="line">        todos.value.splice(index, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> removeCompleted = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        todos.value = todos.value.filter(<span class="function"><span class="params">todo</span> =&gt;</span> !todo.completed)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        remove,</span><br><span class="line">        removeCompleted</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> filter = &#123;</span><br><span class="line">    all: <span class="function"><span class="params">list</span> =&gt;</span> list,</span><br><span class="line">    active: <span class="function"><span class="params">list</span> =&gt;</span> list.filter(<span class="function"><span class="params">todo</span> =&gt;</span> !todo.completed),</span><br><span class="line">    completed: <span class="function"><span class="params">list</span> =&gt;</span> list.filter(<span class="function"><span class="params">todo</span> =&gt;</span> todo.completed)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> type = ref(<span class="string">'all'</span>)</span><br><span class="line"><span class="keyword">const</span> filteredTodos = computed(<span class="function"><span class="params">()</span> =&gt;</span> filter[type.value](todos.value))</span><br><span class="line"><span class="keyword">const</span> remainingCount = computed(<span class="function"><span class="params">()</span> =&gt;</span> filter.active(todos.value).length)</span><br><span class="line"><span class="keyword">const</span> count = computed(<span class="function"><span class="params">()</span> =&gt;</span> todos.value.length)</span><br><span class="line"><span class="keyword">const</span> onHashChange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> hash = <span class="built_in">window</span>.location.hash.replace(<span class="string">'#/'</span>,<span class="string">''</span>)</span><br><span class="line">    <span class="keyword">if</span>(filter[hash])&#123;</span><br><span class="line">        type.value = hash</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        type.value = <span class="string">'all'</span></span><br><span class="line">        <span class="built_in">window</span>.location.hash = <span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">onMounted(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'hashChange'</span>, onHashChange)</span><br><span class="line">    onHashChange()</span><br><span class="line">&#125;)</span><br><span class="line">onUnmounted(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.removeEventListener(<span class="string">'hashChange'</span>, onHashChange)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="17-todolist-存储待办事项"><a href="#17-todolist-存储待办事项" class="headerlink" title="17.todolist-存储待办事项"></a>17.todolist-存储待办事项</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parse</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> value</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        value = <span class="built_in">JSON</span>.parse(str)</span><br><span class="line">    &#125;<span class="keyword">catch</span>&#123;</span><br><span class="line">        value = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">stringify</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> value</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        value = <span class="built_in">JSON</span>.stringify(obj)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        value = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">useLocalStorage</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setItem</span>(<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">        value = stringify(value)</span><br><span class="line">        <span class="built_in">window</span>.localStorage.setItem(key, value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getItem</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> value = <span class="built_in">window</span>.localStorage.getItem(key)</span><br><span class="line">        <span class="keyword">if</span>(value) &#123;</span><br><span class="line">            value = parse(value)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        setItem,</span><br><span class="line">        getItem</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> useStorage = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> KEY = <span class="string">'TODOKEYS'</span></span><br><span class="line">    <span class="keyword">const</span> todos = ref(storage.getItem(KEY)||[])</span><br><span class="line">    watchEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        storage.setItem(KEY, todos.value)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> todos</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="任务三：Vue-js-3-0-响应式系统原理"><a href="#任务三：Vue-js-3-0-响应式系统原理" class="headerlink" title="任务三：Vue.js 3.0 响应式系统原理"></a>任务三：Vue.js 3.0 响应式系统原理</h2><h3 id="1-响应式系统原理-介绍"><a href="#1-响应式系统原理-介绍" class="headerlink" title="1.响应式系统原理-介绍"></a>1.响应式系统原理-介绍</h3><blockquote>
<p>Vue.js 响应式回顾</p>
</blockquote>
<ul>
<li>Proxy 对象实现属性监听</li>
<li>多层属性嵌套，在访问属性过程中处理下一级属性</li>
<li>默认监听动态加的属性</li>
<li>默认监听属性的删除操作</li>
<li>默认监听数组索引和 length 属性</li>
<li>可以作为单独的模块使用</li>
</ul>
<blockquote>
<p>核心方法</p>
</blockquote>
<ul>
<li>reactive/ref/toRefs/computed</li>
<li>effect</li>
<li>track</li>
<li>trigger</li>
</ul>
<h3 id="2-响应式系统原理-Proxy对象回顾"><a href="#2-响应式系统原理-Proxy对象回顾" class="headerlink" title="2.响应式系统原理-Proxy对象回顾"></a>2.响应式系统原理-Proxy对象回顾</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="meta">'use strict'</span></span></span><br><span class="line"><span class="actionscript"><span class="comment">// 问题1：set 和 deleteProperty 中需要返回布尔类型的值</span></span></span><br><span class="line"><span class="actionscript"><span class="comment">// 在严格模式下，如果返回 false 的话会出现 Type Error 的异常</span></span></span><br><span class="line"><span class="actionscript"><span class="keyword">const</span> target = &#123;</span></span><br><span class="line"><span class="actionscript">    foo: <span class="string">'xxx'</span>,</span></span><br><span class="line"><span class="actionscript">    bar: <span class="string">'yyy'</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">get</span>(target, key, receiver) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, key, receiver)</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="keyword">set</span>(target, key, value, receiver) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target, key, value, receiver)</span></span><br><span class="line">    &#125;,</span><br><span class="line">    deleteProperty(target, key)&#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">Reflect</span>.deleteProperty(target, key)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="actionscript">proxy.foo = <span class="string">'zzz'</span></span></span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="comment">// 问题2：Proxy 和 Reflect 中使用的 receiver</span></span></span><br><span class="line"><span class="actionscript"><span class="comment">// Proxy 中 receiver：Proxy 或者继承 Proxy 的对象</span></span></span><br><span class="line"><span class="actionscript"><span class="comment">// Reflect 中 receiver：如果 target 对象中设置了 getter，getter 中的 this 指向 receiver</span></span></span><br><span class="line"><span class="actionscript"><span class="keyword">const</span> obj = &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">get</span> foo()&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="keyword">this</span>.bar</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">get</span>(target, key, receiver) &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span>(key === <span class="string">'bar'</span>) &#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> <span class="string">'value-bar'</span></span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, key, receiver)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-响应式系统原理-reactive"><a href="#3-响应式系统原理-reactive" class="headerlink" title="3.响应式系统原理-reactive"></a>3.响应式系统原理-reactive</h3><ul>
<li>接收一个参数，判断这参数是否是对象</li>
<li>创建拦截器对象 handler，设置 get/set/deleteProperty</li>
<li>返回 Proxy 对象</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isObject = <span class="function"><span class="params">val</span> =&gt;</span> val !== <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> val === <span class="string">'object'</span></span><br><span class="line"><span class="keyword">const</span> convert = <span class="function"><span class="params">target</span> =&gt;</span> isObject(target) ? reactive(target) : target</span><br><span class="line"><span class="keyword">const</span> hasOwnProperty = <span class="built_in">Object</span>.protoype.hasOwnProperty</span><br><span class="line"><span class="keyword">const</span> hasOwn = <span class="function">(<span class="params">target, key</span>) =&gt;</span> hasOwnProperty.call(target, key)</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reactive</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(!isObject(target)) <span class="keyword">return</span> target</span><br><span class="line">  <span class="keyword">const</span> handler = &#123;</span><br><span class="line">      <span class="keyword">get</span>(target, key, receiver)&#123;</span><br><span class="line">        <span class="comment">// 收集依赖</span></span><br><span class="line">        track(target, key)</span><br><span class="line">        <span class="keyword">const</span> result = <span class="built_in">Reflect</span>.get(target, key, receiver)</span><br><span class="line">        <span class="keyword">return</span> convert(result)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="keyword">set</span>(target, key, value, receiver)&#123;</span><br><span class="line">        <span class="keyword">const</span> oldValue = <span class="built_in">Reflect</span>.get(target, key, receiver)</span><br><span class="line">        <span class="keyword">let</span> result = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">if</span>(oldVlaue!==value)&#123;</span><br><span class="line">            result = <span class="built_in">Reflect</span>.set(target, key, value, receiver)</span><br><span class="line">            <span class="comment">// 触发更新</span></span><br><span class="line">            trigger(target, key)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;,</span><br><span class="line">      deleteProperty(target, key)&#123;</span><br><span class="line">        <span class="keyword">const</span> hadkey = hasOwn(target, key)</span><br><span class="line">        <span class="keyword">const</span> result = <span class="built_in">Reflect</span>.deleteProperty(target, key)</span><br><span class="line">        <span class="keyword">if</span>(hadkey &amp;&amp; result)&#123;</span><br><span class="line">            <span class="comment">// 触发更新</span></span><br><span class="line">            trigger(target, key)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-响应式系统原理-收集依赖"><a href="#4-响应式系统原理-收集依赖" class="headerlink" title="4.响应式系统原理-收集依赖"></a>4.响应式系统原理-收集依赖</h3><p>略</p>
<h3 id="5-响应式系统原理-effect-track"><a href="#5-响应式系统原理-effect-track" class="headerlink" title="5.响应式系统原理-effect-track"></a>5.响应式系统原理-effect-track</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> activeEffect = <span class="literal">null</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">effect</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line">    activeEffect = callback</span><br><span class="line">    callback()</span><br><span class="line">    activeEffect = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> targetMap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">track</span>(<span class="params">target, key</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(!activeEffect) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">let</span> depsMap = targetMap.get(target)</span><br><span class="line">  <span class="keyword">if</span>(!depsMap) &#123;</span><br><span class="line">      targetMap.set(target,(depsMap = <span class="keyword">new</span> <span class="built_in">Map</span>()))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> dep = depsMap.get(key)</span><br><span class="line">  <span class="keyword">if</span>(!dep)&#123;</span><br><span class="line">      depsMap.set(key, (dep = <span class="keyword">new</span> <span class="built_in">Set</span>()))</span><br><span class="line">  &#125;</span><br><span class="line">  dep.add(activeEffect)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-响应式系统原理-trigger"><a href="#6-响应式系统原理-trigger" class="headerlink" title="6.响应式系统原理-trigger"></a>6.响应式系统原理-trigger</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params">target, key</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> depsMap = target.get(target)</span><br><span class="line">  <span class="keyword">if</span>(!depsMap) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">const</span> dep = depsMap.get(key)</span><br><span class="line">  <span class="keyword">if</span>(dep)&#123;</span><br><span class="line">      dep.forEach(<span class="function"><span class="params">effect</span> =&gt;</span> &#123;</span><br><span class="line">          effect()</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-响应式系统原理-ref"><a href="#7-响应式系统原理-ref" class="headerlink" title="7.响应式系统原理-ref"></a>7.响应式系统原理-ref</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ref</span> (<span class="params">raw</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 判断 raw 是否是 ref 创建的对象，如果是的话直接返回</span></span><br><span class="line">    <span class="keyword">if</span>(isObject(raw) &amp;&amp; raw._v_isRef)&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> value = convert(raw)</span><br><span class="line">    <span class="keyword">const</span> r = &#123;</span><br><span class="line">        _v_isRef: <span class="literal">true</span>,</span><br><span class="line">        <span class="keyword">get</span> value() &#123;</span><br><span class="line">            track(r, <span class="string">'value'</span>)</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">set</span> value(newValue)&#123;</span><br><span class="line">            <span class="keyword">if</span>(newValue !== value)&#123;</span><br><span class="line">                raw = newValue</span><br><span class="line">                value = convert(raw)</span><br><span class="line">                trigger(r, <span class="string">'value'</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>reactive VS ref</p>
</blockquote>
<ul>
<li>ref 可以把基本数据类型数据转成响应式对象</li>
<li>ref 返回的对象，重新赋值成对象也是响应式的</li>
<li>reactive 返回的对象，重新赋值丢失响应式</li>
<li>reactive 返回的对象不可以解构</li>
</ul>
<h3 id="8-响应式系统原理-toRefs"><a href="#8-响应式系统原理-toRefs" class="headerlink" title="8.响应式系统原理-toRefs"></a>8.响应式系统原理-toRefs</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">roRefs</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">const</span> ret = proxy <span class="keyword">instanceof</span> <span class="built_in">Array</span> ? <span class="keyword">new</span> <span class="built_in">Array</span>(proxy.length) : &#123;&#125;</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">const</span> key <span class="keyword">in</span> proxy)&#123;</span><br><span class="line">       ret[key] = toProxy(proxy, key)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toProxy</span>(<span class="params">proxy, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> r = &#123;</span><br><span class="line">        _v_isRef: <span class="literal">true</span>,</span><br><span class="line">        <span class="keyword">get</span> value() &#123;</span><br><span class="line">            <span class="keyword">return</span> proxy[key]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">set</span> value(newValue) &#123;</span><br><span class="line">            proxy[key] = newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-响应式系统原理-computed"><a href="#9-响应式系统原理-computed" class="headerlink" title="9.响应式系统原理-computed"></a>9.响应式系统原理-computed</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">computed</span>(<span class="params">getter</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result = ref()</span><br><span class="line">    effect(<span class="function"><span class="params">()</span> =&gt;</span> (result.value = getter()))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="任务四：Vite-实现原理"><a href="#任务四：Vite-实现原理" class="headerlink" title="任务四：Vite 实现原理"></a>任务四：Vite 实现原理</h2><h3 id="1-Vite"><a href="#1-Vite" class="headerlink" title="1.Vite"></a>1.Vite</h3><blockquote>
<p>Vite 概念</p>
</blockquote>
<ul>
<li>Vite 是一个面向现代浏览器的一个更轻、更快的 Web 应用开发工具</li>
<li>它基于 ECMAScript 标准原生模块系统（ES Modules）实现</li>
</ul>
<blockquote>
<p>Vite 项目依赖</p>
</blockquote>
<ul>
<li>Vite</li>
<li>@vue/compiler-sfc</li>
</ul>
<blockquote>
<p>基础使用</p>
</blockquote>
<ul>
<li>vite serve</li>
<li>vite build</li>
</ul>
<blockquote>
<p>HMR</p>
</blockquote>
<ul>
<li>Vite HMR<ul>
<li>立即编译当前所修改的文件</li>
</ul>
</li>
<li>Webpack HMR<ul>
<li>会自动以这个文件为入口重写 build 一次，所有的涉及到的依赖也都会被加载一遍</li>
</ul>
</li>
</ul>
<blockquote>
<p>Build</p>
</blockquote>
<ul>
<li>vite build<ul>
<li>Rollup</li>
<li>Dynamic import<ul>
<li>Polyfill</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>打包 or 不打包</p>
</blockquote>
<ul>
<li>使用 Webpack 打包的两个原因<ul>
<li>浏览器环境并不支持模块化</li>
<li>零散的模块文件会产生大量的 HTTP 请求</li>
</ul>
</li>
</ul>
<blockquote>
<p>开箱即用</p>
</blockquote>
<ul>
<li>TypeScript - 内置支持</li>
<li>less/sass/stylus/postcss - 内置支持（需要单独安装）</li>
<li>JSX</li>
<li>Web Assembly</li>
</ul>
<blockquote>
<p>Vite 特性</p>
</blockquote>
<ul>
<li>快速冷启动</li>
<li>模块热更新</li>
<li>按需编译</li>
<li>开箱即用</li>
</ul>
<h3 id="2-Vite-实现原理-静态Web服务器"><a href="#2-Vite-实现原理-静态Web服务器" class="headerlink" title="2.Vite 实现原理-静态Web服务器"></a>2.Vite 实现原理-静态Web服务器</h3><blockquote>
<p>Vite 核心功能</p>
</blockquote>
<ul>
<li>静态 Web 服务器</li>
<li>编译单文件组件<ul>
<li>拦截浏览器不识别的模块，并处理</li>
</ul>
</li>
<li>HRM</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> send = <span class="built_in">require</span>(<span class="string">'koa-send'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span>(ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> send(ctx, ctx.path, &#123; <span class="attr">root</span>: process.cwd(), <span class="attr">index</span>: <span class="string">'index.html'</span> &#125;)</span><br><span class="line">    <span class="keyword">await</span> next()</span><br><span class="line">&#125;)</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3-Vite-实现原理-修改第三方模块的路径"><a href="#3-Vite-实现原理-修改第三方模块的路径" class="headerlink" title="3.Vite 实现原理-修改第三方模块的路径"></a>3.Vite 实现原理-修改第三方模块的路径</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> send = <span class="built_in">require</span>(<span class="string">'koa-send'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> streamToString = <span class="function"><span class="params">stream</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> chunks = []</span><br><span class="line">    stream.on(<span class="string">'data'</span>, chunk =&gt; chunks.push(chunk))</span><br><span class="line">    stream.on(<span class="string">'end'</span>,() =&gt; resolve(Buffer.concat(chunks).toString(<span class="string">'utf-8'</span>)))</span><br><span class="line">    stream.on(<span class="string">'error'</span>, reject)</span><br><span class="line">&#125;)</span><br><span class="line">app.use(<span class="keyword">async</span>(ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> send(ctx, ctx.path, &#123; <span class="attr">root</span>: process.cwd(), <span class="attr">index</span>: <span class="string">'index.html'</span> &#125;)</span><br><span class="line">    <span class="keyword">await</span> next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(ctx.type === <span class="string">'application/javascript'</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> contents = <span class="keyword">await</span> streamToString(ctx.body)</span><br><span class="line">        <span class="comment">// import vue from 'vue'</span></span><br><span class="line">        <span class="comment">// import vue from './App.vue'</span></span><br><span class="line"></span><br><span class="line">        ctx.body = contents.replace(<span class="regexp">/(from\s+['"])(?!\.\/)g, '$1/</span>@modules/<span class="string">')</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">app.listen(3000)</span></span><br></pre></td></tr></table></figure>

<h3 id="4-Vite-实现原理-加载第三方模块"><a href="#4-Vite-实现原理-加载第三方模块" class="headerlink" title="4.Vite 实现原理-加载第三方模块"></a>4.Vite 实现原理-加载第三方模块</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> send = <span class="built_in">require</span>(<span class="string">'koa-send'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> streamToString = <span class="function"><span class="params">stream</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> chunks = []</span><br><span class="line">    stream.on(<span class="string">'data'</span>, chunk =&gt; chunks.push(chunk))</span><br><span class="line">    stream.on(<span class="string">'end'</span>,() =&gt; resolve(Buffer.concat(chunks).toString(<span class="string">'utf-8'</span>)))</span><br><span class="line">    stream.on(<span class="string">'error'</span>, reject)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 3.加载第三方模块</span></span><br><span class="line">app.use(<span class="keyword">async</span>(ctx,next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(ctx.path.startWith(<span class="string">'/@modules/'</span>))&#123;</span><br><span class="line">        <span class="keyword">const</span> moduleName = ctx.path.substr(<span class="number">10</span>)</span><br><span class="line">        <span class="keyword">const</span> pkgPath = path.join(process.cwd(),<span class="string">'node_modules'</span>,moduleName,<span class="string">'package.json'</span>)</span><br><span class="line">        <span class="keyword">const</span> pkg = <span class="built_in">require</span>(pkgPath)</span><br><span class="line">        ctx.path = path.join(<span class="string">'/node_modules'</span>,moduleName,pkg.module)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> next()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 1.静态文件服务器</span></span><br><span class="line">app.use(<span class="keyword">async</span>(ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> send(ctx, ctx.path, &#123; <span class="attr">root</span>: process.cwd(), <span class="attr">index</span>: <span class="string">'index.html'</span> &#125;)</span><br><span class="line">    <span class="keyword">await</span> next()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 2.修改第三方模块的路径</span></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(ctx.type === <span class="string">'application/javascript'</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> contents = <span class="keyword">await</span> streamToString(ctx.body)</span><br><span class="line">        <span class="comment">// import vue from 'vue'</span></span><br><span class="line">        <span class="comment">// import vue from './App.vue'</span></span><br><span class="line"></span><br><span class="line">        ctx.body = contents.replace(<span class="regexp">/(from\s+['"])(?!\.\/)g, '$1/</span>@modules/<span class="string">')</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">app.listen(3000)</span></span><br></pre></td></tr></table></figure>

<h3 id="5-Vite-实现原理-编译单文件组件"><a href="#5-Vite-实现原理-编译单文件组件" class="headerlink" title="5.Vite 实现原理-编译单文件组件"></a>5.Vite 实现原理-编译单文件组件</h3><ul>
<li>npm i @vue/compiler-sfc</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; Readable &#125; = <span class="built_in">require</span>(<span class="string">'stream'</span>)</span><br><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> send = <span class="built_in">require</span>(<span class="string">'koa-send'</span>)</span><br><span class="line"><span class="keyword">const</span> compilerSFC = <span class="built_in">require</span>(<span class="string">'@vue/compiler-sfc'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> streamToString = <span class="function"><span class="params">stream</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> chunks = []</span><br><span class="line">    stream.on(<span class="string">'data'</span>, chunk =&gt; chunks.push(chunk))</span><br><span class="line">    stream.on(<span class="string">'end'</span>,() =&gt; resolve(Buffer.concat(chunks).toString(<span class="string">'utf-8'</span>)))</span><br><span class="line">    stream.on(<span class="string">'error'</span>, reject)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> stringToStream = <span class="function"><span class="params">text</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> stream = <span class="keyword">new</span> Readable()</span><br><span class="line">    stream.push(text)</span><br><span class="line">    stream.push(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> stream</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3.加载第三方模块</span></span><br><span class="line">app.use(<span class="keyword">async</span>(ctx,next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(ctx.path.startWith(<span class="string">'/@modules/'</span>))&#123;</span><br><span class="line">        <span class="keyword">const</span> moduleName = ctx.path.substr(<span class="number">10</span>)</span><br><span class="line">        <span class="keyword">const</span> pkgPath = path.join(process.cwd(),<span class="string">'node_modules'</span>,moduleName,<span class="string">'package.json'</span>)</span><br><span class="line">        <span class="keyword">const</span> pkg = <span class="built_in">require</span>(pkgPath)</span><br><span class="line">        ctx.path = path.join(<span class="string">'/node_modules'</span>,moduleName,pkg.module)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> next()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 1.静态文件服务器</span></span><br><span class="line">app.use(<span class="keyword">async</span>(ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> send(ctx, ctx.path, &#123; <span class="attr">root</span>: process.cwd(), <span class="attr">index</span>: <span class="string">'index.html'</span> &#125;)</span><br><span class="line">    <span class="keyword">await</span> next()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 4.处理单文件组件</span></span><br><span class="line">app.use(<span class="keyword">async</span>(ctx,next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(ctx.path.endsWidth(.vue))&#123;</span><br><span class="line">        <span class="keyword">const</span> contents = <span class="keyword">await</span> streamToString(ctx.body)</span><br><span class="line">        <span class="keyword">const</span> &#123; descriptor &#125; = compilerSFC.parse(contents)</span><br><span class="line">        <span class="keyword">let</span> code</span><br><span class="line">        <span class="keyword">if</span>(!ctx.query.type) &#123;</span><br><span class="line">            code = descriptor.script.content</span><br><span class="line">            code = code.replace(<span class="regexp">/export\s+default\s+/g</span>, <span class="string">'const __script = '</span>)</span><br><span class="line">            code += <span class="string">`</span></span><br><span class="line"><span class="string">            import &#123; render as __render &#125; from "<span class="subst">$&#123;ctx.path&#125;</span>?type=template"</span></span><br><span class="line"><span class="string">            __script.render = __render</span></span><br><span class="line"><span class="string">            export default __script</span></span><br><span class="line"><span class="string">            `</span></span><br><span class="line">        &#125;</span><br><span class="line">        ctx.type = <span class="string">'application/javascript'</span></span><br><span class="line">        ctx.body = stringToStream(code)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> next()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 2.修改第三方模块的路径</span></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(ctx.type === <span class="string">'application/javascript'</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> contents = <span class="keyword">await</span> streamToString(ctx.body)</span><br><span class="line">        <span class="comment">// import vue from 'vue'</span></span><br><span class="line">        <span class="comment">// import vue from './App.vue'</span></span><br><span class="line"></span><br><span class="line">        ctx.body = contents.replace(<span class="regexp">/(from\s+['"])(?![\.\/])g, '$1/</span>@modules/<span class="string">')</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">app.listen(3000)</span></span><br></pre></td></tr></table></figure>

<h3 id="6-Vite-实现原理-编译单文件组件"><a href="#6-Vite-实现原理-编译单文件组件" class="headerlink" title="6.Vite 实现原理-编译单文件组件"></a>6.Vite 实现原理-编译单文件组件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; Readable &#125; = <span class="built_in">require</span>(<span class="string">'stream'</span>)</span><br><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>)</span><br><span class="line"><span class="keyword">const</span> send = <span class="built_in">require</span>(<span class="string">'koa-send'</span>)</span><br><span class="line"><span class="keyword">const</span> compilerSFC = <span class="built_in">require</span>(<span class="string">'@vue/compiler-sfc'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> streamToString = <span class="function"><span class="params">stream</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> chunks = []</span><br><span class="line">    stream.on(<span class="string">'data'</span>, chunk =&gt; chunks.push(chunk))</span><br><span class="line">    stream.on(<span class="string">'end'</span>,() =&gt; resolve(Buffer.concat(chunks).toString(<span class="string">'utf-8'</span>)))</span><br><span class="line">    stream.on(<span class="string">'error'</span>, reject)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> stringToStream = <span class="function"><span class="params">text</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> stream = <span class="keyword">new</span> Readable()</span><br><span class="line">    stream.push(text)</span><br><span class="line">    stream.push(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> stream</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3.加载第三方模块</span></span><br><span class="line">app.use(<span class="keyword">async</span>(ctx,next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(ctx.path.startWith(<span class="string">'/@modules/'</span>))&#123;</span><br><span class="line">        <span class="keyword">const</span> moduleName = ctx.path.substr(<span class="number">10</span>)</span><br><span class="line">        <span class="keyword">const</span> pkgPath = path.join(process.cwd(),<span class="string">'node_modules'</span>,moduleName,<span class="string">'package.json'</span>)</span><br><span class="line">        <span class="keyword">const</span> pkg = <span class="built_in">require</span>(pkgPath)</span><br><span class="line">        ctx.path = path.join(<span class="string">'/node_modules'</span>,moduleName,pkg.module)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> next()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 1.静态文件服务器</span></span><br><span class="line">app.use(<span class="keyword">async</span>(ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> send(ctx, ctx.path, &#123; <span class="attr">root</span>: process.cwd(), <span class="attr">index</span>: <span class="string">'index.html'</span> &#125;)</span><br><span class="line">    <span class="keyword">await</span> next()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 4.处理单文件组件</span></span><br><span class="line">app.use(<span class="keyword">async</span>(ctx,next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(ctx.path.endsWidth(.vue))&#123;</span><br><span class="line">        <span class="keyword">const</span> contents = <span class="keyword">await</span> streamToString(ctx.body)</span><br><span class="line">        <span class="keyword">const</span> &#123; descriptor &#125; = compilerSFC.parse(contents)</span><br><span class="line">        <span class="keyword">let</span> code</span><br><span class="line">        <span class="keyword">if</span>(!ctx.query.type) &#123;</span><br><span class="line">            code = descriptor.script.content</span><br><span class="line">            code = code.replace(<span class="regexp">/export\s+default\s+/g</span>, <span class="string">'const __script = '</span>)</span><br><span class="line">            code += <span class="string">`</span></span><br><span class="line"><span class="string">            import &#123; render as __render &#125; from "<span class="subst">$&#123;ctx.path&#125;</span>?type=template"</span></span><br><span class="line"><span class="string">            __script.render = __render</span></span><br><span class="line"><span class="string">            export default __script</span></span><br><span class="line"><span class="string">            `</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(ctx.query.type === <span class="string">'template'</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> templateRender = compilerSFC.compileTemplate(&#123; <span class="attr">source</span>: descriptor.template.content &#125;)</span><br><span class="line">            code = templateRender.code</span><br><span class="line">        &#125;</span><br><span class="line">        ctx.type = <span class="string">'application/javascript'</span></span><br><span class="line">        ctx.body = stringToStream(code)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> next()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 2.修改第三方模块的路径</span></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(ctx.type === <span class="string">'application/javascript'</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> contents = <span class="keyword">await</span> streamToString(ctx.body)</span><br><span class="line">        <span class="comment">// import vue from 'vue'</span></span><br><span class="line">        <span class="comment">// import vue from './App.vue'</span></span><br><span class="line"></span><br><span class="line">        ctx.body = contents</span><br><span class="line">        .replace(<span class="regexp">/(from\s+['"])(?![\.\/])g, '$1/</span>@modules/<span class="string">')</span></span><br><span class="line"><span class="string">        .replace(/process\.env\.NODE_ENV/g,'</span><span class="string">"development"</span><span class="string">')</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">app.listen(3000)</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/03/34/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旋の飞羽">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/02/03/34/" itemprop="url">学习笔记 ----- 【Vue.js 框架源码与进阶】搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-02-03T00:00:00+08:00">
                2021-02-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>作者：FY<br>引用请标明出处</p>
</blockquote>
<h1 id="Part-3-·-Vue-js-框架源码与进阶"><a href="#Part-3-·-Vue-js-框架源码与进阶" class="headerlink" title="Part 3 · Vue.js 框架源码与进阶"></a>Part 3 · Vue.js 框架源码与进阶</h1><h2 id="模块四-·-搭建自己的SSR、静态站点生成（SSG）及封装-Vue-js-组件库"><a href="#模块四-·-搭建自己的SSR、静态站点生成（SSG）及封装-Vue-js-组件库" class="headerlink" title="模块四 · 搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库"></a>模块四 · 搭建自己的SSR、静态站点生成（SSG）及封装 Vue.js 组件库</h2><h2 id="任务一：搭建自己的SSR"><a href="#任务一：搭建自己的SSR" class="headerlink" title="任务一：搭建自己的SSR"></a>任务一：搭建自己的SSR</h2><h3 id="1-渲染一个-Vue-实例"><a href="#1-渲染一个-Vue-实例" class="headerlink" title="1.渲染一个 Vue 实例"></a>1.渲染一个 Vue 实例</h3><ul>
<li>mkdir vue-ssr</li>
<li>cd vue-ssr</li>
<li>npm init -y</li>
<li>npm i vue-server-renderer</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const renderer = require('</span>vue-server-renderer<span class="string">').createRenderer()</span></span><br><span class="line"><span class="string">const app = new Vue(&#123;</span></span><br><span class="line"><span class="string">  template: `</span></span><br><span class="line"><span class="string">  &lt;div id="app"&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line"><span class="string">  data: &#123;</span></span><br><span class="line"><span class="string">    message: '</span>XXXX<span class="string">'</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">renderer.renderToString(app, (err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">  if(err) throw err</span></span><br><span class="line"><span class="string">  console.log(html)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure>

<h3 id="2-结合到-Web-服务器中"><a href="#2-结合到-Web-服务器中" class="headerlink" title="2.结合到 Web 服务器中"></a>2.结合到 Web 服务器中</h3><ul>
<li>npm i express</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">const renderer = require('</span>vue-server-renderer<span class="string">').createRenderer()</span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string">server.get('</span>/<span class="string">',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">const app = new Vue(&#123;</span></span><br><span class="line"><span class="string">  template: `</span></span><br><span class="line"><span class="string">  &lt;div id="app"&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line"><span class="string">  data: &#123;</span></span><br><span class="line"><span class="string">    message: '</span>XXXX<span class="string">'</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">renderer.renderToString(app, (err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">  if(err) &#123;</span></span><br><span class="line"><span class="string">    return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  // res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">  res.end(`</span></span><br><span class="line"><span class="string">  &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">  &lt;html lang="en"&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">      &lt;meta charset="UTF-8"&gt;</span></span><br><span class="line"><span class="string">      &lt;meta name="viewport" content="width=device-width,initial-scale=1.0"&gt;</span></span><br><span class="line"><span class="string">      &lt;title&gt;Document&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">      $&#123;html&#125;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/html&gt;`)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="3-使用-HTML-模板"><a href="#3-使用-HTML-模板" class="headerlink" title="3.使用 HTML 模板"></a>3.使用 HTML 模板</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.template.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1.0"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- vur-ssr-outlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">cosnst fs = require('</span>fs<span class="string">')</span></span><br><span class="line"><span class="string">const renderer = require('</span>vue-server-renderer<span class="string">').createRenderer(&#123;</span></span><br><span class="line"><span class="string">  template: fs.readFileSync('</span>./index.template.html<span class="string">','</span>utf<span class="number">-8</span><span class="string">')</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string">server.get('</span>/<span class="string">',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">const app = new Vue(&#123;</span></span><br><span class="line"><span class="string">  template: `</span></span><br><span class="line"><span class="string">  &lt;div id="app"&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line"><span class="string">  data: &#123;</span></span><br><span class="line"><span class="string">    message: '</span>XXXX<span class="string">'</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">renderer.renderToString(app, (err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">  if(err) &#123;</span></span><br><span class="line"><span class="string">    return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  // res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">  res.end(html)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="4-在模板中使用外部数据"><a href="#4-在模板中使用外部数据" class="headerlink" title="4.在模板中使用外部数据"></a>4.在模板中使用外部数据</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.template.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1.0"</span>&gt;</span></span><br><span class="line">      &#123;&#123;&#123;meta&#125;&#125;&#125;</span><br><span class="line">      <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- vur-ssr-outlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">cosnst fs = require('</span>fs<span class="string">')</span></span><br><span class="line"><span class="string">const renderer = require('</span>vue-server-renderer<span class="string">').createRenderer(&#123;</span></span><br><span class="line"><span class="string">  template: fs.readFileSync('</span>./index.template.html<span class="string">','</span>utf<span class="number">-8</span><span class="string">')</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string">server.get('</span>/<span class="string">',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">const app = new Vue(&#123;</span></span><br><span class="line"><span class="string">  template: `</span></span><br><span class="line"><span class="string">  &lt;div id="app"&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line"><span class="string">  data: &#123;</span></span><br><span class="line"><span class="string">    message: '</span>XXXX<span class="string">'</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">renderer.renderToString(app, &#123;</span></span><br><span class="line"><span class="string">  title: '</span>XXXX<span class="string">',</span></span><br><span class="line"><span class="string">  meta: `&lt;meta name="description" content="XXXX"`</span></span><br><span class="line"><span class="string">&#125;，(err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">  if(err) &#123;</span></span><br><span class="line"><span class="string">    return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  // res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">  res.end(html)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="5-构建配置-基本思路"><a href="#5-构建配置-基本思路" class="headerlink" title="5.构建配置-基本思路"></a>5.构建配置-基本思路</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">cosnst fs = require('</span>fs<span class="string">')</span></span><br><span class="line"><span class="string">const renderer = require('</span>vue-server-renderer<span class="string">').createRenderer(&#123;</span></span><br><span class="line"><span class="string">  template: fs.readFileSync('</span>./index.template.html<span class="string">','</span>utf<span class="number">-8</span><span class="string">')</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string">server.get('</span>/<span class="string">',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">const app = new Vue(&#123;</span></span><br><span class="line"><span class="string">  template: `</span></span><br><span class="line"><span class="string">  &lt;div id="app"&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;&#123;&#123; message &#125;&#125;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;h2&gt;客户端动态交互&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;input v-model="message"&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;button @click="onClick"&gt;点击测试&lt;/button&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line"><span class="string">  data: &#123;</span></span><br><span class="line"><span class="string">    message: '</span>XXXX<span class="string">'</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  methods: &#123;</span></span><br><span class="line"><span class="string">    onClick()&#123;</span></span><br><span class="line"><span class="string">      console.log('</span>Hello World!<span class="string">')</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">renderer.renderToString(app, &#123;</span></span><br><span class="line"><span class="string">  title: '</span>XXXX<span class="string">',</span></span><br><span class="line"><span class="string">  meta: `&lt;meta name="description" content="XXXX"`</span></span><br><span class="line"><span class="string">&#125;，(err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">  if(err) &#123;</span></span><br><span class="line"><span class="string">    return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  // res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">  res.end(html)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="6-构建配置-源码结构"><a href="#6-构建配置-源码结构" class="headerlink" title="6.构建配置-源码结构"></a>6.构建配置-源码结构</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- App.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>客户端动态交互<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">"message"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"onClick"</span>&gt;</span>点击测试<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="actionscript">  name: <span class="string">'App'</span>,</span></span><br><span class="line">  data()&#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">      message: <span class="string">'XXXX'</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    onClick()&#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'Hello World!'</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出一个工厂函数，用于创建新的</span></span><br><span class="line"><span class="comment">// 应用程序、router 和 store 实例</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createApp</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    <span class="comment">// 根实例简单的渲染应用程序组件。</span></span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123; app &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry-client.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端特定引导逻辑……</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; app &#125; = createApp()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里假定 App.vue 模板中根元素具有 `id="app"`</span></span><br><span class="line">app.$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry-server.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> context =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; app &#125; = createApp()</span><br><span class="line">  <span class="comment">// 服务端路由处理、数据预取</span></span><br><span class="line">  <span class="keyword">return</span> app</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-构建配置-安装依赖"><a href="#7-构建配置-安装依赖" class="headerlink" title="7.构建配置-安装依赖"></a>7.构建配置-安装依赖</h3><blockquote>
<p>安装依赖</p>
</blockquote>
<ul>
<li><p>安装生产依赖</p>
<ul>
<li>npm i vue vue-server-renderer express cross-env<ul>
<li>vue Vue.js 核心库</li>
<li>vue-server-renderer Vue 服务端渲染工具</li>
<li>express 基于 Node 的 Web 服务框架</li>
<li>cross-env 通过 npm scripts 设置跨平台环境变量</li>
</ul>
</li>
</ul>
</li>
<li><p>安装开发依赖</p>
<ul>
<li>npm i -D webpack webpack-cli webpack-merge webpack-node-externals @babel/core @babel/plugin-transform-runtime @babel/preset-env babel-loader css-loader url-loader file-loader rimraf vue-loader vue-template-compiler friendly-errors-webpack-plugin<ul>
<li>webpack webpack 核心包</li>
<li>webpack-cli webpack 的命令行工具</li>
<li>webpack-merge webpack 配置信息合并工具</li>
<li>webpack-node-externals 排除 webpack 中的 Node 模块</li>
<li>rimraf 基于 Node 封装的一个跨平台 rm -rf 工具</li>
<li>friendly-errors-webpack-plugin 友好的 webpack 错误提示</li>
<li>@babel/core @babel/plugin-transform-runtime @babel/preset-env babel-loader Babel 相关工具</li>
<li>vue-loader vue-template-compiler 处理 .vue 资源</li>
<li>file-loader 处理字体资源</li>
<li>css-loader 处理 CSS 资源</li>
<li>url-loader 处理图片资源</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="8-构建配置-webpack-配置文件"><a href="#8-构建配置-webpack-配置文件" class="headerlink" title="8.构建配置-webpack 配置文件"></a>8.构建配置-webpack 配置文件</h3><blockquote>
<p>配置文件及打包命令</p>
</blockquote>
<ul>
<li>初始化 webpack 打包配置文件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">build</span><br><span class="line">|—— webpack.base.config.js</span><br><span class="line">|—— webpack.client.config.js</span><br><span class="line">|—— webpack.server.config.js</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.base.config.js</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 公共配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> VueLoaderPlugin = <span class="built_in">require</span>(<span class="string">'vue-loader/lib/plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> FriendlyErrorsWebpackPlugin = <span class="built_in">require</span>(<span class="string">'friendly-errors-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">file</span> =&gt;</span> path.resolve(__dirname, file)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isProd = process.env.NODE_ENV === <span class="string">'production'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: isProd ? <span class="string">'production'</span> : <span class="string">'development'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: resolve(<span class="string">'../dist/'</span>),</span><br><span class="line">    publicPath: <span class="string">'/dist/'</span>,</span><br><span class="line">    filename: <span class="string">'[name].[chunkhash].js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="comment">// 路径别名，@ 指向 src</span></span><br><span class="line">      <span class="string">'@'</span>: resolve(<span class="string">'../src/'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 可以省略的扩展名</span></span><br><span class="line">    <span class="comment">// 当省略扩展名的时候，按照从前往后的顺序依次解析</span></span><br><span class="line">    extensions: [<span class="string">'.js'</span>, <span class="string">'.vue'</span>, <span class="string">'.json'</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: isProd ? <span class="string">'source-map'</span> : <span class="string">'cheap-module-eval-source-map'</span>,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      <span class="comment">// 处理图片资源</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg|gif)$/i</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">8192</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 处理字体资源</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(woff|woff2|eot|ttf|otf)$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">'file-loader'</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 处理 .vue 资源</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.vue$/</span>,</span><br><span class="line">        loader: <span class="string">'vue-loader'</span></span><br><span class="line">      &#125;,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 处理 CSS 资源</span></span><br><span class="line">      <span class="comment">// 它会应用到普通的 `.css` 文件</span></span><br><span class="line">      <span class="comment">// 以及 `.vue` 文件中的 `&lt;style&gt;` 块</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">'vue-style-loader'</span>,</span><br><span class="line">          <span class="string">'css-loader'</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// CSS 预处理器，参考：https://vue-loader.vuejs.org/zh/guide/pre-processors.html</span></span><br><span class="line">      <span class="comment">// 例如处理 Less 资源</span></span><br><span class="line">      <span class="comment">// &#123;</span></span><br><span class="line">      <span class="comment">//   test: /\.less$/,</span></span><br><span class="line">      <span class="comment">//   use: [</span></span><br><span class="line">      <span class="comment">//     'vue-style-loader',</span></span><br><span class="line">      <span class="comment">//     'css-loader',</span></span><br><span class="line">      <span class="comment">//     'less-loader'</span></span><br><span class="line">      <span class="comment">//   ]</span></span><br><span class="line">      <span class="comment">// &#125;,</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> VueLoaderPlugin(),</span><br><span class="line">    <span class="keyword">new</span> FriendlyErrorsWebpackPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.client.config.js</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端打包配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.config.js'</span>)</span><br><span class="line"><span class="keyword">const</span> VueSSRClientPlugin = <span class="built_in">require</span>(<span class="string">'vue-server-renderer/client-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseConfig, &#123;</span><br><span class="line">  entry: &#123;</span><br><span class="line">    app: <span class="string">'./src/entry-client.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      <span class="comment">// ES6 转 ES5</span></span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.m?js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/(node_modules|bower_components)/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            presets: [<span class="string">'@babel/preset-env'</span>],</span><br><span class="line">            cacheDirectory: <span class="literal">true</span>,</span><br><span class="line">            plugins: [<span class="string">'@babel/plugin-transform-runtime'</span>]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重要信息：这将 webpack 运行时分离到一个引导 chunk 中，</span></span><br><span class="line">  <span class="comment">// 以便可以在之后正确注入异步 chunk。</span></span><br><span class="line">  optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      name: <span class="string">"manifest"</span>,</span><br><span class="line">      minChunks: <span class="literal">Infinity</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// 此插件在输出目录中生成 `vue-ssr-client-manifest.json`。</span></span><br><span class="line">    <span class="keyword">new</span> VueSSRClientPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.server.config.js</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 服务端打包配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> &#123; merge &#125; = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> nodeExternals = <span class="built_in">require</span>(<span class="string">'webpack-node-externals'</span>)</span><br><span class="line"><span class="keyword">const</span> baseConfig = <span class="built_in">require</span>(<span class="string">'./webpack.base.config.js'</span>)</span><br><span class="line"><span class="keyword">const</span> VueSSRServerPlugin = <span class="built_in">require</span>(<span class="string">'vue-server-renderer/server-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseConfig, &#123;</span><br><span class="line">  <span class="comment">// 将 entry 指向应用程序的 server entry 文件</span></span><br><span class="line">  entry: <span class="string">'./src/entry-server.js'</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这允许 webpack 以 Node 适用方式处理模块加载</span></span><br><span class="line">  <span class="comment">// 并且还会在编译 Vue 组件时，</span></span><br><span class="line">  <span class="comment">// 告知 `vue-loader` 输送面向服务器代码(server-oriented code)。</span></span><br><span class="line">  target: <span class="string">'node'</span>,</span><br><span class="line"></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'server-bundle.js'</span>,</span><br><span class="line">    <span class="comment">// 此处告知 server bundle 使用 Node 风格导出模块(Node-style exports)</span></span><br><span class="line">    libraryTarget: <span class="string">'commonjs2'</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 不打包 node_modules 第三方包，而是保留 require 方式直接加载</span></span><br><span class="line">  externals: [nodeExternals(&#123;</span><br><span class="line">    <span class="comment">// 白名单中的资源依然正常打包</span></span><br><span class="line">    allowlist: [<span class="regexp">/\.css$/</span>]</span><br><span class="line">  &#125;)],</span><br><span class="line"></span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// 这是将服务器的整个输出构建为单个 JSON 文件的插件。</span></span><br><span class="line">    <span class="comment">// 默认文件名为 `vue-ssr-server-bundle.json`</span></span><br><span class="line">    <span class="keyword">new</span> VueSSRServerPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="9-构建配置-配置构建命令"><a href="#9-构建配置-配置构建命令" class="headerlink" title="9.构建配置-配置构建命令"></a>9.构建配置-配置构建命令</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">  "scripts": &#123;</span><br><span class="line">    "build:client": "cross-env NODE_ENV=production webpack --config build/webpack.client.config.js",</span><br><span class="line">    "build:server": "cross-env NODE_ENV=production webpack --config build/webpack.server.config.js",</span><br><span class="line">    "build": "rimraf dist &amp;&amp; npm run build:client &amp;&amp; npm run build:server",</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h3 id="10-构建配置-启动应用"><a href="#10-构建配置-启动应用" class="headerlink" title="10.构建配置-启动应用"></a>10.构建配置-启动应用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">cosnst fs = require('</span>fs<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const serverBundle = require('</span>./dist/vue-ssr-server-bundle.json<span class="string">')</span></span><br><span class="line"><span class="string">const template = fs.readFileSync('</span>./index.template.html<span class="string">', '</span>utf<span class="number">-8</span><span class="string">')</span></span><br><span class="line"><span class="string">const clientManifest = require('</span>./dist/vue-ssr-client-manifest.json<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const renderer = require('</span>vue-server-renderer<span class="string">').createBundleRenderer(serverBundle,&#123;</span></span><br><span class="line"><span class="string">  template,</span></span><br><span class="line"><span class="string">  clientManifest</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.use('</span>./dist<span class="string">',express.static('</span>./dist<span class="string">'))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.get('</span>/<span class="string">',(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">  renderer.renderToString(app, &#123;</span></span><br><span class="line"><span class="string">    title: '</span>XXXX<span class="string">',</span></span><br><span class="line"><span class="string">    meta: `&lt;meta name="description" content="XXXX"`</span></span><br><span class="line"><span class="string">  &#125;，(err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">    if(err) &#123;</span></span><br><span class="line"><span class="string">      return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    // res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">    res.end(html)</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="11-构建配置-解析渲染流程"><a href="#11-构建配置-解析渲染流程" class="headerlink" title="11.构建配置-解析渲染流程"></a>11.构建配置-解析渲染流程</h3><p>略</p>
<h3 id="12-构建配置开发模式-基本思路"><a href="#12-构建配置开发模式-基本思路" class="headerlink" title="12.构建配置开发模式-基本思路"></a>12.构建配置开发模式-基本思路</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">  "scripts": &#123;</span><br><span class="line">    "build:client": "cross-env NODE_ENV=production webpack --config build/webpack.client.config.js",</span><br><span class="line">    "build:server": "cross-env NODE_ENV=production webpack --config build/webpack.server.config.js",</span><br><span class="line">    "build": "rimraf dist &amp;&amp; npm run build:client &amp;&amp; npm run build:server",</span><br><span class="line">    "start": "cross-env NODE_ENV=production node server.js",</span><br><span class="line">    "dev": "node server.js"</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">cosnst fs = require('</span>fs<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const isProd = process.env.NODE_ENV === '</span>production<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">let renderer</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if(isProd)&#123;</span></span><br><span class="line"><span class="string">  const serverBundle = require('</span>./dist/vue-ssr-server-bundle.json<span class="string">')</span></span><br><span class="line"><span class="string">  const template = fs.readFileSync('</span>./index.template.html<span class="string">', '</span>utf<span class="number">-8</span><span class="string">')</span></span><br><span class="line"><span class="string">  const clientManifest = require('</span>./dist/vue-ssr-client-manifest.json<span class="string">')</span></span><br><span class="line"><span class="string">  renderer = require('</span>vue-server-renderer<span class="string">').createBundleRenderer(serverBundle,&#123;</span></span><br><span class="line"><span class="string">    template,</span></span><br><span class="line"><span class="string">    clientManifest</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125; else &#123;</span></span><br><span class="line"><span class="string">  // 开发模式 -&gt; 监视打包构建 -&gt; 重新生成 Renderer 渲染器</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.use('</span>./dist<span class="string">',express.static('</span>./dist<span class="string">'))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const render = (req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">  renderer.renderToString(app, &#123;</span></span><br><span class="line"><span class="string">    title: '</span>XXXX<span class="string">',</span></span><br><span class="line"><span class="string">    meta: `&lt;meta name="description" content="XXXX"`</span></span><br><span class="line"><span class="string">  &#125;，(err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">    if(err) &#123;</span></span><br><span class="line"><span class="string">      return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    // res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">    res.end(html)</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.get('</span>/<span class="string">', isProd?render:(req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">  // 等待有了 Renderer 渲染器以后，调用 render 进行渲染</span></span><br><span class="line"><span class="string">  render()</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="13-构建配置开发模式-提取处理模块"><a href="#13-构建配置开发模式-提取处理模块" class="headerlink" title="13.构建配置开发模式-提取处理模块"></a>13.构建配置开发模式-提取处理模块</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">cosnst fs = require('</span>fs<span class="string">')</span></span><br><span class="line"><span class="string">const &#123; createBundleRenderer &#125; = require('</span>vue-server-renderer<span class="string">')</span></span><br><span class="line"><span class="string">const setupDevServer = require('</span>./build/setup-dev-server<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.use('</span>./dist<span class="string">',express.static('</span>./dist<span class="string">'))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const isProd = process.env.NODE_ENV === '</span>production<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">let renderer</span></span><br><span class="line"><span class="string">let onReady</span></span><br><span class="line"><span class="string">if(isProd)&#123;</span></span><br><span class="line"><span class="string">  const serverBundle = require('</span>./dist/vue-ssr-server-bundle.json<span class="string">')</span></span><br><span class="line"><span class="string">  const template = fs.readFileSync('</span>./index.template.html<span class="string">', '</span>utf<span class="number">-8</span><span class="string">')</span></span><br><span class="line"><span class="string">  const clientManifest = require('</span>./dist/vue-ssr-client-manifest.json<span class="string">')</span></span><br><span class="line"><span class="string">  renderer = createBundleRenderer(serverBundle,&#123;</span></span><br><span class="line"><span class="string">    template,</span></span><br><span class="line"><span class="string">    clientManifest</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125; else &#123;</span></span><br><span class="line"><span class="string">  // 开发模式 -&gt; 监视打包构建 -&gt; 重新生成 Renderer 渲染器</span></span><br><span class="line"><span class="string">  onReady = setupDevServer(server, (serverBundle,template,clientManifest)=&gt;&#123;</span></span><br><span class="line"><span class="string">    renderer = createBundleRenderer(serverBundle,&#123;</span></span><br><span class="line"><span class="string">      template,</span></span><br><span class="line"><span class="string">      clientManifest</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const render = (req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">  renderer.renderToString(app, &#123;</span></span><br><span class="line"><span class="string">    title: '</span>XXXX<span class="string">',</span></span><br><span class="line"><span class="string">    meta: `&lt;meta name="description" content="XXXX"`</span></span><br><span class="line"><span class="string">  &#125;，(err,html)=&gt;&#123;</span></span><br><span class="line"><span class="string">    if(err) &#123;</span></span><br><span class="line"><span class="string">      return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    // res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">    res.end(html)</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.get('</span>/<span class="string">', isProd</span></span><br><span class="line"><span class="string">? render</span></span><br><span class="line"><span class="string">: async (req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">    // 等待有了 Renderer 渲染器以后，调用 render 进行渲染</span></span><br><span class="line"><span class="string">    await onReady</span></span><br><span class="line"><span class="string">    render(req,res)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup-dev-server.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">server, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onReady = <span class="keyword">new</span> <span class="built_in">Promise</span>()</span><br><span class="line">  <span class="comment">// 监视构建 -&gt; 更新 Renderer</span></span><br><span class="line">  <span class="keyword">return</span> onReady</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-构建配置开发模式-updata-更新函数"><a href="#14-构建配置开发模式-updata-更新函数" class="headerlink" title="14.构建配置开发模式-updata 更新函数"></a>14.构建配置开发模式-updata 更新函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup-dev-server.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">server, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onReady = <span class="keyword">new</span> <span class="built_in">Promise</span>()</span><br><span class="line">  <span class="comment">// 监视构建 -&gt; 更新 Renderer</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> template</span><br><span class="line">  <span class="keyword">let</span> serverBundle</span><br><span class="line">  <span class="keyword">let</span> clientManifest</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> update = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(template &amp;&amp; serverBundle &amp;&amp; clientManifest) &#123;</span><br><span class="line">      ready()</span><br><span class="line">      callback(template, serverBundle, clientManifest)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 监视构建 template -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="comment">// 监视构建 serverBundle -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="comment">// 监视构建 clientManifest -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">return</span> onReady</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="15-构建配置开发模式-处理模板文件"><a href="#15-构建配置开发模式-处理模板文件" class="headerlink" title="15.构建配置开发模式-处理模板文件"></a>15.构建配置开发模式-处理模板文件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup-dev-server.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> chokidar = <span class="built_in">require</span>(<span class="string">'chokidar'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">server, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onReady = <span class="keyword">new</span> <span class="built_in">Promise</span>()</span><br><span class="line">  <span class="comment">// 监视构建 -&gt; 更新 Renderer</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> template</span><br><span class="line">  <span class="keyword">let</span> serverBundle</span><br><span class="line">  <span class="keyword">let</span> clientManifest</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> update = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(template &amp;&amp; serverBundle &amp;&amp; clientManifest) &#123;</span><br><span class="line">      ready()</span><br><span class="line">      callback(template, serverBundle, clientManifest)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 监视构建 template -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> templatePath = path.resolve(__dirname, <span class="string">'../index.template.html'</span>)</span><br><span class="line">  template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">  update()</span><br><span class="line">  chokidar.watch(templatePath).on(<span class="string">'change'</span>,() =&gt; &#123;</span><br><span class="line">    template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 监视构建 serverBundle -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="comment">// 监视构建 clientManifest -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">return</span> onReady</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="16-构建配置开发模式-服务器监视打包"><a href="#16-构建配置开发模式-服务器监视打包" class="headerlink" title="16.构建配置开发模式-服务器监视打包"></a>16.构建配置开发模式-服务器监视打包</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup-dev-server.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> chokidar = <span class="built_in">require</span>(<span class="string">'chokidar'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">file</span> =&gt;</span> path.resolve(__dirname, file)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">server, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onReady = <span class="keyword">new</span> <span class="built_in">Promise</span>()</span><br><span class="line">  <span class="comment">// 监视构建 -&gt; 更新 Renderer</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> template</span><br><span class="line">  <span class="keyword">let</span> serverBundle</span><br><span class="line">  <span class="keyword">let</span> clientManifest</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> update = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(template &amp;&amp; serverBundle &amp;&amp; clientManifest) &#123;</span><br><span class="line">      ready()</span><br><span class="line">      callback(template, serverBundle, clientManifest)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 监视构建 template -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> templatePath = path.resolve(__dirname, <span class="string">'../index.template.html'</span>)</span><br><span class="line">  template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">  update()</span><br><span class="line">  chokidar.watch(templatePath).on(<span class="string">'change'</span>,() =&gt; &#123;</span><br><span class="line">    template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 监视构建 serverBundle -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> serverConfig = <span class="built_in">require</span>(<span class="string">'./webpack.server.config'</span>)</span><br><span class="line">  <span class="keyword">const</span> serverCompiler = webpack(serverConfig)</span><br><span class="line">  serverCompiler.watch(&#123;&#125;,(err, stats)=&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err</span><br><span class="line">    <span class="keyword">if</span>(stats.hasErrors()) <span class="keyword">return</span></span><br><span class="line">    serverBundle = Json.parse(</span><br><span class="line">      fs.readFileSync(resolve(<span class="string">'../dist/vue-ssr-server-bundle.json'</span>),<span class="string">'utf-8'</span>)</span><br><span class="line">    )</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 监视构建 clientManifest -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">return</span> onReady</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="17-构建配置开发模式-把数据写入内存中"><a href="#17-构建配置开发模式-把数据写入内存中" class="headerlink" title="17.构建配置开发模式-把数据写入内存中"></a>17.构建配置开发模式-把数据写入内存中</h3><ul>
<li>npm install webpack-dev-middleware –save-dev</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup-dev-server.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> chokidar = <span class="built_in">require</span>(<span class="string">'chokidar'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> devMiddleware = <span class="built_in">require</span>(<span class="string">'webpack-dev-middleware'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">file</span> =&gt;</span> path.resolve(__dirname, file)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">server, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onReady = <span class="keyword">new</span> <span class="built_in">Promise</span>()</span><br><span class="line">  <span class="comment">// 监视构建 -&gt; 更新 Renderer</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> template</span><br><span class="line">  <span class="keyword">let</span> serverBundle</span><br><span class="line">  <span class="keyword">let</span> clientManifest</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> update = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(template &amp;&amp; serverBundle &amp;&amp; clientManifest) &#123;</span><br><span class="line">      ready()</span><br><span class="line">      callback(template, serverBundle, clientManifest)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 监视构建 template -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> templatePath = path.resolve(__dirname, <span class="string">'../index.template.html'</span>)</span><br><span class="line">  template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">  update()</span><br><span class="line">  chokidar.watch(templatePath).on(<span class="string">'change'</span>,() =&gt; &#123;</span><br><span class="line">    template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 监视构建 serverBundle -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> serverConfig = <span class="built_in">require</span>(<span class="string">'./webpack.server.config'</span>)</span><br><span class="line">  <span class="keyword">const</span> serverCompiler = webpack(serverConfig)</span><br><span class="line">  <span class="keyword">const</span> serverDevMiddleware = devMiddleware(serverCompiler, &#123;</span><br><span class="line">    logLevel: <span class="string">'silent'</span> <span class="comment">// 关闭日志输出，由 FriendlyErrorsWebpackPlugin 处理</span></span><br><span class="line">  &#125;)</span><br><span class="line">  serverCompiler.hooks.done.tap(<span class="string">'server'</span>,()=&gt;&#123;</span><br><span class="line">    serverBundle = <span class="built_in">JSON</span>.parse(</span><br><span class="line">      serverDevMiddleware.fileSystem.readFileSync(resolve(<span class="string">'../dist/vue-ssr-server-bundle.json'</span>),<span class="string">'utf-8'</span>)</span><br><span class="line">    )</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// serverCompiler.watch(&#123;&#125;,(err, stats)=&gt;&#123;</span></span><br><span class="line">  <span class="comment">//   if(err) throw err</span></span><br><span class="line">  <span class="comment">//   if(stats.hasErrors()) return</span></span><br><span class="line">  <span class="comment">//   serverBundle = JSON.parse(</span></span><br><span class="line">  <span class="comment">//     fs.readFileSync(resolve('../dist/vue-ssr-server-bundle.json'),'utf-8')</span></span><br><span class="line">  <span class="comment">//   )</span></span><br><span class="line">  <span class="comment">//   update()</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line">  <span class="comment">// 监视构建 clientManifest -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">return</span> onReady</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="18-构建配置开发模式-客户端构建"><a href="#18-构建配置开发模式-客户端构建" class="headerlink" title="18.构建配置开发模式-客户端构建"></a>18.构建配置开发模式-客户端构建</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup-dev-server.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> chokidar = <span class="built_in">require</span>(<span class="string">'chokidar'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> devMiddleware = <span class="built_in">require</span>(<span class="string">'webpack-dev-middleware'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">file</span> =&gt;</span> path.resolve(__dirname, file)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">server, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onReady = <span class="keyword">new</span> <span class="built_in">Promise</span>()</span><br><span class="line">  <span class="comment">// 监视构建 -&gt; 更新 Renderer</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> template</span><br><span class="line">  <span class="keyword">let</span> serverBundle</span><br><span class="line">  <span class="keyword">let</span> clientManifest</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> update = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(template &amp;&amp; serverBundle &amp;&amp; clientManifest) &#123;</span><br><span class="line">      ready()</span><br><span class="line">      callback(template, serverBundle, clientManifest)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 监视构建 template -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> templatePath = path.resolve(__dirname, <span class="string">'../index.template.html'</span>)</span><br><span class="line">  template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">  update()</span><br><span class="line">  chokidar.watch(templatePath).on(<span class="string">'change'</span>,() =&gt; &#123;</span><br><span class="line">    template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 监视构建 serverBundle -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> serverConfig = <span class="built_in">require</span>(<span class="string">'./webpack.server.config'</span>)</span><br><span class="line">  <span class="keyword">const</span> serverCompiler = webpack(serverConfig)</span><br><span class="line">  <span class="keyword">const</span> serverDevMiddleware = devMiddleware(serverCompiler, &#123;</span><br><span class="line">    logLevel: <span class="string">'silent'</span> <span class="comment">// 关闭日志输出，由 FriendlyErrorsWebpackPlugin 处理</span></span><br><span class="line">  &#125;)</span><br><span class="line">  serverCompiler.hooks.done.tap(<span class="string">'server'</span>,()=&gt;&#123;</span><br><span class="line">    serverBundle = <span class="built_in">JSON</span>.parse(</span><br><span class="line">      serverDevMiddleware.fileSystem.readFileSync(resolve(<span class="string">'../dist/vue-ssr-server-bundle.json'</span>),<span class="string">'utf-8'</span>)</span><br><span class="line">    )</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// serverCompiler.watch(&#123;&#125;,(err, stats)=&gt;&#123;</span></span><br><span class="line">  <span class="comment">//   if(err) throw err</span></span><br><span class="line">  <span class="comment">//   if(stats.hasErrors()) return</span></span><br><span class="line">  <span class="comment">//   serverBundle = JSON.parse(</span></span><br><span class="line">  <span class="comment">//     fs.readFileSync(resolve('../dist/vue-ssr-server-bundle.json'),'utf-8')</span></span><br><span class="line">  <span class="comment">//   )</span></span><br><span class="line">  <span class="comment">//   update()</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line">  <span class="comment">// 监视构建 clientManifest -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> clientConfig = <span class="built_in">require</span>(<span class="string">'./webpack.client.config'</span>)</span><br><span class="line">  <span class="keyword">const</span> clientCompiler = webpack(clientConfig)</span><br><span class="line">  <span class="keyword">const</span> clientDevMiddleware = devMiddleware(clientCompiler, &#123;</span><br><span class="line">    publicPath: clientConfig.output.publickPath,</span><br><span class="line">    logLevel: <span class="string">'silent'</span> <span class="comment">// 关闭日志输出，由 FriendlyErrorsWebpackPlugin 处理</span></span><br><span class="line">  &#125;)</span><br><span class="line">  clientCompiler.hooks.done.tap(<span class="string">'client'</span>,()=&gt;&#123;</span><br><span class="line">    clientManifest = <span class="built_in">JSON</span>.parse(</span><br><span class="line">      clientDevMiddleware.fileSystem.readFileSync(resolve(<span class="string">'../dist/vue-ssr-client-manifest.json'</span>),<span class="string">'utf-8'</span>)</span><br><span class="line">    )</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 将 clientDevMiddleware 挂载到 Express 服务中，提供对其内部内存中数据的访问</span></span><br><span class="line">  server.use(clientDevMiddleware)</span><br><span class="line">  <span class="keyword">return</span> onReady</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="19-构建配置开发模式-热更新"><a href="#19-构建配置开发模式-热更新" class="headerlink" title="19.构建配置开发模式-热更新"></a>19.构建配置开发模式-热更新</h3><ul>
<li>npm install –save-dev webpack-hot-middleware</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setup-dev-server.js</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> chokidar = <span class="built_in">require</span>(<span class="string">'chokidar'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="keyword">const</span> devMiddleware = <span class="built_in">require</span>(<span class="string">'webpack-dev-middleware'</span>)</span><br><span class="line"><span class="keyword">const</span> hotMiddleware = <span class="built_in">require</span>(<span class="string">'webpack-hot-middleware'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resolve = <span class="function"><span class="params">file</span> =&gt;</span> path.resolve(__dirname, file)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">server, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> onReady = <span class="keyword">new</span> <span class="built_in">Promise</span>()</span><br><span class="line">  <span class="comment">// 监视构建 -&gt; 更新 Renderer</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> template</span><br><span class="line">  <span class="keyword">let</span> serverBundle</span><br><span class="line">  <span class="keyword">let</span> clientManifest</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> update = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(template &amp;&amp; serverBundle &amp;&amp; clientManifest) &#123;</span><br><span class="line">      ready()</span><br><span class="line">      callback(template, serverBundle, clientManifest)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 监视构建 template -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> templatePath = path.resolve(__dirname, <span class="string">'../index.template.html'</span>)</span><br><span class="line">  template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">  update()</span><br><span class="line">  chokidar.watch(templatePath).on(<span class="string">'change'</span>,() =&gt; &#123;</span><br><span class="line">    template = fs.readFileSync(templatePath, <span class="string">'utf-8'</span>)</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 监视构建 serverBundle -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> serverConfig = <span class="built_in">require</span>(<span class="string">'./webpack.server.config'</span>)</span><br><span class="line">  <span class="keyword">const</span> serverCompiler = webpack(serverConfig)</span><br><span class="line">  <span class="keyword">const</span> serverDevMiddleware = devMiddleware(serverCompiler, &#123;</span><br><span class="line">    logLevel: <span class="string">'silent'</span> <span class="comment">// 关闭日志输出，由 FriendlyErrorsWebpackPlugin 处理</span></span><br><span class="line">  &#125;)</span><br><span class="line">  serverCompiler.hooks.done.tap(<span class="string">'server'</span>,()=&gt;&#123;</span><br><span class="line">    serverBundle = <span class="built_in">JSON</span>.parse(</span><br><span class="line">      serverDevMiddleware.fileSystem.readFileSync(resolve(<span class="string">'../dist/vue-ssr-server-bundle.json'</span>),<span class="string">'utf-8'</span>)</span><br><span class="line">    )</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// serverCompiler.watch(&#123;&#125;,(err, stats)=&gt;&#123;</span></span><br><span class="line">  <span class="comment">//   if(err) throw err</span></span><br><span class="line">  <span class="comment">//   if(stats.hasErrors()) return</span></span><br><span class="line">  <span class="comment">//   serverBundle = JSON.parse(</span></span><br><span class="line">  <span class="comment">//     fs.readFileSync(resolve('../dist/vue-ssr-server-bundle.json'),'utf-8')</span></span><br><span class="line">  <span class="comment">//   )</span></span><br><span class="line">  <span class="comment">//   update()</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line">  <span class="comment">// 监视构建 clientManifest -&gt; 调用 update -&gt; 更新 Renderer 渲染器</span></span><br><span class="line">  <span class="keyword">const</span> clientConfig = <span class="built_in">require</span>(<span class="string">'./webpack.client.config'</span>)</span><br><span class="line">  clientConfig.plugins.push(<span class="keyword">new</span> webpack.HotModuleReplacementPlugin())</span><br><span class="line">  clientConfig.entry.app = [</span><br><span class="line">    <span class="string">'webpack-hot-middleware/client?quiet=true&amp;reload=true'</span>, <span class="comment">// 和服务端交互处理热更新一个客户端脚本</span></span><br><span class="line">    clientConfig.entry.app</span><br><span class="line">    ]</span><br><span class="line">  clientConfig.output.filename = <span class="string">'[name].js'</span> <span class="comment">// 热更新模式下确保一致的 hash</span></span><br><span class="line">  <span class="keyword">const</span> clientCompiler = webpack(clientConfig)</span><br><span class="line">  <span class="keyword">const</span> clientDevMiddleware = devMiddleware(clientCompiler, &#123;</span><br><span class="line">    publicPath: clientConfig.output.publickPath,</span><br><span class="line">    logLevel: <span class="string">'silent'</span> <span class="comment">// 关闭日志输出，由 FriendlyErrorsWebpackPlugin 处理</span></span><br><span class="line">  &#125;)</span><br><span class="line">  clientCompiler.hooks.done.tap(<span class="string">'client'</span>,()=&gt;&#123;</span><br><span class="line">    clientManifest = <span class="built_in">JSON</span>.parse(</span><br><span class="line">      clientDevMiddleware.fileSystem.readFileSync(resolve(<span class="string">'../dist/vue-ssr-client-manifest.json'</span>),<span class="string">'utf-8'</span>)</span><br><span class="line">    )</span><br><span class="line">    update()</span><br><span class="line">  &#125;)</span><br><span class="line">  server.use(hotMiddleware(clientCompiler, &#123;</span><br><span class="line">    log: <span class="literal">false</span> <span class="comment">// 关闭本身的日志输出</span></span><br><span class="line">  &#125;))</span><br><span class="line">  <span class="comment">// 将 clientDevMiddleware 挂载到 Express 服务中，提供对其内部内存中数据的访问</span></span><br><span class="line">  server.use(clientDevMiddleware)</span><br><span class="line">  <span class="keyword">return</span> onReady</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="20-编写通用应用注意事项"><a href="#20-编写通用应用注意事项" class="headerlink" title="20.编写通用应用注意事项"></a>20.编写通用应用注意事项</h3><p>略</p>
<h3 id="21-路由处理-配置-VueRouter"><a href="#21-路由处理-配置-VueRouter" class="headerlink" title="21.路由处理-配置 VueRouter"></a>21.路由处理-配置 VueRouter</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'@/pages/Home'</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createRouter = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">    mode: <span class="string">'history'</span>, <span class="comment">// 兼容前后端</span></span><br><span class="line">    routes: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'/'</span>,</span><br><span class="line">        name: <span class="string">'home'</span>,</span><br><span class="line">        component: Home</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'/about'</span>,</span><br><span class="line">        name: <span class="string">'about'</span>,</span><br><span class="line">        component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/About'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'/posts'</span>,</span><br><span class="line">        name: <span class="string">'post-list'</span>,</span><br><span class="line">        component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/Posts'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'*'</span>,</span><br><span class="line">        name: <span class="string">'error404'</span>,</span><br><span class="line">        component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/404'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> router</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="22-路由处理-将路由注册到根实例"><a href="#22-路由处理-将路由注册到根实例" class="headerlink" title="22.路由处理-将路由注册到根实例"></a>22.路由处理-将路由注册到根实例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter &#125; <span class="keyword">from</span> <span class="string">'./router/index.js'</span></span><br><span class="line"><span class="comment">// 导出一个工厂函数，用于创建新的</span></span><br><span class="line"><span class="comment">// 应用程序、router 和 store 实例</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createApp</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> router = createRouter()</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    router,</span><br><span class="line">    <span class="comment">// 根实例简单的渲染应用程序组件。</span></span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123; app , router&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="23-路由处理-适配服务端入口"><a href="#23-路由处理-适配服务端入口" class="headerlink" title="23.路由处理-适配服务端入口"></a>23.路由处理-适配服务端入口</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry-server.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> context =&gt; &#123;</span><br><span class="line">  <span class="comment">// 因为有可能会是异步路由钩子函数或组件，所以我们将返回一个 Promise，</span></span><br><span class="line">  <span class="comment">// 以便服务器能够等待所有的内容在渲染前，</span></span><br><span class="line">  <span class="comment">// 就已经准备就绪。</span></span><br><span class="line">  <span class="keyword">const</span> &#123; app, router &#125; = createApp()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置服务器端 router 的位置</span></span><br><span class="line">  router.push(context.url)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 等到 router 将可能的异步组件和钩子函数解析完</span></span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(router.onReady.bind(router))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> app</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="24-路由处理-服务端-server-适配"><a href="#24-路由处理-服务端-server-适配" class="headerlink" title="24.路由处理-服务端 server 适配"></a>24.路由处理-服务端 server 适配</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">'vue)</span></span><br><span class="line"><span class="string">const express = require('</span>express<span class="string">')</span></span><br><span class="line"><span class="string">cosnst fs = require('</span>fs<span class="string">')</span></span><br><span class="line"><span class="string">const &#123; createBundleRenderer &#125; = require('</span>vue-server-renderer<span class="string">')</span></span><br><span class="line"><span class="string">const setupDevServer = require('</span>./build/setup-dev-server<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const server = express()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.use('</span>./dist<span class="string">',express.static('</span>./dist<span class="string">'))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const isProd = process.env.NODE_ENV === '</span>production<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">let renderer</span></span><br><span class="line"><span class="string">let onReady</span></span><br><span class="line"><span class="string">if(isProd)&#123;</span></span><br><span class="line"><span class="string">  const serverBundle = require('</span>./dist/vue-ssr-server-bundle.json<span class="string">')</span></span><br><span class="line"><span class="string">  const template = fs.readFileSync('</span>./index.template.html<span class="string">', '</span>utf<span class="number">-8</span><span class="string">')</span></span><br><span class="line"><span class="string">  const clientManifest = require('</span>./dist/vue-ssr-client-manifest.json<span class="string">')</span></span><br><span class="line"><span class="string">  renderer = createBundleRenderer(serverBundle,&#123;</span></span><br><span class="line"><span class="string">    template,</span></span><br><span class="line"><span class="string">    clientManifest</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125; else &#123;</span></span><br><span class="line"><span class="string">  // 开发模式 -&gt; 监视打包构建 -&gt; 重新生成 Renderer 渲染器</span></span><br><span class="line"><span class="string">  onReady = setupDevServer(server, (serverBundle,template,clientManifest)=&gt;&#123;</span></span><br><span class="line"><span class="string">    renderer = createBundleRenderer(serverBundle,&#123;</span></span><br><span class="line"><span class="string">      template,</span></span><br><span class="line"><span class="string">      clientManifest</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  &#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const render = async (req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">  try &#123;</span></span><br><span class="line"><span class="string">    const html = await renderer.renderToString(app, &#123;</span></span><br><span class="line"><span class="string">      title: '</span>XXXX<span class="string">',</span></span><br><span class="line"><span class="string">      meta: `&lt;meta name="description" content="XXXX"`,</span></span><br><span class="line"><span class="string">      url: req.url</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">    res.setHeader('</span>Content-Type<span class="string">','</span>text/html;charset=utf8<span class="string">')</span></span><br><span class="line"><span class="string">    res.end(html)</span></span><br><span class="line"><span class="string">  &#125; catch (err) &#123;</span></span><br><span class="line"><span class="string">    return res.status(500).end('</span>Internal Server <span class="built_in">Error</span>.<span class="string">')</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">// 服务端路由设置为 * ，意味着所有的路由都会进入这里</span></span><br><span class="line"><span class="string">server.get('</span>*<span class="string">', isProd</span></span><br><span class="line"><span class="string">? render</span></span><br><span class="line"><span class="string">: async (req,res)=&gt;&#123;</span></span><br><span class="line"><span class="string">    // 等待有了 Renderer 渲染器以后，调用 render 进行渲染</span></span><br><span class="line"><span class="string">    await onReady</span></span><br><span class="line"><span class="string">    render(req,res)</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server.listen(3000,()=&gt;&#123;</span></span><br><span class="line"><span class="string">  console.log('</span>server running at port <span class="number">3000.</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="25-路由处理-适配客户端入口"><a href="#25-路由处理-适配客户端入口" class="headerlink" title="25.路由处理-适配客户端入口"></a>25.路由处理-适配客户端入口</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry-client.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端特定引导逻辑……</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; app, router &#125; = createApp()</span><br><span class="line"></span><br><span class="line">router.onReady(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  app.$mount(<span class="string">'#app'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="26-路由处理-处理完成"><a href="#26-路由处理-处理完成" class="headerlink" title="26.路由处理-处理完成"></a>26.路由处理-处理完成</h3><p>略</p>
<h3 id="27-管理页面-Head-内容"><a href="#27-管理页面-Head-内容" class="headerlink" title="27.管理页面 Head 内容"></a>27.管理页面 Head 内容</h3><ul>
<li>npm i vue-meta</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter &#125; <span class="keyword">from</span> <span class="string">'./router/index.js'</span></span><br><span class="line"><span class="keyword">import</span> VueMeta <span class="keyword">from</span> <span class="string">'vue-meta'</span></span><br><span class="line">Vue.use(VueMeta)</span><br><span class="line">Vue.mixin(&#123;</span><br><span class="line">  metaInfo: &#123;</span><br><span class="line">    titleTemplate: <span class="string">'%s - XXXX'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 导出一个工厂函数，用于创建新的</span></span><br><span class="line"><span class="comment">// 应用程序、router 和 store 实例</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createApp</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> router = createRouter()</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    router,</span><br><span class="line">    <span class="comment">// 根实例简单的渲染应用程序组件。</span></span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123; app , router&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry-server.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> context =&gt; &#123;</span><br><span class="line">  <span class="comment">// 因为有可能会是异步路由钩子函数或组件，所以我们将返回一个 Promise，</span></span><br><span class="line">  <span class="comment">// 以便服务器能够等待所有的内容在渲染前，</span></span><br><span class="line">  <span class="comment">// 就已经准备就绪。</span></span><br><span class="line">  <span class="keyword">const</span> &#123; app, router &#125; = createApp()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置服务器端 router 的位置</span></span><br><span class="line">  router.push(context.url)</span><br><span class="line"></span><br><span class="line">  context.meta = meta</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 等到 router 将可能的异步组件和钩子函数解析完</span></span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(router.onReady.bind(router))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> app</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.template.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1.0"</span>&gt;</span></span><br><span class="line">      &#123;&#123;&#123; meta.inject().title.text() &#125;&#125;&#125;</span><br><span class="line">      &#123;&#123;&#123; meta.inject().meta.text() &#125;&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- vur-ssr-outlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="28-数据预取和状态管理-思路分析"><a href="#28-数据预取和状态管理-思路分析" class="headerlink" title="28.数据预取和状态管理-思路分析"></a>28.数据预取和状态管理-思路分析</h3><p>略</p>
<h3 id="29-数据预取和状态管理-数据预取"><a href="#29-数据预取和状态管理-数据预取" class="headerlink" title="29.数据预取和状态管理-数据预取"></a>29.数据预取和状态管理-数据预取</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/index.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> createStore = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">      posts: []</span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">    mutations: &#123;</span><br><span class="line">      setPosts (state, data) &#123;</span><br><span class="line">        state.posts = data</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    actions: &#123;</span><br><span class="line">      <span class="comment">// 在服务端渲染期间务必让 action 返回一个 Promise</span></span><br><span class="line">      <span class="keyword">async</span> getPosts (&#123; commit &#125;) &#123;</span><br><span class="line">        <span class="comment">// return new Promise()</span></span><br><span class="line">        <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.get(<span class="string">'https://cnodejs.org/api/v1/topics'</span>)</span><br><span class="line">        commit(<span class="string">'setPosts'</span>, data.data)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用启动入口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter &#125; <span class="keyword">from</span> <span class="string">'./router/'</span></span><br><span class="line"><span class="keyword">import</span> VueMeta <span class="keyword">from</span> <span class="string">'vue-meta'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'./store'</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueMeta)</span><br><span class="line"></span><br><span class="line">Vue.mixin(&#123;</span><br><span class="line">  metaInfo: &#123;</span><br><span class="line">    titleTemplate: <span class="string">'%s - XXXX'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出一个工厂函数，用于创建新的</span></span><br><span class="line"><span class="comment">// 应用程序、router 和 store 实例</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createApp</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> router = createRouter()</span><br><span class="line">  <span class="keyword">const</span> store = createStore()</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    router, <span class="comment">// 把路由挂载到 Vue 根实例中</span></span><br><span class="line">    store, <span class="comment">// 把容器挂载到 Vue 根实例中</span></span><br><span class="line">    <span class="comment">// 根实例简单的渲染应用程序组件。</span></span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123; app, router, store &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="30-数据预取和状态管理-将预取数据同步到客户端"><a href="#30-数据预取和状态管理-将预取数据同步到客户端" class="headerlink" title="30.数据预取和状态管理-将预取数据同步到客户端"></a>30.数据预取和状态管理-将预取数据同步到客户端</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry-server.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> context =&gt; &#123;</span><br><span class="line">  <span class="comment">// 因为有可能会是异步路由钩子函数或组件，所以我们将返回一个 Promise，</span></span><br><span class="line">    <span class="comment">// 以便服务器能够等待所有的内容在渲染前，</span></span><br><span class="line">    <span class="comment">// 就已经准备就绪。</span></span><br><span class="line">  <span class="keyword">const</span> &#123; app, router, store &#125; = createApp()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> meta = app.$meta()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置服务器端 router 的位置</span></span><br><span class="line">  router.push(context.url)</span><br><span class="line"></span><br><span class="line">  context.meta = meta</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 等到 router 将可能的异步组件和钩子函数解析完</span></span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(router.onReady.bind(router))</span><br><span class="line"></span><br><span class="line">  context.rendered = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Renderer 会把 context.state 数据对象内联到页面模板中</span></span><br><span class="line">    <span class="comment">// 最终发送给客户端的页面中会包含一段脚本：window.__INITIAL_STATE__ = context.state</span></span><br><span class="line">    <span class="comment">// 客户端就要把页面中的 window.__INITIAL_STATE__ 拿出来填充到客户端 store 容器中</span></span><br><span class="line">    context.state = store.state</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> app</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry.client.js</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端入口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'./app'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端特定引导逻辑……</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; app, router, store &#125; = createApp()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.__INITIAL_STATE__) &#123;</span><br><span class="line">  store.replaceState(<span class="built_in">window</span>.__INITIAL_STATE__)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">router.onReady(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  app.$mount(<span class="string">'#app'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="任务二：静态站点生成"><a href="#任务二：静态站点生成" class="headerlink" title="任务二：静态站点生成"></a>任务二：静态站点生成</h2><h3 id="1-Gridsome基础-介绍"><a href="#1-Gridsome基础-介绍" class="headerlink" title="1.Gridsome基础-介绍"></a>1.Gridsome基础-介绍</h3><blockquote>
<p>Gridsome 是什么</p>
</blockquote>
<ul>
<li>一个免费、开源、基于 Vue.js 技术栈的静态网站生成器</li>
<li>官方网站：<a href="https://gridsome.org/" target="_blank" rel="noopener">https://gridsome.org/</a></li>
<li>GitHub: <a href="https://github.com/gridsome/gridsome" target="_blank" rel="noopener">https://github.com/gridsome/gridsome</a></li>
</ul>
<blockquote>
<p>什么是静态网站生成器</p>
</blockquote>
<ul>
<li>静态网站生成器是使用一系列配置、模板以及数据，生成静态 HTML 文件及相关资源的工具</li>
<li>这个功能也叫预渲染</li>
<li>生成的网站不需要类似 PHP 这样的服务器</li>
<li>只需要放到支持静态资源的 Web Server 或 CDN 上即可运行</li>
</ul>
<blockquote>
<p>静态网站的好处</p>
</blockquote>
<ul>
<li><p>省钱</p>
<ul>
<li>不需要专业的服务器，只要能托管静态文件的空间即可</li>
</ul>
</li>
<li><p>快速</p>
<ul>
<li>不经过后端服务器处理，只传输内容</li>
</ul>
</li>
<li><p>安全</p>
<ul>
<li>没有后端程序的运行，自然会更安全</li>
</ul>
</li>
</ul>
<blockquote>
<p>常见的静态网站生成器</p>
</blockquote>
<ul>
<li>Jekyll(Ruby)</li>
<li>Hexo(Node)</li>
<li>Hugo(Golang)</li>
<li>Gatsby(Node/React)</li>
<li>Gridsome(Node/Vue)</li>
<li>另外，Next.js，Nuxt.js 也能生成静态网站，但是它们更多被认为是 SSR（服务端渲染）框架。</li>
</ul>
<blockquote>
<p>JAMStack</p>
</blockquote>
<ul>
<li>这类静态网站生成器还有个漂亮的名字叫 JAMStack</li>
<li>JAMStack 的 JAM 是 JavaScript、API 和 Markup 的首字母组合</li>
<li>本质上是一种胖前端，通过调用各种 API 来实现更多的功能</li>
<li>其实也是一种前后端的模式，只不过离得比较开，甚至前后端来自多个不同的厂商</li>
</ul>
<blockquote>
<p>静态应用使用场景</p>
</blockquote>
<ul>
<li><p>不适合有大量路由页面的应用</p>
<ul>
<li>如果您的站点有成百上千条路由页面，则预渲染将非常缓慢。当然，您每次更新只需要做一次，但是可能要花一些时间。大多数人不会最终获得数千条静态路由页面，而只是以防万一。</li>
</ul>
</li>
<li><p>不适合有大量动态内容的应用</p>
<ul>
<li>如果渲染路线中包含特定于用户查看其内容或其他动态源的内容，则应确保您具有可以显示的占位符组件，直到动态内容加载到客户端为止。否则可能有点怪异。</li>
</ul>
</li>
</ul>
<blockquote>
<p>Gridsome 学习建议</p>
</blockquote>
<ul>
<li>使用 Gridsome 需要一定的 Vue 基础，如果有基础，看过文档，只会觉得比 Vue 本身更简单一些。</li>
</ul>
<h3 id="2-Gridsome基础-创建-Gridsome-项目"><a href="#2-Gridsome基础-创建-Gridsome-项目" class="headerlink" title="2.Gridsome基础-创建 Gridsome 项目"></a>2.Gridsome基础-创建 Gridsome 项目</h3><ul>
<li><p><a href="https://github.com/lovell/sharp" target="_blank" rel="noopener">https://github.com/lovell/sharp</a></p>
<ul>
<li>npm config set sharp_binary_host “<a href="https://npm.taobao.org/mirrors/sharp&quot;" target="_blank" rel="noopener">https://npm.taobao.org/mirrors/sharp&quot;</a></li>
<li>npm config set sharp_libvips_binary_host “<a href="https://npm.taobao.org/mirrors/sharp-libvips&quot;" target="_blank" rel="noopener">https://npm.taobao.org/mirrors/sharp-libvips&quot;</a></li>
</ul>
</li>
<li><p><a href="https://github.com/nodejs/node-gyp" target="_blank" rel="noopener">https://github.com/nodejs/node-gyp</a></p>
<ul>
<li>npm install -g node-gyp</li>
<li>npm install –global windows-build-tools</li>
</ul>
</li>
</ul>
<h3 id="3-Gridsome基础-预渲染"><a href="#3-Gridsome基础-预渲染" class="headerlink" title="3.Gridsome基础-预渲染"></a>3.Gridsome基础-预渲染</h3><ul>
<li>npm i -g serve</li>
<li>serve dist</li>
</ul>
<h3 id="4-Gridsome基础-目录结构"><a href="#4-Gridsome基础-目录结构" class="headerlink" title="4.Gridsome基础-目录结构"></a>4.Gridsome基础-目录结构</h3><p>略</p>
<h3 id="5-Gridsome基础-项目配置"><a href="#5-Gridsome基础-项目配置" class="headerlink" title="5.Gridsome基础-项目配置"></a>5.Gridsome基础-项目配置</h3><p>略</p>
<h3 id="6-Gridsome基础-Pages"><a href="#6-Gridsome基础-Pages" class="headerlink" title="6.Gridsome基础-Pages"></a>6.Gridsome基础-Pages</h3><p>略</p>
<h3 id="7-Gridsome基础-添加集合"><a href="#7-Gridsome基础-添加集合" class="headerlink" title="7.Gridsome基础-添加集合"></a>7.Gridsome基础-添加集合</h3><p>略</p>
<h3 id="8-Gridsome基础-在-GraphQL-中查询数据"><a href="#8-Gridsome基础-在-GraphQL-中查询数据" class="headerlink" title="8.Gridsome基础-在 GraphQL 中查询数据"></a>8.Gridsome基础-在 GraphQL 中查询数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://localhost:8080/___explore</span></span><br><span class="line"># query &#123;</span><br><span class="line">#   post(id:2)&#123;</span><br><span class="line">#     id</span><br><span class="line">#     title</span><br><span class="line">#     content</span><br><span class="line">#   &#125;</span><br><span class="line"># &#125;</span><br><span class="line"></span><br><span class="line">query&#123;</span><br><span class="line">  allPost&#123;</span><br><span class="line">    edges&#123;</span><br><span class="line">      node&#123;</span><br><span class="line">        id</span><br><span class="line">        title</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-Gridsome基础-在页面中查询-GraphQL"><a href="#9-Gridsome基础-在页面中查询-GraphQL" class="headerlink" title="9.Gridsome基础-在页面中查询 GraphQL"></a>9.Gridsome基础-在页面中查询 GraphQL</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;Layout&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;Post2&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">        &lt;li v-for="edge in $page.posts.edges" :key="edge.node.id"&gt;</span></span><br><span class="line"><span class="regexp">          &lt;g-link to="/</span><span class="string">"&gt;&#123;&#123; edge.node.title &#125;&#125;&lt;/g-link&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">      &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;/Layout&gt;</span></span><br><span class="line"><span class="string">&lt;/template&gt;</span></span><br><span class="line"><span class="string">&lt;page-query&gt;</span></span><br><span class="line"><span class="string">query&#123;</span></span><br><span class="line"><span class="string">  posts:allPost&#123;</span></span><br><span class="line"><span class="string">    edges&#123;</span></span><br><span class="line"><span class="string">      node&#123;</span></span><br><span class="line"><span class="string">        id</span></span><br><span class="line"><span class="string">        title</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/page-query&gt;</span></span><br><span class="line"><span class="string">&lt;script&gt;</span></span><br><span class="line"><span class="string">export default &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;style&gt;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="10-Gridsome基础-使用模板渲染节点页面"><a href="#10-Gridsome基础-使用模板渲染节点页面" class="headerlink" title="10.Gridsome基础-使用模板渲染节点页面"></a>10.Gridsome基础-使用模板渲染节点页面</h3><p>略</p>
<h3 id="11-Gridsome案例-创建项目"><a href="#11-Gridsome案例-创建项目" class="headerlink" title="11.Gridsome案例-创建项目"></a>11.Gridsome案例-创建项目</h3><ul>
<li>gridsome create blog-with-gridsome</li>
</ul>
<h3 id="12-Gridsome案例-处理首页模板"><a href="#12-Gridsome案例-处理首页模板" class="headerlink" title="12.Gridsome案例-处理首页模板"></a>12.Gridsome案例-处理首页模板</h3><p>略</p>
<h3 id="13-Gridsome案例-处理其它页面模板"><a href="#13-Gridsome案例-处理其它页面模板" class="headerlink" title="13.Gridsome案例-处理其它页面模板"></a>13.Gridsome案例-处理其它页面模板</h3><p>略</p>
<h3 id="14-Gridsome案例-使用本地md文件管理文章内容"><a href="#14-Gridsome案例-使用本地md文件管理文章内容" class="headerlink" title="14.Gridsome案例-使用本地md文件管理文章内容"></a>14.Gridsome案例-使用本地md文件管理文章内容</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  siteName: <span class="string">'Gridsome'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    &#123;</span><br><span class="line">      use: <span class="string">'@gridsome/source-filesystem'</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        typeName: <span class="string">'BlogPost'</span>,</span><br><span class="line">        path: <span class="string">'./content/blog/**/*.md'</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="15-Gridsome案例-Strapi介绍"><a href="#15-Gridsome案例-Strapi介绍" class="headerlink" title="15.Gridsome案例-Strapi介绍"></a>15.Gridsome案例-Strapi介绍</h3><ul>
<li><a href="https://strapi.io/" target="_blank" rel="noopener">https://strapi.io/</a></li>
</ul>
<h3 id="16-Gridsome案例-Strapi基本使用"><a href="#16-Gridsome案例-Strapi基本使用" class="headerlink" title="16.Gridsome案例-Strapi基本使用"></a>16.Gridsome案例-Strapi基本使用</h3><ul>
<li>npx create-strapi-app my-project –quickstart</li>
<li>一定要注意 node 版本</li>
</ul>
<h3 id="17-Gridsome案例-使用Strapi接口数据"><a href="#17-Gridsome案例-使用Strapi接口数据" class="headerlink" title="17.Gridsome案例-使用Strapi接口数据"></a>17.Gridsome案例-使用Strapi接口数据</h3><ul>
<li>运行使用 development，不然不支持插件</li>
<li>设置 public 权限，位置和教程不一样，在设置里</li>
</ul>
<h3 id="18-Gridsome案例-访问受保护的API"><a href="#18-Gridsome案例-访问受保护的API" class="headerlink" title="18.Gridsome案例-访问受保护的API"></a>18.Gridsome案例-访问受保护的API</h3><ul>
<li>添加角色权限，获取 token</li>
</ul>
<h3 id="19-Gridsome案例-通过GraphQL访问Strapi"><a href="#19-Gridsome案例-通过GraphQL访问Strapi" class="headerlink" title="19.Gridsome案例-通过GraphQL访问Strapi"></a>19.Gridsome案例-通过GraphQL访问Strapi</h3><p>略</p>
<h3 id="20-Gridsome案例-将Strapi数据预取到Gridsome应用中"><a href="#20-Gridsome案例-将Strapi数据预取到Gridsome应用中" class="headerlink" title="20.Gridsome案例-将Strapi数据预取到Gridsome应用中"></a>20.Gridsome案例-将Strapi数据预取到Gridsome应用中</h3><ul>
<li>npm install @gridsome/source-strapi</li>
</ul>
<h3 id="21-Gridsome案例-设计文章和标签数据模型"><a href="#21-Gridsome案例-设计文章和标签数据模型" class="headerlink" title="21.Gridsome案例-设计文章和标签数据模型"></a>21.Gridsome案例-设计文章和标签数据模型</h3><p>略</p>
<h3 id="22-Gridsome案例-展示文章列表"><a href="#22-Gridsome案例-展示文章列表" class="headerlink" title="22.Gridsome案例-展示文章列表"></a>22.Gridsome案例-展示文章列表</h3><p>略</p>
<h3 id="23-Gridsome案例-文章列表分页"><a href="#23-Gridsome案例-文章列表分页" class="headerlink" title="23.Gridsome案例-文章列表分页"></a>23.Gridsome案例-文章列表分页</h3><p>略</p>
<h3 id="24-Gridsome案例-展示文章详情"><a href="#24-Gridsome案例-展示文章详情" class="headerlink" title="24.Gridsome案例-展示文章详情"></a>24.Gridsome案例-展示文章详情</h3><p>略</p>
<h3 id="25-Gridsome案例-处理Markdown格式的文章内容"><a href="#25-Gridsome案例-处理Markdown格式的文章内容" class="headerlink" title="25.Gridsome案例-处理Markdown格式的文章内容"></a>25.Gridsome案例-处理Markdown格式的文章内容</h3><ul>
<li>npm install markdown-it</li>
</ul>
<h3 id="26-Gridsome案例-文章标签"><a href="#26-Gridsome案例-文章标签" class="headerlink" title="26.Gridsome案例-文章标签"></a>26.Gridsome案例-文章标签</h3><p>略</p>
<h3 id="27-Gridsome案例-基本设置"><a href="#27-Gridsome案例-基本设置" class="headerlink" title="27.Gridsome案例-基本设置"></a>27.Gridsome案例-基本设置</h3><p>略</p>
<h3 id="28-Gridsome案例-联系我"><a href="#28-Gridsome案例-联系我" class="headerlink" title="28.Gridsome案例-联系我"></a>28.Gridsome案例-联系我</h3><p>略</p>
<h3 id="29-Gridsome案例-部署Strapi"><a href="#29-Gridsome案例-部署Strapi" class="headerlink" title="29.Gridsome案例-部署Strapi"></a>29.Gridsome案例-部署Strapi</h3><ul>
<li>git remote add origin …</li>
<li>git push -u origin master</li>
<li>ssh …</li>
<li>git clone …</li>
<li>cd …</li>
<li>npm i</li>
<li>npm run build</li>
<li>npm run start</li>
<li>npm i -g pm2</li>
<li>pm2 start npm – run start –name …</li>
</ul>
<h3 id="30-Gridsome案例-把本地服务联通远程Strapi"><a href="#30-Gridsome案例-把本地服务联通远程Strapi" class="headerlink" title="30.Gridsome案例-把本地服务联通远程Strapi"></a>30.Gridsome案例-把本地服务联通远程Strapi</h3><p>略</p>
<h3 id="31-Gridsome案例-部署Gridsome应用"><a href="#31-Gridsome案例-部署Gridsome应用" class="headerlink" title="31.Gridsome案例-部署Gridsome应用"></a>31.Gridsome案例-部署Gridsome应用</h3><h2 id="任务三：封装-Vue-js-组件库"><a href="#任务三：封装-Vue-js-组件库" class="headerlink" title="任务三：封装 Vue.js 组件库"></a>任务三：封装 Vue.js 组件库</h2><h3 id="1-课程目标"><a href="#1-课程目标" class="headerlink" title="1.课程目标"></a>1.课程目标</h3><blockquote>
<p>开源组件库</p>
</blockquote>
<ul>
<li>Element-UI</li>
<li>iView</li>
</ul>
<blockquote>
<p>CDD</p>
</blockquote>
<ul>
<li>CDD(Component-Driven Development)<ul>
<li>自下而上</li>
<li>从组件级别开始，到页面级别结束</li>
</ul>
</li>
</ul>
<blockquote>
<p>CDD 的好处</p>
</blockquote>
<ul>
<li>组件在最大程度被重用</li>
<li>并行开发</li>
<li>可视化测试</li>
</ul>
<blockquote>
<p>课程介绍</p>
</blockquote>
<ul>
<li>处理组件边界情况</li>
<li>快速原型开发</li>
<li>组件开发</li>
<li>Storybook</li>
<li>Monorepo</li>
<li>基于模板生成包的结构</li>
<li>Lerna + yarn workspaces</li>
<li>组件测试</li>
<li>Rollup 打包</li>
</ul>
<h3 id="2-处理组件的边界情况"><a href="#2-处理组件的边界情况" class="headerlink" title="2.处理组件的边界情况"></a>2.处理组件的边界情况</h3><ul>
<li>$root</li>
<li>$parent/$children</li>
<li>$refs</li>
<li>依赖注入provide/inject</li>
</ul>
<h3 id="3-attrs-listeners"><a href="#3-attrs-listeners" class="headerlink" title="3.attrs-listeners"></a>3.attrs-listeners</h3><ul>
<li>$attrs<ul>
<li>把父组件中非 prop 属性绑定到内部组件</li>
</ul>
</li>
<li>$listeners<ul>
<li>把父组件中的 DOM 对象的原生事件绑定到内部组件</li>
</ul>
</li>
</ul>
<h3 id="4-快速原型开发"><a href="#4-快速原型开发" class="headerlink" title="4.快速原型开发"></a>4.快速原型开发</h3><blockquote>
<p>快速原型开发</p>
</blockquote>
<ul>
<li>VueCLI 中提供了一个插件可以进行原型快速开发</li>
<li>需要先额外安装一个全局的扩展<ul>
<li>npm install -g @vue/cli-service-global</li>
</ul>
</li>
<li>使用 vue serve 快速查看组件的运行效果</li>
</ul>
<blockquote>
<p>vue serve</p>
</blockquote>
<ul>
<li><p>vue serve 如果不指定参数默认会在当前目录找以下入口文件</p>
<ul>
<li>main.js、index.js、App.vue、app.vue</li>
</ul>
</li>
<li><p>可以指定要加载的组件</p>
<ul>
<li>vue serve ./src/login.vue</li>
</ul>
</li>
</ul>
<h3 id="5-快速原型开发-ElementUI"><a href="#5-快速原型开发-ElementUI" class="headerlink" title="5.快速原型开发-ElementUI"></a>5.快速原型开发-ElementUI</h3><blockquote>
<p>安装 ElementUI</p>
</blockquote>
<ul>
<li>初始化 package.json<ul>
<li>npm init -y</li>
</ul>
</li>
<li>安装 ElementUI<ul>
<li>vue add element</li>
</ul>
</li>
<li>加载 ElementUI，使用 Vue.use() 安装插件</li>
</ul>
<h3 id="6-组件开发-步骤条组件"><a href="#6-组件开发-步骤条组件" class="headerlink" title="6.组件开发-步骤条组件"></a>6.组件开发-步骤条组件</h3><blockquote>
<p>组件分类</p>
</blockquote>
<ul>
<li>第三方组件</li>
<li>基础组件</li>
<li>业务组件</li>
</ul>
<h3 id="7-组件开发-表单组件-上"><a href="#7-组件开发-表单组件-上" class="headerlink" title="7.组件开发-表单组件-上"></a>7.组件开发-表单组件-上</h3><blockquote>
<p>整体结构</p>
</blockquote>
<ul>
<li>Form</li>
<li>FormItem</li>
<li>Input</li>
<li>Button</li>
</ul>
<h3 id="8-组件开发-表单组件-下"><a href="#8-组件开发-表单组件-下" class="headerlink" title="8.组件开发-表单组件-下"></a>8.组件开发-表单组件-下</h3><p>略</p>
<h3 id="9-组件开发-表单组件-表单验证-上"><a href="#9-组件开发-表单组件-表单验证-上" class="headerlink" title="9.组件开发-表单组件-表单验证-上"></a>9.组件开发-表单组件-表单验证-上</h3><ul>
<li>npm install async-validator</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Form</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;form&gt;</span><br><span class="line">    &lt;slot&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">  &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;、script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    name:&#39;LgForm&#39;,</span><br><span class="line">    provide()&#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            form: this</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    props: &#123;</span><br><span class="line">        model: &#123;</span><br><span class="line">            type: Object</span><br><span class="line">        &#125;,</span><br><span class="line">        rules: &#123;</span><br><span class="line">            type: Object</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;、script&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; FormItem</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label&gt;&#123;&#123;label&#125;&#125;&lt;label&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;slot&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">      &lt;p v-if&#x3D;&quot;errMessage&quot;&gt;&#123;&#123;errMessage&#125;&#125;&lt;&#x2F;p&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;、script&gt;</span><br><span class="line">import AsyncValidator from &#39;async-validator&#39;</span><br><span class="line">export default &#123;</span><br><span class="line">    name:&#39;LgFormItem&#39;,</span><br><span class="line">    inject:[&#39;form&#39;],</span><br><span class="line">    props: &#123;</span><br><span class="line">        label: &#123;</span><br><span class="line">            type: String</span><br><span class="line">        &#125;,</span><br><span class="line">        prop: &#123;</span><br><span class="line">            type: String</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted()&#123;</span><br><span class="line">        this.$on(&#39;validate&#39;,()&#x3D;&gt;&#123;</span><br><span class="line">            this.validate()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    data()&#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            errMessage: &#39;&#39;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        validate()&#123;</span><br><span class="line">            if(!this.prop) return</span><br><span class="line">            const value &#x3D; this.form.model[this.prop]</span><br><span class="line">            const rules &#x3D; this.form.rules[this.prop]</span><br><span class="line">            </span><br><span class="line">            const descriptor &#x3D; &#123;[this.prop]:rules&#125;</span><br><span class="line">            const validator &#x3D; new AsyncValidator(descriptor)</span><br><span class="line">            return validator.validate(&#123;[this.prop]:value&#125;,errors &#x3D;&gt; &#123;</span><br><span class="line">                if(errors)&#123;</span><br><span class="line">                    this.errMessage &#x3D; errors[0].message</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    this.errMessage &#x3D; &#39;&#39;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;、script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="10-组件开发-表单组件-表单验证-下"><a href="#10-组件开发-表单组件-表单验证-下" class="headerlink" title="10.组件开发-表单组件-表单验证-下"></a>10.组件开发-表单组件-表单验证-下</h3><blockquote>
<p>Input 组件验证</p>
</blockquote>
<ul>
<li>Input 组件中触发自定义事件 validate</li>
<li>FormItem 渲染完毕注册自定义事件 validate</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;&#x2F; Input</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;input v-bind&#x3D;&quot;$attrs&quot; :type&#x3D;&quot;type&quot; :value&#x3D;&quot;value&quot; @input&#x3D;&quot;handleInput&quot;&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;、script&gt;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    name:&#39;LgInput&#39;,</span><br><span class="line">    inheritAttrs: false,</span><br><span class="line">    props: &#123;</span><br><span class="line">        value: &#123;</span><br><span class="line">            type: String</span><br><span class="line">        &#125;,</span><br><span class="line">        type: &#123;</span><br><span class="line">            type: String,</span><br><span class="line">            default: &#39;text&#39;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        handleInput(evt) &#123;</span><br><span class="line">            this.$emit(&#39;input&#39;, evt.target.value)</span><br><span class="line">            const findParent &#x3D; parent &#x3D;&gt; &#123;</span><br><span class="line">                while (parent) &#123;</span><br><span class="line">                    if(parent.$options.name &#x3D;&#x3D;&#x3D; &#39;LgFormItem&#39;) &#123;</span><br><span class="line">                        break</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        parent &#x3D; parent.$parent</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                return parent</span><br><span class="line">            &#125;</span><br><span class="line">            const parent &#x3D; findParent(this.$parent)</span><br><span class="line">            if (parent) &#123;</span><br><span class="line">                parent.$emit(&#39;validate&#39;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;、script&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Button</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;button @click&#x3D;&quot;handleClick&quot;&gt;&lt;slot&gt;&lt;&#x2F;slot&gt;&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&lt;、script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#39;LoButton&#39;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleClick(evt) &#123;</span><br><span class="line">      this.$emit(&#39;click&#39;,evt)</span><br><span class="line">      evt.preventDefault()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;、script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="11-Monorepo"><a href="#11-Monorepo" class="headerlink" title="11.Monorepo"></a>11.Monorepo</h3><blockquote>
<p>两种项目的组织方式</p>
</blockquote>
<ul>
<li><p>Multirepo(Multiple Repository)</p>
<ul>
<li>每一个包对应一个项目</li>
</ul>
</li>
<li><p>Monorepo(Monolithic Repository)</p>
<ul>
<li>一个项目仓库中管理多个模块/包</li>
</ul>
</li>
</ul>
<h3 id="12-Storybook上"><a href="#12-Storybook上" class="headerlink" title="12.Storybook上"></a>12.Storybook上</h3><blockquote>
<p>Storybook</p>
</blockquote>
<ul>
<li>可视化的组件展示平台</li>
<li>在隔离的开发环境中，以交互式的方式展示组件</li>
<li>独立开发组件</li>
<li>支持的框架<ul>
<li>React、React Native、Vue、Angular</li>
<li>Ember、HTML、Svelte、Mithril、Riot</li>
</ul>
</li>
</ul>
<blockquote>
<p>Storybook 安装</p>
</blockquote>
<ul>
<li>自动安装<ul>
<li>npx -p @storybook/cli sb init –type vue</li>
<li>yarn add vue</li>
<li>yarn add vue-loader vue-template-compiler –dev</li>
</ul>
</li>
<li>手动安装</li>
</ul>
<h3 id="13-Storybook下"><a href="#13-Storybook下" class="headerlink" title="13.Storybook下"></a>13.Storybook下</h3><p>略</p>
<h3 id="14-yarn-workspaces"><a href="#14-yarn-workspaces" class="headerlink" title="14.yarn workspaces"></a>14.yarn workspaces</h3><blockquote>
<p>开启 yarn 的工作区</p>
</blockquote>
<ul>
<li>项目根目录的 package.json</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"privite"</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">"workspaces"</span>: [</span><br><span class="line">  <span class="string">"./packages/*"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>yarn workspaces 使用</p>
</blockquote>
<ul>
<li><p>给工作区根目录安装开发依赖</p>
<ul>
<li>yarn add jest -D -W</li>
</ul>
</li>
<li><p>给指定工作区安装依赖</p>
<ul>
<li>yarn workspace lg-button add lodash@4</li>
</ul>
</li>
<li><p>给所有工作区安装依赖</p>
<ul>
<li>yarn install</li>
</ul>
</li>
</ul>
<h3 id="15-Lerna上"><a href="#15-Lerna上" class="headerlink" title="15.Lerna上"></a>15.Lerna上</h3><blockquote>
<p>Lerna 介绍</p>
</blockquote>
<ul>
<li>Lerna 是一个优化使用 git 和 npm 管理多包仓库的工作流工具</li>
<li>用于管理具有多个包的 JavaScript 项目</li>
<li>它可以一键把代码提交到 git 和 npm 仓库</li>
</ul>
<blockquote>
<p>lerna 使用</p>
</blockquote>
<ul>
<li><p>全局安装</p>
<ul>
<li>yarn global add lerna</li>
</ul>
</li>
<li><p>初始化</p>
<ul>
<li>lerna init</li>
</ul>
</li>
<li><p>发布</p>
<ul>
<li>lerna publish</li>
</ul>
</li>
</ul>
<h3 id="16-Lerna下"><a href="#16-Lerna下" class="headerlink" title="16.Lerna下"></a>16.Lerna下</h3><p>略</p>
<h3 id="17-Vue组件的单元测试"><a href="#17-Vue组件的单元测试" class="headerlink" title="17.Vue组件的单元测试"></a>17.Vue组件的单元测试</h3><blockquote>
<p>组件单元测试好处</p>
</blockquote>
<ul>
<li>提供描述组件行为的文档</li>
<li>节省手动测试的时间</li>
<li>减少研发新特性时产生的 bug</li>
<li>改进设计</li>
<li>促进重构</li>
</ul>
<blockquote>
<p>安装依赖</p>
</blockquote>
<ul>
<li>Vue Test Utils</li>
<li>Jest</li>
<li>vue-jest</li>
<li>babel-jest</li>
<li>安装<ul>
<li>yarn add jest @vue/test-utils vue-jest babel-jest -D -W</li>
</ul>
</li>
</ul>
<h3 id="18-Vue组件的单元测试-2"><a href="#18-Vue组件的单元测试-2" class="headerlink" title="18.Vue组件的单元测试 2"></a>18.Vue组件的单元测试 2</h3><blockquote>
<p>Jest 常用 API</p>
</blockquote>
<ul>
<li><p>全局函数</p>
<ul>
<li>describe(name, fn) 把相关测试组合在一起</li>
<li>test(name, fn) 测试方法</li>
<li>expect(value) 断言</li>
</ul>
</li>
<li><p>匹配器</p>
<ul>
<li>toBe(value) 判断值是否相等</li>
<li>toEqual(obj) 判断对象是否相等</li>
<li>toContain(value) 判断数组或者字符串中是否包含</li>
</ul>
</li>
<li><p>快照</p>
<ul>
<li>toMatchSnapshot()</li>
</ul>
</li>
</ul>
<blockquote>
<p>Vue Test Utils 常用 API</p>
</blockquote>
<ul>
<li><p>mount()</p>
<ul>
<li>创建一个包含被挂载和渲染的 Vue 组件的 Wrapper</li>
</ul>
</li>
<li><p>Wrapper</p>
<ul>
<li>vm wrapper 包裹的组件实例</li>
<li>props() 返回 Vue 实例选项中的 props 对象</li>
<li>html() 组件生成的 HTML 标签</li>
<li>find() 通过选择器返回匹配到的组件中的 DOM 元素</li>
<li>trigger() 触发 DOM 原生事件，自定义事件 wrapper.vm.$emit()</li>
</ul>
</li>
</ul>
<h3 id="19-Rollup打包上"><a href="#19-Rollup打包上" class="headerlink" title="19.Rollup打包上"></a>19.Rollup打包上</h3><blockquote>
<p>Rollup</p>
</blockquote>
<ul>
<li>Rollup 是一个模块打包器</li>
<li>Rollup 支持 Tree-shaking</li>
<li>打包的结果比 Webpack 要小</li>
<li>开发框架/组件库的时候使用 Rollup 更合适</li>
</ul>
<blockquote>
<p>安装依赖</p>
</blockquote>
<ul>
<li>Rollup</li>
<li>rollup-plugin-terser</li>
<li><a href="mailto:tollup-plugin-vue@5.1.9">tollup-plugin-vue@5.1.9</a></li>
<li>vue-template-compiler</li>
</ul>
<h3 id="20-Rollup打包下"><a href="#20-Rollup打包下" class="headerlink" title="20.Rollup打包下"></a>20.Rollup打包下</h3><p>略</p>
<h3 id="21-设置环境变量"><a href="#21-设置环境变量" class="headerlink" title="21.设置环境变量"></a>21.设置环境变量</h3><ul>
<li>yarn add cross-env -D -W</li>
</ul>
<h3 id="22-清理"><a href="#22-清理" class="headerlink" title="22.清理"></a>22.清理</h3><ul>
<li>yarn add rimraf -D -W</li>
</ul>
<h3 id="23-基于模板生成组件基本结构"><a href="#23-基于模板生成组件基本结构" class="headerlink" title="23.基于模板生成组件基本结构"></a>23.基于模板生成组件基本结构</h3><ul>
<li>yarn plop -W -D</li>
</ul>
<h3 id="24-基于模板生成组件基本结构2"><a href="#24-基于模板生成组件基本结构2" class="headerlink" title="24.基于模板生成组件基本结构2"></a>24.基于模板生成组件基本结构2</h3><p>略</p>
<h3 id="25-发布"><a href="#25-发布" class="headerlink" title="25.发布"></a>25.发布</h3><p>略</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/01/33/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旋の飞羽">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/01/01/33/" itemprop="url">新年寄语</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-01-01T00:00:00+08:00">
                2021-01-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB/" itemprop="url" rel="index">
                    <span itemprop="name">生活</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>作者：FY<br>引用请标明出处</p>
</blockquote>
<p>2020年最后一天，随着皑皑的白雪，皎洁的明月，五颜六色的灯光悄然离去。<br>总体来说，这一年忙碌且充实。<br>2021年，我希望我的生活能有一丝丝改变。<br>努力生活，让自己变强大。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/27/32/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旋の飞羽">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/27/32/" itemprop="url">学习笔记 ----- 【Vue.js 框架源码与进阶】Vue 数据流管理及 Vue.js 服务端渲染(SSR)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-12-27T00:00:00+08:00">
                2020-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>作者：FY<br>引用请标明出处</p>
</blockquote>
<h1 id="Part-3-·-Vue-js-框架源码与进阶"><a href="#Part-3-·-Vue-js-框架源码与进阶" class="headerlink" title="Part 3 · Vue.js 框架源码与进阶"></a>Part 3 · Vue.js 框架源码与进阶</h1><h2 id="模块三-·-Vue-数据流管理及-Vue-js-服务端渲染-SSR"><a href="#模块三-·-Vue-数据流管理及-Vue-js-服务端渲染-SSR" class="headerlink" title="模块三 · Vue 数据流管理及 Vue.js 服务端渲染(SSR)"></a>模块三 · Vue 数据流管理及 Vue.js 服务端渲染(SSR)</h2><h2 id="任务一：Vuex-状态管理"><a href="#任务一：Vuex-状态管理" class="headerlink" title="任务一：Vuex 状态管理"></a>任务一：Vuex 状态管理</h2><h3 id="1-课程目标"><a href="#1-课程目标" class="headerlink" title="1.课程目标"></a>1.课程目标</h3><ul>
<li>Vue 组件间通信方式回顾</li>
<li>Vuex 核心概念和基本使用回顾</li>
<li>购物车案例</li>
<li>模拟实现 Vuex</li>
</ul>
<h3 id="2-组件内状态管理流程"><a href="#2-组件内状态管理流程" class="headerlink" title="2.组件内状态管理流程"></a>2.组件内状态管理流程</h3><blockquote>
<p>状态管理</p>
</blockquote>
<ul>
<li>state，驱动应用的数据源</li>
<li>view，以声明方式将 state 映射到视图</li>
<li>actions，响应在 view 上的用户输入导致的状态变化</li>
</ul>
<h3 id="3-组件间通信方式回顾-父组件给子组件传值"><a href="#3-组件间通信方式回顾-父组件给子组件传值" class="headerlink" title="3.组件间通信方式回顾-父组件给子组件传值"></a>3.组件间通信方式回顾-父组件给子组件传值</h3><ul>
<li>子组件中通过 props 接收数据</li>
<li>父组件中给子组件通过相应属性传值</li>
</ul>
<h3 id="4-组件间通信方式回顾-子组件给父组件传值"><a href="#4-组件间通信方式回顾-子组件给父组件传值" class="headerlink" title="4.组件间通信方式回顾-子组件给父组件传值"></a>4.组件间通信方式回顾-子组件给父组件传值</h3><p>略</p>
<h3 id="5-组件间通信方式回顾-不相关组件传值"><a href="#5-组件间通信方式回顾-不相关组件传值" class="headerlink" title="5.组件间通信方式回顾-不相关组件传值"></a>5.组件间通信方式回顾-不相关组件传值</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// eventbus.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vue()</span><br></pre></td></tr></table></figure>

<h3 id="6-组件间通信方式回顾-通过ref获取子组件"><a href="#6-组件间通信方式回顾-通过ref获取子组件" class="headerlink" title="6.组件间通信方式回顾-通过ref获取子组件"></a>6.组件间通信方式回顾-通过ref获取子组件</h3><ul>
<li>$root</li>
<li>$parent</li>
<li>$children</li>
<li>$refs</li>
</ul>
<blockquote>
<p>ref 两个作用</p>
</blockquote>
<ul>
<li>在普通的 HTML 标签上使用 ref，获取到的是 DOM</li>
<li>在组件标签上使用 ref，获取到的是组件实例</li>
</ul>
<h3 id="7-简易的状态管理方案"><a href="#7-简易的状态管理方案" class="headerlink" title="7.简易的状态管理方案"></a>7.简易的状态管理方案</h3><blockquote>
<p>问题</p>
</blockquote>
<ul>
<li>多个视图依赖同一状态</li>
<li>来自不同视图的行为需要变更同一状态</li>
</ul>
<h3 id="8-Vuex-概念回顾"><a href="#8-Vuex-概念回顾" class="headerlink" title="8.Vuex 概念回顾"></a>8.Vuex 概念回顾</h3><blockquote>
<p>什么是 Vuex</p>
</blockquote>
<ul>
<li>Vuex 是专门为 Vue.js 设计的状态管理库</li>
<li>Vuex 采用集中式的方式存储需要共享的状态</li>
<li>Vuex 的作用是进行状态管理，解决复杂组件通信，数据共享</li>
<li>Vuex 集成了 devtools 中，提供了 time-travel 时光旅行历史回滚功能</li>
</ul>
<blockquote>
<p>什么情况下使用 Vuex</p>
</blockquote>
<ul>
<li>非必要的情况下不要使用 Vuex</li>
<li>大型的单页应用程序<ul>
<li>多个视图依赖于同一状态</li>
<li>来自不同视图的行为需要变更同一状态</li>
</ul>
</li>
</ul>
<h3 id="9-Vuex-的核心概念"><a href="#9-Vuex-的核心概念" class="headerlink" title="9.Vuex 的核心概念"></a>9.Vuex 的核心概念</h3><ul>
<li>Store</li>
<li>State</li>
<li>Getter</li>
<li>Mutation</li>
<li>Action</li>
<li>Module</li>
</ul>
<h3 id="10-基本代码结构"><a href="#10-基本代码结构" class="headerlink" title="10.基本代码结构"></a>10.基本代码结构</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: &#123;&#125;,</span><br><span class="line">    mutations: &#123;&#125;,</span><br><span class="line">    actions: &#123;&#125;,</span><br><span class="line">    modules: &#123;&#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="11-State"><a href="#11-State" class="headerlink" title="11.State"></a>11.State</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    computed: &#123;</span><br><span class="line">        <span class="comment">// ...mapState(['count','msg'])</span></span><br><span class="line">        ...mapState(&#123;<span class="attr">num</span>:<span class="string">'count'</span>,<span class="attr">message</span>:<span class="string">'msg'</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="12-Getter"><a href="#12-Getter" class="headerlink" title="12.Getter"></a>12.Getter</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        count: <span class="number">0</span>,</span><br><span class="line">        msg: <span class="string">'Hello Vuex'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    getters: &#123;</span><br><span class="line">        reverseMsg(state) &#123;</span><br><span class="line">            <span class="keyword">return</span> state.msg.split(<span class="string">''</span>).reverse().join(<span class="string">''</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;&#125;,</span><br><span class="line">    actions: &#123;&#125;,</span><br><span class="line">    modules: &#123;&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; mapState, mapGetters &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    computed: &#123;</span><br><span class="line">        <span class="comment">// ...mapState(['count','msg'])</span></span><br><span class="line">        ...mapState(&#123;<span class="attr">num</span>:<span class="string">'count'</span>,<span class="attr">message</span>:<span class="string">'msg'</span>&#125;)</span><br><span class="line">        ...mapGetters([<span class="string">'reverseMsg'</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-Mutation"><a href="#13-Mutation" class="headerlink" title="13.Mutation"></a>13.Mutation</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        count: <span class="number">0</span>,</span><br><span class="line">        msg: <span class="string">'Hello Vuex'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    getters: &#123;</span><br><span class="line">        reverseMsg(state) &#123;</span><br><span class="line">            <span class="keyword">return</span> state.msg.split(<span class="string">''</span>).reverse().join(<span class="string">''</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">        increate(state,payload)&#123;</span><br><span class="line">            state.count += payload</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    actions: &#123;&#125;,</span><br><span class="line">    modules: &#123;&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; mapState, mapGetters &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    computed: &#123;</span><br><span class="line">        <span class="comment">// ...mapState(['count','msg'])</span></span><br><span class="line">        ...mapState(&#123;<span class="attr">num</span>:<span class="string">'count'</span>,<span class="attr">message</span>:<span class="string">'msg'</span>&#125;)</span><br><span class="line">        ...mapGetters([<span class="string">'reverseMsg'</span>])</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        ...mapMutations([<span class="string">'increate'</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-Action"><a href="#14-Action" class="headerlink" title="14.Action"></a>14.Action</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        count: <span class="number">0</span>,</span><br><span class="line">        msg: <span class="string">'Hello Vuex'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    getters: &#123;</span><br><span class="line">        reverseMsg(state) &#123;</span><br><span class="line">            <span class="keyword">return</span> state.msg.split(<span class="string">''</span>).reverse().join(<span class="string">''</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">        increate(state,payload)&#123;</span><br><span class="line">            state.count += payload</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    actions: &#123;</span><br><span class="line">        increateAsync(context,payload) &#123;</span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                context.commit(<span class="string">'increate'</span>,payload)</span><br><span class="line">            &#125;,<span class="number">2000</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    modules: &#123;&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; mapState, mapGetters &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    computed: &#123;</span><br><span class="line">        <span class="comment">// ...mapState(['count','msg'])</span></span><br><span class="line">        ...mapState(&#123;<span class="attr">num</span>:<span class="string">'count'</span>,<span class="attr">message</span>:<span class="string">'msg'</span>&#125;)</span><br><span class="line">        ...mapGetters([<span class="string">'reverseMsg'</span>])</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        ...mapMutations([<span class="string">'increate'</span>])</span><br><span class="line">        ...mapActions([<span class="string">'increateAsync'</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="15-Module"><a href="#15-Module" class="headerlink" title="15.Module"></a>15.Module</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// products.js</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">    products: [</span><br><span class="line">        &#123; <span class="attr">id</span>:<span class="number">1</span>, <span class="attr">title</span>:<span class="string">'iPhone 11'</span>, <span class="attr">price</span>:<span class="number">8000</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">id</span>:<span class="number">2</span>, <span class="attr">title</span>:<span class="string">'iPhone 12'</span>, <span class="attr">price</span>:<span class="number">10000</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> getters = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">    setProducts(state, payload) &#123;</span><br><span class="line">        state.products = payload</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> actions = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">   namespaced: <span class="literal">true</span>,</span><br><span class="line">   state,</span><br><span class="line">   getters,</span><br><span class="line">   mutations,</span><br><span class="line">   actions,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// cart.js</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> getters = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> mutations = &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> actions = &#123;&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">   namespaced: <span class="literal">true</span>,</span><br><span class="line">   state,</span><br><span class="line">   getters,</span><br><span class="line">   mutations,</span><br><span class="line">   actions,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        count: <span class="number">0</span>,</span><br><span class="line">        msg: <span class="string">'Hello Vuex'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    getters: &#123;</span><br><span class="line">        reverseMsg(state) &#123;</span><br><span class="line">            <span class="keyword">return</span> state.msg.split(<span class="string">''</span>).reverse().join(<span class="string">''</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">        increate(state,payload)&#123;</span><br><span class="line">            state.count += payload</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    actions: &#123;</span><br><span class="line">        increateAsync(context,payload) &#123;</span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                context.commit(<span class="string">'increate'</span>,payload)</span><br><span class="line">            &#125;,<span class="number">2000</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    modules: &#123;</span><br><span class="line">        products,</span><br><span class="line">        cart</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; mapState, mapGetters &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    computed: &#123;</span><br><span class="line">        <span class="comment">// ...mapState(['count','msg'])</span></span><br><span class="line">        ...mapState(&#123;<span class="attr">num</span>:<span class="string">'count'</span>,<span class="attr">message</span>:<span class="string">'msg'</span>&#125;)</span><br><span class="line">        ...mapGetters([<span class="string">'reverseMsg'</span>])</span><br><span class="line">        ...mapState(<span class="string">'products'</span>,[<span class="string">'products'</span>])</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        ...mapMutations([<span class="string">'increate'</span>])</span><br><span class="line">        ...mapActions([<span class="string">'increateAsync'</span>])</span><br><span class="line">        ...mapMutations(<span class="string">'products'</span>,[<span class="string">'setProducts'</span>])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="16-严格模式"><a href="#16-严格模式" class="headerlink" title="16.严格模式"></a>16.严格模式</h3><ul>
<li>strict: process.env.NODE_ENV !== ‘production’ 开发环境中开启，生产环境中关闭</li>
</ul>
<h3 id="17-购物车案例-演示"><a href="#17-购物车案例-演示" class="headerlink" title="17.购物车案例-演示"></a>17.购物车案例-演示</h3><p>略</p>
<h3 id="18-购物车案例-模板"><a href="#18-购物车案例-模板" class="headerlink" title="18.购物车案例-模板"></a>18.购物车案例-模板</h3><p>略</p>
<h3 id="19-购物车案例-商品列表"><a href="#19-购物车案例-商品列表" class="headerlink" title="19.购物车案例-商品列表"></a>19.购物车案例-商品列表</h3><blockquote>
<p>三个组件</p>
</blockquote>
<ul>
<li>商品列表组件<ul>
<li>展示商品列表</li>
<li>添加购物车</li>
</ul>
</li>
<li>购物车列表组件</li>
<li>我的购物车组件（弹出窗口）</li>
</ul>
<h3 id="20-购物车案例-添加购物车"><a href="#20-购物车案例-添加购物车" class="headerlink" title="20.购物车案例-添加购物车"></a>20.购物车案例-添加购物车</h3><p>略</p>
<h3 id="21-购物车案例-我的购物车-列表"><a href="#21-购物车案例-我的购物车-列表" class="headerlink" title="21.购物车案例-我的购物车-列表"></a>21.购物车案例-我的购物车-列表</h3><p>略</p>
<h3 id="22-购物车案例-我的购物车-统计"><a href="#22-购物车案例-我的购物车-统计" class="headerlink" title="22.购物车案例-我的购物车-统计"></a>22.购物车案例-我的购物车-统计</h3><p>略</p>
<h3 id="23-购物车案例-我的购物车-删除"><a href="#23-购物车案例-我的购物车-删除" class="headerlink" title="23.购物车案例-我的购物车-删除"></a>23.购物车案例-我的购物车-删除</h3><p>略</p>
<h3 id="24-购物车案例-购物车组件-购物车列表"><a href="#24-购物车案例-购物车组件-购物车列表" class="headerlink" title="24.购物车案例-购物车组件-购物车列表"></a>24.购物车案例-购物车组件-购物车列表</h3><p>略</p>
<h3 id="25-购物车案例-购物车组件-全选"><a href="#25-购物车案例-购物车组件-全选" class="headerlink" title="25.购物车案例-购物车组件-全选"></a>25.购物车案例-购物车组件-全选</h3><p>略</p>
<h3 id="26-购物车案例-购物车组件-数字文本框"><a href="#26-购物车案例-购物车组件-数字文本框" class="headerlink" title="26.购物车案例-购物车组件-数字文本框"></a>26.购物车案例-购物车组件-数字文本框</h3><p>略</p>
<h3 id="27-购物车案例-购物车组件-统计"><a href="#27-购物车案例-购物车组件-统计" class="headerlink" title="27.购物车案例-购物车组件-统计"></a>27.购物车案例-购物车组件-统计</h3><p>略</p>
<h3 id="28-购物车案例-本地存储"><a href="#28-购物车案例-本地存储" class="headerlink" title="28.购物车案例-本地存储"></a>28.购物车案例-本地存储</h3><blockquote>
<p>Vuex 插件介绍</p>
</blockquote>
<ul>
<li>Vuex 的插件就是一个函数</li>
<li>这个函数接收一个 store 参数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myPlugin = <span class="function"><span class="params">store</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 当 store 初始化后调用</span></span><br><span class="line">    store.subscribe(<span class="function">(<span class="params">mutation,state</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 每次 mutation 之后调用</span></span><br><span class="line">    <span class="comment">// mutation 的格式为 &#123;type,payload&#125;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    plugins: [myPlugin]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="29-模拟Vuex-基本结构"><a href="#29-模拟Vuex-基本结构" class="headerlink" title="29.模拟Vuex-基本结构"></a>29.模拟Vuex-基本结构</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> _Vue = <span class="literal">null</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">install</span> (<span class="params">vue</span>) </span>&#123;</span><br><span class="line">    _Vue = vue</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    Store,</span><br><span class="line">    install</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="30-模拟Vuex-install"><a href="#30-模拟Vuex-install" class="headerlink" title="30.模拟Vuex-install"></a>30.模拟Vuex-install</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> _Vue = <span class="literal">null</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">install</span> (<span class="params">vue</span>) </span>&#123;</span><br><span class="line">    _Vue = vue</span><br><span class="line">    _Vue.mixin(&#123;</span><br><span class="line">        beforeCreate () &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.$options.store) &#123;</span><br><span class="line">                _Vue.prototype.$store = <span class="keyword">this</span>.$options.store</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    Store,</span><br><span class="line">    install</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="31-模拟Vuex-Store-类"><a href="#31-模拟Vuex-Store-类" class="headerlink" title="31.模拟Vuex-Store 类"></a>31.模拟Vuex-Store 类</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> _Vue = <span class="literal">null</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options)&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;</span><br><span class="line">            state = &#123;&#125;,</span><br><span class="line">            getters = &#123;&#125;,</span><br><span class="line">            mutations = &#123;&#125;,</span><br><span class="line">            actions = &#123;&#125;,</span><br><span class="line">        &#125; = options</span><br><span class="line">        <span class="keyword">this</span>.state = _Vue.observable(state)</span><br><span class="line">        <span class="keyword">this</span>.getters = <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">        <span class="built_in">Object</span>.keys(getters).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>.getters, key, &#123;</span><br><span class="line">                <span class="keyword">get</span>: () =&gt; getters[key](state)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">        this._mutations = mutations</span><br><span class="line">        this._actions = actions</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    commit (type, payload) &#123;</span><br><span class="line">        <span class="keyword">this</span>._mutations[type](<span class="keyword">this</span>.state, payload)</span><br><span class="line">    &#125;</span><br><span class="line">    dispatch (type, payload) &#123;</span><br><span class="line">        <span class="keyword">this</span>._actions[type](<span class="keyword">this</span>, payload)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">install</span> (<span class="params">vue</span>) </span>&#123;</span><br><span class="line">    _Vue = vue</span><br><span class="line">    _Vue.mixin(&#123;</span><br><span class="line">        beforeCreate () &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.$options.store) &#123;</span><br><span class="line">                _Vue.prototype.$store = <span class="keyword">this</span>.$options.store</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    Store,</span><br><span class="line">    install</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="任务二：服务端渲染基础"><a href="#任务二：服务端渲染基础" class="headerlink" title="任务二：服务端渲染基础"></a>任务二：服务端渲染基础</h2><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h3><blockquote>
<p>SPA 单页面应用</p>
</blockquote>
<ul>
<li><p>优点</p>
<ul>
<li>用户体验好</li>
<li>开发效率高</li>
<li>渲染性能好</li>
<li>可维护性好</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>首屏渲染时间长</li>
<li>不利于 SEO</li>
</ul>
</li>
</ul>
<blockquote>
<p>同构应用</p>
</blockquote>
<ul>
<li>通过服务端渲染首屏直出，解决 SPA 应用首屏渲染慢以及不利于 SEO 问题</li>
<li>通过客户端渲染接管页面内容交互得到更好的用户体验</li>
</ul>
<blockquote>
<p>相关概念</p>
</blockquote>
<ul>
<li>什么是渲染</li>
<li>传统的服务端渲染</li>
<li>客户端渲染</li>
<li>现代化的服务端渲染（同构渲染）</li>
</ul>
<h3 id="2-什么是渲染"><a href="#2-什么是渲染" class="headerlink" title="2.什么是渲染"></a>2.什么是渲染</h3><ul>
<li>渲染：把 数据 + 模板 拼接到一起</li>
</ul>
<h3 id="3-传统的服务端渲染"><a href="#3-传统的服务端渲染" class="headerlink" title="3.传统的服务端渲染"></a>3.传统的服务端渲染</h3><ul>
<li>前后端代码完全耦合在一起，不利于开发和维护</li>
<li>前端没有足够发挥空间</li>
<li>服务端压力大</li>
<li>用户体验一般</li>
</ul>
<h3 id="4-客户端渲染"><a href="#4-客户端渲染" class="headerlink" title="4.客户端渲染"></a>4.客户端渲染</h3><ul>
<li>后端：负责处理数据接口</li>
<li>前端：负责将接口数据渲染到页面中</li>
</ul>
<h3 id="5-为什么客户端渲染首屏渲染慢"><a href="#5-为什么客户端渲染首屏渲染慢" class="headerlink" title="5.为什么客户端渲染首屏渲染慢"></a>5.为什么客户端渲染首屏渲染慢</h3><p>略</p>
<h3 id="6-为什么客户端渲染不利于-SEO"><a href="#6-为什么客户端渲染不利于-SEO" class="headerlink" title="6.为什么客户端渲染不利于 SEO"></a>6.为什么客户端渲染不利于 SEO</h3><p>略</p>
<h3 id="7-现代化的服务端渲染"><a href="#7-现代化的服务端渲染" class="headerlink" title="7.现代化的服务端渲染"></a>7.现代化的服务端渲染</h3><ul>
<li>基于 React、Vue 等框架，客户端渲染和服务器渲染的结合<ul>
<li>在服务器端执行一次，用于实现服务器端渲染（首屏直出）</li>
<li>在客户端再执行一次，用于接管页面交互</li>
</ul>
</li>
<li>核心解决 SEO 和首屏渲染慢的问题</li>
<li>拥有传统服务端渲染的优点，也有客户端渲染的优点</li>
</ul>
<blockquote>
<p>如何实现同构渲染</p>
</blockquote>
<ul>
<li>使用 Vue、React 等框架的官方解决方案<ul>
<li>优点：有助于理解原理</li>
<li>缺点：需要搭建环境，比较麻烦</li>
</ul>
</li>
<li>使用第三方解决方案<ul>
<li>React 生态的 Next.js</li>
<li>Vue 生态的 Nuxt.js</li>
</ul>
</li>
</ul>
<h3 id="8-通过-Nuxt-体验同构渲染"><a href="#8-通过-Nuxt-体验同构渲染" class="headerlink" title="8.通过 Nuxt 体验同构渲染"></a>8.通过 Nuxt 体验同构渲染</h3><p>略</p>
<h3 id="9-同构渲染的-SPA-应用"><a href="#9-同构渲染的-SPA-应用" class="headerlink" title="9.同构渲染的 SPA 应用"></a>9.同构渲染的 SPA 应用</h3><p>略</p>
<h3 id="10-同构渲染的问题"><a href="#10-同构渲染的问题" class="headerlink" title="10.同构渲染的问题"></a>10.同构渲染的问题</h3><blockquote>
<p>同构渲染应用的问题</p>
</blockquote>
<ul>
<li>开发条件所限</li>
<li>设计构建设置和部署的更多要求</li>
<li>更多的服务器端负载</li>
</ul>
<blockquote>
<p>开发条件有限</p>
</blockquote>
<ul>
<li>浏览器特定的代码只能在某些生命周期钩子函数中使用</li>
<li>一些外部扩展库可能需要特殊处理才能在服务端渲染应用中运行</li>
<li>不能在服务端渲染期间操作 DOM</li>
<li>某些代码操作需要区分运行环境</li>
</ul>
<blockquote>
<p>更多的服务端负载</p>
</blockquote>
<ul>
<li>在 Node 中渲染完整的应用程序，相比仅仅提供静态文件的服务器需要大量占用 CPU 资源</li>
<li>如果应用在高流量环境下使用，需要准备相应的服务器负载、</li>
<li>需要更多的服务端渲染优化工作处理</li>
</ul>
<blockquote>
<p>服务端渲染使用建议</p>
</blockquote>
<ul>
<li>首屏渲染速度是否真的重要？</li>
<li>是否真的需要 SEO？</li>
</ul>
<h2 id="任务三：NuxtJS-基础"><a href="#任务三：NuxtJS-基础" class="headerlink" title="任务三：NuxtJS 基础"></a>任务三：NuxtJS 基础</h2><h3 id="1-NuxtJS-介绍"><a href="#1-NuxtJS-介绍" class="headerlink" title="1.NuxtJS 介绍"></a>1.NuxtJS 介绍</h3><blockquote>
<p>Nuxt.js 是什么</p>
</blockquote>
<ul>
<li>一个基于 Vue.js 生态的第三方开源服务端渲染应用框架</li>
<li>它可以帮我们轻松的使用 Vue.js 技术栈构建同构应用</li>
<li>官网：<a href="https://zh.nuxtjs.org/" target="_blank" rel="noopener">https://zh.nuxtjs.org/</a></li>
<li>GitHub 仓库：<a href="https://github.com.com/nuxt/nuxt.js" target="_blank" rel="noopener">https://github.com.com/nuxt/nuxt.js</a></li>
</ul>
<h3 id="2-初始化-NuxtJS-项目"><a href="#2-初始化-NuxtJS-项目" class="headerlink" title="2.初始化 NuxtJS 项目"></a>2.初始化 NuxtJS 项目</h3><blockquote>
<p>Nuxt.js 的使用方式</p>
</blockquote>
<ul>
<li>初始项目</li>
<li>已有的 Node.js 服务端项目<ul>
<li>直接把 Nuxt 当做一个中间件集成到 Node Web Server 中</li>
</ul>
</li>
<li>现有的 Vue.js 项目<ul>
<li>非常熟悉 Nuxt.js</li>
<li>至少 10% 的代码改动</li>
</ul>
</li>
</ul>
<blockquote>
<p>初始化 Nuxt.js 应用的方式</p>
</blockquote>
<ul>
<li>官方文档：<a href="https://zh.nuxtjs.org/guide/installation" target="_blank" rel="noopener">https://zh.nuxtjs.org/guide/installation</a><ul>
<li>方式一：使用 create-nuxt-app</li>
<li>方式二：手动创建</li>
</ul>
</li>
</ul>
<h3 id="3-案例代码分支说明"><a href="#3-案例代码分支说明" class="headerlink" title="3.案例代码分支说明"></a>3.案例代码分支说明</h3><p>略</p>
<h3 id="4-路由-基本路由"><a href="#4-路由-基本路由" class="headerlink" title="4.路由-基本路由"></a>4.路由-基本路由</h3><p>略</p>
<h3 id="5-路由-路由导航"><a href="#5-路由-路由导航" class="headerlink" title="5.路由-路由导航"></a>5.路由-路由导航</h3><blockquote>
<p>Nuxt.js 路由-路由导航</p>
</blockquote>
<ul>
<li><p>a 标签</p>
<ul>
<li>它会刷新整个页面，不要使用</li>
</ul>
</li>
<li><p>nuxt-link 组件</p>
<ul>
<li><a href="https://router.vuejs.org/zh/api/#router-link-props" target="_blank" rel="noopener">https://router.vuejs.org/zh/api/#router-link-props</a></li>
</ul>
</li>
<li><p>编程式导航</p>
<ul>
<li><a href="https://router.vuejs.org/zh/guide/essentials/navigation.html" target="_blank" rel="noopener">https://router.vuejs.org/zh/guide/essentials/navigation.html</a></li>
</ul>
</li>
</ul>
<h3 id="6-路由-动态路由"><a href="#6-路由-动态路由" class="headerlink" title="6.路由-动态路由"></a>6.路由-动态路由</h3><blockquote>
<p>Nuxt.js 路由-动态路由</p>
</blockquote>
<ul>
<li><p>Vue Router 动态路由匹配</p>
<ul>
<li><a href="https://router.vuejs.org/zh/guide/essentials/dynamic-matching.html" target="_blank" rel="noopener">https://router.vuejs.org/zh/guide/essentials/dynamic-matching.html</a></li>
</ul>
</li>
<li><p>Nuxt.js 动态路由</p>
<ul>
<li><a href="https://zh.nuxtjs.org/guide/routing#动态路由" target="_blank" rel="noopener">https://zh.nuxtjs.org/guide/routing#动态路由</a></li>
</ul>
</li>
</ul>
<h3 id="7-路由-嵌套路由"><a href="#7-路由-嵌套路由" class="headerlink" title="7.路由-嵌套路由"></a>7.路由-嵌套路由</h3><p>略</p>
<h3 id="8-路由-自定义路由配置"><a href="#8-路由-自定义路由配置" class="headerlink" title="8.路由-自定义路由配置"></a>8.路由-自定义路由配置</h3><p>略</p>
<h3 id="9-视图-模板"><a href="#9-视图-模板" class="headerlink" title="9.视图-模板"></a>9.视图-模板</h3><p>略</p>
<h3 id="10-视图-布局"><a href="#10-视图-布局" class="headerlink" title="10.视图-布局"></a>10.视图-布局</h3><p>略</p>
<h3 id="11-异步数据-asyncData"><a href="#11-异步数据-asyncData" class="headerlink" title="11.异步数据-asyncData"></a>11.异步数据-asyncData</h3><blockquote>
<p>Nuxt.js 异步数据-asyncData 方法</p>
</blockquote>
<ul>
<li><p><a href="https://zh.nuxtjs.org/guide/async-data" target="_blank" rel="noopener">https://zh.nuxtjs.org/guide/async-data</a></p>
</li>
<li><p>基本用法</p>
<ul>
<li>它会将 asyncData 返回的数据融合组件 data 方法返回数据一并给组件</li>
<li>调用时机：服务端渲染期间和客户端路由更新之前</li>
</ul>
</li>
</ul>
<p>-注意事项</p>
<ul>
<li>只能在页面组件中使用</li>
<li>没有 this，因为它是在组件初始化之前被调用的</li>
</ul>
<h3 id="12-异步数据-上下文对象"><a href="#12-异步数据-上下文对象" class="headerlink" title="12.异步数据-上下文对象"></a>12.异步数据-上下文对象</h3><ul>
<li>context</li>
</ul>
<h2 id="任务四：NuxtJS-综合案例"><a href="#任务四：NuxtJS-综合案例" class="headerlink" title="任务四：NuxtJS 综合案例"></a>任务四：NuxtJS 综合案例</h2><h3 id="1-案例介绍"><a href="#1-案例介绍" class="headerlink" title="1.案例介绍"></a>1.案例介绍</h3><ul>
<li>案例名称： RealWorld</li>
<li>一个开源的学习项目，目的就是帮助开发者快速学习新技能</li>
<li>GitHub 仓库：<a href="https://github.com/gothinkser/realworld" target="_blank" rel="noopener">https://github.com/gothinkser/realworld</a></li>
<li>在线实例：<a href="https://demo.realworl.io/#/" target="_blank" rel="noopener">https://demo.realworl.io/#/</a></li>
</ul>
<blockquote>
<p>案例相关资源</p>
</blockquote>
<ul>
<li>页面模板：<a href="https://github.com/gothinkster/realworld-starter-kit/blob/master/FRONTEND_INSTRUCTIONS.md" target="_blank" rel="noopener">https://github.com/gothinkster/realworld-starter-kit/blob/master/FRONTEND_INSTRUCTIONS.md</a></li>
<li>接口文档：<a href="https://github.com/gothunkster/realword/tree/master/api" target="_blank" rel="noopener">https://github.com/gothunkster/realword/tree/master/api</a></li>
</ul>
<blockquote>
<p>学习前提</p>
</blockquote>
<ul>
<li>Vue.js 使用经验</li>
<li>Nuxt.js 基础</li>
<li>Node.js、webpack相关使用经验</li>
</ul>
<blockquote>
<p>学习收获</p>
</blockquote>
<ul>
<li>掌握使用 Nuxt.js 开发同构渲染应用</li>
<li>增强 Vue.js 实践能力</li>
<li>掌握同构渲染应用中常见的功能处理<ul>
<li>用户状态管理</li>
<li>页面访问权限处理</li>
<li>SEO 优化</li>
</ul>
</li>
<li>掌握同构渲染应用的发布与部署</li>
</ul>
<h3 id="2-项目初始化-创建项目"><a href="#2-项目初始化-创建项目" class="headerlink" title="2.项目初始化-创建项目"></a>2.项目初始化-创建项目</h3><blockquote>
<p>创建项目</p>
</blockquote>
<ul>
<li>mikdir realworld-nuxtjs</li>
<li>npm init -y</li>
<li>npm i nuxt</li>
<li>配置启动脚本</li>
<li>创建 page 目录，配置初始化页面</li>
</ul>
<h3 id="3-项目初始化-导入样式资源"><a href="#3-项目初始化-导入样式资源" class="headerlink" title="3.项目初始化-导入样式资源"></a>3.项目初始化-导入样式资源</h3><p>略</p>
<h3 id="4-项目初始化-布局组件"><a href="#4-项目初始化-布局组件" class="headerlink" title="4.项目初始化-布局组件"></a>4.项目初始化-布局组件</h3><p>略</p>
<h3 id="5-项目初始化-导入登录注册页面"><a href="#5-项目初始化-导入登录注册页面" class="headerlink" title="5.项目初始化-导入登录注册页面"></a>5.项目初始化-导入登录注册页面</h3><p>略</p>
<h3 id="6-项目初始化-导入剩余页面"><a href="#6-项目初始化-导入剩余页面" class="headerlink" title="6.项目初始化-导入剩余页面"></a>6.项目初始化-导入剩余页面</h3><p>略</p>
<h3 id="7-项目初始化-处理顶部导航链接"><a href="#7-项目初始化-处理顶部导航链接" class="headerlink" title="7.项目初始化-处理顶部导航链接"></a>7.项目初始化-处理顶部导航链接</h3><p>略</p>
<h3 id="8-项目初始化-处理导航链接高亮"><a href="#8-项目初始化-处理导航链接高亮" class="headerlink" title="8.项目初始化-处理导航链接高亮"></a>8.项目初始化-处理导航链接高亮</h3><p>略</p>
<h3 id="9-项目初始化-封装请求模块"><a href="#9-项目初始化-封装请求模块" class="headerlink" title="9.项目初始化-封装请求模块"></a>9.项目初始化-封装请求模块</h3><p>略</p>
<h3 id="10-登录注册-实现基本登录功能"><a href="#10-登录注册-实现基本登录功能" class="headerlink" title="10.登录注册-实现基本登录功能"></a>10.登录注册-实现基本登录功能</h3><p>略</p>
<h3 id="11-登录注册-封装请求方法"><a href="#11-登录注册-封装请求方法" class="headerlink" title="11.登录注册-封装请求方法"></a>11.登录注册-封装请求方法</h3><p>略</p>
<h3 id="12-登录注册-表单验证"><a href="#12-登录注册-表单验证" class="headerlink" title="12.登录注册-表单验证"></a>12.登录注册-表单验证</h3><p>略</p>
<h3 id="13-登录注册-错误处理"><a href="#13-登录注册-错误处理" class="headerlink" title="13.登录注册-错误处理"></a>13.登录注册-错误处理</h3><p>略</p>
<h3 id="14-登录注册-用户注册"><a href="#14-登录注册-用户注册" class="headerlink" title="14.登录注册-用户注册"></a>14.登录注册-用户注册</h3><p>略</p>
<h3 id="15-登录注册-解析存储登录状态实现流程"><a href="#15-登录注册-解析存储登录状态实现流程" class="headerlink" title="15.登录注册-解析存储登录状态实现流程"></a>15.登录注册-解析存储登录状态实现流程</h3><p>略</p>
<h3 id="16-登录注册-将登录状态存储到容器中"><a href="#16-登录注册-将登录状态存储到容器中" class="headerlink" title="16.登录注册-将登录状态存储到容器中"></a>16.登录注册-将登录状态存储到容器中</h3><p>略</p>
<h3 id="17-登录注册-登录状态持久化"><a href="#17-登录注册-登录状态持久化" class="headerlink" title="17.登录注册-登录状态持久化"></a>17.登录注册-登录状态持久化</h3><p>略</p>
<h3 id="18-登录注册-处理导航栏链接展示状态"><a href="#18-登录注册-处理导航栏链接展示状态" class="headerlink" title="18.登录注册-处理导航栏链接展示状态"></a>18.登录注册-处理导航栏链接展示状态</h3><p>略</p>
<h3 id="19-登录注册-处理页面访问权限"><a href="#19-登录注册-处理页面访问权限" class="headerlink" title="19.登录注册-处理页面访问权限"></a>19.登录注册-处理页面访问权限</h3><p>略</p>
<h3 id="20-首页-业务介绍"><a href="#20-首页-业务介绍" class="headerlink" title="20.首页-业务介绍"></a>20.首页-业务介绍</h3><p>略</p>
<h3 id="21-首页-展示公共文章列表"><a href="#21-首页-展示公共文章列表" class="headerlink" title="21.首页-展示公共文章列表"></a>21.首页-展示公共文章列表</h3><p>略</p>
<h3 id="22-首页-列表分页-分页参数的使用"><a href="#22-首页-列表分页-分页参数的使用" class="headerlink" title="22.首页-列表分页-分页参数的使用"></a>22.首页-列表分页-分页参数的使用</h3><p>略</p>
<h3 id="23-首页-列表分页-页码处理"><a href="#23-首页-列表分页-页码处理" class="headerlink" title="23.首页-列表分页-页码处理"></a>23.首页-列表分页-页码处理</h3><p>略</p>
<h3 id="24-首页-展示文章标签列表"><a href="#24-首页-展示文章标签列表" class="headerlink" title="24.首页-展示文章标签列表"></a>24.首页-展示文章标签列表</h3><p>略</p>
<h3 id="25-首页-优化并行异步任务"><a href="#25-首页-优化并行异步任务" class="headerlink" title="25.首页-优化并行异步任务"></a>25.首页-优化并行异步任务</h3><p>略</p>
<h3 id="26-首页-处理标签列表链接和数据"><a href="#26-首页-处理标签列表链接和数据" class="headerlink" title="26.首页-处理标签列表链接和数据"></a>26.首页-处理标签列表链接和数据</h3><p>略</p>
<h3 id="27-首页-处理导航栏-业务介绍"><a href="#27-首页-处理导航栏-业务介绍" class="headerlink" title="27.首页-处理导航栏-业务介绍"></a>27.首页-处理导航栏-业务介绍</h3><p>略</p>
<h3 id="28-首页-处理导航栏-展示状态处理"><a href="#28-首页-处理导航栏-展示状态处理" class="headerlink" title="28.首页-处理导航栏-展示状态处理"></a>28.首页-处理导航栏-展示状态处理</h3><p>略</p>
<h3 id="29-首页-处理导航栏-标签高亮及链接"><a href="#29-首页-处理导航栏-标签高亮及链接" class="headerlink" title="29.首页-处理导航栏-标签高亮及链接"></a>29.首页-处理导航栏-标签高亮及链接</h3><p>略</p>
<h3 id="30-首页-处理导航栏-展示用户关注的文章列表"><a href="#30-首页-处理导航栏-展示用户关注的文章列表" class="headerlink" title="30.首页-处理导航栏-展示用户关注的文章列表"></a>30.首页-处理导航栏-展示用户关注的文章列表</h3><p>略</p>
<h3 id="31-首页-统一设置用户-Token"><a href="#31-首页-统一设置用户-Token" class="headerlink" title="31.首页-统一设置用户 Token"></a>31.首页-统一设置用户 Token</h3><p>略</p>
<h3 id="32-首页-文章发布时间格式化处理"><a href="#32-首页-文章发布时间格式化处理" class="headerlink" title="32.首页-文章发布时间格式化处理"></a>32.首页-文章发布时间格式化处理</h3><p>略</p>
<h3 id="33-首页-文章点赞"><a href="#33-首页-文章点赞" class="headerlink" title="33.首页-文章点赞"></a>33.首页-文章点赞</h3><p>略</p>
<h3 id="34-文章详情-业务介绍"><a href="#34-文章详情-业务介绍" class="headerlink" title="34.文章详情-业务介绍"></a>34.文章详情-业务介绍</h3><p>略</p>
<h3 id="35-文章详情-展示基本信息"><a href="#35-文章详情-展示基本信息" class="headerlink" title="35.文章详情-展示基本信息"></a>35.文章详情-展示基本信息</h3><p>略</p>
<h3 id="36-文章详情-把-Markdown-转为-HTML"><a href="#36-文章详情-把-Markdown-转为-HTML" class="headerlink" title="36.文章详情-把 Markdown 转为 HTML"></a>36.文章详情-把 Markdown 转为 HTML</h3><p>略</p>
<h3 id="37-文章详情-展示文章作者相关信息"><a href="#37-文章详情-展示文章作者相关信息" class="headerlink" title="37.文章详情-展示文章作者相关信息"></a>37.文章详情-展示文章作者相关信息</h3><p>略</p>
<h3 id="38-文章详情-设置页面-meta-优化-SEO"><a href="#38-文章详情-设置页面-meta-优化-SEO" class="headerlink" title="38.文章详情-设置页面 meta 优化 SEO"></a>38.文章详情-设置页面 meta 优化 SEO</h3><p>略</p>
<h3 id="39-文章评论-通过客户端渲染展示评论列表"><a href="#39-文章评论-通过客户端渲染展示评论列表" class="headerlink" title="39.文章评论-通过客户端渲染展示评论列表"></a>39.文章评论-通过客户端渲染展示评论列表</h3><p>略</p>
<h3 id="40-发布部署-打包"><a href="#40-发布部署-打包" class="headerlink" title="40.发布部署-打包"></a>40.发布部署-打包</h3><p>略</p>
<h3 id="41-发布部署-最简单的部署方式"><a href="#41-发布部署-最简单的部署方式" class="headerlink" title="41.发布部署-最简单的部署方式"></a>41.发布部署-最简单的部署方式</h3><p>略</p>
<h3 id="42-发布部署-使用-PM2-启动-Node-服务"><a href="#42-发布部署-使用-PM2-启动-Node-服务" class="headerlink" title="42.发布部署-使用 PM2 启动 Node 服务"></a>42.发布部署-使用 PM2 启动 Node 服务</h3><p>略</p>
<h3 id="43-发布部署-自动化部署介绍"><a href="#43-发布部署-自动化部署介绍" class="headerlink" title="43.发布部署-自动化部署介绍"></a>43.发布部署-自动化部署介绍</h3><p>略</p>
<h3 id="44-发布部署-准备自动部署内容"><a href="#44-发布部署-准备自动部署内容" class="headerlink" title="44.发布部署-准备自动部署内容"></a>44.发布部署-准备自动部署内容</h3><p>略</p>
<h3 id="45-发布部署-自动部署完成"><a href="#45-发布部署-自动部署完成" class="headerlink" title="45.发布部署-自动部署完成"></a>45.发布部署-自动部署完成</h3><p>略</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/20/30/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旋の飞羽">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/20/30/" itemprop="url">学习笔记 ----- 【Vue.js 框架源码与进阶】手写 Vue Router、手写响应式实现、虚拟 DOM 和 Diff 算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-12-20T00:00:00+08:00">
                2020-12-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>作者：FY<br>引用请标明出处</p>
</blockquote>
<h1 id="Part-3-·-Vue-js-框架源码与进阶"><a href="#Part-3-·-Vue-js-框架源码与进阶" class="headerlink" title="Part 3 · Vue.js 框架源码与进阶"></a>Part 3 · Vue.js 框架源码与进阶</h1><h2 id="模块一-·-手写-Vue-Router、手写响应式实现、虚拟-DOM-和-Diff-算法"><a href="#模块一-·-手写-Vue-Router、手写响应式实现、虚拟-DOM-和-Diff-算法" class="headerlink" title="模块一 · 手写 Vue Router、手写响应式实现、虚拟 DOM 和 Diff 算法"></a>模块一 · 手写 Vue Router、手写响应式实现、虚拟 DOM 和 Diff 算法</h2><h2 id="任务一：Vue-js-基础回顾"><a href="#任务一：Vue-js-基础回顾" class="headerlink" title="任务一：Vue.js 基础回顾"></a>任务一：Vue.js 基础回顾</h2><h3 id="1-阶段内容"><a href="#1-阶段内容" class="headerlink" title="1.阶段内容"></a>1.阶段内容</h3><ul>
<li>快速回顾 Vue.js 基础语法</li>
<li>Vue Router 原理分析与实现</li>
<li>虚拟 DOM 库 Snabbdom 源码解析</li>
<li>响应式原理分析与实现</li>
<li>Vue.js 源码分析</li>
</ul>
<h3 id="2-Vue-基础结构"><a href="#2-Vue-基础结构" class="headerlink" title="2.Vue 基础结构"></a>2.Vue 基础结构</h3><p>略</p>
<h3 id="3-Vue-的生命周期"><a href="#3-Vue-的生命周期" class="headerlink" title="3.Vue 的生命周期"></a>3.Vue 的生命周期</h3><p>略</p>
<h3 id="4-Vue-语法和概念-上"><a href="#4-Vue-语法和概念-上" class="headerlink" title="4.Vue 语法和概念-上"></a>4.Vue 语法和概念-上</h3><ul>
<li>插值表达式</li>
<li>指令</li>
<li>计算属性和侦听器</li>
<li>Class 和 Style 绑定</li>
<li>条件渲染/列表渲染</li>
<li>表单输入绑定</li>
</ul>
<h3 id="5-Vue-语法和概念-下"><a href="#5-Vue-语法和概念-下" class="headerlink" title="5.Vue 语法和概念-下"></a>5.Vue 语法和概念-下</h3><ul>
<li>组件</li>
<li>插槽</li>
<li>插件</li>
<li>混入 mixin</li>
<li>深入响应式原理</li>
<li>不同构建版本的 Vue</li>
</ul>
<h2 id="任务二：Vue-Router-原理实现"><a href="#任务二：Vue-Router-原理实现" class="headerlink" title="任务二：Vue-Router 原理实现"></a>任务二：Vue-Router 原理实现</h2><h3 id="1-课程介绍"><a href="#1-课程介绍" class="headerlink" title="1.课程介绍"></a>1.课程介绍</h3><ul>
<li>Vue Router 基础回顾</li>
<li>Hash 模式和 History 模式</li>
<li>模拟实现自己的Vue Router</li>
</ul>
<h3 id="2-Vue-Router-基础回顾-使用步骤"><a href="#2-Vue-Router-基础回顾-使用步骤" class="headerlink" title="2.Vue Router 基础回顾-使用步骤"></a>2.Vue Router 基础回顾-使用步骤</h3><p>略</p>
<h3 id="3-动态路由"><a href="#3-动态路由" class="headerlink" title="3.动态路由"></a>3.动态路由</h3><p>略</p>
<h3 id="4-嵌套路由"><a href="#4-嵌套路由" class="headerlink" title="4.嵌套路由"></a>4.嵌套路由</h3><p>略</p>
<h3 id="5-编程式导航"><a href="#5-编程式导航" class="headerlink" title="5.编程式导航"></a>5.编程式导航</h3><ul>
<li>push</li>
<li>replace</li>
<li>go</li>
</ul>
<h3 id="6-Hash-模式和-History-模式的区别"><a href="#6-Hash-模式和-History-模式的区别" class="headerlink" title="6.Hash 模式和 History 模式的区别"></a>6.Hash 模式和 History 模式的区别</h3><ul>
<li><p>表现形式的区别</p>
<ul>
<li>Hash 模式<ul>
<li>https:music.163.com/#/palylist?id=3102961863</li>
</ul>
</li>
<li>History 模式<ul>
<li>https:music.163.com/palylist/3102961863</li>
</ul>
</li>
</ul>
</li>
<li><p>原理的区别</p>
<ul>
<li>Hash 模式是基于锚点，以及 onhashchange事件</li>
<li>History 模式是基于 HTML5 中的 History API<ul>
<li>history.pushState() IE10 以后才支持</li>
<li>history.repalceState()</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="7-History-模式"><a href="#7-History-模式" class="headerlink" title="7.History 模式"></a>7.History 模式</h3><ul>
<li>History 需要服务器的支持</li>
<li>单页应用中，服务端不存在 <a href="http://www.testurl.com/login" target="_blank" rel="noopener">http://www.testurl.com/login</a> 这样的地址会返回找不到该页面</li>
<li>在服务端应该除了静态资源外都返回单页应用的 index.html</li>
</ul>
<h3 id="8-History-模式-Node-js"><a href="#8-History-模式-Node-js" class="headerlink" title="8.History 模式 - Node.js"></a>8.History 模式 - Node.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> history = <span class="built_in">require</span>(<span class="string">'connect-history-api-fallback'</span>)</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)</span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line">app.use(history())</span><br><span class="line">app.use(express.static(path.join(__dirname, <span class="string">'../web'</span>)))</span><br><span class="line">app.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'服务器开启， 端口：3000'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="9-History-模式-nginx"><a href="#9-History-模式-nginx" class="headerlink" title="9.History 模式 - nginx"></a>9.History 模式 - nginx</h3><ul>
<li>从官网下载 nginx 的压缩包</li>
<li>把压缩包解压到 c 盘根目录， c:\nginx-1.18.0 文件夹</li>
<li>打开命令行，切换到目录 c:\nginx-1.18.0</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 启动</span></span><br><span class="line">start nginx</span><br><span class="line"><span class="comment">// 重启</span></span><br><span class="line">nginx -s reload</span><br><span class="line"><span class="comment">// 停止</span></span><br><span class="line">nginx -s stop</span><br><span class="line"></span><br><span class="line"><span class="comment">// nginx</span></span><br><span class="line">location / &#123;</span><br><span class="line">  root html;</span><br><span class="line">  index index.html index.htm;</span><br><span class="line">  try_files $uri $uri/ <span class="regexp">/index.html;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="10-VueRouter-实现原理"><a href="#10-VueRouter-实现原理" class="headerlink" title="10.VueRouter 实现原理"></a>10.VueRouter 实现原理</h3><blockquote>
<p>Vue 前置知识</p>
</blockquote>
<ul>
<li>插件</li>
<li>混入</li>
<li>Vue.observable()</li>
<li>插槽</li>
<li>render 函数</li>
<li>运行时和完整版的 Vue</li>
</ul>
<blockquote>
<p>Hash 模式</p>
</blockquote>
<ul>
<li>URL 中 # 后面的内容作为路径地址</li>
<li>监听 hashchange 事件</li>
<li>根据当前路由地址找到对应组件重新渲染</li>
</ul>
<blockquote>
<p>History 模式</p>
</blockquote>
<ul>
<li>通过 history.pushState() 方法改变地址栏</li>
<li>监听 popstate 事件</li>
<li>根据当前路由地址找到对应组件重新渲染</li>
</ul>
<h3 id="11-VueRouter-模拟实现-分析"><a href="#11-VueRouter-模拟实现-分析" class="headerlink" title="11.VueRouter 模拟实现 - 分析"></a>11.VueRouter 模拟实现 - 分析</h3><p>VueRouter</p>
<ul>
<li>options</li>
<li>data</li>
<li>routeMap</li>
<li>Constructor(Options): VueRouter</li>
<li>_install(Vue): void</li>
<li>init(): void</li>
<li>initEvent(): void</li>
<li>createRouterMap(): void</li>
<li>initComponents(Vue): void</li>
</ul>
<h3 id="12-VueRouter-install"><a href="#12-VueRouter-install" class="headerlink" title="12.VueRouter - install"></a>12.VueRouter - install</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> _Vue = <span class="literal">null</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VueRouter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> install (Vue) &#123;</span><br><span class="line">    <span class="comment">// 1.判断当前插件是否已经被安装</span></span><br><span class="line">    <span class="keyword">if</span>(VueRouter.install.installed)&#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    VueRouter.install.installed = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// 2.把 Vue 构造函数记录到全局变量</span></span><br><span class="line">    _Vue = Vue</span><br><span class="line">    <span class="comment">// 3.把创建 Vue 实例时候传入的router对象注入到Vue实例上 </span></span><br><span class="line">    <span class="comment">// 混入</span></span><br><span class="line">    _Vue.mixin(&#123;</span><br><span class="line">      beforeCreate () &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.$options.router)&#123;</span><br><span class="line">          _Vue.prototype.$router = <span class="keyword">this</span>.$options.router</span><br><span class="line">          <span class="keyword">this</span>.$options.router.init() <span class="comment">// 详见 15.VueRouter - router-link</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-VueRouter-构造函数"><a href="#13-VueRouter-构造函数" class="headerlink" title="13.VueRouter - 构造函数"></a>13.VueRouter - 构造函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VueRouter</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">constructor</span> (options) &#123;</span><br><span class="line">    <span class="keyword">this</span>.options = options</span><br><span class="line">    <span class="keyword">this</span>.routeMap = &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.data = _Vue.observable(&#123;</span><br><span class="line">      current: <span class="string">'/'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-VueRouter-createRouteMap"><a href="#14-VueRouter-createRouteMap" class="headerlink" title="14.VueRouter - createRouteMap"></a>14.VueRouter - createRouteMap</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VueRouter</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  createRouteMap() &#123;</span><br><span class="line">    <span class="comment">// 遍历所有的路由规则，把路由规则解析成键值对的形式 存储到 routeMap 中</span></span><br><span class="line">    <span class="keyword">this</span>.options.routes.forEach(<span class="function"><span class="params">route</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.routeMap[route.path] = route.component</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="15-VueRouter-router-link"><a href="#15-VueRouter-router-link" class="headerlink" title="15.VueRouter - router-link"></a>15.VueRouter - router-link</h3><blockquote>
<p>Vue 的构建版本</p>
</blockquote>
<ul>
<li>运行时版：不支持 template 模板，需要打包的时候提前编译</li>
<li>完整版：包含运行时和编译器，体积比运行时版大 10k 左右， 程序运行的时候把模板转换成 render 函数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VueRouter</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  initComponents(Vue) &#123;</span><br><span class="line">    Vue.component(<span class="string">'router-link'</span>, &#123;</span><br><span class="line">      props: &#123;</span><br><span class="line">        to: <span class="built_in">String</span></span><br><span class="line">      &#125;,</span><br><span class="line">      template: <span class="string">'&lt;a :href = "to"&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/a&gt;'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  init() &#123;</span><br><span class="line">    <span class="keyword">this</span>.createRouteMap()</span><br><span class="line">    <span class="keyword">this</span>.initComponents(_Vue)</span><br><span class="line">    <span class="keyword">this</span>.initEvent() <span class="comment">// 详见 19.VueRouter - initEvent</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="16-VueRouter-完整版的-Vue"><a href="#16-VueRouter-完整版的-Vue" class="headerlink" title="16.VueRouter - 完整版的 Vue"></a>16.VueRouter - 完整版的 Vue</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  runtimeCompiler: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="17-VueRouter-render"><a href="#17-VueRouter-render" class="headerlink" title="17.VueRouter - render"></a>17.VueRouter - render</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VueRouter</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  initComponents(Vue) &#123;</span><br><span class="line">    Vue.component(<span class="string">'router-link'</span>, &#123;</span><br><span class="line">      props: &#123;</span><br><span class="line">        to: <span class="built_in">String</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// template: '&lt;a :href = "to"&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/a&gt;'</span></span><br><span class="line">      render(h) &#123;</span><br><span class="line">        <span class="keyword">return</span> h(<span class="string">'a'</span>, &#123;</span><br><span class="line">          attrs: &#123;</span><br><span class="line">            href: <span class="keyword">this</span>.to</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,[<span class="keyword">this</span>.$slots.default])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="18-VueRouter-router-view"><a href="#18-VueRouter-router-view" class="headerlink" title="18.VueRouter - router-view"></a>18.VueRouter - router-view</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VueRouter</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  initComponents(Vue) &#123;</span><br><span class="line">    Vue.component(<span class="string">'router-link'</span>, &#123;</span><br><span class="line">      props: &#123;</span><br><span class="line">        to: <span class="built_in">String</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// template: '&lt;a :href = "to"&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/a&gt;'</span></span><br><span class="line">      render(h) &#123;</span><br><span class="line">        <span class="keyword">return</span> h(<span class="string">'a'</span>, &#123;</span><br><span class="line">          attrs: &#123;</span><br><span class="line">            href: <span class="keyword">this</span>.to</span><br><span class="line">          &#125;,</span><br><span class="line">          on: &#123;</span><br><span class="line">            click: <span class="keyword">this</span>.clickHandler</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,[<span class="keyword">this</span>.$slots.default])</span><br><span class="line">      &#125;,</span><br><span class="line">      methods: &#123;</span><br><span class="line">        clickHandler(e) &#123;</span><br><span class="line">          history.pushState(&#123;&#125;,<span class="string">''</span>,<span class="keyword">this</span>.to)</span><br><span class="line">          <span class="keyword">this</span>.$router.data.current = <span class="keyword">this</span>.to</span><br><span class="line">          e.preventDefault()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> self = <span class="keyword">this</span></span><br><span class="line">    Vue.component(<span class="string">'router-view'</span>, &#123;</span><br><span class="line">      render(h)&#123;</span><br><span class="line">        <span class="keyword">const</span> component = self.routeMap[self.data.current]</span><br><span class="line">        <span class="keyword">return</span> h(component)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="19-VueRouter-initEvent"><a href="#19-VueRouter-initEvent" class="headerlink" title="19.VueRouter - initEvent"></a>19.VueRouter - initEvent</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VueRouter</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  initEvent() &#123;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">'popstate'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="keyword">this</span>.dada.current = <span class="built_in">window</span>.location.pathname</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="任务三：模拟-Vue-js-响应式原理"><a href="#任务三：模拟-Vue-js-响应式原理" class="headerlink" title="任务三：模拟 Vue.js 响应式原理"></a>任务三：模拟 Vue.js 响应式原理</h2><h3 id="1-课程目标"><a href="#1-课程目标" class="headerlink" title="1.课程目标"></a>1.课程目标</h3><ul>
<li>模拟一个最小版本的 Vue</li>
<li>响应式原理在面试的常问问题</li>
<li>学习别人优秀的经验，转换成自己的经验</li>
<li>实际项目中出问题的原理层面的解决<ul>
<li>给 Vue 实例新增一个成员是否是响应式的</li>
<li>给属性重新赋值成对象，是否是响应式的</li>
</ul>
</li>
<li>为学习 Vue 源码做铺垫</li>
</ul>
<h3 id="2-数据驱动"><a href="#2-数据驱动" class="headerlink" title="2.数据驱动"></a>2.数据驱动</h3><ul>
<li><p>准备工作</p>
<ul>
<li>数据驱动</li>
<li>响应式的核心原理</li>
<li>发布订阅模式和观察者模式</li>
</ul>
</li>
<li><p>数据驱动</p>
<ul>
<li>数据响应式、双向绑定、数据驱动</li>
<li>数据响应式<ul>
<li>数据模型仅仅是普通的 JavaScript 对象，而当我们修改数据时，视图会进行更新，避免了繁琐的 DOM 操作，提高开发效率</li>
</ul>
</li>
<li>双向绑定<ul>
<li>数据改变，视图改变；视图改变，数据也随之改变</li>
<li>我们可以使用 v-model 在表单元素上创建双向绑定数据</li>
</ul>
</li>
<li>数据驱动是 Vue 最独特的特性之一<ul>
<li>开发过程中仅需要关注数据本身，不需要关心数据是如何渲染到视图</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="3-数据响应式核心原理-Vue2"><a href="#3-数据响应式核心原理-Vue2" class="headerlink" title="3.数据响应式核心原理 - Vue2"></a>3.数据响应式核心原理 - Vue2</h3><p>略</p>
<h3 id="4-数据响应式核心原理-Vue3"><a href="#4-数据响应式核心原理-Vue3" class="headerlink" title="4.数据响应式核心原理 - Vue3"></a>4.数据响应式核心原理 - Vue3</h3><p>略</p>
<h3 id="5-发布订阅模式"><a href="#5-发布订阅模式" class="headerlink" title="5.发布订阅模式"></a>5.发布订阅模式</h3><ul>
<li><p>发布/订阅模式</p>
<ul>
<li>订阅者</li>
<li>发布者</li>
<li>信号中心</li>
</ul>
</li>
<li><p>我们假定，存在一个“信号中心”，某个任务执行完成，就向信号中心“发布”一个信号，其他任务可以向信号中心“订阅”这个信号，从而知道什么时候自己可以开始执行。这就叫做“发布/订阅模式”</p>
</li>
</ul>
<h3 id="6-观察者模式"><a href="#6-观察者模式" class="headerlink" title="6.观察者模式"></a>6.观察者模式</h3><ul>
<li><p>观察者（订阅者） – Watcher</p>
<ul>
<li>update(): 当事件发生时，具体要做的事情</li>
</ul>
</li>
<li><p>目标（发布者） – Dep</p>
<ul>
<li>subs 数组：存储所有的观察者</li>
<li>addSub()：添加观察者</li>
<li>notify()：当事件发生，调用所有观察者的 update() 方法</li>
</ul>
</li>
<li><p>没有事件中心</p>
</li>
</ul>
<h3 id="7-模拟Vue响应式原理-分析"><a href="#7-模拟Vue响应式原理-分析" class="headerlink" title="7.模拟Vue响应式原理 - 分析"></a>7.模拟Vue响应式原理 - 分析</h3><p>略</p>
<h3 id="8-Vue"><a href="#8-Vue" class="headerlink" title="8.Vue"></a>8.Vue</h3><ul>
<li>功能<ul>
<li>负责接收初始化的参数（选项）</li>
<li>负责把data中的属性注入到Vue实例，转换成getter/setter</li>
<li>负责调用 observer 监听 data 中所有属性的变化</li>
<li>负责调用complier解析指令/差值表达式</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">  contructor(option) &#123;</span><br><span class="line">    <span class="comment">// 1.通过属性保存选项的数据</span></span><br><span class="line">    <span class="keyword">this</span>.$options = options || &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.$data = options.data || &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.$el = <span class="keyword">typeof</span> options.el === <span class="string">'string'</span> ? <span class="built_in">document</span>.querySelector(options.el):options.el</span><br><span class="line">    <span class="comment">// 2.把data中的成员转换成getter和setter，注入到vue实例中</span></span><br><span class="line">    <span class="keyword">this</span>.proxyData(<span class="keyword">this</span>.$data)</span><br><span class="line">    <span class="comment">// 3.调用observer对象，监听数据的变化</span></span><br><span class="line">    <span class="comment">// 4.调用compiler对象，解析指令和差值表达式</span></span><br><span class="line">  &#125;</span><br><span class="line">  _proxyData(data) &#123;</span><br><span class="line">    <span class="comment">// 遍历data中的所有属性</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 把data的属性注入到vue实例中</span></span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>, key, &#123;</span><br><span class="line">        enumerable: <span class="literal">true</span>,</span><br><span class="line">        configurable: <span class="literal">true</span>,</span><br><span class="line">        <span class="keyword">get</span>()&#123;</span><br><span class="line">          <span class="keyword">return</span> data[key]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">set</span>(newValue) &#123;</span><br><span class="line">          <span class="keyword">if</span>(newValue === data[key]) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          data[key] = newValue</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-Observer"><a href="#9-Observer" class="headerlink" title="9.Observer"></a>9.Observer</h3><ul>
<li>功能<ul>
<li>负责把data选项中的属性转换成响应式数据</li>
<li>data 中的某个属性也是对象，把该属性转换成响应式数据</li>
<li>数据变化发送通知</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">  contructor(option) &#123;</span><br><span class="line">    <span class="comment">// 1.通过属性保存选项的数据</span></span><br><span class="line">    <span class="keyword">this</span>.$options = options || &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.$data = options.data || &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.$el = <span class="keyword">typeof</span> options.el === <span class="string">'string'</span> ? <span class="built_in">document</span>.querySelector(options.el):options.el</span><br><span class="line">    <span class="comment">// 2.把data中的成员转换成getter和setter，注入到vue实例中</span></span><br><span class="line">    <span class="keyword">this</span>.proxyData(<span class="keyword">this</span>.$data)</span><br><span class="line">    <span class="comment">// 3.调用observer对象，监听数据的变化</span></span><br><span class="line">    <span class="keyword">new</span> Observer(<span class="keyword">this</span>.$data)</span><br><span class="line">    <span class="comment">// 4.调用compiler对象，解析指令和差值表达式</span></span><br><span class="line">  &#125;</span><br><span class="line">  _proxyData(data) &#123;</span><br><span class="line">    <span class="comment">// 遍历data中的所有属性</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 把data的属性注入到vue实例中</span></span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>, key, &#123;</span><br><span class="line">        enumerable: <span class="literal">true</span>,</span><br><span class="line">        configurable: <span class="literal">true</span>,</span><br><span class="line">        <span class="keyword">get</span>()&#123;</span><br><span class="line">          <span class="keyword">return</span> data[key]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">set</span>(newValue) &#123;</span><br><span class="line">          <span class="keyword">if</span>(newValue === data[key]) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          data[key] = newValue</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// observer.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  constuctor(data)&#123;</span><br><span class="line">    <span class="keyword">this</span>.walk(data)</span><br><span class="line">  &#125;</span><br><span class="line">  walk (data) &#123;</span><br><span class="line">    <span class="comment">// 1.判断data是否是对象</span></span><br><span class="line">    <span class="keyword">if</span>(!data || <span class="keyword">typeof</span> data !== <span class="string">'object'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.遍历data对象的所有属性</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.defineReactive(data, key, data[key])</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  defineReactive(obj, key, val) &#123;</span><br><span class="line">    <span class="keyword">let</span> that = <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">this</span>.walk(val) <span class="comment">// @ 11.Observer - defineReactive2</span></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">      enumerable: <span class="literal">true</span>,</span><br><span class="line">      configurable: <span class="literal">true</span>,</span><br><span class="line">      <span class="keyword">get</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="keyword">set</span>(newValue) &#123;</span><br><span class="line">        <span class="keyword">if</span>(newValue === val) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        val = newValue</span><br><span class="line">        that.walk(newValue) <span class="comment">// @ 11.Observer - defineReactive2</span></span><br><span class="line">        <span class="comment">// 发送通知</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-Observer-defineReactive1"><a href="#10-Observer-defineReactive1" class="headerlink" title="10.Observer - defineReactive1"></a>10.Observer - defineReactive1</h3><p>略</p>
<h3 id="11-Observer-defineReactive2"><a href="#11-Observer-defineReactive2" class="headerlink" title="11.Observer - defineReactive2"></a>11.Observer - defineReactive2</h3><p>略</p>
<h3 id="12-Compiler"><a href="#12-Compiler" class="headerlink" title="12.Compiler"></a>12.Compiler</h3><ul>
<li><p>功能</p>
<ul>
<li>负责编译模板，解析指令/插值表达式</li>
<li>负责页面的首次渲染</li>
<li>当数据变化后重新渲染视图</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// compiler.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (vm) &#123;</span><br><span class="line">     <span class="keyword">this</span>.el = vm.$el</span><br><span class="line">     <span class="keyword">this</span>.vm = vm</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 编译模板，处理文本节点和元素节点</span></span><br><span class="line">  compile(el) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 编译元素节点，处理指令</span></span><br><span class="line">  compileElement(node)&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 编译文本节点，处理差值表达式</span></span><br><span class="line">  compileText(node) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断元素属性是否是指令</span></span><br><span class="line">  isDirective(attrName) &#123;</span><br><span class="line">    <span class="keyword">return</span> attrName.startsWith(<span class="string">'v-'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断节点是否是文本节点</span></span><br><span class="line">  isTextNode(node) &#123;</span><br><span class="line">    <span class="keyword">return</span> node.nodeType === <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断节点是否是元素节点</span></span><br><span class="line">  isElementNode(node) &#123;</span><br><span class="line">    <span class="keyword">return</span> node.nodeType === <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-Compiler-compile"><a href="#13-Compiler-compile" class="headerlink" title="13.Compiler - compile"></a>13.Compiler - compile</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// compiler.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (vm) &#123;</span><br><span class="line">     <span class="keyword">this</span>.el = vm.$el</span><br><span class="line">     <span class="keyword">this</span>.vm = vm</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 编译模板，处理文本节点和元素节点</span></span><br><span class="line">  compile(el) &#123;</span><br><span class="line">    <span class="keyword">let</span> childNodes = el.childNodes</span><br><span class="line">    <span class="built_in">Array</span>.from(childNodes).forEach(<span class="function"><span class="params">node</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 处理文本节点</span></span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">this</span>.isTextNode(node)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.compileText(node)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.isElementNode(node)) &#123;</span><br><span class="line">        <span class="comment">// 处理元素节点</span></span><br><span class="line">        <span class="keyword">this</span>.compileElement(node)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 判断node节点，是否有子节点，如果子节点，要递归调用compile</span></span><br><span class="line">      <span class="keyword">if</span>(node.childNodes &amp;&amp; node.childNodes.length) &#123;</span><br><span class="line">        <span class="keyword">this</span>.compile(node)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-Compiler-compileText"><a href="#14-Compiler-compileText" class="headerlink" title="14.Compiler - compileText"></a>14.Compiler - compileText</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">  contructor(option) &#123;</span><br><span class="line">    <span class="comment">// 1.通过属性保存选项的数据</span></span><br><span class="line">    <span class="keyword">this</span>.$options = options || &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.$data = options.data || &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.$el = <span class="keyword">typeof</span> options.el === <span class="string">'string'</span> ? <span class="built_in">document</span>.querySelector(options.el):options.el</span><br><span class="line">    <span class="comment">// 2.把data中的成员转换成getter和setter，注入到vue实例中</span></span><br><span class="line">    <span class="keyword">this</span>.proxyData(<span class="keyword">this</span>.$data)</span><br><span class="line">    <span class="comment">// 3.调用observer对象，监听数据的变化</span></span><br><span class="line">    <span class="keyword">new</span> Observer(<span class="keyword">this</span>.$data)</span><br><span class="line">    <span class="comment">// 4.调用compiler对象，解析指令和差值表达式</span></span><br><span class="line">    <span class="keyword">new</span> Compiler(<span class="keyword">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  _proxyData(data) &#123;</span><br><span class="line">    <span class="comment">// 遍历data中的所有属性</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 把data的属性注入到vue实例中</span></span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>, key, &#123;</span><br><span class="line">        enumerable: <span class="literal">true</span>,</span><br><span class="line">        configurable: <span class="literal">true</span>,</span><br><span class="line">        <span class="keyword">get</span>()&#123;</span><br><span class="line">          <span class="keyword">return</span> data[key]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">set</span>(newValue) &#123;</span><br><span class="line">          <span class="keyword">if</span>(newValue === data[key]) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          data[key] = newValue</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// compiler.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (vm) &#123;</span><br><span class="line">    <span class="keyword">this</span>.el = vm.$el</span><br><span class="line">    <span class="keyword">this</span>.vm = vm</span><br><span class="line">    <span class="keyword">this</span>.compile(<span class="keyword">this</span>.el)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 编译模板，处理文本节点和元素节点</span></span><br><span class="line">  compile(el) &#123;</span><br><span class="line">    <span class="keyword">let</span> childNodes = el.childNodes</span><br><span class="line">    <span class="built_in">Array</span>.from(childNodes).forEach(<span class="function"><span class="params">node</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 处理文本节点</span></span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">this</span>.isTextNode(node)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.compileText(node)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.isElementNode(node)) &#123;</span><br><span class="line">        <span class="comment">// 处理元素节点</span></span><br><span class="line">        <span class="keyword">this</span>.compileElement(node)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 判断node节点，是否有子节点，如果子节点，要递归调用compile</span></span><br><span class="line">      <span class="keyword">if</span>(node.childNodes &amp;&amp; node.childNodes.length) &#123;</span><br><span class="line">        <span class="keyword">this</span>.compile(node)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 编译文本节点，处理差值表达式</span></span><br><span class="line">  compileText(node) &#123;</span><br><span class="line">    <span class="keyword">let</span> reg = <span class="regexp">/\&#123;\&#123;(.+?)\&#125;\&#125;/</span></span><br><span class="line">    <span class="keyword">let</span> value = node.textContent</span><br><span class="line">    <span class="keyword">if</span>(reg.test(value))&#123;</span><br><span class="line">      <span class="keyword">let</span> key = <span class="built_in">RegExp</span>.$<span class="number">1.</span>trim()</span><br><span class="line">      node.textContent = value.replace(reg, <span class="keyword">this</span>.vm[key])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="15-Compiler-compileElement"><a href="#15-Compiler-compileElement" class="headerlink" title="15.Compiler - compileElement"></a>15.Compiler - compileElement</h3>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// compiler.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (vm) &#123;</span><br><span class="line">    <span class="keyword">this</span>.el = vm.$el</span><br><span class="line">    <span class="keyword">this</span>.vm = vm</span><br><span class="line">    <span class="keyword">this</span>.compile(<span class="keyword">this</span>.el)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 编译模板，处理文本节点和元素节点</span></span><br><span class="line">  compile(el) &#123;</span><br><span class="line">    <span class="keyword">let</span> childNodes = el.childNodes</span><br><span class="line">    <span class="built_in">Array</span>.from(childNodes).forEach(<span class="function"><span class="params">node</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 处理文本节点</span></span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">this</span>.isTextNode(node)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.compileText(node)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.isElementNode(node)) &#123;</span><br><span class="line">        <span class="comment">// 处理元素节点</span></span><br><span class="line">        <span class="keyword">this</span>.compileElement(node)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 判断node节点，是否有子节点，如果子节点，要递归调用compile</span></span><br><span class="line">      <span class="keyword">if</span>(node.childNodes &amp;&amp; node.childNodes.length) &#123;</span><br><span class="line">        <span class="keyword">this</span>.compile(node)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 编译元素节点，处理指令</span></span><br><span class="line">  compileElement(node) &#123;</span><br><span class="line">    <span class="comment">// 遍历所有的属性节点</span></span><br><span class="line">    <span class="built_in">Array</span>.from(node.attributes).forEach(<span class="function"><span class="params">attr</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 判断是否是指令</span></span><br><span class="line">      <span class="keyword">let</span> attrName = attr.name</span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">this</span>.isDirective(attrName)) &#123;</span><br><span class="line">        attrName = attrName.substr(<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">let</span> key = attr.value</span><br><span class="line">        <span class="keyword">this</span>.update(node,key,attrName)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  update(node,key,attrName) &#123;</span><br><span class="line">    <span class="keyword">let</span> updateFn = <span class="keyword">this</span>[attrName + <span class="string">'Updater'</span>]</span><br><span class="line">    updateFn &amp;&amp; updateFn(node, <span class="keyword">this</span>.vm[key])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 处理v-text指令</span></span><br><span class="line">  textUpdater(node, value) &#123;</span><br><span class="line">    node.textContent = value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// v-model</span></span><br><span class="line">  modelUpdater(node, value) &#123;</span><br><span class="line">    node.value = value</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="16-Compiler复习"><a href="#16-Compiler复习" class="headerlink" title="16.Compiler复习"></a>16.Compiler复习</h3><p>略</p>
<h3 id="17-Dep"><a href="#17-Dep" class="headerlink" title="17.Dep"></a>17.Dep</h3><ul>
<li>功能<ul>
<li>收集依赖，添加观察者（watcher）</li>
<li>通知所有观察者</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// observer.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  constuctor(data)&#123;</span><br><span class="line">    <span class="keyword">this</span>.walk(data)</span><br><span class="line">  &#125;</span><br><span class="line">  walk (data) &#123;</span><br><span class="line">    <span class="comment">// 1.判断data是否是对象</span></span><br><span class="line">    <span class="keyword">if</span>(!data || <span class="keyword">typeof</span> data !== <span class="string">'object'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2.遍历data对象的所有属性</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.defineReactive(data, key, data[key])</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  defineReactive(obj, key, val) &#123;</span><br><span class="line">    <span class="keyword">let</span> that = <span class="keyword">this</span></span><br><span class="line">    <span class="comment">// 负责收集依赖，并发送通知</span></span><br><span class="line">    <span class="keyword">let</span> dep = <span class="keyword">new</span> Dep()</span><br><span class="line">    <span class="comment">// 如果val是对象，把val内部的属性转换成响应式数据</span></span><br><span class="line">    <span class="keyword">this</span>.walk(val) <span class="comment">// @ 11.Observer - defineReactive2</span></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">      enumerable: <span class="literal">true</span>,</span><br><span class="line">      configurable: <span class="literal">true</span>,</span><br><span class="line">      <span class="keyword">get</span>() &#123;</span><br><span class="line">        Dep.target &amp;&amp; dep.addSub(Dep.target)</span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="keyword">set</span>(newValue) &#123;</span><br><span class="line">        <span class="keyword">if</span>(newValue === val) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        val = newValue</span><br><span class="line">        that.walk(newValue) <span class="comment">// @ 11.Observer - defineReactive2</span></span><br><span class="line">        <span class="comment">// 发送通知</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// dep.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dep</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="comment">// 存储所有的观察者</span></span><br><span class="line">    <span class="keyword">this</span>.subs = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 添加观察者</span></span><br><span class="line">  addSub(sub)&#123;</span><br><span class="line">    <span class="keyword">if</span>(sub &amp;&amp; sub.update) &#123;</span><br><span class="line">      <span class="keyword">this</span>.subs.push(sub)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 发出通知</span></span><br><span class="line">  notify() &#123;</span><br><span class="line">    <span class="keyword">this</span>.subs.forEach(<span class="function"><span class="params">sub</span> =&gt;</span> &#123;</span><br><span class="line">      sub.update()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="18-Wathcer"><a href="#18-Wathcer" class="headerlink" title="18.Wathcer"></a>18.Wathcer</h3><ul>
<li>功能<ul>
<li>当数据变化触发依赖，dep 通知所有的 Wachter 实例更新视图</li>
<li>自身实例化的时候往dep对象中添加自己</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// watcher.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (vm, key, cb) &#123;</span><br><span class="line">    <span class="keyword">this</span>.vm = vm</span><br><span class="line">    <span class="comment">// data中的属性名称</span></span><br><span class="line">    <span class="keyword">this</span>.key = key</span><br><span class="line">    <span class="comment">// 回调函数负责更新视图</span></span><br><span class="line">    <span class="keyword">this</span>.cb = cb</span><br><span class="line">    <span class="comment">// 把watcher对象记录到Dep类的静态属性target</span></span><br><span class="line">    Dep.target = <span class="keyword">this</span></span><br><span class="line">    <span class="comment">// 触发get方法，在get方法中会调用addSub</span></span><br><span class="line">    <span class="keyword">this</span>.oldValue = vm[key]</span><br><span class="line">    Dep.target = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 当数据变化的时候更新视图</span></span><br><span class="line">  update() &#123;</span><br><span class="line">    <span class="keyword">let</span> newValue = <span class="keyword">this</span>.vm[<span class="keyword">this</span>.key]</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.oldValue === newValue) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.cb(newValue)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="19-创建Wathcer对象1"><a href="#19-创建Wathcer对象1" class="headerlink" title="19.创建Wathcer对象1"></a>19.创建Wathcer对象1</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// compiler.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// 编译文本节点，处理差值表达式</span></span><br><span class="line">  compileText(node) &#123;</span><br><span class="line">    <span class="keyword">let</span> reg = <span class="regexp">/\&#123;\&#123;(.+?)\&#125;\&#125;/</span></span><br><span class="line">    <span class="keyword">let</span> value = node.textContent</span><br><span class="line">    <span class="keyword">if</span>(reg.test(value))&#123;</span><br><span class="line">      <span class="keyword">let</span> key = <span class="built_in">RegExp</span>.$<span class="number">1.</span>trim()</span><br><span class="line">      node.textContent = value.replace(reg, <span class="keyword">this</span>.vm[key])</span><br><span class="line">      <span class="comment">// 创建watcher对象，当数据改变更新视图</span></span><br><span class="line">      <span class="keyword">new</span> Wathcer(<span class="keyword">this</span>.vm, key, (newValue) =&gt; &#123;</span><br><span class="line">         node.textContent = newValue</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="20-创建Wathcer对象2"><a href="#20-创建Wathcer对象2" class="headerlink" title="20.创建Wathcer对象2"></a>20.创建Wathcer对象2</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// compiler.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  update(node,key,attrName) &#123;</span><br><span class="line">    <span class="keyword">let</span> updateFn = <span class="keyword">this</span>[attrName + <span class="string">'Updater'</span>]</span><br><span class="line">    updateFn &amp;&amp; updateFn.call(<span class="keyword">this</span>, node, <span class="keyword">this</span>.vm[key], key)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 处理v-text指令</span></span><br><span class="line">  textUpdater(node, value, key) &#123;</span><br><span class="line">    node.textContent = value</span><br><span class="line">    <span class="keyword">new</span> Wathcer(<span class="keyword">this</span>.vm, key, (newValue) =&gt; &#123;</span><br><span class="line">      node.textContent = newValue</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  modelUpdater(node, value, key) &#123;</span><br><span class="line">    node.value = value</span><br><span class="line">    <span class="keyword">new</span> Wathcer(<span class="keyword">this</span>.vm, key, (newValue) =&gt; &#123;</span><br><span class="line">      node.value = newValue</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="21-双向绑定"><a href="#21-双向绑定" class="headerlink" title="21.双向绑定"></a>21.双向绑定</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// compiler.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  modelUpdater(node, value, key) &#123;</span><br><span class="line">    node.value = value</span><br><span class="line">    <span class="keyword">new</span> Wathcer(<span class="keyword">this</span>.vm, key, (newValue) =&gt; &#123;</span><br><span class="line">      node.value = newValue</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 双向绑定</span></span><br><span class="line">    node.addEventListener(<span class="string">'input'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="keyword">this</span>.vm[key] = node.value</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="22-调试-首次渲染"><a href="#22-调试-首次渲染" class="headerlink" title="22.调试-首次渲染"></a>22.调试-首次渲染</h3><ul>
<li>通过调试加深对代码的理解<ul>
<li>1.调试页面首次渲染的过程</li>
<li>2.调试数据改变更新视图的过程</li>
</ul>
</li>
</ul>
<h3 id="23-数据改变"><a href="#23-数据改变" class="headerlink" title="23.数据改变"></a>23.数据改变</h3><p>略</p>
<h3 id="24-总结-问题"><a href="#24-总结-问题" class="headerlink" title="24.总结-问题"></a>24.总结-问题</h3><ul>
<li>问题<ul>
<li>给属性重新赋值成对象，是否是响应式的？</li>
<li>给Vue实例新增一个成员是否是响应式的？</li>
</ul>
</li>
</ul>
<h3 id="25-总结-整体流程"><a href="#25-总结-整体流程" class="headerlink" title="25.总结-整体流程"></a>25.总结-整体流程</h3><p>略</p>
<h2 id="任务四：Virtual-DOM-的实现原理"><a href="#任务四：Virtual-DOM-的实现原理" class="headerlink" title="任务四：Virtual DOM 的实现原理"></a>任务四：Virtual DOM 的实现原理</h2><h3 id="1-课程目标-1"><a href="#1-课程目标-1" class="headerlink" title="1.课程目标"></a>1.课程目标</h3><ul>
<li>了解什么是虚拟DOM，以及虚拟DOM的作用</li>
<li>Snabbdom 的基本使用</li>
<li>Snabbdom 的源码解析</li>
</ul>
<h3 id="2-什么是虚拟DOM"><a href="#2-什么是虚拟DOM" class="headerlink" title="2.什么是虚拟DOM"></a>2.什么是虚拟DOM</h3><ul>
<li>Virtual DOM（虚拟 DOM），是由普通的 JS 对象来描述 DOM 对象，因为不是真实的 DOM 对象，所以叫 Virtual DOM</li>
</ul>
<h3 id="3-为什么使用虚拟DOM"><a href="#3-为什么使用虚拟DOM" class="headerlink" title="3.为什么使用虚拟DOM"></a>3.为什么使用虚拟DOM</h3><ul>
<li>手动操作 DOM 比较麻烦，还需要考虑浏览器兼容性问题，虽然有 jQuery 等库简化 DOM 操作，但是随着项目的复杂 DOM 操作复杂提升</li>
<li>为了简化 DOM 的复杂操作于是出现了各种 MVVM 框架，MVVM 框架解决了视图和状态的同步问题</li>
<li>为了简化视图的操作我们可以使用模板引擎，但是模板引擎没有解决跟踪状态变化的问题，于是 Virtual DOM 出现了</li>
<li>Virtual DOM 的好处是当状态改变时不需要立即更新 DOM，只需要创建一个虚拟树来描述 DOM，Virtual DOM 内部将弄清楚如何有效（diff）的更新 DOM</li>
<li>参考 github 上 virtual-dom 的描述<ul>
<li>虚拟 DOM 可以维护程序的状态，跟踪上一次的状态</li>
<li>通过比较前后两次状态的差异更新真实 DOM</li>
</ul>
</li>
</ul>
<h3 id="4-虚拟DOM的作用和虚拟DOM库"><a href="#4-虚拟DOM的作用和虚拟DOM库" class="headerlink" title="4.虚拟DOM的作用和虚拟DOM库"></a>4.虚拟DOM的作用和虚拟DOM库</h3><ul>
<li><p>虚拟 DOM 的作用</p>
<ul>
<li>维护视图和状态的关系</li>
<li>复杂视图情况下提升渲染性能</li>
<li>除了渲染 DOM 外，还可以实现 SSR（Nuxt.js/Next.js）、原生应用（Weex/React Native）、小程序（mpvue/uni-app）等</li>
</ul>
</li>
<li><p>Virtual DOM 库</p>
<ul>
<li>Snabbdom</li>
<li>virtual-dom</li>
</ul>
</li>
</ul>
<h3 id="5-创建项目"><a href="#5-创建项目" class="headerlink" title="5.创建项目"></a>5.创建项目</h3><ul>
<li><p>创建项目</p>
<ul>
<li>打包工具为了方便使用 parcel</li>
<li>创建项目，并安装 parcel</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 创建项目目录</span><br><span class="line">md snabbdom-demo</span><br><span class="line"># 进入项目目录</span><br><span class="line">cd snabbdom-demo</span><br><span class="line"># 创建 package.json</span><br><span class="line">yarn init -y</span><br><span class="line"># 本地安装 parcel</span><br><span class="line">yarn add parcel-bundler</span><br></pre></td></tr></table></figure>
<ul>
<li>配置 package.json 的 scripts</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"dev"</span>: <span class="string">"parcel index.html --open"</span>,</span><br><span class="line">  <span class="string">"build"</span>: <span class="string">"parcel build index.html"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>创建目录结构</li>
</ul>
<p>|  index.html<br>|  package.json<br>|_ src<br>   01-basicusage.js</p>
</li>
</ul>
<h3 id="6-导入-Snabbdom"><a href="#6-导入-Snabbdom" class="headerlink" title="6.导入 Snabbdom"></a>6.导入 Snabbdom</h3><blockquote>
<p>Snabbdom 文档</p>
</blockquote>
<ul>
<li><p>看文档的意义</p>
<ul>
<li>学习任何一个库都要先看文档</li>
<li>通过文档了解库的作用</li>
<li>看文档中提供的实例，自己快速实现一个 demo</li>
<li>通过文档查看 API 的使用</li>
</ul>
</li>
<li><p>文档地址</p>
<ul>
<li><a href="https://github.com/snabbdom/snabbdom" target="_blank" rel="noopener">https://github.com/snabbdom/snabbdom</a></li>
<li>中文翻译</li>
</ul>
</li>
</ul>
<blockquote>
<p>安装 Snabbdom</p>
</blockquote>
<ul>
<li>安装 Snabbdom<ul>
<li>yarn add snabbdom</li>
</ul>
</li>
</ul>
<blockquote>
<p>导入 Snabbdom</p>
</blockquote>
<ul>
<li>Snabbdom 的官网 demo 中导入使用的是 commonjs 模块化语法，我们使用更流行的 ES6 模块化的语法 import</li>
<li>关于模块化的语法请参考阮一峰老师的 Module 的语法</li>
<li>ES6 模块与 CommonJs 模块的差异</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; init, h, thunk &#125; <span class="keyword">from</span> <span class="string">'snabbdom'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Snabbdom 的核心仅提供最基本的功能，只导出了三个函数 init()、h()、thunk()<ul>
<li>init() 是一个高阶函数，返回 patch()</li>
<li>h() 返回虚拟节点 VNode，这个函数我们在使用 Vue.js 的时候见过</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;).$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>thunk() 是一种优化策略，可以在处理不可变数据时使用</li>
</ul>
<ul>
<li><strong>注意</strong>：导入的时候不能使用 import snabbdom form ‘snabbdom’<ul>
<li>原因：mode_modules/src/snabbdom.js 末尾导出使用的语法是 export 导出 API，没有使用 export default 导出默认输出</li>
</ul>
</li>
</ul>
<h3 id="7-代码演示"><a href="#7-代码演示" class="headerlink" title="7.代码演示"></a>7.代码演示</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 01-basicusage.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; h, init &#125; <span class="keyword">from</span> <span class="string">'snabbdom'</span></span><br><span class="line"><span class="comment">// 1.hello world</span></span><br><span class="line"><span class="comment">// 参数：数组，模块</span></span><br><span class="line"><span class="comment">// 返回值：patch 函数，作用对比两个vnode的差异更新到真实DOM</span></span><br><span class="line"><span class="keyword">let</span> patch = init([])</span><br><span class="line"><span class="comment">// 第一个参数：标签 + 选择器</span></span><br><span class="line"><span class="comment">// 第二个参数：如果是字符串的话就是标签中的内容</span></span><br><span class="line"><span class="keyword">let</span> vnode = h(<span class="string">'div#container.cls'</span>, <span class="string">'Hello World'</span>)</span><br><span class="line"><span class="keyword">let</span> app = <span class="built_in">document</span>.querySelector(<span class="string">'#app'</span>)</span><br><span class="line"><span class="comment">// 第一个参数：可以是DOM元素，内部会把DOM元素转换成VNode</span></span><br><span class="line"><span class="comment">// 第二个参数： VNode</span></span><br><span class="line"><span class="comment">// 返回值：VNode</span></span><br><span class="line"><span class="keyword">let</span> oldVnode = patch(app, vnode)</span><br><span class="line"><span class="comment">// 假设的时刻</span></span><br><span class="line">vnode = h(<span class="string">'div'</span>, <span class="string">'Hello Snabbdom'</span>)</span><br><span class="line">patch(oldVnode, vnode)</span><br><span class="line"><span class="comment">// 02-basicusage.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; h, init &#125; <span class="keyword">from</span> <span class="string">'snabbdom'</span></span><br><span class="line"><span class="keyword">let</span> patch = init([])</span><br><span class="line"><span class="keyword">let</span> vnode = h(<span class="string">'div#container'</span>,[</span><br><span class="line">  h(<span class="string">'h1'</span>, <span class="string">'Hello Snabbdom'</span>),</span><br><span class="line">  h(<span class="string">'p'</span>, <span class="string">'这是一个p标签'</span>)</span><br><span class="line">])</span><br><span class="line"><span class="keyword">let</span> app = <span class="built_in">document</span>.querySelector(<span class="string">'#app'</span>)</span><br><span class="line"><span class="keyword">let</span> oldVnode = patch(app, vnode)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  vnode = h(<span class="string">'div#container'</span>,[</span><br><span class="line">    h(<span class="string">'h1'</span>, <span class="string">'Hello World'</span>),</span><br><span class="line">    h(<span class="string">'p'</span>, <span class="string">'Hello p'</span>)</span><br><span class="line">  ])</span><br><span class="line">  patch(oldVnode, vnode)</span><br><span class="line">  <span class="comment">// 清空页面元素 -- 错误</span></span><br><span class="line">  <span class="comment">// patch(oldVnode, null)</span></span><br><span class="line">  patch(oldVnode, h(<span class="string">'!'</span>))</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure>

<h3 id="8-模块"><a href="#8-模块" class="headerlink" title="8.模块"></a>8.模块</h3><blockquote>
<p>模块</p>
</blockquote>
<p>Snabbdom 的核心库并不能处理元素的属性/样式/事件等，如果需要处理的话，可以使用模块</p>
<blockquote>
<p>常用模块</p>
</blockquote>
<ul>
<li><p>官方提供了6个模块</p>
<ul>
<li>attributes<ul>
<li>设置 DOM 元素的属性，使用 setAttributes()</li>
<li>处理布尔类型的属性</li>
</ul>
</li>
<li>props<ul>
<li>和 attributes 模块相似，设置DOM元素的属性 element[attr] = value</li>
<li>不处理布尔类型的属性</li>
</ul>
</li>
<li>class<ul>
<li>切换类样式</li>
<li>注意：给元素设置类样式是通过 sel 选择器</li>
</ul>
</li>
<li>dataset<ul>
<li>设置 data-* 的自定义属性</li>
</ul>
</li>
<li>eventlisteners<ul>
<li>注册和移除事件<br>style</li>
<li>设置行内样式，支持动画</li>
<li>delayed/remove/destroy<blockquote>
<p>模块使用</p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
<li><p>模块的使用步骤</p>
<ul>
<li>导入需要的模块</li>
<li>init() 中注册模块</li>
<li>使用 h() 函数创建 VNode 的时候，可以把第二个参数设置为对象，其他参数往后移</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; init, h &#125; <span class="keyword">from</span> <span class="string">'sanbbdom'</span></span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">'snabbdom/modules/style'</span></span><br><span class="line"><span class="keyword">import</span> eventlisteners <span class="keyword">from</span> <span class="string">'snabbdom/modules/eventlisteners'</span></span><br><span class="line"><span class="comment">// 注册模块</span></span><br><span class="line"><span class="keyword">let</span> patch = init([</span><br><span class="line">  style,</span><br><span class="line">  eventlisteners</span><br><span class="line">])</span><br><span class="line"><span class="comment">// 使用 h() 函数的第二个参数传入模块需要的数据</span></span><br><span class="line"><span class="keyword">let</span> vnode = h(<span class="string">'div'</span>, &#123;</span><br><span class="line">  style: &#123;</span><br><span class="line">    backgroundColor: <span class="string">'red'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  on: &#123;</span><br><span class="line">    click: eventHandler</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,[</span><br><span class="line">  h(<span class="string">'h1'</span>, <span class="string">'Hello Snabbdom'</span>),</span><br><span class="line">  h(<span class="string">'p'</span>, <span class="string">'这是p标签'</span>)</span><br><span class="line">])</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">eventHandler</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'点击我了'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> app = <span class="built_in">document</span>.querySlector(<span class="string">'#app'</span>)</span><br><span class="line">patch(app, vnode)</span><br></pre></td></tr></table></figure>

<h3 id="9-Snabbdom-源码解析"><a href="#9-Snabbdom-源码解析" class="headerlink" title="9.Snabbdom 源码解析"></a>9.Snabbdom 源码解析</h3><blockquote>
<p>如何学习源码</p>
</blockquote>
<ul>
<li>先宏观了解</li>
<li>带着目标看源码</li>
<li>看源码的过程要不求甚解</li>
<li>调试</li>
<li>参考资料</li>
</ul>
<blockquote>
<p>Snabbdom 的核心</p>
</blockquote>
<ul>
<li>使用 h() 函数创建 JavaScript 对象(VNode)描述真实 DOM</li>
<li>init() 设置模块，创建 patch()</li>
<li>patch() 比较新旧两个 VNode</li>
<li>把变化的内容更新到真实的 DOM 树上</li>
</ul>
<blockquote>
<p>Snabbdom 源码</p>
</blockquote>
<ul>
<li>源码地址<ul>
<li><a href="https://github.com/snabbdom/snabbdom" target="_blank" rel="noopener">https://github.com/snabbdom/snabbdom</a></li>
</ul>
</li>
</ul>
<h3 id="10-h函数"><a href="#10-h函数" class="headerlink" title="10.h函数"></a>10.h函数</h3><ul>
<li><p>h() 函数介绍</p>
<ul>
<li>在使用 Vue 的时候见过 h() 函数<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;).$mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure></li>
<li>h() 函数最早见于 hyperscript,使用 JavaScript 创建超文本</li>
<li>Snabbdom 中的 h() 函数不是用来创建超文本，而是创建 VNode</li>
</ul>
</li>
<li><p>函数重载</p>
<ul>
<li>概念<ul>
<li>参数个数或类型不同的函数</li>
<li>JavaScript 中没有重载的概念</li>
<li>TypeScript 中有重载，不过重载的实现还是通过代码调整参数</li>
</ul>
</li>
<li>重载的示意<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a + b)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(a + b + c)</span><br><span class="line">&#125;</span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>， <span class="number">3</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>源码位置：src/h.ts</p>
</li>
</ul>
<h3 id="11-必备快捷键"><a href="#11-必备快捷键" class="headerlink" title="11.必备快捷键"></a>11.必备快捷键</h3><ul>
<li>F12 快速定位 或 Ctrl + 鼠标点击</li>
<li>Alt + &lt;—— 返回</li>
</ul>
<h3 id="12-vnode"><a href="#12-vnode" class="headerlink" title="12.vnode"></a>12.vnode</h3><p>略</p>
<h3 id="13-patch-的整体过程"><a href="#13-patch-的整体过程" class="headerlink" title="13.patch 的整体过程"></a>13.patch 的整体过程</h3><ul>
<li>patch(oldVnode, newVnode)</li>
<li>打补丁，把新节点中变化的内容渲染到真实 DOM，最后返回新节点作为下一次处理的旧节点</li>
<li>对比新旧 VNode 是否相同节点（节点的 key 和 sel 相同）</li>
<li>如果不是相同节点，删除之前的内容，重新渲染</li>
<li>如果是相同节点，再判断薪的VNode是否有 text，如果有并且 oldnode 的 text 不同，直接更新文本内容</li>
<li>如果新的 VNode 有 children，判断子节点是否有变化，判断子节点的过程使用的就是 diff 算法</li>
<li>diff 过程只进行同层级比较</li>
</ul>
<h3 id="14-init"><a href="#14-init" class="headerlink" title="14.init"></a>14.init</h3><p>略</p>
<h3 id="15-patch"><a href="#15-patch" class="headerlink" title="15.patch"></a>15.patch</h3><p>略</p>
<h3 id="16-调试-patch"><a href="#16-调试-patch" class="headerlink" title="16.调试 patch"></a>16.调试 patch</h3><p>略</p>
<h3 id="17-createElm"><a href="#17-createElm" class="headerlink" title="17.createElm"></a>17.createElm</h3><p>略</p>
<h3 id="18-createElm-调试"><a href="#18-createElm-调试" class="headerlink" title="18.createElm 调试"></a>18.createElm 调试</h3><p>略</p>
<h3 id="19-addVnodes-和-removeVnodes"><a href="#19-addVnodes-和-removeVnodes" class="headerlink" title="19.addVnodes 和 removeVnodes"></a>19.addVnodes 和 removeVnodes</h3><p>略</p>
<h3 id="20-patchVnode"><a href="#20-patchVnode" class="headerlink" title="20.patchVnode"></a>20.patchVnode</h3><p>略</p>
<h3 id="21-updateChildren-整体分析"><a href="#21-updateChildren-整体分析" class="headerlink" title="21.updateChildren 整体分析"></a>21.updateChildren 整体分析</h3><ul>
<li><p>功能</p>
<ul>
<li>diff 算法的核心，对比新旧节点的 children，更新 DOM</li>
</ul>
</li>
<li><p>执行过程</p>
<ul>
<li>要对比两棵树的差异，我们可以取第一棵树的每一个节点依次和第二棵树的每一个节点比较，但是这样的时间复杂度为O(n^3)</li>
<li>在 DOM 操作的时候我们很少很少会把一个父节点移动/更新到某一个子节点</li>
<li>因此只需要找同级别的子节点依次比较，然后再找下一级别的节点比较，这样算法的时间复杂度为O(n)</li>
<li>在进行同级别节点比较的时候，首先会对新老节点数组的开始和结尾节点设置标记索引，遍历的过程中移动索引</li>
<li>在对开始和结束节点比较的时候，总共有四种情况<ul>
<li>oldStartVnode/newStartVnode(旧开始节点/新开始节点)</li>
<li>oldEndVnode/newEndVnode(旧结束节点/新结束节点)</li>
<li>oldStartVnode/oldEndVnode(旧开始节点/新结束节点)</li>
<li>oldEndVnode/newStartVnode(旧结束节点/新开始节点)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="22-updateChildren"><a href="#22-updateChildren" class="headerlink" title="22.updateChildren"></a>22.updateChildren</h3><p>略</p>
<h3 id="23-调试-PatchVnode"><a href="#23-调试-PatchVnode" class="headerlink" title="23.调试 PatchVnode"></a>23.调试 PatchVnode</h3><p>略</p>
<h3 id="24-调试-updateChildren"><a href="#24-调试-updateChildren" class="headerlink" title="24.调试 updateChildren"></a>24.调试 updateChildren</h3><p>略</p>
<h3 id="25-调试带-key-的情况"><a href="#25-调试带-key-的情况" class="headerlink" title="25.调试带 key 的情况"></a>25.调试带 key 的情况</h3><p>略</p>
<h3 id="26-模块源码"><a href="#26-模块源码" class="headerlink" title="26.模块源码"></a>26.模块源码</h3><p>略</p>
<h2 id="任务五：模块作业"><a href="#任务五：模块作业" class="headerlink" title="任务五：模块作业"></a>任务五：模块作业</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/20/31/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旋の飞羽">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/20/31/" itemprop="url">学习笔记 ----- 【Vue.js 框架源码与进阶】Vue.js 源码分析（响应式、虚拟 DOM、模板编译与组件化）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-12-20T00:00:00+08:00">
                2020-12-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>作者：FY<br>引用请标明出处</p>
</blockquote>
<h1 id="Part-3-·-Vue-js-框架源码与进阶"><a href="#Part-3-·-Vue-js-框架源码与进阶" class="headerlink" title="Part 3 · Vue.js 框架源码与进阶"></a>Part 3 · Vue.js 框架源码与进阶</h1><h2 id="模块二-·-Vue-js-源码分析（响应式、虚拟-DOM、模板编译与组件化）"><a href="#模块二-·-Vue-js-源码分析（响应式、虚拟-DOM、模板编译与组件化）" class="headerlink" title="模块二 · Vue.js 源码分析（响应式、虚拟 DOM、模板编译与组件化）"></a>模块二 · Vue.js 源码分析（响应式、虚拟 DOM、模板编译与组件化）</h2><h2 id="任务一：Vue-js-源码剖析-响应式原理"><a href="#任务一：Vue-js-源码剖析-响应式原理" class="headerlink" title="任务一：Vue.js 源码剖析-响应式原理"></a>任务一：Vue.js 源码剖析-响应式原理</h2><h3 id="1-课程目标"><a href="#1-课程目标" class="headerlink" title="1.课程目标"></a>1.课程目标</h3><ul>
<li>Vue.js 的静态成员和实例成员初始化过程</li>
<li>首次渲染的过程</li>
<li>数据响应式原理</li>
</ul>
<h3 id="2-准备工作-目录结构"><a href="#2-准备工作-目录结构" class="headerlink" title="2.准备工作-目录结构"></a>2.准备工作-目录结构</h3><blockquote>
<p>Vue 源码的获取</p>
</blockquote>
<ul>
<li>项目地址：<a href="https://github.com/vuejs/vue" target="_blank" rel="noopener">https://github.com/vuejs/vue</a></li>
<li>Fork 一份到自己仓库，克隆到本地，可以自己写注释提交到 github</li>
<li>为什么分析 Vue 2.6<ul>
<li>到目前为止 Vue3.0的正式版还没有发布</li>
<li>新版本发布后，现有项目不会升级到3.0,2.x还有很长一段过渡期</li>
<li>3.0 项目地址：<a href="https://github.com/vuejs/vue-next" target="_blank" rel="noopener">https://github.com/vuejs/vue-next</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>源码目录结构</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">   |-compiler           编译相关</span><br><span class="line">   |-core               Vue 核心库</span><br><span class="line">   |-platforms          平台相关代码</span><br><span class="line">   |-server             SSR 服务端渲染</span><br><span class="line">   |-sfc                .vue 文件编译为 js 对象</span><br><span class="line">   |-shared             公共的代码</span><br></pre></td></tr></table></figure>
<blockquote>
<p>了解 Flow</p>
</blockquote>
<ul>
<li>官网：<a href="https://flow.org/" target="_blank" rel="noopener">https://flow.org/</a></li>
<li>javaScript 的静态类型检查器</li>
<li>Flow 的静态类型检查错误是通过静态类型推断实现的<ul>
<li>文件开头通过 // @flow 或者 /* @flow */ 声明</li>
</ul>
</li>
</ul>
<h3 id="3-准备工作-调试"><a href="#3-准备工作-调试" class="headerlink" title="3.准备工作-调试"></a>3.准备工作-调试</h3><blockquote>
<p>打包</p>
</blockquote>
<ul>
<li><p>打包工具 Rollup</p>
<ul>
<li>Vue.js 源码的打包工具使用的是 Rollup，比 Webpack 轻量</li>
<li>Webpack 把所有文件当做模块，Rollup 只处理 js 文件，更适合在 Vue.js 这样的库中使用</li>
<li>Rollup 打包不会生成冗余的代码</li>
</ul>
</li>
<li><p>安装依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i</span><br></pre></td></tr></table></figure></li>
<li><p>设置 sourcemap</p>
<ul>
<li>package.json 文件中的 dev 脚本中添加参数 –sourcemap<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;dev&quot;:&quot;rollup -w -c scripts&#x2F;config.js --sourcemap --environment TARGET:web-full-dev&quot;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>执行 dev</p>
<ul>
<li>npm run dev 执行打包，用的 rollup，-w 参数是监听文件的变化，文件变化自动重新打包</li>
<li>结果</li>
</ul>
</li>
</ul>
<h3 id="4-准备工作-Vue-的不同构建版本"><a href="#4-准备工作-Vue-的不同构建版本" class="headerlink" title="4.准备工作-Vue 的不同构建版本"></a>4.准备工作-Vue 的不同构建版本</h3><blockquote>
<p>Vue 的不同构建版本</p>
</blockquote>
<ul>
<li>npm run build 重新打包所有文件</li>
<li>官方文档-对不同构建版本的解释</li>
<li>dist/README.md</li>
</ul>
<blockquote>
<p>术语</p>
</blockquote>
<ul>
<li><p>完整版：同时包含<strong>编译器</strong>和<strong>运行时</strong>的版本</p>
</li>
<li><p>编译器：用来将模板字符串编译成为 JavaScript 渲染函数的代码，体积大，效率低</p>
</li>
<li><p>运行时：用来创建 Vue 实例、渲染并处理虚拟 DOM 等的代码，体积小、效率高。基本上就是除去编译器的代码</p>
</li>
<li><p>UMD：UMD 版本**通用的模块版本，支持多种模块方式。vue.js 默认文件就是运行时 + 编译器的 UMD 版本</p>
</li>
<li><p>CommonJS(cjs)：CommonJs 版本用来配合老的打包工具比如 Browserify 或 webpack 1</p>
</li>
<li><p>ES Module：从 2.6 开始 Vue 会提供两个 ES Module(ESM) 构造文件，为现代打包工具提供的版本</p>
<ul>
<li>ESM 格式被设计为可以被静态分析，所以打包工具可以利用这一点来进行 tree-shaking 并将用不到的代码排除出最终的包。</li>
<li>ESM 模块 与 CommonJS 模块的差异</li>
</ul>
</li>
<li><p>vue inspect &gt; output.js 查看 Webpack 配置文件</p>
</li>
</ul>
<h3 id="5-寻找入口文件"><a href="#5-寻找入口文件" class="headerlink" title="5.寻找入口文件"></a>5.寻找入口文件</h3><blockquote>
<p>寻找入口文件</p>
</blockquote>
<ul>
<li>查看 dist/vue.js 的构建过程</li>
</ul>
<blockquote>
<p>执行构建</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br><span class="line"># "dev": "rollup -w -c script/config.js --sourcemap --environment TARGET:web-full-dev"</span><br><span class="line"># --environment TARGET:web-full-dev 设置环境变量 TARGET</span><br></pre></td></tr></table></figure>
<ul>
<li>script/config.js 的执行过程<ul>
<li>作用：生成 rollup 构建的配置文件</li>
<li>使用环境变量 TARGET = web-full-dev</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断环境变量是否有 TARGET</span></span><br><span class="line"><span class="comment">// 如果有的话 使用 genConfig() 生成 rollup 配置文件</span></span><br><span class="line"><span class="keyword">if</span>(process.env.TARGET) &#123;</span><br><span class="line">    <span class="built_in">module</span>.exports = genConfig(process.env.TARGET)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 否则获取全部配置</span></span><br><span class="line">    exports.getBuild = genConfig</span><br><span class="line">    exports.getAllBuilds = <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">Object</span>.keys(builds).map(getConfig)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-从入口开始"><a href="#6-从入口开始" class="headerlink" title="6.从入口开始"></a>6.从入口开始</h3><ul>
<li>src/platform/web/entry-runtime-with-compiler.js</li>
</ul>
<blockquote>
<p>通过查看源码解决下面问题</p>
</blockquote>
<ul>
<li>观察以下代码，通过阅读源码，回答在页面上输出的结果</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">"app"</span>,</span><br><span class="line">    template: <span class="string">'&lt;h3&gt;Hello template&lt;/h3&gt;'</span>,</span><br><span class="line">    render (h) &#123;</span><br><span class="line">        <span class="keyword">return</span> h(<span class="string">'h4'</span>, <span class="string">'Hello render'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>阅读源码记录<ul>
<li>el 不能是 body 或者 html 标签</li>
<li>如果没有 render，把 template 转换成 render 函数</li>
<li>如有有 render 方法，直接调用 mount 挂载 DOM</li>
</ul>
</li>
</ul>
<h3 id="7-Vue-初始化的过程"><a href="#7-Vue-初始化的过程" class="headerlink" title="7.Vue 初始化的过程"></a>7.Vue 初始化的过程</h3><blockquote>
<p>四个导出 Vue 的模块</p>
</blockquote>
<ul>
<li><p>src/platform/web/entry-runtime-with-compiler.js</p>
<ul>
<li>web 平台相关的入口</li>
<li>重写了平台相关的 $mount() 方法</li>
<li>注册了 Vue.compile() 方法，传递一个 HTML 字符串返回 render 函数</li>
</ul>
</li>
<li><p>src/platform/web/runtime/index.js</p>
<ul>
<li>web 平台相关</li>
<li>注册和平台相关的全局指令：v-model、v-show</li>
<li>注册和平台相关的全局组件：v-transition、v-transition-group</li>
<li>全局方法<ul>
<li>_<em>patch_</em>:把虚拟 DOM 转换成真实 DOM</li>
<li>$mount: 挂载方法</li>
</ul>
</li>
</ul>
</li>
<li><p>src/core/index.js</p>
<ul>
<li>与平台无关</li>
<li>设置了 Vue 的静态方法，initGlobalAPI(Vue)</li>
</ul>
</li>
<li><p>src/core/instance/index.js</p>
<ul>
<li>与平台无关</li>
<li>定义了构造函数，调用了 this._init(options)方法</li>
<li>给 Vue 中混入了常用的实例成员</li>
</ul>
</li>
</ul>
<h3 id="8-Vue-初始化-两个问题"><a href="#8-Vue-初始化-两个问题" class="headerlink" title="8.Vue 初始化-两个问题"></a>8.Vue 初始化-两个问题</h3><ul>
<li>vscode 不识别 flow<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// setting.json</span></span><br><span class="line"><span class="string">"javascript.validate.enable"</span>: <span class="literal">false</span></span><br></pre></td></tr></table></figure></li>
<li>Babel Javascript 插件 解决 flow 泛型不高亮显示问题 不能解决 ctrl + 鼠标左键 跳转问题</li>
</ul>
<h3 id="9-Vue-初始化-静态成员"><a href="#9-Vue-初始化-静态成员" class="headerlink" title="9.Vue 初始化-静态成员"></a>9.Vue 初始化-静态成员</h3><p>略</p>
<h3 id="10-Vue-初始化-实例成员"><a href="#10-Vue-初始化-实例成员" class="headerlink" title="10.Vue 初始化-实例成员"></a>10.Vue 初始化-实例成员</h3><p>略</p>
<h3 id="11-Vue-初始化-实例成员-init"><a href="#11-Vue-初始化-实例成员-init" class="headerlink" title="11.Vue 初始化-实例成员-init"></a>11.Vue 初始化-实例成员-init</h3><p>略</p>
<h3 id="12-Vue-初始化-实例成员-initState"><a href="#12-Vue-初始化-实例成员-initState" class="headerlink" title="12.Vue 初始化-实例成员-initState"></a>12.Vue 初始化-实例成员-initState</h3><p>略</p>
<h3 id="13-调试-Vue-初始化过程"><a href="#13-调试-Vue-初始化过程" class="headerlink" title="13.调试 Vue 初始化过程"></a>13.调试 Vue 初始化过程</h3><p>略</p>
<h3 id="14-首次渲染过程"><a href="#14-首次渲染过程" class="headerlink" title="14.首次渲染过程"></a>14.首次渲染过程</h3><ul>
<li>首先进入第一个文件 src/core/instance/index.js<ul>
<li>调用 Vue 构造函数 _init() 方法</li>
</ul>
</li>
<li>进入第二个文件 src/core/index.js<ul>
<li>调用 initGlobalApi()，初始化 Vue 中静态成员</li>
</ul>
</li>
<li>进入第三个文件 src/platforms/web/runtime/index.js<ul>
<li>初始化和平台相关的内容，比如指令和组件。挂载了<strong>patch</strong>和$mount</li>
</ul>
</li>
<li>进入第四个文件 src/platforms/web/entry-runtime-with-compiler.js<ul>
<li>重写了 $mount 方法 增加了编译的功能</li>
</ul>
</li>
</ul>
<h3 id="15-首次渲染过程-总结"><a href="#15-首次渲染过程-总结" class="headerlink" title="15.首次渲染过程-总结"></a>15.首次渲染过程-总结</h3><ul>
<li><p>首先进行 Vue 的初始化，初始化 Vue 的实例成员以及静态成员。</p>
</li>
<li><p>初始化结束后，调用 Vue 的构造函数，在 Vue 的构造函数中调用了 this._init(),在这个方法中又调用了vm.$mount()</p>
<ul>
<li>第一个 $mount 是 src/platform/web/entry-runtime-with-compiler.js 中的<ul>
<li>核心作用是把模板编译成 render() 函数。首先会判断是否传入了 render 选项，如果没传入会获取 template 选项，如果没有 template，会把 el 作为模板，然后把模板编译成 render() 函数。通过 compileToFunctions() 生成 renser() 渲染函数。最后将这个render() 存在 options.render 中。</li>
</ul>
</li>
<li>第二个 $mount 是 src/platform/web/runtime/index.js 中的<ul>
<li>重新获取 el</li>
</ul>
</li>
</ul>
</li>
<li><p>调用 src/core/instance/lifecycle.js 的 mountComponent(this.el) </p>
<ul>
<li>首先判断是否有 render 选项，如果没有但是传入了模板，并且是开发环境的话会发送警告。运行时版本不支持编译器。</li>
</ul>
</li>
<li><p>触发 beforeMount</p>
</li>
<li><p>定义 updateComponent</p>
<ul>
<li>在这个方法中，定义了 _render 和 _update<ul>
<li>_render 的作用是生成虚拟 DOM</li>
<li>_update 的作用是将虚拟 DOM 转换成真实 DOM，并且挂载到页面上</li>
</ul>
</li>
</ul>
</li>
<li><p>创建 Watcher 实例</p>
<ul>
<li>在创建 Watcher 时，传递了 updateComponent 这个函数，这个函数最终实在Watcher内部调用的</li>
<li>调用 get() 方法，在 get() 方法中会调用 updateComponent()</li>
</ul>
</li>
<li><p>最后触发了生命周期的钩子函数 mounted，挂载结束，return vm</p>
</li>
</ul>
<h3 id="16-数据响应式原理-响应式处理入口"><a href="#16-数据响应式原理-响应式处理入口" class="headerlink" title="16.数据响应式原理-响应式处理入口"></a>16.数据响应式原理-响应式处理入口</h3><blockquote>
<p>通过查看源码解决下面问题</p>
</blockquote>
<ul>
<li>vm.msg = { count: 0 },重新给属性赋值，是否是响应式的</li>
<li>vm.arr[0] = 4,给数组元素赋值，视图是否会更新</li>
<li>vm.arrlength = 0,修改数组的 length，视图是否会更新</li>
<li>vm.arr.push(4),视图是否会更新</li>
</ul>
<blockquote>
<p>响应式处理的入口</p>
</blockquote>
<p>整个响应式的入口是比较复杂的，下面我们先从</p>
<ul>
<li><p>src/core/instance/init.js</p>
<ul>
<li>initState(vm) vm 状态的初始化</li>
<li>初始化了 _data、_props、modules 等</li>
</ul>
</li>
<li><p>src/core/instance/state.js</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据的初始化</span></span><br><span class="line"><span class="keyword">if</span> (opts.data) &#123;</span><br><span class="line">  initData(vm)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  observe(vm._data = &#123;&#125;, <span class="literal">true</span> <span class="comment">/* asRootData */</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="17-数据响应式原理-Observer"><a href="#17-数据响应式原理-Observer" class="headerlink" title="17.数据响应式原理-Observer"></a>17.数据响应式原理-Observer</h3><ul>
<li>首先判断传进来的第一个参数 value 是否是对象，如果不是直接返回</li>
<li>获取 value 中的<strong>ob</strong>（observer对象）属性，如果有取出来直接返回</li>
<li>判断 value 对象是否可以进行响应式处理，如果可以创建一个 Observer 对象</li>
</ul>
<h3 id="18-数据响应式原理-defineReactive"><a href="#18-数据响应式原理-defineReactive" class="headerlink" title="18.数据响应式原理-defineReactive"></a>18.数据响应式原理-defineReactive</h3><ul>
<li>为一个对象定义一个响应式的属性</li>
</ul>
<h3 id="19-数据响应式原理-依赖收集"><a href="#19-数据响应式原理-依赖收集" class="headerlink" title="19.数据响应式原理-依赖收集"></a>19.数据响应式原理-依赖收集</h3><p>略</p>
<h3 id="20-数据响应式原理-依赖收集-调试"><a href="#20-数据响应式原理-依赖收集-调试" class="headerlink" title="20.数据响应式原理-依赖收集-调试"></a>20.数据响应式原理-依赖收集-调试</h3><p>略</p>
<h3 id="21-数据响应式原理-数组"><a href="#21-数据响应式原理-数组" class="headerlink" title="21.数据响应式原理-数组"></a>21.数据响应式原理-数组</h3><p>略</p>
<h3 id="22-数据响应式原理-数组练习"><a href="#22-数据响应式原理-数组练习" class="headerlink" title="22.数据响应式原理-数组练习"></a>22.数据响应式原理-数组练习</h3><p>略</p>
<h3 id="23-数据响应式原理-Watcher上"><a href="#23-数据响应式原理-Watcher上" class="headerlink" title="23.数据响应式原理-Watcher上"></a>23.数据响应式原理-Watcher上</h3><blockquote>
<p>Watcher类</p>
</blockquote>
<ul>
<li>Watcher 分为三种，Computed Wather、用户 Watcher（侦听器）、渲染 Watcher</li>
<li>渲染 Wathcer 的创建时机<ul>
<li>/src/core/instance/lifecycle.js</li>
</ul>
</li>
</ul>
<h3 id="24-数据响应式原理-Watcher下"><a href="#24-数据响应式原理-Watcher下" class="headerlink" title="24.数据响应式原理-Watcher下"></a>24.数据响应式原理-Watcher下</h3><p>略</p>
<h3 id="25-数据响应式原理-调试上"><a href="#25-数据响应式原理-调试上" class="headerlink" title="25.数据响应式原理-调试上"></a>25.数据响应式原理-调试上</h3><blockquote>
<p>调试响应式数据执行过程</p>
</blockquote>
<ul>
<li>数组响应式处理的核心过程和数组收集依赖的过程</li>
<li>当数组的数据改变的时候 watcher 的执行过程</li>
</ul>
<h3 id="26-数据响应式原理-调试下"><a href="#26-数据响应式原理-调试下" class="headerlink" title="26.数据响应式原理-调试下"></a>26.数据响应式原理-调试下</h3><p>略</p>
<h3 id="27-数据响应式原理-总结"><a href="#27-数据响应式原理-总结" class="headerlink" title="27.数据响应式原理-总结"></a>27.数据响应式原理-总结</h3><blockquote>
<p>响应式的处理过程</p>
</blockquote>
<ul>
<li>整个响应式是从 vue 实例的 init 方法开始的</li>
<li>在 init 方法中先调用 initState() 初始化 vue 实例的状态，在 initState() 方法中调用了 initData() 把 data 属性注入到实例上，并且调用 observe() 把 data 对象转换为响应式对象</li>
<li>observe(value) 位置 src/core/observer/index.js  <ul>
<li>首先判断 value 是否是对象，如果不是对象直接返回</li>
<li>判断 value 对象有没有 __ob__，如果有直接返回，如果没有，创建 observer 对象</li>
<li>返回 observer 对象</li>
</ul>
</li>
<li>Observer 位置 src/core/observer/index.js<ul>
<li>给 value 对象定义不可枚举的 __ob__属性，记录当前的 observer 对象</li>
<li>数组的响应式处理</li>
<li>对象的响应式处理，调用 walk 方法</li>
</ul>
</li>
<li>defineReactive 位置 src/core/observer/index.js<ul>
<li>为每一个属性创建 dep 对象</li>
<li>如果当前属性的值是对象，调用 observe</li>
<li>定义 getter 收集依赖 返回属性的值</li>
<li>定义 setter 保存新值 如果新值是对象，调用 observe</li>
<li>派发更新(发送通知)，调用 dep.notify()</li>
</ul>
</li>
<li>依赖收集<ul>
<li>在 watcher 对象的 get 方法中调用 pushTarget 记录 Dep.target 属性</li>
<li>访问 data 中的成员的时候收集依赖，defineReactive 的 getter 中收集依赖</li>
<li>把属性对象的 watcher 对象添加到 dep 的 subs 数组中</li>
<li>给 childOb 收集依赖，目的是子对象添加和删除成员时发送通知</li>
</ul>
</li>
<li>Watcher<ul>
<li>dep.notify() 在调用 watcher 对象的 update() 方法</li>
<li>queueWatcher() 判断 watcher 是否被处理，如果没有的话添加到 queue 队列中，并调用 flushScheduleQueue()</li>
<li>flushScheduleQueue()<ul>
<li>触发 beforeUpdate 钩子函数</li>
<li>调用 wathcer.run() run() –&gt; get() –&gt; getter –&gt; updateComponent</li>
<li>清空上一次的依赖</li>
<li>触发 actived 钩子函数</li>
<li>触发 updated 钩子函数</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="28-动态添加一个响应式属性"><a href="#28-动态添加一个响应式属性" class="headerlink" title="28.动态添加一个响应式属性"></a>28.动态添加一个响应式属性</h3><p>略</p>
<h3 id="29-set-源码"><a href="#29-set-源码" class="headerlink" title="29.set-源码"></a>29.set-源码</h3><blockquote>
<p>定义位置</p>
</blockquote>
<ul>
<li>Vue.set()<ul>
<li>global-api/index.js</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 静态方法 set/delete/nextTick</span></span><br><span class="line">Vue.set = <span class="keyword">set</span></span><br><span class="line">Vue.delete = del</span><br><span class="line">Vue.nextTick = nextTick</span><br></pre></td></tr></table></figure>
<ul>
<li>Vue.$set()<ul>
<li>instance/index.js</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册 vm 的 $data/$props/$set/$delete/$watch</span></span><br><span class="line"><span class="comment">// instance/state.js</span></span><br><span class="line">stateMixin(Vue)</span><br><span class="line"><span class="comment">// instance/state.js</span></span><br><span class="line">Vue.prototype.$<span class="keyword">set</span> = <span class="keyword">set</span></span><br><span class="line">Vue.prototype.$delete = del</span><br></pre></td></tr></table></figure>
<h3 id="30-set-调试"><a href="#30-set-调试" class="headerlink" title="30.set-调试"></a>30.set-调试</h3><p>略</p>
<h3 id="31-delete"><a href="#31-delete" class="headerlink" title="31.delete"></a>31.delete</h3><blockquote>
<p>vm.$delete</p>
</blockquote>
<ul>
<li>功能<ul>
<li>删除对象的属性。如果对象是响应式的，确保删除能触发更新视图。这个方法主要用于避开 Vue 不能检测到属性被删除的限制，但是你应该很少会使用它。</li>
<li>注意：目标对象不能是一个 Vue 实例或 Vue 实例的根数据对象。</li>
</ul>
</li>
<li>示例</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.$<span class="keyword">delete</span>(vm.obj,<span class="string">'msg'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="32-delete-源码"><a href="#32-delete-源码" class="headerlink" title="32.delete-源码"></a>32.delete-源码</h3><p>略</p>
<h3 id="33-watch-回顾"><a href="#33-watch-回顾" class="headerlink" title="33.watch-回顾"></a>33.watch-回顾</h3><blockquote>
<p>vm.$watch</p>
</blockquote>
<ul>
<li>vm.$watch(expOrFn,callback,[options])<ul>
<li>功能<br>-观察 Vue 实例变化的一个表达式或计算属性函数。回调函数得到的参数为新值和旧值。表达式只接受监督的键路径。对于更复杂的表达式，用一个函数取代。</li>
<li>参数<ul>
<li>expOrFn：要监视的 $data 中的属性，可以是表达式或函数</li>
<li>callback：数据变化后执行的函数<ul>
<li>函数：回调函数</li>
<li>对象：具有 handler 属性（字符串或者函数），如果该属性为字符串则 methods 中相应的定义</li>
</ul>
</li>
<li>options：可选的选项<ul>
<li>deep：布尔类型，深度监听</li>
<li>immediate：布尔类型，是否立即执行一次回调函数</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="34-三种类型的-Watcher"><a href="#34-三种类型的-Watcher" class="headerlink" title="34.三种类型的 Watcher"></a>34.三种类型的 Watcher</h3><ul>
<li>没有静态方法，因为 $watch 方法中要使用 Vue 的实例</li>
<li>Watchr 分三种：计算属性 Watcher、用户 Watcher（侦听器）、渲染 Watcher<ul>
<li>创建顺序：计算属性 Watcher、用户 Watcher（侦听器）、渲染 Watcher</li>
</ul>
</li>
<li>vm.$watcher<ul>
<li>src/core/instance/state.js</li>
</ul>
</li>
</ul>
<h3 id="35-watch-源码"><a href="#35-watch-源码" class="headerlink" title="35.watch-源码"></a>35.watch-源码</h3><p>略</p>
<h3 id="36-nextTick-回顾"><a href="#36-nextTick-回顾" class="headerlink" title="36.nextTick-回顾"></a>36.nextTick-回顾</h3><blockquote>
<p>异步更新队列-nextTick()</p>
</blockquote>
<ul>
<li>Vue 更新 DOM 是异步执行的，批量的<ul>
<li>在下次 DOM 更新循环结束之后执行延迟回调。在修改数据之后立即使用这个方法，获取更新后的 DOM。</li>
<li>vm.$nextTcik(function(){/<em>操作 DOM</em>/}) / Vue.nextTick(function(){})</li>
</ul>
</li>
</ul>
<h3 id="36-nextTick-源码"><a href="#36-nextTick-源码" class="headerlink" title="36.nextTick-源码"></a>36.nextTick-源码</h3><blockquote>
<p>定义位置</p>
</blockquote>
<ul>
<li>src\core\instance\render.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype.$nextTick = <span class="function"><span class="keyword">function</span>(<span class="params">fn:Function</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> nextTick(fn,<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>源码</p>
</blockquote>
<ul>
<li>手动调用 vm.$nextTick()</li>
<li>在 Watcher 的 queueWatcher 中执行 nextTick()</li>
<li>src\core\util\next-tick.js</li>
</ul>
<h2 id="任务二：Vue-js-源码剖析-虚拟DOM"><a href="#任务二：Vue-js-源码剖析-虚拟DOM" class="headerlink" title="任务二：Vue.js 源码剖析-虚拟DOM"></a>任务二：Vue.js 源码剖析-虚拟DOM</h2><h3 id="1-课程回顾"><a href="#1-课程回顾" class="headerlink" title="1.课程回顾"></a>1.课程回顾</h3><ul>
<li>虚拟 DOM 库 - Snabbdom</li>
<li>Vue.js 响应式原理模拟实现</li>
<li>Vue.js 源码剖析 - 响应式原理</li>
</ul>
<h3 id="2-虚拟-DOM-概念回顾"><a href="#2-虚拟-DOM-概念回顾" class="headerlink" title="2.虚拟 DOM 概念回顾"></a>2.虚拟 DOM 概念回顾</h3><blockquote>
<p>什么是虚拟 DOM</p>
</blockquote>
<ul>
<li>虚拟 DOM 是使用 JacaScript 对象描述真实 DOM</li>
<li>Vue.js 中的虚拟 DOM 借鉴 Snabbdom，并添加了 Vue.js 的特性<ul>
<li>例如：指令和组件机制</li>
</ul>
</li>
</ul>
<blockquote>
<p>为什么要使用虚拟 DOM</p>
</blockquote>
<ul>
<li>避免直接操作 DOM，提高开发效率</li>
<li>作为一个中间层可以跨平台</li>
<li>虚拟 DOM 不一定可以提高性能<ul>
<li>首次渲染的时候会增加开销</li>
<li>复杂视图情况下提高渲染性能</li>
</ul>
</li>
</ul>
<h3 id="3-代码演示"><a href="#3-代码演示" class="headerlink" title="3.代码演示"></a>3.代码演示</h3><blockquote>
<p>h 函数</p>
</blockquote>
<ul>
<li><p>vm.$createElement(tag, data, children, normalizeChildren)</p>
<ul>
<li>tag<ul>
<li>标签名称或者组件对象</li>
</ul>
</li>
<li>data<ul>
<li>描述 tag，可以设置 DOM 的属性或者标签的属性</li>
</ul>
</li>
<li>children<ul>
<li>tag 中的文本内容或者子节点<blockquote>
<p>VNode</p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
<li><p>VNode 的核心属性</p>
<ul>
<li>tag</li>
<li>data</li>
<li>children</li>
<li>text</li>
<li>elm</li>
<li>key</li>
</ul>
</li>
</ul>
<h3 id="4-整体过程分析"><a href="#4-整体过程分析" class="headerlink" title="4.整体过程分析"></a>4.整体过程分析</h3><p>略</p>
<h3 id="5-createElement-上"><a href="#5-createElement-上" class="headerlink" title="5.createElement-上"></a>5.createElement-上</h3><p>略</p>
<h3 id="6-createElement-下"><a href="#6-createElement-下" class="headerlink" title="6.createElement-下"></a>6.createElement-下</h3><p>略</p>
<h3 id="7-update"><a href="#7-update" class="headerlink" title="7.update"></a>7.update</h3><p>略</p>
<h3 id="8-patch-函数的初始化"><a href="#8-patch-函数的初始化" class="headerlink" title="8.patch 函数的初始化"></a>8.patch 函数的初始化</h3><ul>
<li>src/platforms/web/runtime/index.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; patch &#125; <span class="keyword">from</span> <span class="string">'./patch'</span></span><br><span class="line">Vue.prototype.__patch__ = inBrowser ? patch : noop</span><br></pre></td></tr></table></figure>

<h3 id="9-patch"><a href="#9-patch" class="headerlink" title="9.patch"></a>9.patch</h3><p>略</p>
<h3 id="10-createElm"><a href="#10-createElm" class="headerlink" title="10.createElm"></a>10.createElm</h3><p>略</p>
<h3 id="11-patchVnode"><a href="#11-patchVnode" class="headerlink" title="11.patchVnode"></a>11.patchVnode</h3><p>略</p>
<h3 id="12-updateChildren"><a href="#12-updateChildren" class="headerlink" title="12.updateChildren"></a>12.updateChildren</h3><p>略</p>
<h3 id="13-没有设置-key-的情况"><a href="#13-没有设置-key-的情况" class="headerlink" title="13.没有设置 key 的情况"></a>13.没有设置 key 的情况</h3><p>略</p>
<h3 id="14-设置-key-的情况"><a href="#14-设置-key-的情况" class="headerlink" title="14.设置 key 的情况"></a>14.设置 key 的情况</h3><p>略</p>
<h3 id="15-总结"><a href="#15-总结" class="headerlink" title="15.总结"></a>15.总结</h3><p>略</p>
<h2 id="任务三：Vue-js-源码剖析-模板编译和组件化"><a href="#任务三：Vue-js-源码剖析-模板编译和组件化" class="headerlink" title="任务三：Vue.js 源码剖析-模板编译和组件化"></a>任务三：Vue.js 源码剖析-模板编译和组件化</h2><h3 id="1-模板编译介绍"><a href="#1-模板编译介绍" class="headerlink" title="1.模板编译介绍"></a>1.模板编译介绍</h3><ul>
<li>模板编译的主要目的是将模板(tempalte)转换为渲染函数(render)<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> @<span class="attr">click</span>=<span class="string">"handler"</span>&gt;</span>title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>some content<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>渲染函数<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">render(h) &#123;</span><br><span class="line">  <span class="keyword">return</span> h(<span class="string">'div'</span>, [</span><br><span class="line">    h(<span class="string">'h1'</span>, &#123; <span class="attr">on</span>: &#123; <span class="attr">click</span>: <span class="keyword">this</span>.handler &#125; &#125;, <span class="string">'title'</span>)</span><br><span class="line">    h(<span class="string">'p'</span>, <span class="string">'some content'</span>)</span><br><span class="line">  ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p>模板编译的作用</p>
</blockquote>
<ul>
<li>Vue 2.x 使用 VNode 描述视图以及各种交互，用户自己编写 VNode 比较复杂</li>
<li>用户只需要编写类似 HTML 的代码 - Vue.js 模板，通过编译器将模板转换为返回 VNode 的 render 函数</li>
<li>.vue 文件会被 webpack 在构建的过程中转换成 render 函数</li>
</ul>
<h3 id="2-体验模板编译的结果-上"><a href="#2-体验模板编译的结果-上" class="headerlink" title="2.体验模板编译的结果-上"></a>2.体验模板编译的结果-上</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">anonymous</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">with</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> _c(</span><br><span class="line">      <span class="string">"div"</span>,</span><br><span class="line">      &#123; <span class="attr">attrs</span>: &#123; <span class="attr">id</span>: <span class="string">"app"</span> &#125; &#125;,</span><br><span class="line">      [</span><br><span class="line">        _m(<span class="number">0</span>),</span><br><span class="line">        _v(<span class="string">" "</span>),</span><br><span class="line">        _c(<span class="string">"p"</span>, [_v[_s(msg)]]),</span><br><span class="line">        _v(<span class="string">" "</span>),</span><br><span class="line">        _c(<span class="string">"comp"</span>, &#123; <span class="attr">on</span>: &#123; <span class="attr">myclick</span>: handler &#125;&#125;),</span><br><span class="line">      ],</span><br><span class="line">      <span class="number">1</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>编译生成的函数的位置</p>
</blockquote>
<ul>
<li><p>_c()</p>
<ul>
<li>src/core/instance/render.js</li>
</ul>
</li>
<li><p>_m()/_v()/_s()</p>
<ul>
<li>src/core/instance/render-helpers/index.js</li>
</ul>
</li>
</ul>
<h3 id="3-体验模板编译的结果-下"><a href="#3-体验模板编译的结果-下" class="headerlink" title="3.体验模板编译的结果-下"></a>3.体验模板编译的结果-下</h3><p>略</p>
<h3 id="4-Vue-Template-Explorer"><a href="#4-Vue-Template-Explorer" class="headerlink" title="4.Vue Template Explorer"></a>4.Vue Template Explorer</h3><ul>
<li><a href="https://template-explorer.vuejs.org" target="_blank" rel="noopener">https://template-explorer.vuejs.org</a></li>
<li><a href="https://vue-next-template-explorer.netlify.app" target="_blank" rel="noopener">https://vue-next-template-explorer.netlify.app</a></li>
</ul>
<h3 id="5-模板编译的入口"><a href="#5-模板编译的入口" class="headerlink" title="5.模板编译的入口"></a>5.模板编译的入口</h3><ul>
<li>compileToFunction(template,{},this) 返回 {render,staticRenderFns}</li>
<li>createCompiler(baseOptions)<ul>
<li>定义 compile(template,options) 函数</li>
<li>生成 compileToFunctions  createCompileToFunction(compile)</li>
<li>返回 {compile,compileToFunctions}</li>
<li>compileToFunctions 函数是模板编译的入口</li>
</ul>
</li>
<li>createCompileCreator(function baseCompile(){})<ul>
<li>传入了 baseCompile(template,finalOptions) 函数</li>
<li>baseCompile<ul>
<li>解析 parse</li>
<li>优化 optimize</li>
<li>生成 generate</li>
</ul>
</li>
<li>返回 createCompiler 函数</li>
</ul>
</li>
</ul>
<h3 id="6-模板编译过程-compileToFunction"><a href="#6-模板编译过程-compileToFunction" class="headerlink" title="6.模板编译过程-compileToFunction"></a>6.模板编译过程-compileToFunction</h3><p>略</p>
<h3 id="7-模板编译过程-compile"><a href="#7-模板编译过程-compile" class="headerlink" title="7.模板编译过程-compile"></a>7.模板编译过程-compile</h3><p>略</p>
<h3 id="8-模板编译过程-baseCompile-AST"><a href="#8-模板编译过程-baseCompile-AST" class="headerlink" title="8.模板编译过程-baseCompile-AST"></a>8.模板编译过程-baseCompile-AST</h3><ul>
<li>首先调用 parse 函数把模板转换成 ast 抽象语法树</li>
<li>然后调用 optimize 优化抽象语法树</li>
<li>最后调用 genertate 把抽象语法树生成字符串形式的 js 代码</li>
<li>最终返回对象 { ast, render: code.render, staticRenderFns: code.staticRenderFns }</li>
</ul>
<blockquote>
<p>什么是抽象语法树</p>
</blockquote>
<ul>
<li>抽象语法树简称 AST(Abstract Syntax Tree)</li>
<li>使用对象的形式描述树形的代码结构</li>
<li>此处的抽象语法树是用来描述树形结构的 HTML 字符串</li>
</ul>
<blockquote>
<p>为什么要使用抽象语法树</p>
</blockquote>
<ul>
<li>模板字符串转换成 AST 后，可以通过 AST 对模板做优化处理</li>
<li>标记模板中的静态内容，在 patch 的时候直接跳过静态内容</li>
<li>在 patch 的过程中静态内容不需要对比和重新渲染</li>
</ul>
<h3 id="9-模板编译过程-baseCompile-parse"><a href="#9-模板编译过程-baseCompile-parse" class="headerlink" title="9.模板编译过程-baseCompile-parse"></a>9.模板编译过程-baseCompile-parse</h3><p>略</p>
<h3 id="10-模板编译过程-baseCompile-optimize"><a href="#10-模板编译过程-baseCompile-optimize" class="headerlink" title="10.模板编译过程-baseCompile-optimize"></a>10.模板编译过程-baseCompile-optimize</h3><p>略</p>
<h3 id="11-模板编译过程-generate-上"><a href="#11-模板编译过程-generate-上" class="headerlink" title="11.模板编译过程-generate-上"></a>11.模板编译过程-generate-上</h3><p>略</p>
<h3 id="12-模板编译过程-generate-下"><a href="#12-模板编译过程-generate-下" class="headerlink" title="12.模板编译过程-generate-下"></a>12.模板编译过程-generate-下</h3><p>略</p>
<h3 id="13-模板编译过程-调试"><a href="#13-模板编译过程-调试" class="headerlink" title="13.模板编译过程-调试"></a>13.模板编译过程-调试</h3><p>略</p>
<h3 id="14-模板编译过程-总结"><a href="#14-模板编译过程-总结" class="headerlink" title="14.模板编译过程-总结"></a>14.模板编译过程-总结</h3><ul>
<li>compileToFunctions(template,…)<ul>
<li>先从缓存中加载编译好的 render 函数</li>
<li>缓存中没有调用 compile(template,options)</li>
</ul>
</li>
<li>compile(template,options)<ul>
<li>合并 options</li>
<li>baseCompile(template.trim(),finalOptions)  </li>
</ul>
</li>
<li>baseCompile(template.trim(),finalOptions)<ul>
<li>parse() 把 tempalte 转换成 AST tree</li>
<li>optimize()<ul>
<li>标记 AST tree 中的静态 sub trees</li>
<li>检测到静态子树，设置为静态，不需要在每次重新渲染的时候重新生成节点</li>
<li>patch 阶段跳过静态子树</li>
</ul>
</li>
</ul>
</li>
<li>generate()<ul>
<li>AST tree 生成 js 的创建代码</li>
</ul>
</li>
<li>compileToFunctions(template,…)<ul>
<li>继续把上一步中生成的字符串形式 js 代码转换为函数</li>
<li>createFunction()</li>
<li>render 和 staticRenderFns 初始化完毕，挂载到 Vue 实例的 options 对应的属性中</li>
</ul>
</li>
</ul>
<h3 id="15-组件化回顾"><a href="#15-组件化回顾" class="headerlink" title="15.组件化回顾"></a>15.组件化回顾</h3><ul>
<li>一个 Vue 组件就是一个拥有预定义选项的一个 Vue 实例</li>
<li>一个组件可以组成页面上一个功能完备的区域，组件可以包含脚本、样式、模板</li>
</ul>
<h3 id="16-组件注册"><a href="#16-组件注册" class="headerlink" title="16.组件注册"></a>16.组件注册</h3><blockquote>
<p>组件注册方式</p>
</blockquote>
<ul>
<li>全局组件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"app"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">cosnt Comp = Vue.component('comp',&#123;</span></span><br><span class="line"><span class="regexp">  template: '&lt;div&gt;Hello Component&lt;/</span>div&gt;<span class="string">'</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">const vm = new Vue(&#123;</span></span><br><span class="line">  el: '#app',</span><br><span class="line">  render(h) &#123;</span><br><span class="line">    <span class="keyword">return</span> h(Comp)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>局部组件<h3 id="17-Vue-extend"><a href="#17-Vue-extend" class="headerlink" title="17.Vue.extend"></a>17.Vue.extend</h3></li>
</ul>
<p>略</p>
<h3 id="18-调试组件注册过程"><a href="#18-调试组件注册过程" class="headerlink" title="18.调试组件注册过程"></a>18.调试组件注册过程</h3><p>略</p>
<h3 id="19-组件的创建过程"><a href="#19-组件的创建过程" class="headerlink" title="19.组件的创建过程"></a>19.组件的创建过程</h3><blockquote>
<p>回顾首次渲染过程</p>
</blockquote>
<ul>
<li>Vue 构造函数</li>
<li>this._init()</li>
<li>this.$mount()</li>
<li>mountComponent()</li>
<li>new Watcher() 渲染 Watcher</li>
<li>updateComponent()</li>
<li>vm._render() -&gt; createElement()</li>
<li>vm._update()</li>
</ul>
<h3 id="20-组件的-patch-过程"><a href="#20-组件的-patch-过程" class="headerlink" title="20.组件的 patch 过程"></a>20.组件的 patch 过程</h3><p>略</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/04/29/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旋の飞羽">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/12/04/29/" itemprop="url">学习笔记 ----- 【前端工程化实践】模块化开发与规范化标准</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-12-04T00:00:00+08:00">
                2020-12-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>作者：FY<br>引用请标明出处</p>
</blockquote>
<h1 id="Part-2-·-前端工程化实践"><a href="#Part-2-·-前端工程化实践" class="headerlink" title="Part 2 · 前端工程化实践"></a>Part 2 · 前端工程化实践</h1><h2 id="模块二-·-模块化开发与规范化标准"><a href="#模块二-·-模块化开发与规范化标准" class="headerlink" title="模块二 · 模块化开发与规范化标准"></a>模块二 · 模块化开发与规范化标准</h2><h2 id="任务一：模块化开发"><a href="#任务一：模块化开发" class="headerlink" title="任务一：模块化开发"></a>任务一：模块化开发</h2><h3 id="1-模块化概述"><a href="#1-模块化概述" class="headerlink" title="1.模块化概述"></a>1.模块化概述</h3><ul>
<li>内容概要<ul>
<li>模块化演变过程</li>
<li>模块化规范</li>
<li>常用的模块化打包工具</li>
<li>基于模块化工具构建现代 Web 应用</li>
<li>打包工具的优化技巧</li>
</ul>
</li>
</ul>
<h3 id="2-模块化演变过程"><a href="#2-模块化演变过程" class="headerlink" title="2.模块化演变过程"></a>2.模块化演变过程</h3><ul>
<li>Stage1 - 文件划分方式<ul>
<li>污染全局作用域</li>
<li>命名冲突问题</li>
<li>无法管理模块依赖关系</li>
<li>早期模块化完全依靠约定</li>
</ul>
</li>
<li>Stage2 - 命名空间方式</li>
<li>Stage3 - IIFE</li>
<li>早期在没有工具和规范的情况下对模块化的落地方式</li>
</ul>
<h3 id="3-模块化规范的出现"><a href="#3-模块化规范的出现" class="headerlink" title="3.模块化规范的出现"></a>3.模块化规范的出现</h3><ul>
<li>CommonJS 规范<ul>
<li>一个文件就是一个模块</li>
<li>每个模块都有单独的作用域</li>
<li>通过 module.exports 导出成员</li>
<li>通过 require 函数载入模块</li>
</ul>
</li>
<li>CommonJS 是以同步模式加载模块</li>
<li>AMD(Asynchronous Module Definiton)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个模块</span></span><br><span class="line">define(<span class="string">'module1'</span>, [<span class="string">'jquery'</span>, <span class="string">'./module2'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">$, module2</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        start: funciton() &#123;</span><br><span class="line">            $(<span class="string">'body'</span>).animate(&#123; <span class="attr">margin</span>: <span class="number">200</span>px<span class="string">' &#125;)</span></span><br><span class="line"><span class="string">            module2()</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Require.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 载入一个模块</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">'./module1'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">module1</span>)</span>&#123;</span><br><span class="line">    module1.start()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>目前绝大多数第三方库都支持AMD规范</li>
<li>AMD 使用起来相对复杂</li>
<li>模块 JS 文件请求频繁</li>
<li>Sea.js + CMD</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CMD 规范（类似 Common.js 规范）</span></span><br><span class="line">define(funciton (<span class="built_in">require</span>, exports, <span class="built_in">module</span>)) &#123;</span><br><span class="line">    <span class="comment">// 通过 require 引入依赖</span></span><br><span class="line">    <span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">'jquery'</span>)</span><br><span class="line">    <span class="comment">// 通过 exports 或者 module.exports 对外暴露成员</span></span><br><span class="line">    <span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'module 2~'</span>)</span><br><span class="line">        $(<span class="string">'body'</span>).append(<span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>module2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-模块化标准规范"><a href="#4-模块化标准规范" class="headerlink" title="4.模块化标准规范"></a>4.模块化标准规范</h3><ul>
<li>浏览器环境 ES Modules</li>
<li>NodeJs 环境 Common.js</li>
</ul>
<h3 id="5-ES-Modules-特性"><a href="#5-ES-Modules-特性" class="headerlink" title="5.ES Modules 特性"></a>5.ES Modules 特性</h3><ul>
<li>自动采用严格模式，忽略’use strict’</li>
<li>每个 ESM 模块都是单独的私有作用域</li>
<li>ESM 是通过 cors 去请求外部 JS 模块的</li>
<li>ESM 的 script 标签会延迟执行脚本</li>
</ul>
<h3 id="6-ES-Modules-导出"><a href="#6-ES-Modules-导出" class="headerlink" title="6.ES Modules 导出"></a>6.ES Modules 导出</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./module.js</span></span><br><span class="line"><span class="keyword">const</span> foo = <span class="string">'es modules'</span></span><br><span class="line"><span class="keyword">export</span> &#123; foo &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ./app.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; foo &#125; <span class="keyword">from</span> <span class="string">'./module.js'</span></span><br><span class="line"><span class="built_in">console</span>.log(foo) <span class="comment">// es modules</span></span><br></pre></td></tr></table></figure>

<h3 id="7-ES-Modules-导入导出的注意事项"><a href="#7-ES-Modules-导入导出的注意事项" class="headerlink" title="7.ES Modules 导入导出的注意事项"></a>7.ES Modules 导入导出的注意事项</h3><ul>
<li>export 后面大括号是固定语法，不是对象字面量。 export default { name, age } 是对象字面量。</li>
<li>import 不是解构，就是固定用法。</li>
<li>导出是把值存放的地址导出，不是复制。</li>
<li>导入的成员是只读成员，不能修改。</li>
</ul>
<h3 id="8-ES-Modules-导入用法"><a href="#8-ES-Modules-导入用法" class="headerlink" title="8.ES Modules 导入用法"></a>8.ES Modules 导入用法</h3><ul>
<li>需要完整路径和扩展名，不能省略 ./</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;&#125; <span class="keyword">from</span> <span class="string">'./module.js'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./module.js'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> mod <span class="keyword">from</span> <span class="string">'./module.js'</span></span><br><span class="line"><span class="keyword">import</span>(<span class="string">'./moudle.js'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">module</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">module</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">import</span> &#123; name, age, <span class="keyword">default</span> <span class="keyword">as</span> title &#125; rom <span class="string">'./module.js'</span></span><br><span class="line"><span class="keyword">import</span> title, &#123; name, age &#125; rom <span class="string">'./module.js'</span></span><br></pre></td></tr></table></figure>

<h3 id="9-ES-Modules-导出导入成员"><a href="#9-ES-Modules-导出导入成员" class="headerlink" title="9.ES Modules 导出导入成员"></a>9.ES Modules 导出导入成员</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// idnex.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">'./button.js'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Avatar &#125; <span class="keyword">from</span> <span class="string">'./avatar.js'</span></span><br><span class="line"><span class="keyword">export</span> &#123; Button, Avatar &#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-ES-Modules-浏览器环境-Polyfill"><a href="#10-ES-Modules-浏览器环境-Polyfill" class="headerlink" title="10.ES Modules 浏览器环境 Polyfill"></a>10.ES Modules 浏览器环境 Polyfill</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script nomodule src=<span class="string">"https://unpkg.com/promise-polyfill@8.1.3/dist/polyfill.min.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;script nomodule src="https:/</span><span class="regexp">/unpkg.com/</span>browser-es-moudle-loader@<span class="number">0.4</span><span class="number">.1</span>/dist/babel-browser-build.js<span class="string">"&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;script nomodule src="</span>https:<span class="comment">//unpkg.com/browser-es-moudle-loader@0.4.1/dist/browser-es-module-loader.js"&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="11-ES-Modules-in-Node-js-支持情况"><a href="#11-ES-Modules-in-Node-js-支持情况" class="headerlink" title="11.ES Modules in Node.js - 支持情况"></a>11.ES Modules in Node.js - 支持情况</h3><ul>
<li>node –experimental-modules index.mjs</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支持</span></span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span></span><br><span class="line"><span class="built_in">console</span>.log(_.cameClass(<span class="string">'ES Module'</span>))</span><br><span class="line"><span class="comment">// 不支持，因为第三方模块都是导出默认成员</span></span><br><span class="line"><span class="keyword">import</span> &#123; cameClass &#125; <span class="keyword">from</span> <span class="string">'lodash'</span></span><br><span class="line"><span class="built_in">console</span>.log(cameClass(<span class="string">'ES Module'</span>))</span><br><span class="line"><span class="comment">// 内置模块兼容了 ESM 的提取成员方式</span></span><br><span class="line"><span class="keyword">import</span> &#123; writeFileSunc &#125; <span class="keyword">from</span> <span class="string">'fs'</span></span><br><span class="line">writeFileSunc(<span class="string">'./bar.txt'</span>, <span class="string">'es module working~'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="12-ES-Modules-in-Node-js-与-CommonjS-交互"><a href="#12-ES-Modules-in-Node-js-与-CommonjS-交互" class="headerlink" title="12.ES Modules in Node.js - 与 CommonjS 交互"></a>12.ES Modules in Node.js - 与 CommonjS 交互</h3><ul>
<li>ES Module 中可以导入 CommonJS 模块</li>
<li>CommonJS 中不能导入 ES Modules 模块</li>
<li>CommonJS 模块始终只会导出一个默认成员</li>
<li>注意 import 不是解构导出对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// es-module.mjs</span></span><br><span class="line"><span class="comment">// ES Module 中可以导入 CommonJS 模块</span></span><br><span class="line"><span class="keyword">import</span> mod <span class="keyword">from</span> <span class="string">'./commonjs.js'</span></span><br><span class="line"><span class="built_in">console</span>.log(mod)</span><br><span class="line"><span class="comment">// 不能直接提取成员，注意 import 不是解构导出对象</span></span><br><span class="line"><span class="keyword">import</span> &#123; foo &#125; <span class="keyword">from</span> <span class="string">'./commonjs.js'</span></span><br><span class="line"><span class="built_in">console</span>.log(foo)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> foo = <span class="string">'es module export value'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// commonjs.js</span></span><br><span class="line"><span class="comment">// CommonJS 模块始终只会导出一个默认成员</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  foo: <span class="string">'commonjs exports value'</span></span><br><span class="line">&#125;</span><br><span class="line">exports.foo = <span class="string">'commonjs exports value'</span></span><br><span class="line"><span class="comment">// 不能再 CommonJS 模块中通过 require 载入 ES Module</span></span><br><span class="line"><span class="keyword">const</span> mod = <span class="built_in">require</span>(<span class="string">'./es-module.mjs'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(mod)</span><br></pre></td></tr></table></figure>

<h3 id="13-ES-Modules-in-Node-js-与-CommonjS-的差异"><a href="#13-ES-Modules-in-Node-js-与-CommonjS-的差异" class="headerlink" title="13.ES Modules in Node.js - 与 CommonjS 的差异"></a>13.ES Modules in Node.js - 与 CommonjS 的差异</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// esm.mjs</span></span><br><span class="line"><span class="comment">// ESM 中没有 CommonJS 中那些模块全局成员了</span></span><br><span class="line"><span class="keyword">import</span> &#123; fileURLToPath &#125; <span class="keyword">from</span> <span class="string">'url'</span></span><br><span class="line"><span class="keyword">import</span> &#123; dirname &#125; <span class="keyword">from</span> <span class="string">'path'</span></span><br><span class="line"><span class="keyword">const</span> __filename = fileURLToPath(<span class="keyword">import</span>.meta.url)</span><br><span class="line"><span class="built_in">console</span>.log(__filename)</span><br><span class="line"><span class="keyword">const</span> __dirname = dirname(__filename)</span><br><span class="line"><span class="built_in">console</span>.log(__dirname)</span><br></pre></td></tr></table></figure>

<h3 id="14-ES-Modules-in-Node-js-新版本进一步支持"><a href="#14-ES-Modules-in-Node-js-新版本进一步支持" class="headerlink" title="14.ES Modules in Node.js - 新版本进一步支持"></a>14.ES Modules in Node.js - 新版本进一步支持</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pakage.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"type"</span>: <span class="string">"module"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// common.cjs</span></span><br></pre></td></tr></table></figure>

<h3 id="15-ES-Modules-in-Node-js-Babel-兼容方案"><a href="#15-ES-Modules-in-Node-js-Babel-兼容方案" class="headerlink" title="15.ES Modules in Node.js - Babel 兼容方案"></a>15.ES Modules in Node.js - Babel 兼容方案</h3><ul>
<li><p>yarn add @babel/node @babel/core @babel/preset-env –dev</p>
</li>
<li><p>yarn babel-node</p>
</li>
<li><p>yarn babel-node index.js –presets=@babel/preset-env</p>
</li>
<li><p>yarn add @babel/plugin-transform-modules-commonjs</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [<span class="string">"@babel/preset-env"</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// .babelrc</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"plugins"</span>: [<span class="string">"@babel/plugin-transform-modules-commonjs"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="任务二：Webpack打包"><a href="#任务二：Webpack打包" class="headerlink" title="任务二：Webpack打包"></a>任务二：Webpack打包</h2><h3 id="1-模块打包工具的由来"><a href="#1-模块打包工具的由来" class="headerlink" title="1.模块打包工具的由来"></a>1.模块打包工具的由来</h3><ul>
<li>ES Modules 存在环境兼容问题</li>
<li>模块文件过多，网络请求频繁</li>
<li>所有的前端资源都需要模块化</li>
<li>新特性代码编译</li>
<li>模块化 javascript 打包</li>
<li>支持不同类型的资源模块</li>
</ul>
<h3 id="2-模块打包工具概要"><a href="#2-模块打包工具概要" class="headerlink" title="2.模块打包工具概要"></a>2.模块打包工具概要</h3><ul>
<li>打包工具解决的是前端整体的模块化，并不单指 Javascript 模块化</li>
</ul>
<h3 id="3-Webpack-快速上手"><a href="#3-Webpack-快速上手" class="headerlink" title="3.Webpack 快速上手"></a>3.Webpack 快速上手</h3><ul>
<li>yarn add webpack webpack-cli –dev</li>
</ul>
<h3 id="4-Webpack-配置文件"><a href="#4-Webpack-配置文件" class="headerlink" title="4.Webpack 配置文件"></a>4.Webpack 配置文件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-Webpack-工作模式"><a href="#5-Webpack-工作模式" class="headerlink" title="5.Webpack 工作模式"></a>5.Webpack 工作模式</h3><ul>
<li>默认为 production</li>
<li>yarn webpack –mode development</li>
<li>yarn webpack –mode none</li>
</ul>
<h3 id="6-Webpack-打包结果运行原理"><a href="#6-Webpack-打包结果运行原理" class="headerlink" title="6.Webpack 打包结果运行原理"></a>6.Webpack 打包结果运行原理</h3><p>略</p>
<h3 id="7-Webpack-资源模块加载"><a href="#7-Webpack-资源模块加载" class="headerlink" title="7.Webpack 资源模块加载"></a>7.Webpack 资源模块加载</h3><ul>
<li>yarn add css-loader –dev</li>
<li>yarn add style-loader –dev</li>
<li>Loader 是 Webpack 的核心特性</li>
<li>借助于Loader就可以加载任何类型的资源</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-Webpack-导入资源模块"><a href="#8-Webpack-导入资源模块" class="headerlink" title="8.Webpack 导入资源模块"></a>8.Webpack 导入资源模块</h3><ul>
<li>根据代码的需要动态导入资源</li>
<li>需要资源的不是应用，而是代码</li>
<li>javascript驱动整个前端应用</li>
<li>逻辑合理，JS确实需要这些资源文件</li>
<li>确保上线资源不缺失，都是必要的</li>
<li>新事物的思想才是突破点</li>
</ul>
<h3 id="9-Webpack-文件资源加载器"><a href="#9-Webpack-文件资源加载器" class="headerlink" title="9.Webpack 文件资源加载器"></a>9.Webpack 文件资源加载器</h3><ul>
<li>yarn add file-loader –dev</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>),</span><br><span class="line">      publicPath: <span class="string">'dist/'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.png$/</span>,</span><br><span class="line">          use: <span class="string">'file-loader'</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-Webpack-URL加载器"><a href="#10-Webpack-URL加载器" class="headerlink" title="10.Webpack URL加载器"></a>10.Webpack URL加载器</h3><ul>
<li>yarn add url-loader –dev</li>
<li>小文件使用 Data URLs，减少请求次数</li>
<li>大文件单独提取存放，提高加载速度</li>
<li>必须同时安装 file-loader</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>),</span><br><span class="line">      publicPath: <span class="string">'dist/'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.png$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 10kb</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-Webpack-常用加载器分类"><a href="#11-Webpack-常用加载器分类" class="headerlink" title="11.Webpack 常用加载器分类"></a>11.Webpack 常用加载器分类</h3><ul>
<li>编译转换类<ul>
<li>css-loader</li>
</ul>
</li>
<li>文件操作类<ul>
<li>file-loader</li>
</ul>
</li>
<li>代码检查类<ul>
<li>eslint-loader</li>
</ul>
</li>
</ul>
<h3 id="12-Webpack-与-ES-2015"><a href="#12-Webpack-与-ES-2015" class="headerlink" title="12.Webpack 与 ES 2015"></a>12.Webpack 与 ES 2015</h3><ul>
<li>因为模块打包需要，所以处理 import 和 export</li>
<li>yarn add babel-loader @babel/core @babel/preset-env –dev</li>
<li>Webpack 只是打包工具</li>
<li>加载器可以用来编译转换代码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>),</span><br><span class="line">      publicPath: <span class="string">'dist/'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.js$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.png$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 10kb</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-Webpack-加载资源的方式"><a href="#13-Webpack-加载资源的方式" class="headerlink" title="13.Webpack 加载资源的方式"></a>13.Webpack 加载资源的方式</h3><ul>
<li>遵循 ES Modules 标准的 import 声明</li>
<li>遵循 CommonJS 标准的 require 函数 </li>
<li>遵循 AMD 标准的 define 函数和 require 函数</li>
<li>*样式代码中的@import指令和url函数</li>
<li>*HTML 代码中图片标签的src属性</li>
</ul>
<h3 id="14-Webpack-核心工作原理"><a href="#14-Webpack-核心工作原理" class="headerlink" title="14.Webpack 核心工作原理"></a>14.Webpack 核心工作原理</h3><ul>
<li>Loader 机制是 Webpack 的核心</li>
</ul>
<h3 id="15-Webpack-开发一个-Loader"><a href="#15-Webpack-开发一个-Loader" class="headerlink" title="15.Webpack 开发一个 Loader"></a>15.Webpack 开发一个 Loader</h3><ul>
<li>Loader 负责资源文件从输入到输出的转换</li>
<li>对于同一个资源可以依次使用多个 Loader</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>),</span><br><span class="line">      publicPath: <span class="string">'dist/'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.md$/</span>,</span><br><span class="line">          use: [<span class="string">'html-loader'</span>,<span class="string">'./markdown-loader'</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// markdown-loader.js</span></span><br><span class="line"><span class="keyword">const</span> marked = <span class="built_in">require</span>(<span class="string">'marked'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">source</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> html = marked(source)</span><br><span class="line">  <span class="comment">// return `module.exports = $&#123;JSON.stringify(html)&#125;`</span></span><br><span class="line">  <span class="comment">// return `export default = $&#123;JSON.stringify(html)&#125;`</span></span><br><span class="line">  <span class="keyword">return</span> html</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="16-Webpack-插件机制介绍"><a href="#16-Webpack-插件机制介绍" class="headerlink" title="16.Webpack 插件机制介绍"></a>16.Webpack 插件机制介绍</h3><ul>
<li>增强 Webpack 自动化能力</li>
<li>Loader 专注实现资源模块加载</li>
<li>Plugin 解决其他自动化工作<ul>
<li>e.g.清除 dist 目录</li>
<li>e.g.拷贝静态文件至输出目录</li>
<li>e.g.压缩输出代码</li>
</ul>
</li>
</ul>
<h3 id="17-Webpack-自动清除输出目录插件"><a href="#17-Webpack-自动清除输出目录插件" class="headerlink" title="17.Webpack 自动清除输出目录插件"></a>17.Webpack 自动清除输出目录插件</h3><ul>
<li>yarn add clean-webpack-plugin –dev</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>),</span><br><span class="line">      publicPath: <span class="string">'dist/'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.js$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.png$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 10kb</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> CleanWebpackPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="18-Webpack-自动生成-HTML-插件（上）"><a href="#18-Webpack-自动生成-HTML-插件（上）" class="headerlink" title="18.Webpack 自动生成 HTML 插件（上）"></a>18.Webpack 自动生成 HTML 插件（上）</h3><ul>
<li>yarn add html-webpack-plugin –dev</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'HTML-webpack-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.js$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.png$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 10kb</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="19-Webpack-自动生成-HTML-插件（中）"><a href="#19-Webpack-自动生成-HTML-插件（中）" class="headerlink" title="19.Webpack 自动生成 HTML 插件（中）"></a>19.Webpack 自动生成 HTML 插件（中）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.js$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.png$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 10kb</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: <span class="string">'Webpack Plugin Sample'</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">          viewport: <span class="string">'width=device-width'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        template: <span class="string">'./src/index.html'</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="20-Webpack-自动生成-HTML-插件（下）"><a href="#20-Webpack-自动生成-HTML-插件（下）" class="headerlink" title="20.Webpack 自动生成 HTML 插件（下）"></a>20.Webpack 自动生成 HTML 插件（下）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.js$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.png$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 10kb</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: <span class="string">'Webpack Plugin Sample'</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">          viewport: <span class="string">'width=device-width'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        template: <span class="string">'./src/index.html'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        filename: <span class="string">'about.html'</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="21-Webpack-插件使用总结"><a href="#21-Webpack-插件使用总结" class="headerlink" title="21.Webpack 插件使用总结"></a>21.Webpack 插件使用总结</h3><ul>
<li>yarn add copy-webpack-plugin –dev</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.js$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.png$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 10kb</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: <span class="string">'Webpack Plugin Sample'</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">          viewport: <span class="string">'width=device-width'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        template: <span class="string">'./src/index.html'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        filename: <span class="string">'about.html'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> CopyWebpackPlugin(&#123;</span><br><span class="line">        <span class="comment">// 'public/**'</span></span><br><span class="line">        <span class="string">'public'</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="22-Webpack-开发一个插件"><a href="#22-Webpack-开发一个插件" class="headerlink" title="22.Webpack 开发一个插件"></a>22.Webpack 开发一个插件</h3><ul>
<li>Plugin 通过钩子机制实现</li>
<li>一个函数或者是一个包含 apply 方法的对象</li>
<li>通过在生命周期的钩子中挂载函数实现扩展</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPlugin</span> </span>&#123;</span><br><span class="line">  apply(compiler)&#123;</span><br><span class="line">    compiler.hooks.emit.tap(<span class="string">'MyPlugin'</span>, compilation =&gt; &#123;</span><br><span class="line">      <span class="comment">// compilation =&gt; 可以理解为此次打包的上下文</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">const</span> name <span class="keyword">in</span> compilation.assets) &#123;</span><br><span class="line">        <span class="comment">// console.log(name)</span></span><br><span class="line">        <span class="comment">// console.log(compilation.assets[name].source())</span></span><br><span class="line">        <span class="keyword">if</span>(name.endWidth(<span class="string">'.js'</span>)) &#123;</span><br><span class="line">          <span class="keyword">const</span> contents = compilation.assets[name].source()</span><br><span class="line">          <span class="keyword">const</span> withoutComments = content.replace(<span class="regexp">/\/\*\*+\*\//g</span>, <span class="string">''</span>)</span><br><span class="line">          compilation.assets[name] = &#123;</span><br><span class="line">            source: <span class="function"><span class="params">()</span> =&gt;</span> withoutComments</span><br><span class="line">            size: <span class="function"><span class="params">()</span> =&gt;</span> withoutComments.length</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.js$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.png$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 10kb</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: <span class="string">'Webpack Plugin Sample'</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">          viewport: <span class="string">'width=device-width'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        template: <span class="string">'./src/index.html'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        filename: <span class="string">'about.html'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> CopyWebpackPlugin(&#123;</span><br><span class="line">        <span class="comment">// 'public/**'</span></span><br><span class="line">        <span class="string">'public'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> MyPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="23-Webpack-开发体验问题"><a href="#23-Webpack-开发体验问题" class="headerlink" title="23.Webpack 开发体验问题"></a>23.Webpack 开发体验问题</h3><ul>
<li>以 HTTP Server 运行</li>
<li>自动编译 + 自动刷新</li>
<li>提供 Source Map 支持</li>
</ul>
<h3 id="24-Webpack-自动编译"><a href="#24-Webpack-自动编译" class="headerlink" title="24.Webpack 自动编译"></a>24.Webpack 自动编译</h3><ul>
<li>yarn webpack –watch</li>
</ul>
<h3 id="25-Webpack-自动刷新浏览器"><a href="#25-Webpack-自动刷新浏览器" class="headerlink" title="25.Webpack 自动刷新浏览器"></a>25.Webpack 自动刷新浏览器</h3><ul>
<li>browser-sync dist –files “<em>*/</em>“</li>
</ul>
<h3 id="26-Webpack-Dev-Server"><a href="#26-Webpack-Dev-Server" class="headerlink" title="26.Webpack Dev Server"></a>26.Webpack Dev Server</h3><ul>
<li>yarn add webpack-dev-server –dev</li>
</ul>
<h3 id="27-Webpack-Dev-Server-静态资源访问"><a href="#27-Webpack-Dev-Server-静态资源访问" class="headerlink" title="27.Webpack Dev Server 静态资源访问"></a>27.Webpack Dev Server 静态资源访问</h3><ul>
<li>contentBase 额外为开发服务器指定查找资源目录</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPlugin</span> </span>&#123;</span><br><span class="line">  apply(compiler)&#123;</span><br><span class="line">    compiler.hooks.emit.tap(<span class="string">'MyPlugin'</span>, compilation =&gt; &#123;</span><br><span class="line">      <span class="comment">// compilation =&gt; 可以理解为此次打包的上下文</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">const</span> name <span class="keyword">in</span> compilation.assets) &#123;</span><br><span class="line">        <span class="comment">// console.log(name)</span></span><br><span class="line">        <span class="comment">// console.log(compilation.assets[name].source())</span></span><br><span class="line">        <span class="keyword">if</span>(name.endWidth(<span class="string">'.js'</span>)) &#123;</span><br><span class="line">          <span class="keyword">const</span> contents = compilation.assets[name].source()</span><br><span class="line">          <span class="keyword">const</span> withoutComments = content.replace(<span class="regexp">/\/\*\*+\*\//g</span>, <span class="string">''</span>)</span><br><span class="line">          compilation.assets[name] = &#123;</span><br><span class="line">            source: <span class="function"><span class="params">()</span> =&gt;</span> withoutComments</span><br><span class="line">            size: <span class="function"><span class="params">()</span> =&gt;</span> withoutComments.length</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    devServer: &#123;</span><br><span class="line">      contentBase: <span class="string">'./public'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.js$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.png$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 10kb</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: <span class="string">'Webpack Plugin Sample'</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">          viewport: <span class="string">'width=device-width'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        template: <span class="string">'./src/index.html'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        filename: <span class="string">'about.html'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 开发阶段最好不要使用这个插件</span></span><br><span class="line">      <span class="comment">// new CopyWebpackPlugin(['public']),</span></span><br><span class="line">      <span class="keyword">new</span> MyPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="28-Webpack-Dev-Server-代理-API"><a href="#28-Webpack-Dev-Server-代理-API" class="headerlink" title="28.Webpack Dev Server 代理 API"></a>28.Webpack Dev Server 代理 API</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    devServer: &#123;</span><br><span class="line">      contentBase: <span class="string">'./public'</span>,</span><br><span class="line">      proxy: &#123;</span><br><span class="line">        <span class="string">'./api'</span>: &#123;</span><br><span class="line">          <span class="comment">// http://localhost:8080/api/users -&gt; https://api.github.com/api/users</span></span><br><span class="line">          target: <span class="string">'https://api.github.com'</span>,</span><br><span class="line">          <span class="comment">// http://localhost:8080/api/users -&gt; https://api.github.com/users</span></span><br><span class="line">          pathRewrite: &#123;</span><br><span class="line">            <span class="string">'^api'</span>: <span class="string">''</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">// 不能使用 localhost:8080作为请求 GitHub 的主机名</span></span><br><span class="line">          changeOrigin: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.js$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.png$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 10kb</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: <span class="string">'Webpack Plugin Sample'</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">          viewport: <span class="string">'width=device-width'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        template: <span class="string">'./src/index.html'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        filename: <span class="string">'about.html'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 开发阶段最好不要使用这个插件</span></span><br><span class="line">      <span class="comment">// new CopyWebpackPlugin(['public']),</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="29-Souce-Map-介绍"><a href="#29-Souce-Map-介绍" class="headerlink" title="29.Souce Map 介绍"></a>29.Souce Map 介绍</h3><ul>
<li>Source Map 解决了源代码与运行代码不一致所产生的问题</li>
</ul>
<h3 id="30-Webpack-配置-Source-Map"><a href="#30-Webpack-配置-Source-Map" class="headerlink" title="30.Webpack 配置 Source Map"></a>30.Webpack 配置 Source Map</h3><ul>
<li>Webpack支持12种不同的方式，每种方式的效率和效果各不相同</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    devtool: <span class="string">'source-map'</span>,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.js$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.png$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 10kb</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: <span class="string">'Webpack Plugin Sample'</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">          viewport: <span class="string">'width=device-width'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        template: <span class="string">'./src/index.html'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        filename: <span class="string">'about.html'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 开发阶段最好不要使用这个插件</span></span><br><span class="line">      <span class="comment">// new CopyWebpackPlugin(['public']),</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="31-Webpack-eval-模式的-Source-Map"><a href="#31-Webpack-eval-模式的-Source-Map" class="headerlink" title="31.Webpack eval 模式的 Source Map"></a>31.Webpack eval 模式的 Source Map</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    devtool: <span class="string">'eval'</span>,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.js$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.png$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 10kb</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: <span class="string">'Webpack Plugin Sample'</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">          viewport: <span class="string">'width=device-width'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        template: <span class="string">'./src/index.html'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        filename: <span class="string">'about.html'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 开发阶段最好不要使用这个插件</span></span><br><span class="line">      <span class="comment">// new CopyWebpackPlugin(['public']),</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="32-Webpack-devtool-模式对比（上）"><a href="#32-Webpack-devtool-模式对比（上）" class="headerlink" title="32.Webpack devtool 模式对比（上）"></a>32.Webpack devtool 模式对比（上）</h3><p>略</p>
<h3 id="33-Webpack-devtool-模式对比（下）"><a href="#33-Webpack-devtool-模式对比（下）" class="headerlink" title="33.Webpack devtool 模式对比（下）"></a>33.Webpack devtool 模式对比（下）</h3><ul>
<li>eval - 是否使用eval执行模块代码</li>
<li>cheap - Source Map是否包含行信息</li>
<li>module - 是否能够得到Loader处理之前的源代码</li>
</ul>
<h3 id="34-Webpack-选择-Source-Map-模式"><a href="#34-Webpack-选择-Source-Map-模式" class="headerlink" title="34.Webpack 选择 Source Map 模式"></a>34.Webpack 选择 Source Map 模式</h3><ul>
<li>开发模式 cheap-module-eval-source-map<ul>
<li>代码每行不会超过80个字符</li>
<li>代码经过Loader转换过后的差异较大</li>
<li>首次打包速度慢无所谓，重写打包相对较快</li>
</ul>
</li>
<li>生产环境 none / nosources-source-map<ul>
<li>Source Map 会暴露源代码</li>
<li>调试是开发阶段的事情</li>
</ul>
</li>
</ul>
<h3 id="35-Webpack-自动刷新的问题"><a href="#35-Webpack-自动刷新的问题" class="headerlink" title="35.Webpack 自动刷新的问题"></a>35.Webpack 自动刷新的问题</h3><ul>
<li>页面不刷新的情况下，模块也可以及时更新</li>
</ul>
<h3 id="36-Webpack-HRM-体验"><a href="#36-Webpack-HRM-体验" class="headerlink" title="36.Webpack HRM 体验"></a>36.Webpack HRM 体验</h3><ul>
<li>应用运行过程中实时替换某个模块，应用运行状态不受影响</li>
<li>热替换只将修改的模块实时替换至应用中</li>
</ul>
<h3 id="37-Webpack-开启-HRM"><a href="#37-Webpack-开启-HRM" class="headerlink" title="37.Webpack 开启 HRM"></a>37.Webpack 开启 HRM</h3><ul>
<li>webpack-dev-server –hot</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// wabpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'none'</span></span><br><span class="line">    entry: <span class="string">'./src/main.js'</span></span><br><span class="line">    output: &#123;</span><br><span class="line">      filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">      path: path.join(__dirname,<span class="string">'output'</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    devtool: <span class="string">'eval'</span>,</span><br><span class="line">    devServer: &#123;</span><br><span class="line">      hot: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.js$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.css$/</span>,</span><br><span class="line">          use: [</span><br><span class="line">            <span class="string">'style-loader'</span>,</span><br><span class="line">            <span class="string">'css-loader'</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/.png$/</span>,</span><br><span class="line">          use: &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              limit: <span class="number">10</span> * <span class="number">1024</span> <span class="comment">// 10kb</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: <span class="string">'Webpack Plugin Sample'</span>,</span><br><span class="line">        meta: &#123;</span><br><span class="line">          viewport: <span class="string">'width=device-width'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        template: <span class="string">'./src/index.html'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        filename: <span class="string">'about.html'</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">      <span class="comment">// 开发阶段最好不要使用这个插件</span></span><br><span class="line">      <span class="comment">// new CopyWebpackPlugin(['public']),</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="38-Webpack-HRM-的疑问"><a href="#38-Webpack-HRM-的疑问" class="headerlink" title="38.Webpack HRM 的疑问"></a>38.Webpack HRM 的疑问</h3><ul>
<li>样式文件可以热更新</li>
<li>js文件还是刷新，我们需要手动处理JS模块热更新后的热替换</li>
</ul>
<h3 id="39-Webpack-使用-HRM-API"><a href="#39-Webpack-使用-HRM-API" class="headerlink" title="39.Webpack 使用 HRM API"></a>39.Webpack 使用 HRM API</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line">moudle.exports.hot.accept(<span class="string">'./editor'</span>, ()=&gt; &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'editor 模块更新了，需要这里手动处理热替换逻辑'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="40-Webpack-处理-JS-模块热替换"><a href="#40-Webpack-处理-JS-模块热替换" class="headerlink" title="40.Webpack 处理 JS 模块热替换"></a>40.Webpack 处理 JS 模块热替换</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">let</span> lastEditor = editor</span><br><span class="line">moudle.hot.accept(<span class="string">'./editor'</span>, ()=&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> value = lastEditor.innerHTML</span><br><span class="line">  <span class="built_in">document</span>.body.removeChild(editor)</span><br><span class="line">  <span class="keyword">const</span> newEditor = createEditor()</span><br><span class="line">  newEditor.innerHTML = value</span><br><span class="line">  <span class="built_in">document</span>.body.appendChild(newEditor)</span><br><span class="line">  lastEditor = newEditor</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="41-Webpack-处理图片模块热替换"><a href="#41-Webpack-处理图片模块热替换" class="headerlink" title="41.Webpack 处理图片模块热替换"></a>41.Webpack 处理图片模块热替换</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line">moudle.hot.accept(<span class="string">'./better.png'</span>, ()=&gt; &#123;</span><br><span class="line">  img.src = background</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="42-Webpack-HRM-注意事项"><a href="#42-Webpack-HRM-注意事项" class="headerlink" title="42.Webpack HRM 注意事项"></a>42.Webpack HRM 注意事项</h3><ul>
<li>处理 HRM 的代码报错会导致自动刷新</li>
<li>没启用 HRM 的情况下，HRM API 报错</li>
<li>代码中多了一些与业务无关的代码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    hotOnly: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">module</span>.hot)&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="43-Webpack-生产环境优化"><a href="#43-Webpack-生产环境优化" class="headerlink" title="43.Webpack 生产环境优化"></a>43.Webpack 生产环境优化</h3><ul>
<li>生产环境和开发环境有很大的差异</li>
<li>生产环境注重运行效率</li>
<li>开发环境注重开发效率</li>
<li>为不同的工作环境创建不同的配置</li>
</ul>
<h3 id="44-Webpack-不同环境下的配置"><a href="#44-Webpack-不同环境下的配置" class="headerlink" title="44.Webpack 不同环境下的配置"></a>44.Webpack 不同环境下的配置</h3><ul>
<li>配置文件根据环境不同导出不同的配置</li>
<li>一个环境对应一个配置文件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">env, argv</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">const</span> config = &#123;</span><br><span class="line">   ...</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">if</span>(env === <span class="string">'production'</span>)&#123;</span><br><span class="line">   config.mode = <span class="string">'production'</span></span><br><span class="line">   config.devtool = <span class="literal">false</span></span><br><span class="line">   config.plugins = &#123;</span><br><span class="line">     ...config.plugins,</span><br><span class="line">     <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">     <span class="keyword">new</span> CopyWebpackPlugin([<span class="string">'public'</span>])</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="45-Webpack-不同环境的配置文件"><a href="#45-Webpack-不同环境的配置文件" class="headerlink" title="45.Webpack 不同环境的配置文件"></a>45.Webpack 不同环境的配置文件</h3><ul>
<li>yarn add webpack-merge –dev</li>
<li>yarn webpack –config webpack.prod.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.common.js</span></span><br><span class="line"><span class="comment">// webpack.dev.js</span></span><br><span class="line"><span class="comment">// webpack.prod.js</span></span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">'./webpack.common'</span>)</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">  mode: <span class="string">'production'</span>,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">    <span class="keyword">new</span> CopyWebpackPlugin([<span class="string">'public'</span>])</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="46-Webpack-DefinePlugin"><a href="#46-Webpack-DefinePlugin" class="headerlink" title="46.Webpack DefinePlugin"></a>46.Webpack DefinePlugin</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'none'</span>,</span><br><span class="line">  entry: <span class="string">'./src/main.js'</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">      <span class="comment">// API_BASE_URL: '"https://api.example.com"'</span></span><br><span class="line">      API_BASE_URL: <span class="built_in">JSON</span>.stringify(<span class="string">'https://api.example.com'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="47-Webpack-体验-Tree-Shaking"><a href="#47-Webpack-体验-Tree-Shaking" class="headerlink" title="47.Webpack 体验 Tree Shaking"></a>47.Webpack 体验 Tree Shaking</h3><ul>
<li>摇掉代码中未引用部分（dead-code）</li>
<li>在生产环境中自动开启</li>
</ul>
<h3 id="48-Webpack-使用-Tree-Shaking"><a href="#48-Webpack-使用-Tree-Shaking" class="headerlink" title="48.Webpack 使用 Tree Shaking"></a>48.Webpack 使用 Tree Shaking</h3><ul>
<li>Tree Shaking 不是指某个配置选项</li>
<li>一组功能搭配使用后的优化效果</li>
<li>production 模式下自动启动</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'none'</span>,</span><br><span class="line">  entry: <span class="string">'./src/main.js'</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    useExports: <span class="literal">true</span> <span class="comment">// 负责标记枯树叶</span></span><br><span class="line">    minimize: <span class="literal">true</span> <span class="comment">// 负责摇掉它们</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="49-Webpack-合并模块"><a href="#49-Webpack-合并模块" class="headerlink" title="49.Webpack 合并模块"></a>49.Webpack 合并模块</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'none'</span>,</span><br><span class="line">  entry: <span class="string">'./src/main.js'</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    useExports: <span class="literal">true</span> <span class="comment">// 负责标记枯树叶</span></span><br><span class="line">    concatenatModules: <span class="literal">true</span>, <span class="comment">// 尽可能的将所有模块合并并输出到一个函数中，既提升了运行效率，又减少了代码的体积</span></span><br><span class="line">    <span class="comment">// minimize: true // 负责摇掉它们</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="50-Webpack-Tree-Shaking-与-Babel"><a href="#50-Webpack-Tree-Shaking-与-Babel" class="headerlink" title="50.Webpack Tree Shaking 与 Babel"></a>50.Webpack Tree Shaking 与 Babel</h3><ul>
<li>Tree Shaking 前提是 ES Modules</li>
<li>由 Webpack 打包的代码必须使用 ESM</li>
<li>为了转换代码中的 ECMAScript 新特性，很多时候使用 babel-loader，ES Modules -&gt; CommonJS</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'none'</span>,</span><br><span class="line">  entry: <span class="string">'./src/main.js'</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js&amp;/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            <span class="comment">// presets: ['@babel/preset-env']</span></span><br><span class="line">            presets: [</span><br><span class="line">              [<span class="string">'@babel/preset-env'</span>,&#123;<span class="attr">modules</span>: <span class="string">'commonjs'</span>&#125;]</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    useExports: <span class="literal">true</span> <span class="comment">// 负责标记枯树叶</span></span><br><span class="line">    <span class="comment">// concatenatModules: true, // 尽可能的将所有模块合并并输出到一个函数中，既提升了运行效率，又减少了代码的体积</span></span><br><span class="line">    <span class="comment">// minimize: true // 负责摇掉它们</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="51-Webpack-sideEffects"><a href="#51-Webpack-sideEffects" class="headerlink" title="51.Webpack sideEffects"></a>51.Webpack sideEffects</h3><ul>
<li>sideEffects 一般用于 npm 包标记是否有副作用</li>
<li>production 下也会自动开启</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'none'</span>,</span><br><span class="line">  entry: <span class="string">'./src/main.js'</span></span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js&amp;/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">          options: &#123;</span><br><span class="line">            <span class="comment">// presets: ['@babel/preset-env']</span></span><br><span class="line">            presets: [</span><br><span class="line">              [<span class="string">'@babel/preset-env'</span>,&#123;<span class="attr">modules</span>: <span class="string">'commonjs'</span>&#125;]</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    sideEffects: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// useExports: true // 负责标记枯树叶</span></span><br><span class="line">    <span class="comment">// concatenatModules: true, // 尽可能的将所有模块合并并输出到一个函数中，既提升了运行效率，又减少了代码的体积</span></span><br><span class="line">    <span class="comment">// minimize: true // 负责摇掉它们</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  sideEffects: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="52-Webpack-sideEffects-注意"><a href="#52-Webpack-sideEffects-注意" class="headerlink" title="52.Webpack sideEffects 注意"></a>52.Webpack sideEffects 注意</h3><ul>
<li>前提是确保你的代码真的没有副作用</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  sideEffects: [</span><br><span class="line">    <span class="string">"./src/extends.js"</span>,</span><br><span class="line">    <span class="string">"*.css"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="53-Webpack-代码分割"><a href="#53-Webpack-代码分割" class="headerlink" title="53.Webpack 代码分割"></a>53.Webpack 代码分割</h3><ul>
<li>多入口打包</li>
<li>动态导入</li>
</ul>
<h3 id="54-Webpack-多入口打包"><a href="#54-Webpack-多入口打包" class="headerlink" title="54.Webpack 多入口打包"></a>54.Webpack 多入口打包</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 注意这里是对象</span></span><br><span class="line">  entry: &#123;</span><br><span class="line">    index: <span class="string">'./src/index.js'</span></span><br><span class="line">    album: <span class="string">'./src/album.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">'[name].bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      titile: <span class="string">'Multi Entry'</span>,</span><br><span class="line">      template: <span class="string">'./src/index.html'</span>,</span><br><span class="line">      filename: <span class="string">'index.html'</span>,</span><br><span class="line">      chunks: [<span class="string">'index'</span>]</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      titile: <span class="string">'Multi Entry'</span>,</span><br><span class="line">      template: <span class="string">'./src/album.html'</span>,</span><br><span class="line">      filename: <span class="string">'album.html'</span>,</span><br><span class="line">      chunks: [<span class="string">'album'</span>]</span><br><span class="line">    &#125;), </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="55-Webpack-提取公共模块"><a href="#55-Webpack-提取公共模块" class="headerlink" title="55.Webpack 提取公共模块"></a>55.Webpack 提取公共模块</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line">&#123;</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      chunks: <span class="string">'all'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="56-Webpack-动态导入"><a href="#56-Webpack-动态导入" class="headerlink" title="56.Webpack 动态导入"></a>56.Webpack 动态导入</h3><ul>
<li>需要用到某个模块时，再加载这个模块</li>
<li>动态导入的模块会被自动分包</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> render = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> hash = <span class="built_in">window</span>.location.hash || <span class="string">'#posts'</span></span><br><span class="line">  <span class="keyword">const</span> mainElement = <span class="built_in">document</span>.querySelector(<span class="string">'.main'</span>)</span><br><span class="line">  mainElement.innerHTML = <span class="string">''</span></span><br><span class="line">  <span class="keyword">if</span>(hash === <span class="string">'#posts'</span>)&#123;</span><br><span class="line">    <span class="keyword">import</span>(<span class="string">'./posts/posts'</span>).then(<span class="function">(<span class="params">&#123;<span class="keyword">default</span>: posts&#125;</span>)) =&gt;</span> &#123;</span><br><span class="line">      mainElement.appendChild(posts())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hash === <span class="string">'#album'</span>) &#123;</span><br><span class="line">    <span class="keyword">import</span>(<span class="string">'./album/album'</span>).then(<span class="function">(<span class="params">&#123;<span class="keyword">default</span>: album&#125;</span>)) =&gt;</span> &#123;</span><br><span class="line">      mainElement.appendChild(album())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="57-Webpack-魔法注释"><a href="#57-Webpack-魔法注释" class="headerlink" title="57.Webpack 魔法注释"></a>57.Webpack 魔法注释</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> render = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> hash = <span class="built_in">window</span>.location.hash || <span class="string">'#posts'</span></span><br><span class="line">  <span class="keyword">const</span> mainElement = <span class="built_in">document</span>.querySelector(<span class="string">'.main'</span>)</span><br><span class="line">  mainElement.innerHTML = <span class="string">''</span></span><br><span class="line">  <span class="keyword">if</span>(hash === <span class="string">'#posts'</span>)&#123;</span><br><span class="line">    <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: 'posts' */</span><span class="string">'./posts/posts'</span>).then(<span class="function">(<span class="params">&#123;<span class="keyword">default</span>: posts&#125;</span>)) =&gt;</span> &#123;</span><br><span class="line">      mainElement.appendChild(posts())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hash === <span class="string">'#album'</span>) &#123;</span><br><span class="line">    <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: 'album' */</span><span class="string">'./album/album'</span>).then(<span class="function">(<span class="params">&#123;<span class="keyword">default</span>: album&#125;</span>)) =&gt;</span> &#123;</span><br><span class="line">      mainElement.appendChild(album())</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="58-Webpack-MiniCssExtractPlugin"><a href="#58-Webpack-MiniCssExtractPlugin" class="headerlink" title="58.Webpack MiniCssExtractPlugin"></a>58.Webpack MiniCssExtractPlugin</h3><ul>
<li>yarn add mini-css-extract-plugin</li>
<li>建议超过 150kb 再单独提取</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  moudle: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          MiniCssExtractPlugin.loader,</span><br><span class="line">          <span class="string">'css-loader'</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="59-Webpack-OptimizeCssAssetsWebpackPlugin"><a href="#59-Webpack-OptimizeCssAssetsWebpackPlugin" class="headerlink" title="59.Webpack OptimizeCssAssetsWebpackPlugin"></a>59.Webpack OptimizeCssAssetsWebpackPlugin</h3><ul>
<li>yarn add optimize-css-assets-webpack-plugin</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> OptimizeCssAssetsWebpackPlugin = <span class="built_in">require</span>(<span class="string">'optimize-css-assets-webpack-plugin'</span>)</span><br><span class="line"><span class="keyword">const</span> TerserWebpackPlugin = <span class="built_in">require</span>(<span class="string">'rerser-webpack-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  moudle: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          MiniCssExtractPlugin.loader,</span><br><span class="line">          <span class="string">'css-loader'</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    minimizer: [</span><br><span class="line">      <span class="keyword">new</span> TerserWebpackPlugin(),</span><br><span class="line">      <span class="keyword">new</span> OptimizeCssAssetsWebpackPlugin()</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="comment">// new OptimizeCssAssetsWebpackPlugin()</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="60-Webpack-输出文件名-Hash"><a href="#60-Webpack-输出文件名-Hash" class="headerlink" title="60.Webpack 输出文件名 Hash"></a>60.Webpack 输出文件名 Hash</h3><ul>
<li>生产模式下，文件名使用 Hash</li>
<li>hash chunkhash contenthash<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mode: <span class="string">'none'</span>,</span><br><span class="line">  entry: &#123;</span><br><span class="line">    main: <span class="string">'./src/index.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    <span class="comment">// filename: '[name]-[hash].bundle.js'</span></span><br><span class="line">    <span class="comment">// filename: '[name]-[chunkhash].bundle.js'</span></span><br><span class="line">    filename: <span class="string">'[name]-[contenthash:8].bundle.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      <span class="comment">// filename: '[name]-[hash].bundle.css'</span></span><br><span class="line">      <span class="comment">// filename: '[name]-[chunkhash].bundle.css'</span></span><br><span class="line">      filename: <span class="string">'[name]-[contenthash:8].bundle.css'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="任务三：其他打包工具"><a href="#任务三：其他打包工具" class="headerlink" title="任务三：其他打包工具"></a>任务三：其他打包工具</h2><h3 id="1-Rollup-概述"><a href="#1-Rollup-概述" class="headerlink" title="1.Rollup 概述"></a>1.Rollup 概述</h3><ul>
<li>仅仅是一款 ESM 打包器</li>
<li>Rollup 中并不支持类似 HMR 这种高级特性</li>
<li>提供一个充分利用 ESM 各项特性的高效打包器</li>
</ul>
<h3 id="2-Rollup-快速上手"><a href="#2-Rollup-快速上手" class="headerlink" title="2.Rollup 快速上手"></a>2.Rollup 快速上手</h3><ul>
<li>yarn add rollup –dev</li>
<li>yarn rollup ./src/index.js –format iife –file dist/bundle.js</li>
</ul>
<h3 id="3-Rollup-配置文件"><a href="#3-Rollup-配置文件" class="headerlink" title="3.Rollup 配置文件"></a>3.Rollup 配置文件</h3><ul>
<li>yarn rollup –config rollup.config.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rollup.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  input: <span class="string">'src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    file: <span class="string">'dist/bundle.js'</span>,</span><br><span class="line">    format: <span class="string">'iife'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-Rollup-使用插件"><a href="#4-Rollup-使用插件" class="headerlink" title="4.Rollup 使用插件"></a>4.Rollup 使用插件</h3><ul>
<li>插件是 Rollup 唯一的扩展途径</li>
<li>yarn add rollup-plugin-json</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rollup.config.js</span></span><br><span class="line"><span class="keyword">import</span> json <span class="keyword">from</span> <span class="string">'rollup-plugin-json'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  input: <span class="string">'src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    file: <span class="string">'dist/bundle.js'</span>,</span><br><span class="line">    format: <span class="string">'iife'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    json()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-Rollup-加载-NPM-模块"><a href="#5-Rollup-加载-NPM-模块" class="headerlink" title="5.Rollup 加载 NPM 模块"></a>5.Rollup 加载 NPM 模块</h3><ul>
<li>yarn add rollup-plugin-node-resolve –dev</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rollup.config.js</span></span><br><span class="line"><span class="keyword">import</span> json <span class="keyword">from</span> <span class="string">'rollup-plugin-json'</span></span><br><span class="line"><span class="keyword">import</span> resolve <span class="keyword">from</span> <span class="string">'rollup-plugin-node-resolve'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  input: <span class="string">'src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    file: <span class="string">'dist/bundle.js'</span>,</span><br><span class="line">    format: <span class="string">'iife'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    json(),</span><br><span class="line">    resolve()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-Rollup-加载-CommonJS-模块"><a href="#6-Rollup-加载-CommonJS-模块" class="headerlink" title="6.Rollup 加载 CommonJS 模块"></a>6.Rollup 加载 CommonJS 模块</h3><ul>
<li>yarn add rollup-plugin-commonjs –dev</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rollup.config.js</span></span><br><span class="line"><span class="keyword">import</span> json <span class="keyword">from</span> <span class="string">'rollup-plugin-json'</span></span><br><span class="line"><span class="keyword">import</span> resolve <span class="keyword">from</span> <span class="string">'rollup-plugin-node-resolve'</span></span><br><span class="line"><span class="keyword">import</span> commonjs <span class="keyword">from</span> <span class="string">'rollup-plugin-commonjs'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  input: <span class="string">'src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    file: <span class="string">'dist/bundle.js'</span>,</span><br><span class="line">    format: <span class="string">'iife'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    json(),</span><br><span class="line">    resolve(),</span><br><span class="line">    commonjs()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-Rollup-代码拆分"><a href="#7-Rollup-代码拆分" class="headerlink" title="7.Rollup 代码拆分"></a>7.Rollup 代码拆分</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span>(<span class="string">'./logger'</span>).then(<span class="function">(<span class="params">&#123;log&#125;</span>)=&gt;</span>&#123;</span><br><span class="line">  log(<span class="string">'code splitting~'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// rollup.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  input: <span class="string">'src/index.js'</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    dir: <span class="string">'dist'</span>,</span><br><span class="line">    format: <span class="string">'amd'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-Rollup-多入口打包"><a href="#8-Rollup-多入口打包" class="headerlink" title="8.Rollup 多入口打包"></a>8.Rollup 多入口打包</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rollup.config.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  input: &#123;</span><br><span class="line">    foo: <span class="string">'src/index.js'</span>,</span><br><span class="line">    bar: <span class="string">'src/album.js'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    dir: <span class="string">'dist'</span>,</span><br><span class="line">    format: <span class="string">'amd'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// index.html</span></span><br><span class="line">&lt;script src=<span class="string">"https://unpkg.com/requirejs@2.3.6/require.js"</span> data-main=<span class="string">"foo.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="8-Rollup-选用原则"><a href="#8-Rollup-选用原则" class="headerlink" title="8.Rollup 选用原则"></a>8.Rollup 选用原则</h3><ul>
<li>输出结果更加扁平</li>
<li>自动移除未引用代码</li>
<li>打包结果依然完全可读</li>
<li>加载非 ESM 的第三方模块比较复杂</li>
<li>模块最终都被打包到一个函数中，无法实现 HMR</li>
<li>浏览器环境中，代码拆分功能依赖 AMD 库</li>
<li>应用开发使用 Webpack</li>
<li>库/框架开发使用 Rollup</li>
</ul>
<h3 id="9-Parcel"><a href="#9-Parcel" class="headerlink" title="9.Parcel"></a>9.Parcel</h3><ul>
<li>yarn add parcel-bundler</li>
<li>yarn parcel src/index.html</li>
<li>yarn parcel build src/index.html</li>
</ul>
<h2 id="任务四：规范化标准"><a href="#任务四：规范化标准" class="headerlink" title="任务四：规范化标准"></a>任务四：规范化标准</h2><h3 id="1-规范化介绍"><a href="#1-规范化介绍" class="headerlink" title="1.规范化介绍"></a>1.规范化介绍</h3><ul>
<li>为什么要有规范标准<ul>
<li>软件开发需要多人协同</li>
<li>不同开发者具有不同的编码习惯和喜好</li>
<li>不同的喜好增加项目维护成本</li>
<li>每个项目或者团队需要明确统一的标准</li>
</ul>
</li>
<li>哪里需要规范化标准<ul>
<li>代码、文档、甚至是提交日志</li>
<li>开发过程中人为编写的成果物</li>
<li>代码标准化规范最为重要</li>
</ul>
</li>
<li>实施规范化的方法<ul>
<li>编码前人为的标准约定</li>
<li>通过工具实现 Lint</li>
</ul>
</li>
<li>常见的规范化实现方式<ul>
<li>ESLint 工具使用</li>
<li>定制 ESLint 校验规则</li>
<li>ESLint 对 TypeScript 支持</li>
<li>ESLint 结合自动化工具或者 Webpack</li>
<li>基于 ESLint 的衍生工具</li>
<li>Stylelint 工具的使用</li>
</ul>
</li>
</ul>
<h3 id="2-ESLint-介绍"><a href="#2-ESLint-介绍" class="headerlink" title="2.ESLint 介绍"></a>2.ESLint 介绍</h3><ul>
<li>最为主流的 JavaScript Lint 工具 监测 JS 代码质量</li>
<li>ESLint 很容易统一开发者的编码风格</li>
<li>ESLint 可以帮助开发者提升编码能力</li>
</ul>
<h3 id="3-ESLint-安装"><a href="#3-ESLint-安装" class="headerlink" title="3.ESLint 安装"></a>3.ESLint 安装</h3><ul>
<li><p>ESLint 安装步骤</p>
<ul>
<li>初始化项目</li>
<li>安装 ESLint 模块为开发依赖</li>
<li>通过 CLI 命令验证安装结果</li>
</ul>
</li>
<li><p>npm install eslint –dev</p>
</li>
<li><p>npx eslint –version</p>
</li>
</ul>
<h3 id="4-ESLint-快速上手"><a href="#4-ESLint-快速上手" class="headerlink" title="4.ESLint 快速上手"></a>4.ESLint 快速上手</h3><ul>
<li><p>npx eslint –init</p>
</li>
<li><p>ESLint 检查步骤</p>
<ul>
<li>编写 “问题” 代码</li>
<li>使用 eslint 执行监测</li>
<li>完成 eslint 使用配置</li>
</ul>
</li>
</ul>
<h3 id="5-ESLint-配置文件解析"><a href="#5-ESLint-配置文件解析" class="headerlink" title="5.ESLint 配置文件解析"></a>5.ESLint 配置文件解析</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .eslintrc.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: <span class="literal">true</span>,</span><br><span class="line">    es2020: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  extends: [</span><br><span class="line">    <span class="string">'standard'</span></span><br><span class="line">  ],</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    ecmaVersion: <span class="number">11</span></span><br><span class="line">  &#125;,</span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="string">'no-alert'</span>: <span class="string">"error"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  globals: &#123;</span><br><span class="line">    <span class="string">"jQuery"</span>: <span class="string">"readonly"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-ESLint-配置注释"><a href="#6-ESLint-配置注释" class="headerlink" title="6.ESLint 配置注释"></a>6.ESLint 配置注释</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str1 = <span class="string">"$&#123;name&#125; is a coder"</span> <span class="comment">// eslint-disable-line no-template-curly-in-string</span></span><br><span class="line"><span class="built_in">console</span>.log(str1)</span><br></pre></td></tr></table></figure>

<h3 id="7-ESLint-结合自动化工具"><a href="#7-ESLint-结合自动化工具" class="headerlink" title="7.ESLint 结合自动化工具"></a>7.ESLint 结合自动化工具</h3><ul>
<li>集成之后，ESLint 一定会工作</li>
<li>与项目统一，管理更加方便</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// plugins.eslint.format()</span></span><br><span class="line"><span class="comment">// plugins.eslint.failAfterError()</span></span><br></pre></td></tr></table></figure>

<h3 id="8-ESLint-结合-Webpack"><a href="#8-ESLint-结合-Webpack" class="headerlink" title="8.ESLint 结合 Webpack"></a>8.ESLint 结合 Webpack</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        use: <span class="string">'babel-loader'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        use: <span class="string">'eslint-loader'</span>,</span><br><span class="line">        enforce: <span class="string">'pre'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">'style-loader'</span>,</span><br><span class="line">          <span class="string">'css-loader'</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-ESLint-结合-Webpack-后续配置"><a href="#9-ESLint-结合-Webpack-后续配置" class="headerlink" title="9.ESLint 结合 Webpack 后续配置"></a>9.ESLint 结合 Webpack 后续配置</h3><ul>
<li>npm install eslint-plugin-react</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .eslintrc.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: <span class="literal">true</span>,</span><br><span class="line">    es2020: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  extends: [</span><br><span class="line">    <span class="string">'standard'</span>,</span><br><span class="line">    <span class="string">'plugin:react/recommended'</span></span><br><span class="line">  ],</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    ecmaVersion: <span class="number">11</span></span><br><span class="line">  &#125;,</span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="comment">// 'react/jsx-uses-react': 2,</span></span><br><span class="line">    <span class="comment">// 'react/jsx-uses-vars': 2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// plugins: [</span></span><br><span class="line">  <span class="comment">//   'react'</span></span><br><span class="line">  <span class="comment">// ]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-现代化项目集成-ESLint"><a href="#10-现代化项目集成-ESLint" class="headerlink" title="10.现代化项目集成 ESLint"></a>10.现代化项目集成 ESLint</h3><p>略</p>
<h3 id="11-ESLint-检查-TypeScript"><a href="#11-ESLint-检查-TypeScript" class="headerlink" title="11.ESLint 检查 TypeScript"></a>11.ESLint 检查 TypeScript</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .eslintrc.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: <span class="literal">true</span>,</span><br><span class="line">    es2020: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  extends: [</span><br><span class="line">    <span class="string">'standard'</span>,</span><br><span class="line">  ],</span><br><span class="line">  parser: <span class="string">'@typescript-eslint/parser'</span>,</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    ecmaVersion: <span class="number">11</span></span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="string">'@typescript-eslint'</span></span><br><span class="line">  ],</span><br><span class="line">  rules: &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="12-Stylelint-认识"><a href="#12-Stylelint-认识" class="headerlink" title="12.Stylelint 认识"></a>12.Stylelint 认识</h3><ul>
<li>提供默认的代码检查规则</li>
<li>提供 CLI 工具，快速调用</li>
<li>通过插件支持 Sass Less PostCss</li>
<li>支持 Gulp 或 Webpack 集成</li>
<li>npm install stylelint -D</li>
<li>npm install stylelint-config-standard</li>
<li>npm install stylelint-config-sass-guidelines -D</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .stylelintrc.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  extends: [</span><br><span class="line">    <span class="string">"stylelint-config-standard"</span>,</span><br><span class="line">    <span class="string">"stylelint-config-sass-guidelines"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-Prettier-的使用"><a href="#13-Prettier-的使用" class="headerlink" title="13.Prettier 的使用"></a>13.Prettier 的使用</h3><ul>
<li>npm install prettier</li>
<li>npx prettier style.css –write</li>
</ul>
<h3 id="14-Git-Hooks-工作机制"><a href="#14-Git-Hooks-工作机制" class="headerlink" title="14.Git Hooks 工作机制"></a>14.Git Hooks 工作机制</h3><ul>
<li>Git Hooks 也称之为 git 钩子，每个钩子都对应一个任务</li>
<li>通过 shell 脚本可以编写钩子任务触发时要看具体执行的操作</li>
</ul>
<h3 id="15-ESLint-结合-Git-Hooks"><a href="#15-ESLint-结合-Git-Hooks" class="headerlink" title="15.ESLint 结合 Git Hooks"></a>15.ESLint 结合 Git Hooks</h3><ul>
<li>npm install husky -D</li>
<li>npm install lint-staged -D<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"test"</span>: <span class="string">"eslint ./index.js"</span>,</span><br><span class="line">    <span class="string">"precommit"</span>: <span class="string">"lint-staged"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"husky"</span>: &#123;</span><br><span class="line">    <span class="string">"hooks"</span>: &#123;</span><br><span class="line">      <span class="string">"pre-commit"</span>: <span class="string">"npm run precommit"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"lint-staged"</span>: &#123;</span><br><span class="line">    <span class="string">"*.js"</span>: [</span><br><span class="line">      <span class="string">"eslint"</span>,</span><br><span class="line">      <span class="string">"git add"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/22/28/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旋の飞羽">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/11/22/28/" itemprop="url">学习笔记 ----- 【前端工程化实践】开发脚手架及封装自动化构建工作流</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-11-22T00:00:00+08:00">
                2020-11-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>作者：FY<br>引用请标明出处</p>
</blockquote>
<h1 id="Part-2-·-前端工程化实践"><a href="#Part-2-·-前端工程化实践" class="headerlink" title="Part 2 · 前端工程化实践"></a>Part 2 · 前端工程化实践</h1><h2 id="模块一：开发脚手架及封装自动化构建工作流"><a href="#模块一：开发脚手架及封装自动化构建工作流" class="headerlink" title="模块一：开发脚手架及封装自动化构建工作流"></a>模块一：开发脚手架及封装自动化构建工作流</h2><h2 id="任务一：工程化概述"><a href="#任务一：工程化概述" class="headerlink" title="任务一：工程化概述"></a>任务一：工程化概述</h2><h3 id="1-工程化的定义和主要解决的问题"><a href="#1-工程化的定义和主要解决的问题" class="headerlink" title="1.工程化的定义和主要解决的问题"></a>1.工程化的定义和主要解决的问题</h3><ul>
<li>主要解决的问题<ul>
<li>传统语言或语法的弊端</li>
<li>无法使用模块化/组件化</li>
<li>重复的机械式工作</li>
<li>代码风格统一、质量保证</li>
<li>依赖后端服务接口支持</li>
<li>整体依赖后端项目</li>
</ul>
</li>
</ul>
<h3 id="2-一个项目过程中工程化的体现"><a href="#2-一个项目过程中工程化的体现" class="headerlink" title="2.一个项目过程中工程化的体现"></a>2.一个项目过程中工程化的体现</h3><ul>
<li>一切以提高效率、降低成本、质量保证为目的的手段都属于<strong>工程化</strong></li>
<li>一切重复的工作都应该被自动化<ul>
<li>创建项目<ul>
<li>创建项目结构</li>
<li>创建特定类型文件</li>
</ul>
</li>
<li>编码<ul>
<li>格式化代码</li>
<li>校验代码风格</li>
<li>编译/构建/打包</li>
</ul>
</li>
<li>预览/测试<ul>
<li>Web Server / Mock</li>
<li>Live Reloading / HMR</li>
<li>Source Map</li>
</ul>
</li>
<li>提交<ul>
<li>Git Hooks</li>
<li>Lint-staged</li>
<li>持续集成</li>
</ul>
</li>
<li>部署<ul>
<li>CI / CD</li>
<li>自动发布</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="3-工程化不等于工具"><a href="#3-工程化不等于工具" class="headerlink" title="3.工程化不等于工具"></a>3.工程化不等于工具</h3><ul>
<li>一些成熟的工程化集成<ul>
<li>create-react-app</li>
<li>vue-cli</li>
<li>angular-cli</li>
<li>gatsby-cli</li>
</ul>
</li>
</ul>
<h3 id="4-工程化与Node-js"><a href="#4-工程化与Node-js" class="headerlink" title="4.工程化与Node.js"></a>4.工程化与Node.js</h3><ul>
<li>内容概要<ul>
<li>脚手架工具开发</li>
<li>自动化构建系统</li>
<li>模块化打包</li>
<li>项目代码规范化</li>
<li>自动化部署</li>
</ul>
</li>
</ul>
<h2 id="任务二：脚手架工具"><a href="#任务二：脚手架工具" class="headerlink" title="任务二：脚手架工具"></a>任务二：脚手架工具</h2><h3 id="1-脚手架工具概要"><a href="#1-脚手架工具概要" class="headerlink" title="1.脚手架工具概要"></a>1.脚手架工具概要</h3><ul>
<li><p>脚手架的本质作用</p>
<ul>
<li>创建项目基础结构、提供项目规范和约定<ul>
<li>相同的组织结构</li>
<li>相同的开发范式</li>
<li>相同的模块依赖</li>
<li>相同的工具配置</li>
<li>相同的基础代码</li>
</ul>
</li>
</ul>
</li>
<li><p>内容概要</p>
<ul>
<li>脚手架的作用</li>
<li>常用的脚手架工具</li>
<li>通用脚手架工具剖析</li>
<li>开发一款脚手架</li>
</ul>
</li>
</ul>
<h3 id="2-常用的脚手架工具"><a href="#2-常用的脚手架工具" class="headerlink" title="2.常用的脚手架工具"></a>2.常用的脚手架工具</h3><ul>
<li>React 项目 -&gt; create-react-app</li>
<li>Vue.js 项目 -&gt; vue-cli</li>
<li>Angular 项目 -&gt; angular-cli</li>
<li>Yeoman</li>
<li>Plop</li>
</ul>
<h3 id="3-Yeoman-简介"><a href="#3-Yeoman-简介" class="headerlink" title="3.Yeoman 简介"></a>3.Yeoman 简介</h3><ul>
<li>用于创造现代化Web应用的脚手架工具</li>
</ul>
<h3 id="4-Yeoman-基础使用"><a href="#4-Yeoman-基础使用" class="headerlink" title="4.Yeoman 基础使用"></a>4.Yeoman 基础使用</h3><ul>
<li>在全局范围安装 yo<ul>
<li>$ npm install yo –global # or yarn global add yo</li>
</ul>
</li>
<li>安装对应的 generator<ul>
<li>$ npm install generator-node –global # or yarn global add generator-node</li>
</ul>
</li>
<li>通过 yo 运行 generator<ul>
<li>$ cd path/to/project-dir</li>
<li>$ mkdir my-module</li>
<li>$ yo node</li>
</ul>
</li>
</ul>
<h3 id="5-Sub-Generator"><a href="#5-Sub-Generator" class="headerlink" title="5.Sub Generator"></a>5.Sub Generator</h3><ul>
<li>略</li>
</ul>
<h3 id="6-Yeoman-使用步骤总结"><a href="#6-Yeoman-使用步骤总结" class="headerlink" title="6.Yeoman 使用步骤总结"></a>6.Yeoman 使用步骤总结</h3><ul>
<li>明确你的需求</li>
<li>找到合适的 Generator</li>
<li>全局范围安装找到的 Generator</li>
<li>通过 Yo 运行对应的 Generator</li>
<li>通过命令行交互填写选项</li>
<li>生成你所需要的项目结构</li>
</ul>
<h3 id="7-自定义-Generator"><a href="#7-自定义-Generator" class="headerlink" title="7.自定义 Generator"></a>7.自定义 Generator</h3><ul>
<li>略</li>
</ul>
<h3 id="8-创建-Generator-模块"><a href="#8-创建-Generator-模块" class="headerlink" title="8.创建 Generator 模块"></a>8.创建 Generator 模块</h3><ul>
<li>Generator 本质上就是一个 NPM 模块</li>
<li>略</li>
</ul>
<h3 id="9-根据模板创建文件"><a href="#9-根据模板创建文件" class="headerlink" title="9.根据模板创建文件"></a>9.根据模板创建文件</h3><ul>
<li>相对于手动创建每一个文件，模板的方式大大提高了效率</li>
</ul>
<h3 id="10-接收用户输入"><a href="#10-接收用户输入" class="headerlink" title="10.接收用户输入"></a>10.接收用户输入</h3><ul>
<li>略</li>
</ul>
<h3 id="11-Vue-Generator-案例"><a href="#11-Vue-Generator-案例" class="headerlink" title="11.Vue Generator 案例"></a>11.Vue Generator 案例</h3><ul>
<li>略</li>
</ul>
<h3 id="12-发布-Generator"><a href="#12-发布-Generator" class="headerlink" title="12.发布 Generator"></a>12.发布 Generator</h3><ul>
<li>略</li>
</ul>
<h3 id="13-Plop-简介"><a href="#13-Plop-简介" class="headerlink" title="13.Plop 简介"></a>13.Plop 简介</h3><ul>
<li>一个小而美的脚手架工具</li>
</ul>
<h3 id="14-Plop-的基本使用"><a href="#14-Plop-的基本使用" class="headerlink" title="14.Plop 的基本使用"></a>14.Plop 的基本使用</h3><ul>
<li>将plop模块作为项目开发依赖安装</li>
<li>在项目根目录下创建一个plopfile.js文件</li>
<li>在plopfile.js文件中定义脚手架任务</li>
<li>编写用于生成特定类型文件的模板</li>
<li>通过Plop提供的CLI运行脚手架任务</li>
</ul>
<h3 id="15-脚手架的工作原理"><a href="#15-脚手架的工作原理" class="headerlink" title="15.脚手架的工作原理"></a>15.脚手架的工作原理</h3><ul>
<li>略</li>
</ul>
<h2 id="任务三：自动化构建"><a href="#任务三：自动化构建" class="headerlink" title="任务三：自动化构建"></a>任务三：自动化构建</h2><h3 id="1-自动化构建简介"><a href="#1-自动化构建简介" class="headerlink" title="1.自动化构建简介"></a>1.自动化构建简介</h3><ul>
<li>自动化构建工作流<ul>
<li>源代码 =&gt; 自动化构建 =&gt; 生产代码</li>
<li>脱离运行环境兼容带来的问题</li>
<li>使用提高效率的语法、规范和标准<ul>
<li>ECMAScript Next</li>
<li>Sass</li>
<li>模板引擎</li>
<li>这些用法大都不被浏览器直接支持</li>
</ul>
</li>
</ul>
</li>
<li>构建转换那些不被支持的<strong>特性</strong></li>
</ul>
<h3 id="2-自动化构建初体验"><a href="#2-自动化构建初体验" class="headerlink" title="2.自动化构建初体验"></a>2.自动化构建初体验</h3><ul>
<li>NPM Scripts 实现自动化构建工作流的最简方式</li>
</ul>
<h3 id="3-常用的自动化构建工具"><a href="#3-常用的自动化构建工具" class="headerlink" title="3.常用的自动化构建工具"></a>3.常用的自动化构建工具</h3><ul>
<li>Grunt 工作过程基于临时文件去实现，构建速度相对较慢</li>
<li>Gulp 基于内存去实现，默认支持同时执行多个任务</li>
<li>FIS 资源加载、模块化开发、代码部署、性能优化</li>
</ul>
<h3 id="4-Grunt-的基本使用"><a href="#4-Grunt-的基本使用" class="headerlink" title="4.Grunt 的基本使用"></a>4.Grunt 的基本使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span> &#123;</span><br><span class="line">    grunt.registerTask(<span class="string">'foo'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'hello grunt~'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    grunt.registerTask(<span class="string">'bar'</span>, <span class="string">'任务描述'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'other task~'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// grunt.registerTask('default', () =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//     console.log('default task~')</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    grunt.registerTask(<span class="string">'default'</span>, [<span class="string">'foo'</span>, <span class="string">'bar'</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">// grunt.registerTask('async-task', () =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//       setTimeout(() =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//           console.log('async task working~')</span></span><br><span class="line">    <span class="comment">//       &#125;, 1000);</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">    grunt.registerTask(<span class="string">'async-task'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> done = <span class="keyword">this</span>.async()</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'async task working~'</span>)</span><br><span class="line">            done()</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-Grunt-标记任务失败"><a href="#5-Grunt-标记任务失败" class="headerlink" title="5.Grunt 标记任务失败"></a>5.Grunt 标记任务失败</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span> &#123;</span><br><span class="line">    grunt.registerTask(<span class="string">'bad'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'bad working~'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">    grunt.registerTask(<span class="string">'bad-async'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> done = <span class="keyword">this</span>.async()</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'bad async'</span>)</span><br><span class="line">            done(<span class="literal">false</span>)</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-Grunt-的配置方法"><a href="#6-Grunt-的配置方法" class="headerlink" title="6.Grunt 的配置方法"></a>6.Grunt 的配置方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span> &#123;</span><br><span class="line">    grunt.initConfig(&#123;</span><br><span class="line">      <span class="comment">// foo: 'bar'</span></span><br><span class="line">      foo: &#123;</span><br><span class="line">        bar: <span class="number">123</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    grunt.registerTask(<span class="string">'foo'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="comment">// console,log(grunt.config('foo'))</span></span><br><span class="line">      <span class="built_in">console</span>,log(grunt.config(<span class="string">'foo.bar'</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-Grunt-多目标任务"><a href="#7-Grunt-多目标任务" class="headerlink" title="7.Grunt 多目标任务"></a>7.Grunt 多目标任务</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span> &#123;</span><br><span class="line">    grunt.initConfig(&#123;</span><br><span class="line">      <span class="string">'build'</span>: &#123;</span><br><span class="line">        options:&#123;</span><br><span class="line">           foo: <span class="string">'bar'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        css: &#123;</span><br><span class="line">          options: &#123;</span><br><span class="line">            foo: <span class="string">'baz'</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        js: <span class="string">'2'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    grunt.registerMultiTask(<span class="string">'build'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.options())</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`target: <span class="subst">$&#123;<span class="keyword">this</span>.target&#125;</span>, data: <span class="subst">$&#123;<span class="keyword">this</span>.data&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-Grunt-插件的使用"><a href="#8-Grunt-插件的使用" class="headerlink" title="8.Grunt 插件的使用"></a>8.Grunt 插件的使用</h3><ul>
<li>yarn add grunt-contrib-clean 用来自动清除项目开发过程中产生的一些临时文件</li>
<li>yarn grunt clean</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span> &#123;</span><br><span class="line">  grunt.initConfig(&#123;</span><br><span class="line">    clean: &#123;</span><br><span class="line">      temp: <span class="string">'temp/**'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  grunt.loadNpmTasks(<span class="string">'grunt-contrib-clean'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-Grunt-常用插件及总结"><a href="#9-Grunt-常用插件及总结" class="headerlink" title="9.Grunt 常用插件及总结"></a>9.Grunt 常用插件及总结</h3><ul>
<li>yarn add grunt-sass sass –dev</li>
<li>yarn add grunt-babel @babel/core @babel/preset-env –dev</li>
<li>yarn add load-grunt-tasks –dev</li>
<li>yarn add grunt-contrib-watch –dev</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sass = <span class="built_in">require</span>(<span class="string">'sass'</span>)</span><br><span class="line"><span class="keyword">const</span> loadGruntTasks = <span class="built_in">require</span>(<span class="string">'load-grunt-tasks'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span> &#123;</span><br><span class="line">  grunt.initConfig(&#123;</span><br><span class="line">    sass: &#123;</span><br><span class="line">      options: &#123;</span><br><span class="line">        sourceMap: <span class="literal">true</span>,</span><br><span class="line">        implementation: sass</span><br><span class="line">      &#125;,</span><br><span class="line">      main: &#123;</span><br><span class="line">        files: &#123;</span><br><span class="line">          <span class="string">'dist/css/main.css'</span>: <span class="string">'src/scss/main.scss'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    babel: &#123;</span><br><span class="line">      options: &#123;</span><br><span class="line">        sourceMap: <span class="literal">true</span>,</span><br><span class="line">        presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">      &#125;</span><br><span class="line">      main: &#123;</span><br><span class="line">        files: &#123;</span><br><span class="line">          <span class="string">'dist/js/app.js'</span>: <span class="string">'src/js/app.js'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    watch: &#123;</span><br><span class="line">      js: &#123;</span><br><span class="line">        files: [<span class="string">'src/js/*.js'</span>],</span><br><span class="line">        tasks: [<span class="string">'babel'</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      css: &#123;</span><br><span class="line">        files: [<span class="string">'src/scss/*.scss'</span>],</span><br><span class="line">        tasks: [<span class="string">'sass'</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// grunt.loadNpmTasks('grunt-sass')</span></span><br><span class="line">  loadGruntTasks(grunt) <span class="comment">// 自动加载所有的 grunt 插件中的任务</span></span><br><span class="line">  grunt.registerTask(<span class="string">'default'</span>,[<span class="string">'sass'</span>,<span class="string">'babel'</span>,<span class="string">'watch'</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-Gulp-的基本使用"><a href="#10-Gulp-的基本使用" class="headerlink" title="10.Gulp 的基本使用"></a>10.Gulp 的基本使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gulp 入口文件 gulpfile.js</span></span><br><span class="line">exports.foo = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'foo task working~'</span>)</span><br><span class="line">    done() <span class="comment">// 标识任务完成</span></span><br><span class="line">&#125;</span><br><span class="line">exports.default = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'default task working~'</span>)</span><br><span class="line">    done() </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-Gulp-的组合任务"><a href="#11-Gulp-的组合任务" class="headerlink" title="11.Gulp 的组合任务"></a>11.Gulp 的组合任务</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; series,, parallel &#125; = <span class="built_in">require</span>(<span class="string">'gulp'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> task1 = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'task1 working~'</span>)</span><br><span class="line">    done()</span><br><span class="line">  &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> task2 = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'task2 working~'</span>)</span><br><span class="line">    done()</span><br><span class="line">  &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> task3 = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'task3 working~'</span>)</span><br><span class="line">    done()</span><br><span class="line">  &#125;,<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.foo = series(task1, task2, task3) <span class="comment">// 串行</span></span><br><span class="line">exports.bar = parallel(task1, task2, task3) <span class="comment">// 并行</span></span><br></pre></td></tr></table></figure>

<h3 id="12-Gulp-的异步任务"><a href="#12-Gulp-的异步任务" class="headerlink" title="12.Gulp 的异步任务"></a>12.Gulp 的异步任务</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line">exports.callback = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'callback task~'</span>)</span><br><span class="line">  done()</span><br><span class="line">&#125;</span><br><span class="line">exports.callback_error = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'callback task~'</span>)</span><br><span class="line">  done(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'task failed!'</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.promise = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise task~'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve()</span><br><span class="line">&#125;</span><br><span class="line">exports.promise_error = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise task~'</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'task failed!'</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> timeout = <span class="function"><span class="params">time</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    setTimeout(resolve, time)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">exports.async = <span class="keyword">async</span>() =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> timeout(<span class="number">1000</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'async task~'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.stream = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> readStream = fs.createReadStream(<span class="string">'package,json'</span>)</span><br><span class="line">  <span class="keyword">const</span> writeStream = fs.createWriteStream(<span class="string">'temp.txt'</span>)</span><br><span class="line">  readSream.pipe(writeStream)</span><br><span class="line">  <span class="keyword">return</span> readStream</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exports.stream = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> readStream = fs.createReadStream(<span class="string">'package,json'</span>)</span><br><span class="line">  <span class="keyword">const</span> writeStream = fs.createWriteStream(<span class="string">'temp.txt'</span>)</span><br><span class="line">  readSream.pipe(writeStream)</span><br><span class="line">  readStream.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">    done()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="13-Gulp-构建过程核心工作原理"><a href="#13-Gulp-构建过程核心工作原理" class="headerlink" title="13.Gulp 构建过程核心工作原理"></a>13.Gulp 构建过程核心工作原理</h3><ul>
<li>读取流 =&gt; 转换流 =&gt; 写入流</li>
<li>The streaming build system</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; Transform &#125; = <span class="built_in">require</span>(<span class="string">'stream'</span>)</span><br><span class="line">exports.default = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 文件读取流</span></span><br><span class="line">  <span class="keyword">const</span> read = fs.createReadStream(<span class="string">'normalize.css'</span>)</span><br><span class="line">  <span class="comment">// 文件转换流</span></span><br><span class="line">  <span class="keyword">const</span> transform = <span class="keyword">new</span> Transform(&#123;</span><br><span class="line">    transform: <span class="function">(<span class="params">chunk, encoding, callback</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> input = chunk.toString()</span><br><span class="line">      <span class="keyword">const</span> output = input.replace(<span class="regexp">/\s+/g</span>, <span class="string">''</span>).repalce(<span class="regexp">/\/\*.+?\*\//g</span>,<span class="string">''</span>)</span><br><span class="line">      callback(<span class="literal">null</span>, output)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 文件写入流</span></span><br><span class="line">  <span class="keyword">const</span> write = fs.createWriteStream(<span class="string">'normalize.min.css'</span>)</span><br><span class="line">  <span class="comment">// 把读取出来的文件流导入写入文件流</span></span><br><span class="line">  read</span><br><span class="line">  .pipe(transform)</span><br><span class="line">  .pipe(write)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> read</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="14-Gulp-文件操作-API"><a href="#14-Gulp-文件操作-API" class="headerlink" title="14.Gulp 文件操作 API"></a>14.Gulp 文件操作 API</h3><ul>
<li>yarn add gulp-clean-css –dev</li>
<li>yarn add gulp-rename –dev</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest &#125; = <span class="built_in">require</span>(<span class="string">'gulp'</span>)</span><br><span class="line"><span class="keyword">const</span> cleanCss = <span class="built_in">require</span>(<span class="string">'gulp-clean-css'</span>)</span><br><span class="line"><span class="keyword">const</span> rename = <span class="built_in">require</span>(<span class="string">'gulp-rename'</span>)</span><br><span class="line">exports.default = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> src(<span class="string">'src/*.css'</span>)</span><br><span class="line">  .pipe(cleanCss())</span><br><span class="line">  .pipe(rename(&#123;<span class="attr">extname</span>: <span class="string">'.min.css'</span>&#125;))</span><br><span class="line">  .pipe(dest(<span class="string">'dist'</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="15-Gulp-案例-样式编译"><a href="#15-Gulp-案例-样式编译" class="headerlink" title="15.Gulp 案例-样式编译"></a>15.Gulp 案例-样式编译</h3><ul>
<li>略</li>
</ul>
<h3 id="16-Gulp-案例-脚本编译"><a href="#16-Gulp-案例-脚本编译" class="headerlink" title="16.Gulp 案例-脚本编译"></a>16.Gulp 案例-脚本编译</h3><ul>
<li>略</li>
</ul>
<h3 id="17-Gulp-案例-页面模板编译"><a href="#17-Gulp-案例-页面模板编译" class="headerlink" title="17.Gulp 案例-页面模板编译"></a>17.Gulp 案例-页面模板编译</h3><ul>
<li>略</li>
</ul>
<h3 id="18-Gulp-案例-图片和字体文件转换"><a href="#18-Gulp-案例-图片和字体文件转换" class="headerlink" title="18.Gulp 案例-图片和字体文件转换"></a>18.Gulp 案例-图片和字体文件转换</h3><ul>
<li>略</li>
</ul>
<h3 id="19-Gulp-案例-其它文件及文件清除"><a href="#19-Gulp-案例-其它文件及文件清除" class="headerlink" title="19.Gulp 案例-其它文件及文件清除"></a>19.Gulp 案例-其它文件及文件清除</h3><ul>
<li>略</li>
</ul>
<h3 id="20-Gulp-案例-自动加载插件"><a href="#20-Gulp-案例-自动加载插件" class="headerlink" title="20.Gulp 案例-自动加载插件"></a>20.Gulp 案例-自动加载插件</h3><ul>
<li>略</li>
</ul>
<h3 id="21-Gulp-案例-开发服务器"><a href="#21-Gulp-案例-开发服务器" class="headerlink" title="21.Gulp 案例-开发服务器"></a>21.Gulp 案例-开发服务器</h3><ul>
<li>略</li>
</ul>
<h3 id="22-Gulp-案例-监听变化以及构建优化"><a href="#22-Gulp-案例-监听变化以及构建优化" class="headerlink" title="22.Gulp 案例-监听变化以及构建优化"></a>22.Gulp 案例-监听变化以及构建优化</h3><ul>
<li>略</li>
</ul>
<h3 id="23-Gulp-案例-useref文件引用处理"><a href="#23-Gulp-案例-useref文件引用处理" class="headerlink" title="23.Gulp 案例-useref文件引用处理"></a>23.Gulp 案例-useref文件引用处理</h3><ul>
<li>略</li>
</ul>
<h3 id="24-Gulp-案例-文件压缩"><a href="#24-Gulp-案例-文件压缩" class="headerlink" title="24.Gulp 案例-文件压缩"></a>24.Gulp 案例-文件压缩</h3><ul>
<li>略</li>
</ul>
<h3 id="25-Gulp-案例-重新规划构建过程"><a href="#25-Gulp-案例-重新规划构建过程" class="headerlink" title="25.Gulp 案例-重新规划构建过程"></a>25.Gulp 案例-重新规划构建过程</h3><ul>
<li>略</li>
</ul>
<h3 id="26-Gulp-案例-补充"><a href="#26-Gulp-案例-补充" class="headerlink" title="26.Gulp 案例-补充"></a>26.Gulp 案例-补充</h3><ul>
<li>略</li>
</ul>
<h3 id="27-封装工作流-准备"><a href="#27-封装工作流-准备" class="headerlink" title="27.封装工作流-准备"></a>27.封装工作流-准备</h3><ul>
<li>略</li>
</ul>
<h3 id="28-封装工作流-提取-gulpfile"><a href="#28-封装工作流-提取-gulpfile" class="headerlink" title="28.封装工作流-提取 gulpfile"></a>28.封装工作流-提取 gulpfile</h3><ul>
<li>略</li>
</ul>
<h3 id="29-封装工作流-解决模块中的问题"><a href="#29-封装工作流-解决模块中的问题" class="headerlink" title="29.封装工作流-解决模块中的问题"></a>29.封装工作流-解决模块中的问题</h3><ul>
<li>略</li>
</ul>
<h3 id="30-封装工作流-抽象路径配置"><a href="#30-封装工作流-抽象路径配置" class="headerlink" title="30.封装工作流-抽象路径配置"></a>30.封装工作流-抽象路径配置</h3><ul>
<li>略</li>
</ul>
<h3 id="31-封装工作流-包装-Gulp-Cli"><a href="#31-封装工作流-包装-Gulp-Cli" class="headerlink" title="31.封装工作流-包装 Gulp Cli"></a>31.封装工作流-包装 Gulp Cli</h3><ul>
<li>略</li>
</ul>
<h3 id="32-封装工作流-发布并使用模块"><a href="#32-封装工作流-发布并使用模块" class="headerlink" title="32.封装工作流-发布并使用模块"></a>32.封装工作流-发布并使用模块</h3><ul>
<li>略</li>
</ul>
<h3 id="33-封装工作流-总结"><a href="#33-封装工作流-总结" class="headerlink" title="33.封装工作流-总结"></a>33.封装工作流-总结</h3><ul>
<li>略</li>
</ul>
<h3 id="34-FIS-的基本使用"><a href="#34-FIS-的基本使用" class="headerlink" title="34.FIS 的基本使用"></a>34.FIS 的基本使用</h3><ul>
<li>略</li>
</ul>
<h3 id="35-FIS-编译与压缩"><a href="#35-FIS-编译与压缩" class="headerlink" title="35.FIS 编译与压缩"></a>35.FIS 编译与压缩</h3><ul>
<li>略</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/11/04/27/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FY">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旋の飞羽">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/11/04/27/" itemprop="url">学习笔记 ----- 【JavaScript 深度剖析】ES 新特性与 TypeScript、JS 性能优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-11-04T00:00:00+08:00">
                2020-11-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <blockquote>
<p>作者：FY<br>引用请标明出处</p>
</blockquote>
<h1 id="Part-1-·-模块二-ES-新特性与-TypeScript、JS-性能优化"><a href="#Part-1-·-模块二-ES-新特性与-TypeScript、JS-性能优化" class="headerlink" title="Part 1 · 模块二 ES 新特性与 TypeScript、JS 性能优化"></a>Part 1 · 模块二 ES 新特性与 TypeScript、JS 性能优化</h1><h2 id="任务一：ECMAScript-新特性"><a href="#任务一：ECMAScript-新特性" class="headerlink" title="任务一：ECMAScript 新特性"></a>任务一：ECMAScript 新特性</h2><h3 id="1-课程介绍"><a href="#1-课程介绍" class="headerlink" title="1.课程介绍"></a>1.课程介绍</h3><ul>
<li>ECMAScript 与 JavaScript</li>
<li>ECMAScript 的发展过程</li>
<li>ECMAScript2015 的新特性</li>
<li>And more…</li>
</ul>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2020/11/04/27/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="accessibility.prev_page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="accessibility.next_page"></i></a>
  </nav>

          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="FY" />
            
              <p class="site-author-name" itemprop="name">FY</p>
              <p class="site-description motion-element" itemprop="description">Just Be Yourself</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">47</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/xuanfeiyu" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">FY</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
